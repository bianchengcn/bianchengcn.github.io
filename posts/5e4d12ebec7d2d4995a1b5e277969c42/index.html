<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Word转PDF简单示例，分别在windows和centos中完成转换 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Word转PDF简单示例，分别在windows和centos中完成转换" />
<meta property="og:description" content="概述 本篇博客以简单的示例代码分别在Windows和Linux环境下完成Word转PDF的文档转换。
文章提供SpringBoot &#43; Vue3的示例代码。
文章为什么要分为Windows和Linux环境？
因为在如下提供的Windows后端示例代码中使用documents4j库做转换，此库需要调用命令行工具，并且需要安装Microsoft Word，但在Linux上无法安装Microsoft Word，因此如下提供了两份后端代码。
过程
前端传入word文件 -&gt; 后端处理 -&gt; 返回转换后的字节数组（byte[]）
Windows后端代码 maven依赖 &lt;dependency&gt; &lt;groupId&gt;com.documents4j&lt;/groupId&gt; &lt;artifactId&gt;documents4j-local&lt;/artifactId&gt; &lt;version&gt;1.0.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.documents4j&lt;/groupId&gt; &lt;artifactId&gt;documents4j-transformer-msoffice-word&lt;/artifactId&gt; &lt;version&gt;1.0.3&lt;/version&gt; &lt;/dependency&gt; 示例代码 // controller接口 @PostMapping(&#34;/upload&#34;) public byte[] convertDocxToPdf(@RequestParam(&#34;file&#34;) MultipartFile file) throws IOException { if (!file.getOriginalFilename().endsWith(&#34;.docx&#34;)) { throw new IllegalArgumentException(&#34;文件类型不支持&#34;); } try (InputStream docxInputStream = file.getInputStream(); ByteArrayOutputStream outputStream = new ByteArrayOutputStream()) { IConverter converter = LocalConverter.builder().build(); converter.convert(docxInputStream).as(DocumentType.DOCX).to(outputStream).as(DocumentType.PDF).execute(); return outputStream.toByteArray(); } } CentOS后端代码 maven依赖 &lt;dependency&gt; &lt;groupId&gt;org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/5e4d12ebec7d2d4995a1b5e277969c42/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-13T23:05:03+08:00" />
<meta property="article:modified_time" content="2023-11-13T23:05:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Word转PDF简单示例，分别在windows和centos中完成转换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>概述</h2> 
<p>本篇博客以简单的示例代码分别在Windows和Linux环境下完成Word转PDF的文档转换。</p> 
<p>文章提供<span style="color:#fe2c24;"><strong>SpringBoot + Vue3</strong></span>的示例代码。</p> 
<blockquote> 
 <p><strong>文章为什么要分为Windows和Linux环境？</strong></p> 
 <p>因为在如下提供的Windows后端示例代码中使用<strong><span style="color:#fe2c24;">documents4j</span></strong>库做转换，此库需要调用命令行工具，并且需要安装Microsoft Word，但在Linux上无法安装Microsoft Word，因此如下提供了两份后端代码。</p> 
</blockquote> 
<blockquote> 
 <p> <strong>过程</strong></p> 
 <p>前端传入word文件 -&gt; 后端处理 -&gt; 返回转换后的字节数组（byte[]）</p> 
</blockquote> 
<h2>Windows后端代码</h2> 
<h3>maven依赖</h3> 
<pre><code class="language-XML">
&lt;dependency&gt;
    &lt;groupId&gt;com.documents4j&lt;/groupId&gt;
    &lt;artifactId&gt;documents4j-local&lt;/artifactId&gt;
    &lt;version&gt;1.0.3&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.documents4j&lt;/groupId&gt;
    &lt;artifactId&gt;documents4j-transformer-msoffice-word&lt;/artifactId&gt;
    &lt;version&gt;1.0.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<h3> 示例代码</h3> 
<pre><code class="language-java">// controller接口
@PostMapping("/upload")
    public byte[] convertDocxToPdf(@RequestParam("file") MultipartFile file) throws IOException {
        if (!file.getOriginalFilename().endsWith(".docx")) {
            throw new IllegalArgumentException("文件类型不支持");
        }

        try (InputStream docxInputStream = file.getInputStream();
             ByteArrayOutputStream outputStream = new ByteArrayOutputStream()) {

            IConverter converter = LocalConverter.builder().build();
            converter.convert(docxInputStream).as(DocumentType.DOCX).to(outputStream).as(DocumentType.PDF).execute();

            return outputStream.toByteArray();
        }
    }</code></pre> 
<h2>CentOS后端代码</h2> 
<h3>maven依赖</h3> 
<pre><code class="language-XML">&lt;dependency&gt;
    &lt;groupId&gt;org.jodconverter&lt;/groupId&gt;
    &lt;artifactId&gt;jodconverter-local&lt;/artifactId&gt;
    &lt;version&gt;4.4.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<h3>示例代码</h3> 
<pre><code class="language-java">    @PostMapping(value = "/upload", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    public byte[] uploadFile(@RequestParam("file") MultipartFile file) throws IOException, OfficeException {
        if (file.getOriginalFilename().endsWith(".docx")) {
            LocalOfficeManager officeManager = LocalOfficeManager.install();
            try {
                officeManager.start();
                DocumentConverter converter = LocalConverter.builder().officeManager(officeManager).build();
                ByteArrayOutputStream out = new ByteArrayOutputStream();
                converter.convert(file.getInputStream()).as(DefaultDocumentFormatRegistry.DOCX).to(out).as(DefaultDocumentFormatRegistry.PDF).execute();
                return out.toByteArray();
            } finally {
                OfficeUtils.stopQuietly(officeManager);
            }
        } else {
            throw new IOException("文件类型不支持");
        }
    }</code></pre> 
<p><span style="color:#fe2c24;"><strong>*** 当使用上方的代码进行word转pdf之后，输出的很大可能会出现中文文字不能正确显示，文字全部变成小矩形框。</strong></span></p> 
<p>这是因为<span style="color:#fe2c24;"><strong>在linux上没有中文字体库</strong></span>导致的。</p> 
<h3><strong><span style="background-color:#d4e9d5;"> 在centos7中安装中文字体库 </span></strong></h3> 
<p>1.首先检查安装所需要的工具</p> 
<blockquote> 
 <p><strong>yum -y install fontconfig</strong></p> 
 <p></p> 
 <p><strong>yum -y install ttmkfdir</strong></p> 
</blockquote> 
<p> 2.之后<strong>检查/usr/share目录是否有fonts 和 fontconfig</strong></p> 
<p><img alt="" height="199" src="https://images2.imgbox.com/fa/af/YCIKXawf_o.png" width="752"></p> 
<p>3.创建chinese目录，用于存放我们需要的字体</p> 
<p><strong>在/usr/share/fonts下创建chinese</strong></p> 
<p><img alt="" height="222" src="https://images2.imgbox.com/b0/a3/AuUee3QE_o.png" width="590"></p> 
<p>4.下载需要的字体</p> 
<p>我们到自己的<strong>windows电脑上查找想要的字体，访问<span style="color:#fe2c24;">C:\Windows\Fonts</span></strong></p> 
<p><img alt="" height="302" src="https://images2.imgbox.com/da/fb/r9uZIX4x_o.png" width="563"></p> 
<p>可以搜索自己文档转换过程中需要的字体，例如：宋体</p> 
<p><img alt="" height="573" src="https://images2.imgbox.com/89/ba/MPMaoOpK_o.png" width="1200"></p> 
<p><strong>将字体拷贝放到centos的/usr/share/fonts/chinese目录中，并修改chinese目录的权限：</strong></p> 
<blockquote> 
 <p><strong>chmod -R 755 /usr/share/fonts/chinese</strong></p> 
</blockquote> 
<p>5.执行命令，生成 TrueType 字体的字体度量</p> 
<blockquote> 
 <p><strong>ttmkfdir -e /usr/share/X11/fonts/encodings/encodings.dir</strong></p> 
</blockquote> 
<p>6.<strong>配置刚才创建中文字体目录</strong>，使之生效即可。</p> 
<blockquote> 
 <p><strong>vi /etc/fonts/fonts.conf </strong></p> 
</blockquote> 
<p><img alt="" height="246" src="https://images2.imgbox.com/5f/bb/IQcqE82r_o.png" width="1071"></p> 
<p>7.执行命令，刷新字体缓存</p> 
<blockquote> 
 <p><strong>fc-cache </strong></p> 
</blockquote> 
<p> 至此，重新访问后端服务进行word转pdf会发现字体成功显示。</p> 
<h2>前端测试代码</h2> 
<p><strong><span style="background-color:#edf6e8;"> 在此提供与后端代码配套测试的前端代码（vue3） </span></strong></p> 
<pre><code class="language-javascript">&lt;template&gt;
  &lt;div&gt;
    &lt;div id="my_ipt"&gt;
  &lt;label for="ipt" class="upload-button"&gt;上传文件（Word 或 PDF）&lt;/label&gt;
  &lt;input id="ipt" type="file" @change="uploadFile" accept=".pdf,.docx"&gt;
&lt;/div&gt;
    &lt;hr&gt;
    &lt;iframe v-if="fileSrc" :src="fileSrc" width="100%" height="600px"&gt;&lt;/iframe&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue';
import axios from 'axios'; 

const fileSrc = ref(null);

const uploadFile = async (event) =&gt; {
  const file = event.target.files[0];
  if (file) {
    if (file.type === 'application/pdf') {
      fileSrc.value = URL.createObjectURL(file);
    } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
      const formData = new FormData();
      formData.append('file', file);
      const response = await axios.post('/doc/upload', formData, {
        responseType: 'blob',
        headers: {
          'Content-Type': 'multipart/form-data'
        }
      });
      fileSrc.value = URL.createObjectURL(new Blob([response.data], { type: 'application/pdf' }));
    } 
  }
};
&lt;/script&gt;

&lt;style scoped&gt;
.upload-button {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  cursor: pointer;
  border-radius: 5px;
}

.upload-button:hover {
  background-color: #3e8e41;
}

&lt;/style&gt;</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9cd63314577a495a61689895ffa34d16/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Element-Ui el-table 动态添加行</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2542a1cf62e9d8d796a94c48adb6c699/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深入理解Java Stream流</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>