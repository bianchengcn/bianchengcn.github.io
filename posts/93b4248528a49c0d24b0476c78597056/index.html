<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>占位图和图片懒加载项目实战详解 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="占位图和图片懒加载项目实战详解" />
<meta property="og:description" content="占位图（兜底图）： 真实图片太大还没有加载完之前先用一张占位图表示这个位置将来会有图片或者说明这个位置是有图片的但是不知道什么原因真正的图片没有加载出来用户只能看到这张占位图；
什么是图片懒加载： 懒加载也就是延迟加载，当访问一个页面的时候，先把img元素渲染出来，但是不给它真正的src地址，只有当用户需要看到真正图片的时候，才设置图片正真的路径，让图片显示出来。
为什么要使用懒加载： 在一个页面中，假设有20张图片，每张为100kb，用户在不点滚动条的时候看到的只有4张，如果这20张图片都设置了真正的src，那么当页面首次加载的时候浏览器会立即请求这20张图片资源，需要2000kb的流量； 但是我们做懒加载只请求用户看到的4张图片的话，浏览器只请求这4张图片资源，需要的流量只有400kb。这种手段可以大大减少首屏时间。
懒加载的实现步骤： 1)首先，不要将真正的图片地址放到src属性中，此时放到src中的是一张兜底图，而是放到其它属性(picAddress)中。 2)页面加载完成后，根据scrollTop判断图片是否在用户的视野内，如果在，则将picAddress属性中的值取出存放到src属性中。 3)在滚动事件中重复判断图片是否进入视野，如果进入，则将picAddress属性中的值取出存放到src属性中。
案例： index.html
&lt;html&gt; &lt;head&gt; &lt;meta charset=&#34;utf-8&#34;&gt; &lt;/head&gt; &lt;body&gt; &lt;style&gt; body{ text-align: center; } .game-detail-logo{ width: 750px; height: 430px; text-align: center; margin-top:30px; } &lt;/style&gt; &lt;img src=&#34;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg&#34; class=&#34;game-detail-logo lazyLoadImg&#34; picAddress=&#34;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=4003935283,4035293154&amp;fm=27&amp;gp=0.jpg&#34;&gt; &lt;img src=&#34;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg&#34; class=&#34;game-detail-logo lazyLoadImg&#34; picAddress=&#34;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1535003204948&amp;di=7f297fc3bd01dcbca58f47c470ae9b9e&amp;imgtype=0&amp;src=http%3A%2F%2Fpic50.nipic.com%2Ffile%2F20141019%2F19104397_104929568000_2.jpg&#34;&gt; &lt;img src=&#34;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg&#34; class=&#34;game-detail-logo lazyLoadImg&#34; picAddress=&#34;http://i1.hdslb.com/bfs/archive/062705867631af9f8e83aadf6d8a1f935b25cbc2.jpg&#34;&gt; &lt;img src=&#34;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg&#34; class=&#34;game-detail-logo lazyLoadImg&#34; picAddress=&#34;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2390937513,1169699994&amp;fm=27&amp;gp=0.jpg&#34;&gt; &lt;img src=&#34;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg&#34; class=&#34;game-detail-logo lazyLoadImg&#34; picAddress=&#34;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6169699994&amp;fm=27&amp;gp=0.jpg&#34;&gt; &lt;img src=&#34;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg&#34; class=&#34;game-detail-logo lazyLoadImg&#34; picAddress=&#34;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3947968217,2342505746&amp;fm=27&amp;gp=0.jpg&#34;&gt; &lt;/body&gt; &lt;script src=&#34;http://libs.baidu.com/jquery/2.0.0/jquery.min.js&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/93b4248528a49c0d24b0476c78597056/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-23T14:40:37+08:00" />
<meta property="article:modified_time" content="2018-08-23T14:40:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">占位图和图片懒加载项目实战详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 id="占位图兜底图">占位图（兜底图）：</h3> 
<p>真实图片太大还没有加载完之前先用一张占位图表示这个位置将来会有图片或者说明这个位置是有图片的但是不知道什么原因真正的图片没有加载出来用户只能看到这张占位图；</p> 
<h3 id="什么是图片懒加载">什么是图片懒加载：</h3> 
<p>懒加载也就是延迟加载，当访问一个页面的时候，先把img元素渲染出来，但是不给它真正的src地址，只有当用户需要看到真正图片的时候，才设置图片正真的路径，让图片显示出来。</p> 
<h3 id="为什么要使用懒加载">为什么要使用懒加载：</h3> 
<p>在一个页面中，假设有20张图片，每张为100kb，用户在不点滚动条的时候看到的只有4张，如果这20张图片都设置了真正的src，那么当页面首次加载的时候浏览器会立即请求这20张图片资源，需要2000kb的流量； <br> 但是我们做懒加载只请求用户看到的4张图片的话，浏览器只请求这4张图片资源，需要的流量只有400kb。这种手段可以大大减少首屏时间。</p> 
<h3 id="懒加载的实现步骤">懒加载的实现步骤：</h3> 
<p>1)首先，不要将真正的图片地址放到src属性中，此时放到src中的是一张兜底图，而是放到其它属性(picAddress)中。 <br> 2)页面加载完成后，根据scrollTop判断图片是否在用户的视野内，如果在，则将picAddress属性中的值取出存放到src属性中。 <br> 3)在滚动事件中重复判断图片是否进入视野，如果进入，则将picAddress属性中的值取出存放到src属性中。</p> 
<h3 id="案例">案例：</h3> 
<p><img src="https://images2.imgbox.com/ab/6b/VnIgxdl8_o.png" alt="这里写图片描述" title=""></p> 
<p>index.html</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
            <span class="hljs-tag">body</span><span class="hljs-rules">{
                <span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value"> center</span></span>;
            <span class="hljs-rule">}</span></span>
            <span class="hljs-class">.game-detail-logo</span><span class="hljs-rules">{
                <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">750</span>px</span></span>;
                <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">430</span>px</span></span>;
                <span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value"> center</span></span>;
                <span class="hljs-rule"><span class="hljs-attribute">margin-top</span>:<span class="hljs-value"><span class="hljs-number">30</span>px</span></span>;
            <span class="hljs-rule">}</span></span>
        </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"game-detail-logo lazyLoadImg"</span> <span class="hljs-attribute">picAddress</span>=<span class="hljs-value">"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=4003935283,4035293154&amp;fm=27&amp;gp=0.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"game-detail-logo lazyLoadImg"</span> <span class="hljs-attribute">picAddress</span>=<span class="hljs-value">"https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1535003204948&amp;di=7f297fc3bd01dcbca58f47c470ae9b9e&amp;imgtype=0&amp;src=http%3A%2F%2Fpic50.nipic.com%2Ffile%2F20141019%2F19104397_104929568000_2.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"game-detail-logo lazyLoadImg"</span> <span class="hljs-attribute">picAddress</span>=<span class="hljs-value">"http://i1.hdslb.com/bfs/archive/062705867631af9f8e83aadf6d8a1f935b25cbc2.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"game-detail-logo lazyLoadImg"</span> <span class="hljs-attribute">picAddress</span>=<span class="hljs-value">"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2390937513,1169699994&amp;fm=27&amp;gp=0.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"game-detail-logo lazyLoadImg"</span> <span class="hljs-attribute">picAddress</span>=<span class="hljs-value">"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6169699994&amp;fm=27&amp;gp=0.jpg"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4259389730,3152819071&amp;fm=26&amp;gp=0.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"game-detail-logo lazyLoadImg"</span> <span class="hljs-attribute">picAddress</span>=<span class="hljs-value">"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3947968217,2342505746&amp;fm=27&amp;gp=0.jpg"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"http://libs.baidu.com/jquery/2.0.0/jquery.min.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"lazyLoadImg.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></code></pre> 
<p>lazyLoadImg.js</p> 
<pre class="prettyprint"><code class=" hljs php">
<span class="hljs-comment">/* 
*<span class="hljs-phpdoc"> @example</span>
* &lt;img src="" class="lazyLoadImg" picAddress=""&gt;
*<span class="hljs-phpdoc"> @param</span> src里面写的是占位图或者说兜底图地址（一张默认填充图）
*<span class="hljs-phpdoc"> @param</span> class="lazyLoadImg" 是必须的标识
*<span class="hljs-phpdoc"> @param</span> picAddress里面写的是真正需要懒加载的图片地址
*/</span>
<span class="hljs-keyword">const</span> lazyLoadImg = {
  initConfig() {
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">self</span> = this;
    <span class="hljs-keyword">self</span>.imgObject.srcFlag = <span class="hljs-string">'picAddress'</span>; <span class="hljs-comment">// 图片地址</span>
    <span class="hljs-keyword">self</span>.imgObject.class = <span class="hljs-string">'lazyLoadImg'</span>; <span class="hljs-comment">// 惰性加载的图片需要添加的class</span>
    <span class="hljs-keyword">self</span>.imgObject.sensitivity = <span class="hljs-number">40</span>; <span class="hljs-comment">// 鼠标滚动敏感度，该值越小，惰性越强（加载越少）</span>
    <span class="hljs-keyword">self</span>.imgObject.init();
  },
  imgObject: {
    trigger() {
      <span class="hljs-keyword">const</span> <span class="hljs-keyword">self</span> = this;
      <span class="hljs-keyword">const</span> eventType = (<span class="hljs-keyword">self</span>.isPhone &amp;&amp; <span class="hljs-string">'touchend'</span>) || <span class="hljs-string">'scroll'</span>;
      <span class="hljs-keyword">self</span>.imgListData = $(<span class="hljs-string">'img.'</span> + <span class="hljs-keyword">self</span>.class + <span class="hljs-string">''</span>);
      $(window).trigger(eventType);
    },
    init() {
      <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = this;
      $(window).on(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        <span class="hljs-keyword">self</span>.isLoadImg();
      });
      <span class="hljs-keyword">self</span>.trigger();
    },
    isLoadImg() {
      <span class="hljs-keyword">const</span> <span class="hljs-keyword">self</span> = this;
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadNeedImg</span><span class="hljs-params">(img)</span> {<!-- --></span> <span class="hljs-comment">// 判断哪些img元素需要加载</span>
        <span class="hljs-keyword">const</span> windowPageYOffset = window.pageYOffset; <span class="hljs-comment">// 滚动条距离窗口顶部的偏移量</span>
        <span class="hljs-keyword">const</span> offsetAddInner = window.pageYOffset + window.innerHeight; <span class="hljs-comment">// window.innerHeight返回窗口的文档显示区的高度</span>
        <span class="hljs-keyword">const</span> imgOffsetTop = img.offset().top; <span class="hljs-comment">// 当前img元素距离窗口顶部的偏移量</span>
        <span class="hljs-keyword">return</span> (
          imgOffsetTop &gt;= windowPageYOffset &amp;&amp; <span class="hljs-comment">// 确保img元素在窗口内</span>
          imgOffsetTop - <span class="hljs-keyword">self</span>.sensitivity &lt;= offsetAddInner <span class="hljs-comment">//当前img元素是不是在窗口可见范围内，不可见返回:false</span>
        );
      }
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadImg</span><span class="hljs-params">(img, index)</span> {<!-- --></span>
        <span class="hljs-keyword">const</span> imgUrl = img.attr(<span class="hljs-keyword">self</span>.srcFlag);
        <span class="hljs-keyword">const</span> imgLazy = img.attr(<span class="hljs-string">'src'</span>);
        img.attr(<span class="hljs-string">'src'</span>, imgUrl);
        img[<span class="hljs-number">0</span>].onload ||  <span class="hljs-comment">// 开始向服务器请求加载图片</span>
          ((img[<span class="hljs-number">0</span>].onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
            $(this)
              .removeClass(<span class="hljs-keyword">self</span>.class)
              .removeAttr(<span class="hljs-keyword">self</span>.srcFlag),
            (<span class="hljs-keyword">self</span>.imgListData[index] = <span class="hljs-keyword">null</span>),
            (this.onerror = this.onload = <span class="hljs-keyword">null</span>);
          }),
            (img[<span class="hljs-number">0</span>].onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
              (this.src = imgLazy),
              $(this)
                .removeClass(<span class="hljs-keyword">self</span>.class)
                .removeAttr(<span class="hljs-keyword">self</span>.srcFlag),
              (<span class="hljs-keyword">self</span>.imgListData[index] = <span class="hljs-keyword">null</span>),
              (this.onerror = this.onload = <span class="hljs-keyword">null</span>);
            }));
      }
      <span class="hljs-keyword">self</span>.imgListData.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, val)</span> {<!-- --></span>
        <span class="hljs-keyword">if</span> (!val) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">const</span> img = $(val);
        <span class="hljs-keyword">if</span> (!loadNeedImg(img)) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">const</span> aa = img.attr(<span class="hljs-keyword">self</span>.srcFlag);
        <span class="hljs-keyword">if</span> (!img.attr(<span class="hljs-keyword">self</span>.srcFlag)) <span class="hljs-keyword">return</span>;<span class="hljs-comment">// 判断是否有规定的picAddress属性，没有则退出当次循环</span>
        loadImg(img, index);
      });
    },
  },
};
lazyLoadImg.initConfig();</code></pre> 
<h3 id="案例运行注意点">案例运行注意点：</h3> 
<p>1）将浏览器变成手机调试模式，Chrome最佳 <br> 2）手机模式后高度不能太高（越矮越好），需要出现滚动条，以便滚动下去测试后面的图片 <br> 3）网络限速将online设成mid-tier mobile或者low-end mobile更容易看到效果</p> 
<h3 id="案例效果">案例效果：</h3> 
<p>首次运行时，会先出现占位图（兜底图)，然后加载其他图片；当滚动到后面的图片时再按需请求对应的图片资源</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b5cba0fc54157a122831e033b95bcc89/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">echarts微信小程序图表不跟随滑动问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fa3e875ddea5827bd0e88339bc352749/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FPGA实战-管脚分配相关及设置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>