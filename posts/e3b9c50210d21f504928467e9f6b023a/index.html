<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>动态链接库函数启动器Rundll32 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="动态链接库函数启动器Rundll32" />
<meta property="og:description" content="HMODULE g_hmodDLL;
BOOL APIENTRY DllMain( HANDLE hModule, DWORD ul_reason_for_call, LPVOID lpReserved
)
{
if (ul_reason_for_call == DLL_PROCESS_ATTACH)
g_hmodDLL =HMODULE(hModule);
return TRUE;
}
extern &#34;C&#34; __declspec(dllexport) void CALLBACK MagicDel(HWND,
HINSTANCE,
LPTSTR lpCmdLine,
int)
{
// delete the executable file that created this process
Sleep(2000);
DeleteFile(lpCmdLine);
// delete ourself
char filenameDLL[MAX_PATH];
GetModuleFileName(g_hmodDLL, filenameDLL, sizeof(filenameDLL));
__asm
{
lea eax, filenameDLL
push 0
push 0
push eax
push ExitProcess
push g_hmodDLL
push DeleteFile" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/e3b9c50210d21f504928467e9f6b023a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2010-05-26T10:40:00+08:00" />
<meta property="article:modified_time" content="2010-05-26T10:40:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">动态链接库函数启动器Rundll32</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><br>HMODULE g_hmodDLL;</p> 
<p>BOOL APIENTRY DllMain( HANDLE hModule, <br>                       DWORD  ul_reason_for_call, <br>                       LPVOID lpReserved<br>      )<br>{<!-- --><br> if (ul_reason_for_call == DLL_PROCESS_ATTACH)<br>        g_hmodDLL =HMODULE(hModule);</p> 
<p>    return TRUE;<br>}</p> 
<p> </p> 
<p>extern "C" __declspec(dllexport) void CALLBACK MagicDel(HWND,<br>                                                        HINSTANCE,<br>                                                        LPTSTR lpCmdLine,<br>                                                        int)<br>{<!-- --><br>    // delete the executable file that created this process<br>    Sleep(2000);<br>    DeleteFile(lpCmdLine);<br> <br>    // delete ourself<br>    char filenameDLL[MAX_PATH];<br>    GetModuleFileName(g_hmodDLL, filenameDLL, sizeof(filenameDLL));<br> <br>    __asm<br>    {<!-- --><br>   lea     eax, filenameDLL<br>   push    0<br>   push    0<br>   push    eax<br>   push    ExitProcess<br>   push    g_hmodDLL<br>   push    DeleteFile<br>   push    FreeLibrary<br>   ret<br>    }<br>}</p> 
<p>extern   "C"   __declspec(dllexport) void __cdecl   MyEntry(HWND   hwnd,                 //   handle   to   owner   window   <br>               HINSTANCE   hinst,     //   instance   handle   for   the   DLL   <br>               LPTSTR   lpCmdLine,   //   string   the   DLL   will   parse   <br>               int   nCmdShow             //   show   state   <br>               )   <br>{   <br> MessageBox(NULL,lpCmdLine,"",MB_OK);   <br>}   </p> 
<p> </p> 
<p> 调用方法：<br> rundll32.exe rdTest.dll,MyEntry "hello!"</p> 
<p> </p> 
<p>The Run DLL utility (Rundll32.exe) included in Windows enables you to call functions exported from a 32-bit DLL. These functions must have the following syntax:</p> 
<pre class="syntax"><strong>void CALLBACK EntryPoint(
</strong>  <strong>HWND</strong> <em>hwnd</em>,        // handle to owner window
  <strong>HINSTANCE</strong> <em>hinst</em>,  // instance handle for the DLL
  <strong>LPTSTR</strong> <em>lpCmdLine</em>, // string the DLL will parse
  <strong>int</strong> <em>nCmdShow</em>      // show state
<strong>);</strong></pre> 
<p>Note that <strong>EntryPoint</strong> is a placeholder for the actual function name. For a list of possible show states, see <a rel="nofollow"><strong>WinMain</strong></a>. </p> 
<p>The following is the command-line syntax for Rundll32:</p> 
<pre class="syntax">rundll32 <em><a class="synParam">DllName</a></em>,<em><a class="synParam">FunctionName</a></em> [<em><a class="synParam">Arguments</a></em>]</pre> 
<dl> 
  
  <em>DllName</em> 
  
 <dd>
   Specifies the name of the DLL. The name cannot contain spaces, commas, or quotation marks. The utility searches for the DLL using the search criteria documented for the 
  <a rel="nofollow"><strong>LoadLibrary</strong></a> function. Therefore, it is best to use the short name and provide a full path for the DLL. 
 </dd> 
  
  <em>FunctionName</em> 
  
 <dd>
   Specifies the name of the function to call in 
  <em>DllName</em>. Requires a comma (without no spaces) between 
  <em>DllName</em> and 
  <em>FunctionName</em>. 
 </dd> 
  
  <em>Arguments</em> 
  
 <dd>
   Optional arguments for 
  <em>FunctionName</em>. 
 </dd> 
</dl> 
<p>Rundll32 loads the specified DLL using <strong>LoadLibrary</strong>, obtains the address of the function using the <a rel="nofollow"><strong>GetProcAddress</strong></a> function, and calls the function with the specified arguments, if any. When the function returns, Rundll32 unloads the DLL and exits.</p> 
<p><strong>Windows NT/2000:</strong> It is possible to create a Unicode version of the function. Rundll32 first tries to find a function named <strong>EntryPointW</strong>. If it cannot find this function, it tries <strong>EntryPointA</strong>, then <strong>EntryPoint</strong>. To create a DLL that supports ANSI on Windows 95/98/Me and Unicode otherwise, export two functions: <strong>EntryPointW</strong> and <strong>EntryPoint</strong>. </p> 
<p> </p> 
<p>参阅：</p> 
 
<p><a href="http://support.microsoft.com/kb/164787" rel="nofollow">http://support.microsoft.com/kb/164787</a></p> 
<p><a href="http://blogs.msdn.com/b/oldnewthing/archive/2004/01/15/58973.aspx" rel="nofollow">http://blogs.msdn.com/b/oldnewthing/archive/2004/01/15/58973.aspx</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c8d9b772ef6a6ccdddf496a28c88c788/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">.NET创建证书</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1d88ab576877f6c665604fb353e52a78/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">后台下载利器 —— 让shell退出了子进程可以继续运行</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>