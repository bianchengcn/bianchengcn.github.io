<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【驱动开发】文件系统微过滤驱动（Minifilter） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【驱动开发】文件系统微过滤驱动（Minifilter）" />
<meta property="og:description" content=" 文章目录 编程框架FLT_REGISTRATION操作回调函数集预操作回调函数回调数据包（FLT_CALLBACK_DATA）参数（FLT_IO_PARAMETER_BLOCK）状态和信息（IO_STATUS_BLOCK） 关联对象 编程框架 FltRegisterFilter 注册Minifilter驱动；使用结束后用FltUnregisterFilter卸载。
注册时，第二参数传入构建的FLT_REGISTRATION结构，主要是操作回调函数集和驱动卸载函数。FltBuildDefaultSecurityDescriptor 生成默认安全描述符。FltCreateCommunicationPort 创建通信服务器端口；使用结束后用FltCloseCommunicationPort关闭。FltStartFiltering开始过滤。当有I/O操作发生时，执行流会进入操作回调函数集。 FLT_REGISTRATION typedef struct _FLT_REGISTRATION { USHORT Size;	// 结构体大小 USHORT Version;	// 版本 FLT_REGISTRATION_FLAGS Flags;	// 标志位 const FLT_CONTEXT_REGISTRATION *ContextRegistration;	// 上下文注册 const FLT_OPERATION_REGISTRATION *OperationRegistration;	// 操作回调函数集注册！！！ PFLT_FILTER_UNLOAD_CALLBACK FilterUnloadCallback;	// 驱动卸载回调！！！ PFLT_INSTANCE_SETUP_CALLBACK InstanceSetupCallback;	// 实例安装回调 PFLT_INSTANCE_QUERY_TEARDOWN_CALLBACK InstanceQueryTeardownCallback;	// 控制实例销毁函数 PFLT_INSTANCE_TEARDOWN_CALLBACK InstanceTeardownStartCallback;	// 实例解绑定函数 PFLT_INSTANCE_TEARDOWN_CALLBACK InstanceTeardownCompleteCallback;	// 实际解绑定完成函数 PFLT_GENERATE_FILE_NAME GenerateFileNameCallback;	// 生成文件名回调 PFLT_NORMALIZE_NAME_COMPONENT NormalizeNameComponentCallback;	// 格式化名字组件回调 PFLT_NORMALIZE_CONTEXT_CLEANUP NormalizeContextCleanupCallback;	// 格式化上下文清理回调 PFLT_TRANSACTION_NOTIFICATION_CALLBACK TransactionNotificationCallback; PFLT_NORMALIZE_NAME_COMPONENT_EX NormalizeNameComponentExCallback; PFLT_SECTION_CONFLICT_NOTIFICATION_CALLBACK SectionNotificationCallback; } FLT_REGISTRATION, *PFLT_REGISTRATION; 操作回调函数集 typedef struct _FLT_OPERATION_REGISTRATION { UCHAR MajorFunction;	// IRP FLT_OPERATION_REGISTRATION_FLAGS Flags;	// 标志位：0(仅对读/写回调有用);FLTFL_OPERATION_REGISTRATION_SKIP_CACHED_IO(不过来缓冲读/写请求);FLTFL_OPERATION_REGISTRATION_SKIP_PAGING_IP(不过滤分页读/写请求) PFLT_PRE_OPERATION_CALLBACK PreOperation;	// 预操作回调函数 PFLT_POST_OPERATION_CALLBACK PostOperation;	// 后操作回调函数 PVOID Reserved1; } FLT_OPERATION_REGISTRATION, *PFLT_OPERATION_REGISTRATION; // 自定义 static CONST FLT_OPERATION_REGISTRATION OperationRegistration[] = { { IRP_MJ_CREATE,	// 文件创建 0, PrevCreate,	PostCreate,	}, { IRP_MJ_OPERATION_END }, }; 预操作回调函数 FLT_PREOP_CALLBACK_STATUS PfltPreOperationCallback( [in, out] PFLT_CALLBACK_DATA Data,	// 回调数据包，内包含这个请求相关的全部信息 [in] PCFLT_RELATED_OBJECTS FltObjects,	// 包含与当前 I/O 请求相关的对象的不透明指针 [out] PVOID *CompletionContext	// 如果该回调函数返回FLT_PREOP_SUCCESS_WITH_CALLBACK或FLT_PREOP_SYNCHRONIZE，则此参数是传递给相应操作后回调例程的可选上下文指针，否则必须为 NULL 回调数据包（FLT_CALLBACK_DATA） typedef struct _FLT_CALLBACK_DATA { FLT_CALLBACK_DATA_FLAGS Flags;	// 标志位 PETHREAD Thread;	// 线程指针 PFLT_IO_PARAMETER_BLOCK Iopb;	// 参数 IO_STATUS_BLOCK IoStatus;	// 状态和信息 struct _FLT_TAG_DATA_BUFFER *TagData;	// 重新分析点数据 union { struct { LIST_ENTRY QueueLinks; PVOID QueueContext[2]; }; PVOID FilterContext[4]; }; KPROCESSOR_MODE RequestorMode;	// 启动I/O操作的进程的执行模式 } FLT_CALLBACK_DATA, *PFLT_CALLBACK_DATA; 参数（FLT_IO_PARAMETER_BLOCK） typedef struct _FLT_IO_PARAMETER_BLOCK { ULONG IrpFlags; UCHAR MajorFunction; UCHAR MinorFunction; UCHAR OperationFlags; UCHAR Reserved; PFILE_OBJECT TargetFileObject;	// 目标文件/目录的文件对象指针 PFLT_INSTANCE TargetInstance;	// 目标Minifilter FLT_PARAMETERS Parameters; } FLT_IO_PARAMETER_BLOCK, *PFLT_IO_PARAMETER_BLOCK; typedef union _FLT_PARAMETERS { struct { PIO_SECURITY_CONTEXT SecurityContext; ULONG Options; USHORT POINTER_ALIGNMENT FileAttributes; USHORT ShareAccess; ULONG POINTER_ALIGNMENT EaLength; PVOID EaBuffer; LARGE_INTEGER AllocationSize; } Create; struct { PIO_SECURITY_CONTEXT SecurityContext; ULONG Options; USHORT POINTER_ALIGNMENT Reserved; USHORT ShareAccess; PVOID Parameters; } CreatePipe; struct { PIO_SECURITY_CONTEXT SecurityContext; ULONG Options; USHORT POINTER_ALIGNMENT Reserved; USHORT ShareAccess; PVOID Parameters; } CreateMailslot; struct { ULONG Length; ULONG POINTER_ALIGNMENT Key; LARGE_INTEGER ByteOffset; PVOID ReadBuffer; PMDL MdlAddress; } Read; struct { ULONG Length; ULONG POINTER_ALIGNMENT Key; LARGE_INTEGER ByteOffset; PVOID WriteBuffer; PMDL MdlAddress; } Write; struct { ULONG Length; FILE_INFORMATION_CLASS POINTER_ALIGNMENT FileInformationClass; PVOID InfoBuffer; } QueryFileInformation; struct { ULONG Length; FILE_INFORMATION_CLASS POINTER_ALIGNMENT FileInformationClass; PFILE_OBJECT ParentOfTarget; union { struct { BOOLEAN ReplaceIfExists; BOOLEAN AdvanceOnly; }; ULONG ClusterCount; HANDLE DeleteHandle; }; PVOID InfoBuffer; } SetFileInformation; struct { ULONG Length; PVOID EaList; ULONG EaListLength; ULONG POINTER_ALIGNMENT EaIndex; PVOID EaBuffer; PMDL MdlAddress; } QueryEa; struct { ULONG Length; PVOID EaBuffer; PMDL MdlAddress; } SetEa; struct { ULONG Length; FS_INFORMATION_CLASS POINTER_ALIGNMENT FsInformationClass; PVOID VolumeBuffer; } QueryVolumeInformation; struct { ULONG Length; FS_INFORMATION_CLASS POINTER_ALIGNMENT FsInformationClass; PVOID VolumeBuffer; } SetVolumeInformation; union { struct { ULONG Length; PUNICODE_STRING FileName; FILE_INFORMATION_CLASS FileInformationClass; ULONG POINTER_ALIGNMENT FileIndex; PVOID DirectoryBuffer; PMDL MdlAddress; } QueryDirectory; struct { ULONG Length; ULONG POINTER_ALIGNMENT CompletionFilter; ULONG POINTER_ALIGNMENT Spare1; ULONG POINTER_ALIGNMENT Spare2; PVOID DirectoryBuffer; PMDL MdlAddress; } NotifyDirectory; struct { ULONG Length; ULONG POINTER_ALIGNMENT CompletionFilter; DIRECTORY_NOTIFY_INFORMATION_CLASS POINTER_ALIGNMENT DirectoryNotifyInformationClass; ULONG POINTER_ALIGNMENT Spare2; PVOID DirectoryBuffer; PMDL MdlAddress; } NotifyDirectoryEx; } DirectoryControl; union { struct { PVPB Vpb; PDEVICE_OBJECT DeviceObject; } VerifyVolume; struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT FsControlCode; } Common; struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT FsControlCode; PVOID InputBuffer; PVOID OutputBuffer; PMDL OutputMdlAddress; } Neither; struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT FsControlCode; PVOID SystemBuffer; } Buffered; struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT FsControlCode; PVOID InputSystemBuffer; PVOID OutputBuffer; PMDL OutputMdlAddress; } Direct; } FileSystemControl; union { struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT IoControlCode; } Common; struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT IoControlCode; PVOID InputBuffer; PVOID OutputBuffer; PMDL OutputMdlAddress; } Neither; struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT IoControlCode; PVOID SystemBuffer; } Buffered; struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT IoControlCode; PVOID InputSystemBuffer; PVOID OutputBuffer; PMDL OutputMdlAddress; } Direct; struct { ULONG OutputBufferLength; ULONG POINTER_ALIGNMENT InputBufferLength; ULONG POINTER_ALIGNMENT IoControlCode; PVOID InputBuffer; PVOID OutputBuffer; } FastIo; } DeviceIoControl; struct { PLARGE_INTEGER Length; ULONG POINTER_ALIGNMENT Key; LARGE_INTEGER ByteOffset; PEPROCESS ProcessId; BOOLEAN FailImmediately; BOOLEAN ExclusiveLock; } LockControl; struct { SECURITY_INFORMATION SecurityInformation; ULONG POINTER_ALIGNMENT Length; PVOID SecurityBuffer; PMDL MdlAddress; } QuerySecurity; struct { SECURITY_INFORMATION SecurityInformation; PSECURITY_DESCRIPTOR SecurityDescriptor; } SetSecurity; struct { ULONG_PTR ProviderId; PVOID DataPath; ULONG BufferSize; PVOID Buffer; } WMI; struct { ULONG Length; PSID StartSid; PFILE_GET_QUOTA_INFORMATION SidList; ULONG SidListLength; PVOID QuotaBuffer; PMDL MdlAddress; } QueryQuota; struct { ULONG Length; PVOID QuotaBuffer; PMDL MdlAddress; } SetQuota; union { struct { PCM_RESOURCE_LIST AllocatedResources; PCM_RESOURCE_LIST AllocatedResourcesTranslated; } StartDevice; struct { DEVICE_RELATION_TYPE Type; } QueryDeviceRelations; struct { const GUID *InterfaceType; USHORT Size; USHORT Version; PINTERFACE Interface; PVOID InterfaceSpecificData; } QueryInterface; struct { PDEVICE_CAPABILITIES Capabilities; } DeviceCapabilities; struct { PIO_RESOURCE_REQUIREMENTS_LIST IoResourceRequirementList; } FilterResourceRequirements; struct { ULONG WhichSpace; PVOID Buffer; ULONG Offset; ULONG POINTER_ALIGNMENT Length; } ReadWriteConfig; struct { BOOLEAN Lock; } SetLock; struct { BUS_QUERY_ID_TYPE IdType; } QueryId; struct { DEVICE_TEXT_TYPE DeviceTextType; LCID POINTER_ALIGNMENT LocaleId; } QueryDeviceText; struct { BOOLEAN InPath; BOOLEAN Reserved[3]; DEVICE_USAGE_NOTIFICATION_TYPE POINTER_ALIGNMENT Type; } UsageNotification; } Pnp; struct { FS_FILTER_SECTION_SYNC_TYPE SyncType; ULONG PageProtection; PFS_FILTER_SECTION_SYNC_OUTPUT OutputInformation; ULONG Flags; ULONG AllocationAttributes; } AcquireForSectionSynchronization; struct { PLARGE_INTEGER EndingOffset; PERESOURCE *ResourceToRelease; } AcquireForModifiedPageWriter; struct { PERESOURCE ResourceToRelease; } ReleaseForModifiedPageWriter; struct { PIRP Irp; PVOID FileInformation; PULONG Length; FILE_INFORMATION_CLASS FileInformationClass; } QueryOpen; struct { LARGE_INTEGER FileOffset; ULONG Length; ULONG POINTER_ALIGNMENT LockKey; BOOLEAN POINTER_ALIGNMENT CheckForReadOperation; } FastIoCheckIfPossible; struct { PIRP Irp; PFILE_NETWORK_OPEN_INFORMATION NetworkInformation; } NetworkQueryOpen; struct { LARGE_INTEGER FileOffset; ULONG POINTER_ALIGNMENT Length; ULONG POINTER_ALIGNMENT Key; PMDL *MdlChain; } MdlRead; struct { PMDL MdlChain; } MdlReadComplete; struct { LARGE_INTEGER FileOffset; ULONG POINTER_ALIGNMENT Length; ULONG POINTER_ALIGNMENT Key; PMDL *MdlChain; } PrepareMdlWrite; struct { LARGE_INTEGER FileOffset; PMDL MdlChain; } MdlWriteComplete; struct { ULONG DeviceType; } MountVolume; struct { PVOID Argument1; PVOID Argument2; PVOID Argument3; PVOID Argument4; PVOID Argument5; LARGE_INTEGER Argument6; } Others; } FLT_PARAMETERS, *PFLT_PARAMETERS; 状态和信息（IO_STATUS_BLOCK） typedef struct _IO_STATUS_BLOCK { union { NTSTATUS Status;	// 完成状态 PVOID Pointer; }; ULONG_PTR Information;	// 依赖于请求的值，如果传输请求完成，则为传输的字节数；如果使用另一个STATUS_XXX完成传输请求，则为0 } IO_STATUS_BLOCK, *PIO_STATUS_BLOCK; 关联对象 typedef struct _FLT_RELATED_OBJECTS { USHORT Size; USHORT TransactionContext; PFLT_FILTER Filter; PFLT_VOLUME Volume; PFLT_INSTANCE Instance; PFILE_OBJECT FileObject;	// 操作的文件对象 PKTRANSACTION Transaction; } FLT_RELATED_OBJECTS, *PFLT_RELATED_OBJECTS; " />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/bf81d664c58b0907c6555c6a2bf5f317/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-13T14:45:53+08:00" />
<meta property="article:modified_time" content="2023-04-13T14:45:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【驱动开发】文件系统微过滤驱动（Minifilter）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">编程框架</a></li><li><a href="#FLT_REGISTRATION_8" rel="nofollow">FLT_REGISTRATION</a></li><li><a href="#_29" rel="nofollow">操作回调函数集</a></li><li><ul><li><a href="#_55" rel="nofollow">预操作回调函数</a></li><li><ul><li><a href="#FLT_CALLBACK_DATA_62" rel="nofollow">回调数据包（FLT_CALLBACK_DATA）</a></li><li><ul><li><a href="#FLT_IO_PARAMETER_BLOCK_80" rel="nofollow">参数（FLT_IO_PARAMETER_BLOCK）</a></li><li><a href="#IO_STATUS_BLOCK_410" rel="nofollow">状态和信息（IO_STATUS_BLOCK）</a></li></ul> 
    </li><li><a href="#_420" rel="nofollow">关联对象</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>编程框架</h2> 
<ol><li><code>FltRegisterFilter</code> 注册Minifilter驱动；使用结束后用<code>FltUnregisterFilter</code>卸载。<br> 注册时，第二参数传入构建的<code>FLT_REGISTRATION</code>结构，主要是<strong>操作回调函数集</strong>和<strong>驱动卸载函数</strong>。</li><li><code>FltBuildDefaultSecurityDescriptor</code> 生成默认安全描述符。</li><li><code>FltCreateCommunicationPort</code> 创建通信服务器端口；使用结束后用<code>FltCloseCommunicationPort</code>关闭。</li><li><code>FltStartFiltering</code>开始过滤。</li><li>当有I/O操作发生时，执行流会进入操作回调函数集。</li></ol> 
<h2><a id="FLT_REGISTRATION_8"></a>FLT_REGISTRATION</h2> 
<pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_FLT_REGISTRATION</span> <span class="token punctuation">{<!-- --></span>
  USHORT                                      Size<span class="token punctuation">;</span>		<span class="token comment">// 结构体大小</span>
  USHORT                                      Version<span class="token punctuation">;</span>	<span class="token comment">// 版本</span>
  FLT_REGISTRATION_FLAGS                      Flags<span class="token punctuation">;</span>	<span class="token comment">// 标志位</span>
  <span class="token keyword">const</span> FLT_CONTEXT_REGISTRATION              <span class="token operator">*</span>ContextRegistration<span class="token punctuation">;</span>		<span class="token comment">// 上下文注册</span>
  <span class="token keyword">const</span> FLT_OPERATION_REGISTRATION            <span class="token operator">*</span>OperationRegistration<span class="token punctuation">;</span>	<span class="token comment">// 操作回调函数集注册！！！</span>
  PFLT_FILTER_UNLOAD_CALLBACK                 FilterUnloadCallback<span class="token punctuation">;</span>		<span class="token comment">// 驱动卸载回调！！！</span>
  PFLT_INSTANCE_SETUP_CALLBACK                InstanceSetupCallback<span class="token punctuation">;</span>	<span class="token comment">// 实例安装回调</span>
  PFLT_INSTANCE_QUERY_TEARDOWN_CALLBACK       InstanceQueryTeardownCallback<span class="token punctuation">;</span>	<span class="token comment">// 控制实例销毁函数</span>
  PFLT_INSTANCE_TEARDOWN_CALLBACK             InstanceTeardownStartCallback<span class="token punctuation">;</span>	<span class="token comment">// 实例解绑定函数</span>
  PFLT_INSTANCE_TEARDOWN_CALLBACK             InstanceTeardownCompleteCallback<span class="token punctuation">;</span>	<span class="token comment">// 实际解绑定完成函数</span>
  PFLT_GENERATE_FILE_NAME                     GenerateFileNameCallback<span class="token punctuation">;</span>			<span class="token comment">// 生成文件名回调</span>
  PFLT_NORMALIZE_NAME_COMPONENT               NormalizeNameComponentCallback<span class="token punctuation">;</span>	<span class="token comment">// 格式化名字组件回调</span>
  PFLT_NORMALIZE_CONTEXT_CLEANUP              NormalizeContextCleanupCallback<span class="token punctuation">;</span>	<span class="token comment">// 格式化上下文清理回调</span>
  PFLT_TRANSACTION_NOTIFICATION_CALLBACK      TransactionNotificationCallback<span class="token punctuation">;</span>
  PFLT_NORMALIZE_NAME_COMPONENT_EX            NormalizeNameComponentExCallback<span class="token punctuation">;</span>
  PFLT_SECTION_CONFLICT_NOTIFICATION_CALLBACK SectionNotificationCallback<span class="token punctuation">;</span>
<span class="token punctuation">}</span> FLT_REGISTRATION<span class="token punctuation">,</span> <span class="token operator">*</span>PFLT_REGISTRATION<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_29"></a>操作回调函数集</h2> 
<pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_FLT_OPERATION_REGISTRATION</span> <span class="token punctuation">{<!-- --></span>
  UCHAR                            MajorFunction<span class="token punctuation">;</span>	<span class="token comment">// IRP</span>
  FLT_OPERATION_REGISTRATION_FLAGS Flags<span class="token punctuation">;</span>			<span class="token comment">// 标志位：0(仅对读/写回调有用);FLTFL_OPERATION_REGISTRATION_SKIP_CACHED_IO(不过来缓冲读/写请求);FLTFL_OPERATION_REGISTRATION_SKIP_PAGING_IP(不过滤分页读/写请求)</span>
  PFLT_PRE_OPERATION_CALLBACK      PreOperation<span class="token punctuation">;</span>	<span class="token comment">// 预操作回调函数</span>
  PFLT_POST_OPERATION_CALLBACK     PostOperation<span class="token punctuation">;</span>	<span class="token comment">// 后操作回调函数</span>
  PVOID                            Reserved1<span class="token punctuation">;</span>
<span class="token punctuation">}</span> FLT_OPERATION_REGISTRATION<span class="token punctuation">,</span> <span class="token operator">*</span>PFLT_OPERATION_REGISTRATION<span class="token punctuation">;</span>

<span class="token comment">// 自定义</span>
<span class="token keyword">static</span>
CONST
FLT_OPERATION_REGISTRATION
OperationRegistration<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">{<!-- --></span>
        IRP_MJ_CREATE<span class="token punctuation">,</span>	<span class="token comment">// 文件创建</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        PrevCreate<span class="token punctuation">,</span>	
        PostCreate<span class="token punctuation">,</span>	
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        IRP_MJ_OPERATION_END
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_55"></a>预操作回调函数</h3> 
<pre><code class="prism language-c">FLT_PREOP_CALLBACK_STATUS <span class="token function">PfltPreOperationCallback</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> out<span class="token punctuation">]</span> PFLT_CALLBACK_DATA Data<span class="token punctuation">,</span>			<span class="token comment">// 回调数据包，内包含这个请求相关的全部信息</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>      PCFLT_RELATED_OBJECTS FltObjects<span class="token punctuation">,</span>	<span class="token comment">// 包含与当前 I/O 请求相关的对象的不透明指针</span>
  <span class="token punctuation">[</span>out<span class="token punctuation">]</span>     PVOID <span class="token operator">*</span>CompletionContext			<span class="token comment">// 如果该回调函数返回FLT_PREOP_SUCCESS_WITH_CALLBACK或FLT_PREOP_SYNCHRONIZE，则此参数是传递给相应操作后回调例程的可选上下文指针，否则必须为 NULL</span>
</code></pre> 
<h4><a id="FLT_CALLBACK_DATA_62"></a>回调数据包（FLT_CALLBACK_DATA）</h4> 
<pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_FLT_CALLBACK_DATA</span> <span class="token punctuation">{<!-- --></span>
  FLT_CALLBACK_DATA_FLAGS     Flags<span class="token punctuation">;</span>	<span class="token comment">// 标志位</span>
  PETHREAD                    Thread<span class="token punctuation">;</span>	<span class="token comment">// 线程指针</span>
  PFLT_IO_PARAMETER_BLOCK     Iopb<span class="token punctuation">;</span>		<span class="token comment">// 参数</span>
  IO_STATUS_BLOCK             IoStatus<span class="token punctuation">;</span>	<span class="token comment">// 状态和信息</span>
  <span class="token keyword">struct</span> <span class="token class-name">_FLT_TAG_DATA_BUFFER</span> <span class="token operator">*</span>TagData<span class="token punctuation">;</span>	<span class="token comment">// 重新分析点数据</span>
  <span class="token keyword">union</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      LIST_ENTRY QueueLinks<span class="token punctuation">;</span>
      PVOID      QueueContext<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    PVOID FilterContext<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  KPROCESSOR_MODE             RequestorMode<span class="token punctuation">;</span>	<span class="token comment">// 启动I/O操作的进程的执行模式</span>
<span class="token punctuation">}</span> FLT_CALLBACK_DATA<span class="token punctuation">,</span> <span class="token operator">*</span>PFLT_CALLBACK_DATA<span class="token punctuation">;</span>
</code></pre> 
<h5><a id="FLT_IO_PARAMETER_BLOCK_80"></a>参数（FLT_IO_PARAMETER_BLOCK）</h5> 
<pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_FLT_IO_PARAMETER_BLOCK</span> <span class="token punctuation">{<!-- --></span>
  ULONG          IrpFlags<span class="token punctuation">;</span>
  UCHAR          MajorFunction<span class="token punctuation">;</span>
  UCHAR          MinorFunction<span class="token punctuation">;</span>
  UCHAR          OperationFlags<span class="token punctuation">;</span>
  UCHAR          Reserved<span class="token punctuation">;</span>
  PFILE_OBJECT   TargetFileObject<span class="token punctuation">;</span>	<span class="token comment">// 目标文件/目录的文件对象指针</span>
  PFLT_INSTANCE  TargetInstance<span class="token punctuation">;</span>	<span class="token comment">// 目标Minifilter</span>
  FLT_PARAMETERS Parameters<span class="token punctuation">;</span>
<span class="token punctuation">}</span> FLT_IO_PARAMETER_BLOCK<span class="token punctuation">,</span> <span class="token operator">*</span>PFLT_IO_PARAMETER_BLOCK<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">union</span> _FLT_PARAMETERS <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PIO_SECURITY_CONTEXT     SecurityContext<span class="token punctuation">;</span>
    ULONG                    Options<span class="token punctuation">;</span>
    USHORT POINTER_ALIGNMENT FileAttributes<span class="token punctuation">;</span>
    USHORT                   ShareAccess<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT  EaLength<span class="token punctuation">;</span>
    PVOID                    EaBuffer<span class="token punctuation">;</span>
    LARGE_INTEGER            AllocationSize<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> Create<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PIO_SECURITY_CONTEXT     SecurityContext<span class="token punctuation">;</span>
    ULONG                    Options<span class="token punctuation">;</span>
    USHORT POINTER_ALIGNMENT Reserved<span class="token punctuation">;</span>
    USHORT                   ShareAccess<span class="token punctuation">;</span>
    PVOID                    Parameters<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> CreatePipe<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PIO_SECURITY_CONTEXT     SecurityContext<span class="token punctuation">;</span>
    ULONG                    Options<span class="token punctuation">;</span>
    USHORT POINTER_ALIGNMENT Reserved<span class="token punctuation">;</span>
    USHORT                   ShareAccess<span class="token punctuation">;</span>
    PVOID                    Parameters<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> CreateMailslot<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG                   Length<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT Key<span class="token punctuation">;</span>
    LARGE_INTEGER           ByteOffset<span class="token punctuation">;</span>
    PVOID                   ReadBuffer<span class="token punctuation">;</span>
    PMDL                    MdlAddress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> Read<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG                   Length<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT Key<span class="token punctuation">;</span>
    LARGE_INTEGER           ByteOffset<span class="token punctuation">;</span>
    PVOID                   WriteBuffer<span class="token punctuation">;</span>
    PMDL                    MdlAddress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> Write<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG                                    Length<span class="token punctuation">;</span>
    FILE_INFORMATION_CLASS POINTER_ALIGNMENT FileInformationClass<span class="token punctuation">;</span>
    PVOID                                    InfoBuffer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> QueryFileInformation<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG                                    Length<span class="token punctuation">;</span>
    FILE_INFORMATION_CLASS POINTER_ALIGNMENT FileInformationClass<span class="token punctuation">;</span>
    PFILE_OBJECT                             ParentOfTarget<span class="token punctuation">;</span>
    <span class="token keyword">union</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
        BOOLEAN ReplaceIfExists<span class="token punctuation">;</span>
        BOOLEAN AdvanceOnly<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      ULONG  ClusterCount<span class="token punctuation">;</span>
      HANDLE DeleteHandle<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    PVOID                                    InfoBuffer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> SetFileInformation<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG                   Length<span class="token punctuation">;</span>
    PVOID                   EaList<span class="token punctuation">;</span>
    ULONG                   EaListLength<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT EaIndex<span class="token punctuation">;</span>
    PVOID                   EaBuffer<span class="token punctuation">;</span>
    PMDL                    MdlAddress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> QueryEa<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG Length<span class="token punctuation">;</span>
    PVOID EaBuffer<span class="token punctuation">;</span>
    PMDL  MdlAddress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> SetEa<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG                                  Length<span class="token punctuation">;</span>
    FS_INFORMATION_CLASS POINTER_ALIGNMENT FsInformationClass<span class="token punctuation">;</span>
    PVOID                                  VolumeBuffer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> QueryVolumeInformation<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG                                  Length<span class="token punctuation">;</span>
    FS_INFORMATION_CLASS POINTER_ALIGNMENT FsInformationClass<span class="token punctuation">;</span>
    PVOID                                  VolumeBuffer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> SetVolumeInformation<span class="token punctuation">;</span>
  <span class="token keyword">union</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   Length<span class="token punctuation">;</span>
      PUNICODE_STRING         FileName<span class="token punctuation">;</span>
      FILE_INFORMATION_CLASS  FileInformationClass<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT FileIndex<span class="token punctuation">;</span>
      PVOID                   DirectoryBuffer<span class="token punctuation">;</span>
      PMDL                    MdlAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> QueryDirectory<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   Length<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT CompletionFilter<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT Spare1<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT Spare2<span class="token punctuation">;</span>
      PVOID                   DirectoryBuffer<span class="token punctuation">;</span>
      PMDL                    MdlAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> NotifyDirectory<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                                                Length<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT                              CompletionFilter<span class="token punctuation">;</span>
      DIRECTORY_NOTIFY_INFORMATION_CLASS POINTER_ALIGNMENT DirectoryNotifyInformationClass<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT                              Spare2<span class="token punctuation">;</span>
      PVOID                                                DirectoryBuffer<span class="token punctuation">;</span>
      PMDL                                                 MdlAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> NotifyDirectoryEx<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> DirectoryControl<span class="token punctuation">;</span>
  <span class="token keyword">union</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      PVPB           Vpb<span class="token punctuation">;</span>
      PDEVICE_OBJECT DeviceObject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> VerifyVolume<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT FsControlCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> Common<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT FsControlCode<span class="token punctuation">;</span>
      PVOID                   InputBuffer<span class="token punctuation">;</span>
      PVOID                   OutputBuffer<span class="token punctuation">;</span>
      PMDL                    OutputMdlAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> Neither<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT FsControlCode<span class="token punctuation">;</span>
      PVOID                   SystemBuffer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> Buffered<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT FsControlCode<span class="token punctuation">;</span>
      PVOID                   InputSystemBuffer<span class="token punctuation">;</span>
      PVOID                   OutputBuffer<span class="token punctuation">;</span>
      PMDL                    OutputMdlAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> Direct<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> FileSystemControl<span class="token punctuation">;</span>
  <span class="token keyword">union</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT IoControlCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> Common<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT IoControlCode<span class="token punctuation">;</span>
      PVOID                   InputBuffer<span class="token punctuation">;</span>
      PVOID                   OutputBuffer<span class="token punctuation">;</span>
      PMDL                    OutputMdlAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> Neither<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT IoControlCode<span class="token punctuation">;</span>
      PVOID                   SystemBuffer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> Buffered<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT IoControlCode<span class="token punctuation">;</span>
      PVOID                   InputSystemBuffer<span class="token punctuation">;</span>
      PVOID                   OutputBuffer<span class="token punctuation">;</span>
      PMDL                    OutputMdlAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> Direct<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   OutputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT InputBufferLength<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT IoControlCode<span class="token punctuation">;</span>
      PVOID                   InputBuffer<span class="token punctuation">;</span>
      PVOID                   OutputBuffer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> FastIo<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> DeviceIoControl<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PLARGE_INTEGER          Length<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT Key<span class="token punctuation">;</span>
    LARGE_INTEGER           ByteOffset<span class="token punctuation">;</span>
    PEPROCESS               ProcessId<span class="token punctuation">;</span>
    BOOLEAN                 FailImmediately<span class="token punctuation">;</span>
    BOOLEAN                 ExclusiveLock<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> LockControl<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    SECURITY_INFORMATION    SecurityInformation<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT Length<span class="token punctuation">;</span>
    PVOID                   SecurityBuffer<span class="token punctuation">;</span>
    PMDL                    MdlAddress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> QuerySecurity<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    SECURITY_INFORMATION SecurityInformation<span class="token punctuation">;</span>
    PSECURITY_DESCRIPTOR SecurityDescriptor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> SetSecurity<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG_PTR ProviderId<span class="token punctuation">;</span>
    PVOID     DataPath<span class="token punctuation">;</span>
    ULONG     BufferSize<span class="token punctuation">;</span>
    PVOID     Buffer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> WMI<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG                       Length<span class="token punctuation">;</span>
    PSID                        StartSid<span class="token punctuation">;</span>
    PFILE_GET_QUOTA_INFORMATION SidList<span class="token punctuation">;</span>
    ULONG                       SidListLength<span class="token punctuation">;</span>
    PVOID                       QuotaBuffer<span class="token punctuation">;</span>
    PMDL                        MdlAddress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> QueryQuota<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG Length<span class="token punctuation">;</span>
    PVOID QuotaBuffer<span class="token punctuation">;</span>
    PMDL  MdlAddress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> SetQuota<span class="token punctuation">;</span>
  <span class="token keyword">union</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      PCM_RESOURCE_LIST AllocatedResources<span class="token punctuation">;</span>
      PCM_RESOURCE_LIST AllocatedResourcesTranslated<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> StartDevice<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      DEVICE_RELATION_TYPE Type<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> QueryDeviceRelations<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> GUID <span class="token operator">*</span>InterfaceType<span class="token punctuation">;</span>
      USHORT     Size<span class="token punctuation">;</span>
      USHORT     Version<span class="token punctuation">;</span>
      PINTERFACE Interface<span class="token punctuation">;</span>
      PVOID      InterfaceSpecificData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> QueryInterface<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      PDEVICE_CAPABILITIES Capabilities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> DeviceCapabilities<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      PIO_RESOURCE_REQUIREMENTS_LIST IoResourceRequirementList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> FilterResourceRequirements<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      ULONG                   WhichSpace<span class="token punctuation">;</span>
      PVOID                   Buffer<span class="token punctuation">;</span>
      ULONG                   Offset<span class="token punctuation">;</span>
      ULONG POINTER_ALIGNMENT Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> ReadWriteConfig<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      BOOLEAN Lock<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> SetLock<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      BUS_QUERY_ID_TYPE IdType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> QueryId<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      DEVICE_TEXT_TYPE       DeviceTextType<span class="token punctuation">;</span>
      LCID POINTER_ALIGNMENT LocaleId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> QueryDeviceText<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
      BOOLEAN                                          InPath<span class="token punctuation">;</span>
      BOOLEAN                                          Reserved<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      DEVICE_USAGE_NOTIFICATION_TYPE POINTER_ALIGNMENT Type<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> UsageNotification<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> Pnp<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    FS_FILTER_SECTION_SYNC_TYPE    SyncType<span class="token punctuation">;</span>
    ULONG                          PageProtection<span class="token punctuation">;</span>
    PFS_FILTER_SECTION_SYNC_OUTPUT OutputInformation<span class="token punctuation">;</span>
    ULONG                          Flags<span class="token punctuation">;</span>
    ULONG                          AllocationAttributes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> AcquireForSectionSynchronization<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PLARGE_INTEGER EndingOffset<span class="token punctuation">;</span>
    PERESOURCE     <span class="token operator">*</span>ResourceToRelease<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> AcquireForModifiedPageWriter<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PERESOURCE ResourceToRelease<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> ReleaseForModifiedPageWriter<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PIRP                   Irp<span class="token punctuation">;</span>
    PVOID                  FileInformation<span class="token punctuation">;</span>
    PULONG                 Length<span class="token punctuation">;</span>
    FILE_INFORMATION_CLASS FileInformationClass<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> QueryOpen<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    LARGE_INTEGER             FileOffset<span class="token punctuation">;</span>
    ULONG                     Length<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT   LockKey<span class="token punctuation">;</span>
    BOOLEAN POINTER_ALIGNMENT CheckForReadOperation<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> FastIoCheckIfPossible<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PIRP                           Irp<span class="token punctuation">;</span>
    PFILE_NETWORK_OPEN_INFORMATION NetworkInformation<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> NetworkQueryOpen<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    LARGE_INTEGER           FileOffset<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT Length<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT Key<span class="token punctuation">;</span>
    PMDL                    <span class="token operator">*</span>MdlChain<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> MdlRead<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PMDL MdlChain<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> MdlReadComplete<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    LARGE_INTEGER           FileOffset<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT Length<span class="token punctuation">;</span>
    ULONG POINTER_ALIGNMENT Key<span class="token punctuation">;</span>
    PMDL                    <span class="token operator">*</span>MdlChain<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> PrepareMdlWrite<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    LARGE_INTEGER FileOffset<span class="token punctuation">;</span>
    PMDL          MdlChain<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> MdlWriteComplete<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ULONG DeviceType<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> MountVolume<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    PVOID         Argument1<span class="token punctuation">;</span>
    PVOID         Argument2<span class="token punctuation">;</span>
    PVOID         Argument3<span class="token punctuation">;</span>
    PVOID         Argument4<span class="token punctuation">;</span>
    PVOID         Argument5<span class="token punctuation">;</span>
    LARGE_INTEGER Argument6<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> Others<span class="token punctuation">;</span>
<span class="token punctuation">}</span> FLT_PARAMETERS<span class="token punctuation">,</span> <span class="token operator">*</span>PFLT_PARAMETERS<span class="token punctuation">;</span>
</code></pre> 
<h5><a id="IO_STATUS_BLOCK_410"></a>状态和信息（IO_STATUS_BLOCK）</h5> 
<pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_IO_STATUS_BLOCK</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">union</span> <span class="token punctuation">{<!-- --></span>
    NTSTATUS Status<span class="token punctuation">;</span>	<span class="token comment">// 完成状态</span>
    PVOID    Pointer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  ULONG_PTR Information<span class="token punctuation">;</span>	<span class="token comment">// 依赖于请求的值，如果传输请求完成，则为传输的字节数；如果使用另一个STATUS_XXX完成传输请求，则为0</span>
<span class="token punctuation">}</span> IO_STATUS_BLOCK<span class="token punctuation">,</span> <span class="token operator">*</span>PIO_STATUS_BLOCK<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_420"></a>关联对象</h4> 
<pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_FLT_RELATED_OBJECTS</span> <span class="token punctuation">{<!-- --></span>
  USHORT        Size<span class="token punctuation">;</span>
  USHORT        TransactionContext<span class="token punctuation">;</span>
  PFLT_FILTER   Filter<span class="token punctuation">;</span>
  PFLT_VOLUME   Volume<span class="token punctuation">;</span>
  PFLT_INSTANCE Instance<span class="token punctuation">;</span>
  PFILE_OBJECT  FileObject<span class="token punctuation">;</span>		<span class="token comment">// 操作的文件对象</span>
  PKTRANSACTION Transaction<span class="token punctuation">;</span>
<span class="token punctuation">}</span> FLT_RELATED_OBJECTS<span class="token punctuation">,</span> <span class="token operator">*</span>PFLT_RELATED_OBJECTS<span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d517e0e04f9c850f6d11019a07234053/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用c&#43;&#43;/winrt API获取RGB相机视频流</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b183e81dada860cb430f7d3c08cc33ce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">随想006：帮忙的时机</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>