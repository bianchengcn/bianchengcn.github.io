<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>std::any - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="std::any" />
<meta property="og:description" content="一、简介 std::any 可以储存任何可拷贝构造和可销毁的类型的对象。
struct test { test(int a,int b){} }; int main(int argc, char *argv[]) { std::any a = 1; qDebug() &lt;&lt; a.type().name(); a = 3.14; qDebug() &lt;&lt; a.type().name(); a = true; qDebug() &lt;&lt; a.type().name(); a = test(1,2); qDebug() &lt;&lt; a.type().name(); } QObject 类型是不可拷贝的，直接将此类对象赋给 std::any 就会报错：
要把 QObject 赋给 std::any 应该赋指针：
二、相关函数 1、std::any_cast 在类型匹配的情况下，从 std::any 中获取存储的值，并将其转换为目标类型。
int main(int argc, char *argv[]) { std::any storage = 3.14; double d = std::any_cast&lt;double&gt;(storage); qDebug() &lt;&lt; d; double* ptr = std::any_cast&lt;double&gt;(&amp;storage); if (ptr) { qDebug() &lt;&lt; *ptr; } } 要注意如果类型不匹配会抛出 std::bad_any_cast 异常。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/68cdf81a296c17812f5703c4853431bf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-13T00:26:28+08:00" />
<meta property="article:modified_time" content="2023-11-13T00:26:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">std::any</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、简介</h2> 
<p><span style="color:#ed7976;"><strong>std::any</strong></span><span style="color:#fe2c24;"><strong> </strong></span>可以储存任何<strong>可拷贝构造</strong>和<strong>可销毁</strong>的类型的对象。</p> 
<pre><code class="language-cpp">struct test
{
    test(int a,int b){}
};

int main(int argc, char *argv[])
{
    std::any a = 1;
    qDebug() &lt;&lt; a.type().name();
    a = 3.14;
    qDebug() &lt;&lt; a.type().name();
    a = true;
    qDebug() &lt;&lt; a.type().name();
    a = test(1,2);
    qDebug() &lt;&lt; a.type().name();
}</code></pre> 
<p><img alt="" height="119" src="https://images2.imgbox.com/a6/32/r5dnkQDT_o.png" width="224"></p> 
<p><span style="color:#ed7976;"><strong>QObject</strong></span> 类型是不可拷贝的，直接将此类对象赋给 <span style="color:#ed7976;"><strong>std::any</strong></span> 就会报错：</p> 
<p><img alt="" height="295" src="https://images2.imgbox.com/49/65/yoziltuD_o.png" width="1065"></p> 
<p>要把 <span style="color:#ed7976;"><strong>QObject </strong></span>赋给 <span style="color:#ed7976;"><strong>std::any</strong></span> 应该赋指针：</p> 
<p><img alt="" height="400" src="https://images2.imgbox.com/4f/34/3uh8DiUB_o.png" width="858"></p> 
<h2>二、相关函数</h2> 
<h3>1、std::any_cast</h3> 
<blockquote> 
 <p>在类型匹配的情况下，从 <span style="color:#ed7976;"><strong>std::any</strong></span> 中获取存储的值，并将其转换为目标类型。</p> 
</blockquote> 
<pre><code class="language-cpp">int main(int argc, char *argv[])
{
    std::any storage = 3.14;

    double d = std::any_cast&lt;double&gt;(storage);
    qDebug() &lt;&lt; d;

    double* ptr = std::any_cast&lt;double&gt;(&amp;storage);
    if (ptr)
    {
        qDebug() &lt;&lt; *ptr;
    }
}</code></pre> 
<p><img alt="" height="350" src="https://images2.imgbox.com/a2/bf/EzxV6BZX_o.png" width="960"></p> 
<p>要注意如果类型不匹配会抛出 <span style="color:#fe2c24;"><strong>std::bad_any_cast</strong></span> 异常。</p> 
<p><img alt="" height="523" src="https://images2.imgbox.com/6c/4d/hfwh6xmT_o.png" width="1200"></p> 
<h3>2、std::make_any</h3> 
<blockquote> 
 <p>在运行时构建 <span style="color:#ed7976;"><strong>std::any</strong></span> 类型的对象，并以推导模板参数的方式自动将输入参数转换为 <span style="color:#ed7976;"><strong>std::any</strong></span>。</p> 
</blockquote> 
<p>这是两种方式：</p> 
<pre><code class="language-cpp">std::any val = std::make_any&lt;int&gt;(23);
std::any val = 23;</code></pre> 
<p>二者的区别：</p> 
<ul><li><code>std::make_any&lt;int&gt;(23)</code>：使用 <span style="color:#956fe7;"><strong><code>std::make_any</code></strong></span> 函数并指定模板参数为 <code>int</code>，通过调用 <code>int</code> 类型的构造函数创建一个临时的 <code>int</code> 对象，然后将该对象存储在 <span style="color:#ed7976;"><strong>std::any</strong></span> 中。</li><li><code>std::any val = 23</code>：直接将整数值 23 赋给 <span style="color:#ed7976;"><strong>std::any</strong></span> 变量 <code>val</code>，此时编译器会自动推导出 <span style="color:#ed7976;"><strong>std::any</strong></span> 对象的类型，并调用相应的构造函数来存储该值。</li></ul> 
<p>两者的区别在于对象的构造方式。使用 <strong><span style="color:#956fe7;"><code>std::make_any</code></span></strong> 可以显式指定对象的类型，并通过调用构造函数来创建对象。</p> 
<h3>3、std::any::emplace</h3> 
<blockquote> 
 <p>它是 <span style="color:#ed7976;"><strong>std::any </strong></span>的<strong>成员函数</strong>，用于在 <span style="color:#ed7976;"><strong>std::any </strong></span>中就地构造存储的对象。</p> 
 <p>它可以在运行时<span style="color:#fe2c24;"><u><strong>指定对象的类型</strong></u></span>，并通过提供构造函数的参数，在 <span style="color:#ed7976;"><strong>std::any</strong></span> 中构造出一个新的对象。</p> 
 <p>与直接赋值相比更加显示。</p> 
</blockquote> 
<pre><code class="language-cpp">int main(int argc, char *argv[])
{
    std::any storage1 = 2.2;
    storage1 = 23;
    qDebug()&lt;&lt;storage1.type().name();   //int

    std::any storage2 = 2.2;
    storage2.emplace&lt;qint8&gt;(23);
    qDebug()&lt;&lt;storage2.type().name();   //signed char
}</code></pre> 
<h3>4、std::any::has_value</h3> 
<blockquote> 
 <p>是 <span style="color:#ed7976;"><strong>std::any</strong></span> 的成员函数，用于检查 <span style="color:#ed7976;"><strong>std::any</strong></span> 对象是否存储了一个值。</p> 
</blockquote> 
<pre><code class="language-cpp">int main(int argc, char *argv[])
{
    std::any storage;
    qDebug() &lt;&lt; storage.has_value(); // false
    storage = 42;
    qDebug() &lt;&lt; storage.has_value() ; // true
}</code></pre> 
<h3>5、std::any::reset</h3> 
<blockquote> 
 <p>是 <span style="color:#ed7976;"><strong>std::any</strong></span> 的成员函数，用于将 <span style="color:#ed7976;"><strong>std::any</strong></span> 对象重置为空，释放其持有的值。</p> 
</blockquote> 
<pre><code class="language-cpp">int main(int argc, char *argv[])
{
    std::any storage = 42;
    qDebug() &lt;&lt; storage.has_value(); // true
    storage.reset();
    qDebug() &lt;&lt; storage.has_value(); // false
}</code></pre> 
<h3>6、std::any::type</h3> 
<blockquote> 
 <p>是 <span style="color:#ed7976;"><strong>std::any</strong></span> 的成员函数，如果对象非空则返回 <span style="color:#ed7976;"><strong>std::any</strong></span> 对象的 <span style="color:#e6b223;"><strong>typeid</strong></span>（<span style="color:#ed7976;"><strong>std::type_info</strong></span>），空则返回 <span style="color:#e6b223;"><strong>typeid</strong></span>(void)</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1f6de4f865986e197597a89bacca2c61/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LLM的未来会如何影响我们呢？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9cd63314577a495a61689895ffa34d16/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Element-Ui el-table 动态添加行</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>