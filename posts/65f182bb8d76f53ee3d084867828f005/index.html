<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8s 安装部署-Master和Minion(Node) - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8s 安装部署-Master和Minion(Node)" />
<meta property="og:description" content="K8s 安装部署-Master和Minion(Node)
操作系统版本：CentOS 7.4
Master ：172.20.26.167
Minion-1：172.20.26.198
Minion-2：172.20.26.210（后增加节点）
ETCD：172.20.27.218
先安装部署ETCD
yum install etcd -y
cd /etc/etcd/
cp etcd.conf etcd.conf.bak #备份etcd.conf 文件
grep -aivE &#34;#|^$&#34; etcd.conf #去掉#、空行的显示
[root@localhost etcd]# grep -aivE &#34;#|^$&#34; etcd.conf
ETCD_DATA_DIR=&#34;/var/lib/etcd/default.etcd&#34;
ETCD_LISTEN_CLIENT_URLS=&#34;http://localhost:2379&#34;
ETCD_NAME=&#34;default&#34;
ETCD_ADVERTISE_CLIENT_URLS=&#34;http://localhost:2379&#34;
vim etcd.conf
[root@localhost etcd]# mkdir -p /data/etcd/ #创建ETCD的数据目录
[root@localhost etcd]# id etcd #看看ETCD用户
uid=997(etcd) gid=995(etcd) 组=995(etcd)
[root@localhost etcd]# chown -R etcd.etcd /data/etcd/ #对数据目录授权etcd用户和组
[root@localhost etcd]# ls -ld /data/etcd/ #查看数据目录权限
drwxr-xr-x. 2 etcd etcd 6 4月 17 13:32 /data/etcd/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/65f182bb8d76f53ee3d084867828f005/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-29T10:17:21+08:00" />
<meta property="article:modified_time" content="2024-01-29T10:17:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8s 安装部署-Master和Minion(Node)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:center;"><strong>K8s </strong><strong>安装部署-Master和Minion(Node)</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>操作系统版本：CentOS 7.4</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>Master </strong><strong>：172.20.26.167</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>Minion-1</strong><strong>：172.20.26.198</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>Minion-2</strong><strong>：172.20.26.210（后增加节点）</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>ETCD</strong><strong>：172.20.27.218</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>先安装部署ETCD</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>yum install etcd -y</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="331" src="https://images2.imgbox.com/3b/31/DGj3Aw2r_o.png" width="698"></p> 
<p style="margin-left:.0001pt;text-align:justify;">cd /etc/etcd/</p> 
<p style="margin-left:.0001pt;text-align:justify;">cp etcd.conf etcd.conf.bak    #备份etcd.conf 文件</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="359" src="https://images2.imgbox.com/3c/e4/oyi5kCdY_o.png" width="716"></p> 
<p style="margin-left:.0001pt;text-align:justify;">grep -aivE "#|^$" etcd.conf  #去掉#、空行的显示</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@localhost etcd]# grep -aivE "#|^$" etcd.conf</p> 
<p style="margin-left:.0001pt;text-align:justify;">ETCD_DATA_DIR="/var/lib/etcd/default.etcd"</p> 
<p style="margin-left:.0001pt;text-align:justify;">ETCD_LISTEN_CLIENT_URLS="http://localhost:2379"</p> 
<p style="margin-left:.0001pt;text-align:justify;">ETCD_NAME="default"</p> 
<p style="margin-left:.0001pt;text-align:justify;">ETCD_ADVERTISE_CLIENT_URLS="http://localhost:2379"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="230" src="https://images2.imgbox.com/8e/a7/Kv5RQErw_o.png" width="738"></p> 
<p style="margin-left:.0001pt;text-align:justify;">vim etcd.conf</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="163" src="https://images2.imgbox.com/58/84/zfq1UDH7_o.png" width="780"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@localhost etcd]# mkdir -p /data/etcd/  #创建ETCD的数据目录</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@localhost etcd]# id etcd    #看看ETCD用户</p> 
<p style="margin-left:.0001pt;text-align:justify;">uid=997(etcd) gid=995(etcd) 组=995(etcd)</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@localhost etcd]# chown -R etcd.etcd /data/etcd/   #对数据目录授权etcd用户和组</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@localhost etcd]# ls -ld /data/etcd/   #查看数据目录权限</p> 
<p style="margin-left:.0001pt;text-align:justify;">drwxr-xr-x. 2 etcd etcd 6 4月  17 13:32 /data/etcd/</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="417" src="https://images2.imgbox.com/80/4d/ZZeHsgK6_o.png" width="783"></p> 
<p style="margin-left:.0001pt;text-align:justify;">启动ETCD 服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl start etcd.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">ps -ef |grep -aiE etcd</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="149" src="https://images2.imgbox.com/ea/db/BpqbQ8IO_o.png" width="812"></p> 
<p style="margin-left:.0001pt;text-align:justify;">创建key</p> 
<p style="margin-left:.0001pt;text-align:justify;">etcdctl  mk  /atomic.io/network/config '{"Network":"172.17.0.0/16"}'</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="182" src="https://images2.imgbox.com/43/f0/vgwL9RXk_o.png" width="805"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>安装部署Master</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>yum install kubernetes-master flannel -y</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="476" src="https://images2.imgbox.com/6b/87/21Tlg6Ci_o.png" width="797"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="241" src="https://images2.imgbox.com/db/bd/NpXjGoeU_o.png" width="801"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>[root@bogon kubernetes]# vim apiserver</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_API_ADDRESS="--insecure-bind-address=0.0.0.0"</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_API_PORT="--port=8080"</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_ETCD_SERVERS="--etcd-servers=http://172.20.26.218:2379"</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_ADMISSION_CONTROL="--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="426" src="https://images2.imgbox.com/58/d4/Q7HeFniD_o.png" width="812"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>因为我们没有配置账号和密码，所以要把“ServiceAccount,”删除掉，否则会出问题</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>[root@bogon kubernetes]# vim config</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_ALLOW_PRIV="--allow-privileged=true"</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_MASTER="--master=http://172.20.26.167:8080"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="494" src="https://images2.imgbox.com/39/9e/T0u3Y8q3_o.png" width="843"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon kubernetes]# systemctl start kube-apiserver</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon kubernetes]# systemctl start kube-controller-manager</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon kubernetes]# systemctl start kube-scheduler</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon]#ps -ef | grep kube</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="161" src="https://images2.imgbox.com/50/ef/JcWWVxD6_o.png" width="829"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"> 查看kube-apiserver、kube-controller-manager、kube-scheduler服务进程都起来了，到此Master 端部署完成。</p> 
<p style="margin-left:.0001pt;text-align:justify;">也可以使用for I in 命令重新启动各个服务：</p> 
<p style="margin-left:.0001pt;text-align:justify;">for  I  in  etcd  kube-apiserver  kube-controller-manager kube-scheduler;  do</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl restart  $I</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl enable  $I</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl status   $I</p> 
<p style="margin-left:.0001pt;text-align:justify;">done</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>安装部署(Node)Minion端</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">yum install kubernetes-node docker flannel *rhsm* -y</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# cd /etc/kubernetes/</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="236" src="https://images2.imgbox.com/3f/c5/2viy6oM2_o.png" width="695"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>[root@bogon kubernetes]# vim config</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_ALLOW_PRIV="--allow-privileged=true"  在web管理界面中，让勾选“以特权身份运行”生效</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_MASTER="--master=http://172.20.26.167:8080"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="472" src="https://images2.imgbox.com/d6/c0/cmPdILu5_o.png" width="839"></p> 
<p style="margin-left:.0001pt;text-align:justify;"> [root@bogon kubernetes]# vim kubelet</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBELET_ADDRESS="--address=0.0.0.0"</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBELET_HOSTNAME="--hostname-override=172.20.26.198"</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBELET_API_SERVER="--api-servers=http://172.20.26.167:8080"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="291" src="https://images2.imgbox.com/6c/9e/RdWG2wC7_o.png" width="836"></p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /etc/sysconfig/flanneld  #配置flannel网络</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="254" src="https://images2.imgbox.com/a6/3f/4uVJCFJg_o.png" width="844"></p> 
<p style="margin-left:.0001pt;text-align:justify;">service flanneld start  #先启动flanneld服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">service docker start   #再启动docker 服务</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="299" src="https://images2.imgbox.com/a6/b3/BdTuPmjN_o.png" width="839"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>在Master端也要配置flannel网络</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# vim /etc/sysconfig/flanneld </p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="283" src="https://images2.imgbox.com/ce/60/7i3uvsX2_o.png" width="834"></p> 
<p style="margin-left:.0001pt;text-align:justify;">service flanneld start  #启动flanneld服务</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="355" src="https://images2.imgbox.com/a4/e1/m9MkideU_o.png" width="836"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>回到Minion端</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">启动kubelet、kube-proxy服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# service kubelet start</p> 
<p style="margin-left:.0001pt;text-align:justify;">Redirecting to /bin/systemctl start kubelet.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# service kubelet restart</p> 
<p style="margin-left:.0001pt;text-align:justify;">Redirecting to /bin/systemctl restart kubelet.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# service kube-proxy start</p> 
<p style="margin-left:.0001pt;text-align:justify;">Redirecting to /bin/systemctl start kube-proxy.service</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="245" src="https://images2.imgbox.com/33/78/JttiTkNG_o.png" width="731"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看相关进程</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ps -ef |grep kube</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ps -ef |grep docker</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ps -ef |grep flanneld</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="394" src="https://images2.imgbox.com/17/84/OmyNEnIn_o.png" width="835"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>至此Minion端配置完成。</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>在Master端输入kubectl get nodes  </strong>验证是否成功？看到STATUS 的状态为Read 即可</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# kubectl get nodes</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="173" src="https://images2.imgbox.com/b6/b7/y0ciR2sK_o.png" width="548"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在Master端查看IP地址信息</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="484" src="https://images2.imgbox.com/de/40/AsahyW7G_o.png" width="842"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在Minion端查看IP地址信息</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="563" src="https://images2.imgbox.com/2a/c9/z0hV2suV_o.png" width="838"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在Master端查看FORWARD参数策略是否为ACEEPT(允许)？</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# iptables -t filter -L -n</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="283" src="https://images2.imgbox.com/02/eb/S3gJYYTu_o.png" width="752"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Ping Minion端IP地址是通的</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ping 172.17.60.1</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ping 172.17.60.0</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="634" src="https://images2.imgbox.com/91/63/RLBj1kt0_o.png" width="830"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在Minion 端ping 172.17.34.0 看是否通</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="283" src="https://images2.imgbox.com/de/53/EzX4Gpou_o.png" width="836"></p> 
<p style="margin-left:.0001pt;text-align:justify;">至此，Master和Minion端网络已打通。</p> 
<p style="margin-left:.0001pt;text-align:justify;">在Minion端查看FORWARD 规则参数为DROP（丢弃）状态</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="497" src="https://images2.imgbox.com/54/40/HT0QK3PT_o.png" width="838"></p> 
<p style="margin-left:.0001pt;text-align:justify;">需要将FORWARD 规则设置为ACCEPT（允许）状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# iptables -P FORWARD ACCEPT</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# iptables -t filter -L -n</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="535" src="https://images2.imgbox.com/8d/67/0HWhU3mV_o.png" width="836"></p> 
<p style="margin-left:.0001pt;text-align:justify;">K8S集群搭建完成。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>创建K8S的web 管理界面</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">在<strong><span style="color:#ff0000;">Minion</span></strong><strong><span style="color:#ff0000;">端</span></strong>导入两个镜像文件：pod-infrastructure、kubernetes-dashboard-amd64</p> 
<p style="margin-left:.0001pt;text-align:justify;">这两个镜像文件直接从网络上下载可能会超时，导致导入失败，所以可以先从本地上传后进行导入。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="214" src="https://images2.imgbox.com/98/c0/TAimq0Rs_o.png" width="847"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Docker镜像导入指令如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker load &lt;pod-infrastructure.tgz，将导入的pod镜像名称修改,命令如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker tag $(docker images|grep none|awk '{print $3}') registry.access.redhat.com/rhel7/pod-infrastructure</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="278" src="https://images2.imgbox.com/b9/2d/vwwdMSG9_o.png" width="845"></p> 
<p style="margin-left:.0001pt;text-align:justify;">docker load &lt;kubernetes-dashboard-amd64.tgz，将导入的pod镜像名称修改，命令如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker tag $(docker images|grep none|awk '{print $3}') bestwu/kubernetes-dashboard-amd64:v1.6.3</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="414" src="https://images2.imgbox.com/86/ea/1ikQzJTZ_o.png" width="845"></p> 
<p style="margin-left:.0001pt;text-align:justify;">然后在Master端,上传两个yaml文件：dashboard-controller.yaml、dashboard-service.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="314" src="https://images2.imgbox.com/9d/e8/Q667AXHf_o.png" width="846"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在Master 端创建k8s目录，将dashboard-controller.yaml、dashboard-service.yaml 移动到k8s目录下</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="493" src="https://images2.imgbox.com/50/4b/3Bc2dvss_o.png" width="839"></p> 
<p style="margin-left:.0001pt;text-align:justify;">然后修改一下dashboard-controller.yaml文件里的api地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon k8s]# vim dashboard-controller.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="595" src="https://images2.imgbox.com/10/23/10Ht4PPz_o.png" width="839"></p> 
<p style="margin-left:.0001pt;text-align:justify;">保存退出</p> 
<p style="margin-left:.0001pt;text-align:justify;">创建dashboard dashborad pods模块</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl create -f dashboard-controller.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl create -f dashboard-service.yaml</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="178" src="https://images2.imgbox.com/b0/35/kPum5vgj_o.png" width="811"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon k8s]# kubectl get pods -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="240" src="https://images2.imgbox.com/f4/12/jD0moh4t_o.png" width="835"></p> 
<p style="margin-left:.0001pt;text-align:justify;">看到STATUS状态为Running ，表示web界面配置成功。</p> 
<p style="margin-left:.0001pt;text-align:justify;">通过浏览器访问Master端IP地址的8080端口</p> 
<p style="margin-left:.0001pt;text-align:justify;">http://172.20.26.167:8080</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="903" src="https://images2.imgbox.com/58/09/UysO5RZs_o.png" width="708"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在<a href="http://172.20.26.167:8080" rel="nofollow" title="http://172.20.26.167:8080">http://172.20.26.167:8080</a>后面加上ui 即可访问k8s的web界面</p> 
<p style="margin-left:.0001pt;text-align:justify;">http://172.20.26.167:8080/ui</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="470" src="https://images2.imgbox.com/c5/41/lWSjoKfa_o.png" width="854"></p> 
<p style="margin-left:.0001pt;text-align:justify;">制作centOS7镜像，先上传一个centos7-ansible镜像包，使用Dockerfile 文件制作镜像</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim Dockerfile</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="298" src="https://images2.imgbox.com/36/e2/VWTRfomj_o.png" width="619"></p> 
<p style="margin-left:.0001pt;text-align:justify;">mkdir -p /Docker</p> 
<p style="margin-left:.0001pt;text-align:justify;">将Dockerfile 文件移动到/Docker目录下</p> 
<p style="margin-left:.0001pt;text-align:justify;">mv Dockerfile /Docker/</p> 
<p style="margin-left:.0001pt;text-align:justify;">cd /Docker</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker build -t centos7-ssh:v1 .</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="609" src="https://images2.imgbox.com/0a/5e/TdH5Klr9_o.png" width="838"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="874" src="https://images2.imgbox.com/02/94/0QGmhHkr_o.png" width="831"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="139" src="https://images2.imgbox.com/65/c7/0fDH85hH_o.png" width="835"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在k8s管理界面，点击“创建”，新建一个名称为centos7容器，容器镜像：centos7-ssh:v1，显示高级选项，勾选“以特权身份运行”，点击“部署”</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="469" src="https://images2.imgbox.com/7c/b9/BBIYly9j_o.png" width="763"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="653" src="https://images2.imgbox.com/50/7d/qHjZ0GR8_o.png" width="756"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="360" src="https://images2.imgbox.com/a3/b4/r2oG5Bpf_o.png" width="878"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Centos7容器创建完成，点击“容器组”里的“<span style="background-color:#ffffff;">centos7-3728401273-pzr09”</span><span style="background-color:#ffffff;">新建容器名，</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="401" src="https://images2.imgbox.com/b8/5f/UeZHErzh_o.png" width="849"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">也可以点击右上角的“运行命令“按钮，进入命令行界面</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="339" src="https://images2.imgbox.com/8f/3f/fUbLtsgu_o.png" width="850"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="270" src="https://images2.imgbox.com/14/8d/F1yhP1Nf_o.png" width="814"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">也可以通过Minion端通过ssh 连接进入这个容器</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="590" src="https://images2.imgbox.com/de/7b/q3ob2Ufq_o.png" width="845"></p> 
<p style="margin-left:.0001pt;text-align:justify;">创建部署nginx容器</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="414" src="https://images2.imgbox.com/37/e6/cZryCrdX_o.png" width="857"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="387" src="https://images2.imgbox.com/75/e8/oif5gJwX_o.png" width="535"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="379" src="https://images2.imgbox.com/ab/5a/Lc76Hwf5_o.png" width="853"></p> 
<p style="margin-left:.0001pt;text-align:justify;">可以对nginx容器进行扩容多个</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="303" src="https://images2.imgbox.com/66/4f/PtwLlPXD_o.png" width="848"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="1058" src="https://images2.imgbox.com/62/89/xLUCrGDd_o.png" width="835"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="377" src="https://images2.imgbox.com/0d/8d/wLKiplb0_o.png" width="851"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>再增加Node（Minion）节点</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#fcfcfc;"><span style="color:#000000;">yum install kubernetes-node docker flannel* *rhsm* -y</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="330" src="https://images2.imgbox.com/04/25/3JGL2iWp_o.png" width="848"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# cd /etc/kubernetes/</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="231" src="https://images2.imgbox.com/3f/e9/Vg5CrnIK_o.png" width="739"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">编辑</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>[root@bogon kubernetes]# vim config</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_ALLOW_PRIV="--allow-privileged=true"  在web管理界面中，让勾选“以特权身份运行”生效</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBE_MASTER="--master=http://172.20.26.167:8080"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="493" src="https://images2.imgbox.com/25/f4/OrfnpgSk_o.png" width="842"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon kubernetes]# vim kubelet</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBELET_ADDRESS="--address=0.0.0.0"</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBELET_HOSTNAME="--hostname-override=172.20.26.210"</p> 
<p style="margin-left:.0001pt;text-align:justify;">KUBELET_API_SERVER="--api-servers=http://172.20.26.167:8080"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="265" src="https://images2.imgbox.com/e5/f7/8r3jc5Tz_o.png" width="845"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon /]# vim /etc/sysconfig/flanneld   配置flannel网络</p> 
<p style="margin-left:.0001pt;text-align:justify;">FLANNEL_ETCD_ENDPOINTS="http://172.20.218:2379"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="251" src="https://images2.imgbox.com/35/04/bEgfugu5_o.png" width="847"></p> 
<p style="margin-left:.0001pt;text-align:justify;">service flanneld start  先启动flanneld服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">flanneld服务无法启动，报错</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="496" src="https://images2.imgbox.com/76/6c/1eZGc8Kd_o.png" width="840"></p> 
<p style="margin-left:.0001pt;text-align:justify;">将Minion端系统重启一下，</p> 
<p style="margin-left:.0001pt;text-align:justify;">再执行service flanneld start  启动flanneld服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">service docker start  #再启动docker 服务</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="159" src="https://images2.imgbox.com/82/82/wAwjnHXF_o.png" width="802"></p> 
<p style="margin-left:.0001pt;text-align:justify;">启动kubelet、kube-proxy服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# service kubelet start</p> 
<p style="margin-left:.0001pt;text-align:justify;">Redirecting to /bin/systemctl start kubelet.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# service kubelet restart</p> 
<p style="margin-left:.0001pt;text-align:justify;">Redirecting to /bin/systemctl restart kubelet.service</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# service kube-proxy start</p> 
<p style="margin-left:.0001pt;text-align:justify;">Redirecting to /bin/systemctl start kube-proxy.service</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="248" src="https://images2.imgbox.com/a4/2e/91LTq1U7_o.png" width="758"></p> 
<p style="margin-left:.0001pt;text-align:justify;">也可以用for I in命令启动服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">for  I  in  kube-proxy  kubelet  flanneld docker</p> 
<p style="margin-left:.0001pt;text-align:justify;">do</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl  restart  $I</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl  enable  $I</p> 
<p style="margin-left:.0001pt;text-align:justify;">done</p> 
<p style="margin-left:.0001pt;text-align:justify;">service iptables stop;iptables -P FORWARD ACCEPT</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看相关进程</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ps -ef |grep kube</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ps -ef |grep docker</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ps -ef |grep flanneld</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="243" src="https://images2.imgbox.com/00/7f/QGpXFaGZ_o.png" width="855"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>至此新增加的Node（Minion）节点配置完成。</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>在Master端输入kubectl get nodes  </strong>验证是否成功？看到STATUS 的状态为Read 即可</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# kubectl get nodes</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="200" src="https://images2.imgbox.com/43/27/1s1fIFZX_o.png" width="797"></p> 
<p style="margin-left:.0001pt;text-align:justify;">回到k8s 管理界面，查看节点情况，172.20.26.210节点成功增加</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="223" src="https://images2.imgbox.com/3e/ab/27hNOmJm_o.png" width="855"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>创建K8S的web 管理界面</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;">因没有创建本地仓库，所以需要</span></strong>在<strong><span style="color:#ff0000;">Minion</span></strong><strong><span style="color:#ff0000;">端</span></strong>再导入pod-infrastructure、kubernetes-dashboard-amd64两个镜像文件。<span style="color:#ff0000;">如果已创建好本地仓库，在第一次部署Minion节点时，将pod-infrastructure、kubernetes-dashboard-amd64镜像上传到本地仓库即可。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">这两个镜像文件直接从网络上下载可能会超时，导致导入失败，所以可以先从本地上传后进行导入。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="184" src="https://images2.imgbox.com/66/6b/8C1IUHKd_o.png" width="865"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Docker镜像导入指令如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker load &lt;pod-infrastructure.tgz，将导入的pod镜像名称修改,命令如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker tag $(docker images|grep none|awk '{print $3}') registry.access.redhat.com/rhel7/pod-infrastructure</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="222" src="https://images2.imgbox.com/9d/d1/g1BZOTKn_o.png" width="856"></p> 
<p style="margin-left:.0001pt;text-align:justify;">docker load &lt;kubernetes-dashboard-amd64.tgz，将导入的pod镜像名称修改，命令如下：</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker tag $(docker images|grep none|awk '{print $3}') bestwu/kubernetes-dashboard-amd64:v1.6.3</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="330" src="https://images2.imgbox.com/c8/c4/BOhSLjdz_o.png" width="856"></p> 
<p style="margin-left:.0001pt;text-align:justify;">回到k8s管理界面，查看节点数量</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="210" src="https://images2.imgbox.com/da/70/btutpOLe_o.png" width="880"></p> 
<p style="margin-left:.0001pt;text-align:justify;">新部署tomcat容器，数量为2，将会在两个节点中分别创建1台tomcat容器。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="529" src="https://images2.imgbox.com/23/d8/hFyaOubN_o.png" width="842"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="433" src="https://images2.imgbox.com/de/97/upGVGaR5_o.png" width="547"></p> 
<p style="margin-left:.0001pt;text-align:justify;">由于是在网上下载tomcat 镜像，需要等待时间较长，最后完成情况如下</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="404" src="https://images2.imgbox.com/73/3e/EwFjm71q_o.png" width="847"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在master控制端查看所有云主机的IP 地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# kubectl get -n default pods -o wide</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="184" src="https://images2.imgbox.com/78/e0/XH9lVjvL_o.png" width="859"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# kubectl get -n default pods -o wide|awk '{print $1,$6}'|awk -F"-" 'NR&gt;1 {print $1,$NF}'|awk '{print $1,$NF}'</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="122" src="https://images2.imgbox.com/8c/d5/p5KrahiT_o.png" width="863"></p> 
<p style="margin-left:.0001pt;text-align:justify;">可以通过宿主机重启容器</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker ps |grep tomcat   查看tomcat容器ID</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker restart 574bf1497167    重启tomcat容器</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="131" src="https://images2.imgbox.com/4a/ad/2hwhfkdy_o.png" width="853"></p> 
<p style="margin-left:.0001pt;text-align:justify;">重启，数据不会丢失</p> 
<p style="margin-left:.0001pt;text-align:justify;">如果是删除云主机，会自动产生一台云主机，但是数据丢失</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>创建本地私有仓库</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">在172.20.26.198上创建本地私有仓库</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker pull docker.io/registry</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="307" src="https://images2.imgbox.com/60/43/fUBZzehW_o.png" width="861"></p> 
<p style="margin-left:.0001pt;text-align:justify;">mkdir -p  /data/registry/</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker run -itd  -p  5000:5000 -v /data/registry:/var/lib/registry  docker.io/registry</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="189" src="https://images2.imgbox.com/0f/e0/aYu9vBzg_o.png" width="843"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# vim /etc/docker/daemon.json</p> 
<p style="margin-left:.0001pt;text-align:justify;">"insecure-registries":["172.20.26.198:5000"]</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="125" src="https://images2.imgbox.com/89/60/1r1FjFSk_o.png" width="689"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# service docker restart</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ps -ef |grep 5000   查看5000端口状态</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="78" src="https://images2.imgbox.com/07/6d/xXBc1D7M_o.png" width="853"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Docker images 查看一下镜像信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">对centos7-ssh镜像修改tag号</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker tag 5a97f88791d1 172.20.26.198:5000/centos7-ssh:v1</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="166" src="https://images2.imgbox.com/a1/3d/wSR8kwzc_o.png" width="842"></p> 
<p style="margin-left:.0001pt;text-align:justify;">将修改好tag号的centos7-ssh镜像上传到本地仓库中</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker push 172.20.26.198:5000/centos7-ssh:v1</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="202" src="https://images2.imgbox.com/c6/5b/FlSBKp2E_o.png" width="853"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker ps -a   查看docker 容器情况docker.io/registry</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker start bf5bd542fba4  启动docker.io/registry</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# ps -ef |grep 5000  查看5000端口情况</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker push 172.20.26.198:5000/centos7-ssh:v1  再次上传镜像到本地仓库</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="521" src="https://images2.imgbox.com/d8/4c/IagSbVL0_o.png" width="835"></p> 
<p style="margin-left:.0001pt;text-align:justify;">上传成功</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="229" src="https://images2.imgbox.com/c3/a4/3MCNa05i_o.png" width="848"></p> 
<p style="margin-left:.0001pt;text-align:justify;">上传一个nginx镜像到本地仓库</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon Docker]# vim Dockerfile_nginx    编写安装nginx的Dockerfile文件</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon Docker]# docker build -t centos7-nginx:v1 - &lt; Dockerfile_nginx</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="544" src="https://images2.imgbox.com/e0/da/cZLspaPZ_o.png" width="834"></p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker images</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker tag 0672328a3122 172.20.26.198:5000/centos7-nginx:v1 修改tag号</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker push 172.20.26.198:5000/centos7-nginx:v1  上传nginx镜像到本地仓库</p> 
<p style="margin-left:.0001pt;text-align:justify;">[root@bogon ~]# docker ps | grep 5000</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="341" src="https://images2.imgbox.com/80/11/Vf89zybJ_o.png" width="855"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看本地私有仓库里的镜像</p> 
<p style="margin-left:.0001pt;text-align:justify;">ls -l /data/registry/docker/registry/v2/repositories/</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="176" src="https://images2.imgbox.com/75/1e/tHE5dI15_o.png" width="846"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">添加2个nginx“外部”服务的容器，使用本地私有仓库</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="477" src="https://images2.imgbox.com/e5/04/cfEzgrQz_o.png" width="834"></p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="386" src="https://images2.imgbox.com/e0/cb/2hY1u9iZ_o.png" width="635"></p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="386" src="https://images2.imgbox.com/e5/c7/U6rPOZBb_o.png" width="848"></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#ff5722;">Failed to pull image "172.20.26.198:5000/nginx:latest": Get https://172.20.26.198:5000/v1/_ping: http: server gave HTTP response to HTTPS client</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#ff5722;">Error syncing pod, skipping: failed to "StartContainer" for "nginx" with ErrImagePull: "Get https://172.20.26.198:5000/v1/_ping: http: server gave HTTP response to HTTPS client"</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">以上错误原因是在172.20.26.210节点上daemon.json文件里要指定本地私有仓库的地址，</p> 
<p style="margin-left:.0001pt;text-align:justify;">vim /etc/docker/daemon.json</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="129" src="https://images2.imgbox.com/d6/11/SLbW02dF_o.png" width="859"></p> 
<p style="margin-left:.0001pt;text-align:justify;">执行以下命令，重启相关服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">for  I  in  kube-proxy  kubelet  flanneld docker</p> 
<p style="margin-left:.0001pt;text-align:justify;">do</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl  restart  $I</p> 
<p style="margin-left:.0001pt;text-align:justify;">systemctl  enable  $I</p> 
<p style="margin-left:.0001pt;text-align:justify;">done</p> 
<p style="margin-left:.0001pt;text-align:justify;">service iptables stop;iptables -P FORWARD ACCEPT</p> 
<p style="margin-left:.0001pt;text-align:justify;">回到k8sweb界面，查看错误状态是否已消失</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="523" src="https://images2.imgbox.com/83/6a/j8LeeMxS_o.png" width="857"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;">故障问题：</span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">用Dockerfile 做了个镜像，改了tag号，push 到本地仓库，提示连接被拒绝</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="257" src="https://images2.imgbox.com/e7/ba/VULe6lT3_o.png" width="837"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;">解决：</span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">docker run -itd  -p  5000:5000 -v /data/registry:/var/lib/registry  docker.io/registry</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker ps</p> 
<p style="margin-left:.0001pt;text-align:justify;">docker push 172.20.26.198:5000/centos7-nginx:v2</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="135" src="https://images2.imgbox.com/36/db/C4GhetJ9_o.png" width="851"></p> 
<p style="margin-left:.0001pt;text-align:justify;">创建部署外部nginx主机</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="423" src="https://images2.imgbox.com/86/b0/Bl1tPtlw_o.png" width="842"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="383" src="https://images2.imgbox.com/bc/dd/yiJCcXld_o.png" width="473"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="492" src="https://images2.imgbox.com/65/4b/3yErUWqY_o.png" width="847"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;">故障问题：</span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="414" src="https://images2.imgbox.com/fa/35/gJBJmMvU_o.png" width="846"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="240" src="https://images2.imgbox.com/fc/ce/aC9YiQXk_o.png" width="856"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>故障问题</strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="171" src="https://images2.imgbox.com/3c/4f/UyhyGOFe_o.png" width="846"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;">Master</span></strong><strong><span style="color:#ff0000;">、Minion端排查解决：</span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">Master端：</p> 
<p style="margin-left:.0001pt;text-align:justify;">1、ps -ef | grep kube 查看kube-apiserver、kube-controller-manager、kube-scheduler服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">2、 ps -ef |grep flanneld  查看flanneld的状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">3、ifconfig 查看网卡地址情况（是否有flannel0地址）</p> 
<p style="margin-left:.0001pt;text-align:justify;">Minion端：</p> 
<p style="margin-left:.0001pt;text-align:justify;">1、ps -ef |grep kube 查看kubelet、kube-proxy服务</p> 
<p style="margin-left:.0001pt;text-align:justify;">2、ps -ef |grep docker  查看Docker状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">3、 ps -ef |grep flanneld 查看flanneld的状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">4、iptables -t filter -L -n  查看是否是Chain FORWARD (policy ACCEPT)状态，如不是，执行iptables -P FORWARD ACCEPT命令</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c01ec714fd4219d6125b1aa633e49f5f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">phpstorm: Failed to transfer file could not close the output stream for file</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a9d1b5d19fd38f82a30a9b5995ed0d86/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">将elasticsearch数据存储到excel中</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>