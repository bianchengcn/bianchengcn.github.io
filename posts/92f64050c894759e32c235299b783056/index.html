<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>libcurl部分总结 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="libcurl部分总结" />
<meta property="og:description" content="curl是开源的东西,主要用于页面下载和上传 1、对于页面跳转的网站，最好先用sniffer把http数据包全部抓下，分析协议头，尤其是要对应好post后的url地址，以及记住cookie中的session_id（情况根据各网站会有所差别）。 2、 curl_easy_setopt(curl,CURLOPT_POST,1); 使用POST方式 3、curl_easy_setopt(curl,CURLOPT_POSTFIELDS,buffer） buffer对应content中的内容，类似&#34;name=zhangsan&amp;pwd=1234&amp;Submit2=%B5%C7&#43;%C2%BC&amp;oriurl=%2F&amp;flag=0&#34;。 4、res=curl_easy_setopt(curl,CURLOPT_COOKIEFILE,&#34;&#34;); 记下cookie到内存，可以在以后跳转中不用再设置cookie内容（根据网站设计有所差别） curl_easy_setopt(curl,CURLOPT_URL,host&#43;posturl1）//首个地址 5、curl_easy_perform(curl); 6、curl_easy_getinfo(curl,CURLINFO_RESPONSE_CODE,&amp;infocode); 7、通过的到的返回码，准备跳转 8、curl_easy_setopt(curl,CURLOPT_URL,host&#43;url2） 新的跳转页面地址 9、curl_easy_perform(curl); 最后搞定。 需要注意的是host为网站服务url，后面的posturl为实际要请求的相对地址。 最简单的例子： #include &lt;stdio.h&gt;;
#include &lt;curl/curl.h&gt;;
#include &lt;stdlib.h&gt;;
int main(int argc, char *argv[])
{
CURL *curl; //定义CURL类型的指针
CURLcode res; //定义CURLcode类型的变量
if(argc!=2)
{
printf(&#34;Usage : file &lt;url&gt;;\n&#34;);
exit(1);
}
curl = curl_easy_init(); //初始化一个CURL类型的指针
if(curl!=NULL)
{
//设置curl选项. 其中CURLOPT_URL是让用户指定url. argv[1]中存放的命令行传进来的网址
curl_easy_setopt(curl, CURLOPT_URL, argv[1]); //调用curl_easy_perform 执行我们的设置.并进行相关的操作. 在这里只在屏幕上显示出来.
res = curl_easy_perform(curl);
//清除curl操作.
curl_easy_cleanup(curl);
}
return 0;
} 注：官网上有很多资料" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/92f64050c894759e32c235299b783056/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-09-27T18:53:23+08:00" />
<meta property="article:modified_time" content="2013-09-27T18:53:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">libcurl部分总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <span style="font-family:Fixedsys"><span style="color:#0000cc"></span></span> 
 <div> 
  <div>
    curl是开源的东西,主要用于页面下载和上传 
  </div> 
 </div> 
 <div>
   1、对于页面跳转的网站，最好先用sniffer把http数据包全部抓下，分析协议头，尤其是要对应好post后的url地址，以及记住cookie中的session_id（情况根据各网站会有所差别）。 
 </div> 
 <div>
   2、 curl_easy_setopt(curl,CURLOPT_POST,1); 
 </div> 
 <div>
   使用POST方式 
 </div> 
 <div>
   3、curl_easy_setopt(curl,CURLOPT_POSTFIELDS,buffer） 
 </div> 
 <div>
   buffer对应content中的内容，类似"name=zhangsan&amp;pwd=1234&amp;Submit2=%B5%C7+%C2%BC&amp;oriurl=%2F&amp;flag=0"。 
 </div> 
 <div>
   4、res=curl_easy_setopt(curl,CURLOPT_COOKIEFILE,""); 
 </div> 
 <div>
   记下cookie到内存，可以在以后跳转中不用再设置cookie内容（根据网站设计有所差别） 
 </div> 
 <div>
   curl_easy_setopt(curl,CURLOPT_URL,host+posturl1）//首个地址 
 </div> 
 <div>
   5、curl_easy_perform(curl); 
 </div> 
 <div>
   6、curl_easy_getinfo(curl,CURLINFO_RESPONSE_CODE,&amp;infocode); 
 </div> 
 <div>
   7、通过的到的返回码，准备跳转 
 </div> 
 <div>
   8、curl_easy_setopt(curl,CURLOPT_URL,host+url2） 
 </div> 
 <div>
   新的跳转页面地址 
 </div> 
 <div>
   9、curl_easy_perform(curl); 
 </div> 
 <div>
   最后搞定。 
 </div> 
 <div>
   需要注意的是host为网站服务url，后面的posturl为实际要请求的相对地址。 
 </div> 
</div> 
<div> 
 <span style="font-family:Fixedsys"><span style="color:#0000cc">最简单的例子：</span></span> 
</div> 
<div> 
 <span style="font-family:Fixedsys"><span style="color:#0000cc">#</span><span style="color:#ff0000">include</span> <span style="color:#0000cc">&lt;</span>stdio<span style="color:#0000cc">.</span>h<span style="color:#0000cc">&gt;</span><span style="color:#0000cc">;</span><br> <span style="color:#0000cc">#</span><span style="color:#ff0000">include</span> <span style="color:#0000cc"> &lt;</span>curl<span style="color:#0000cc">/</span>curl<span style="color:#0000cc">.</span>h<span style="color:#0000cc">&gt;</span><span style="color:#0000cc">;</span><br> <span style="color:#0000cc">#</span><span style="color:#ff0000">include</span> <span style="color:#0000cc"> &lt;</span>stdlib<span style="color:#0000cc">.</span>h<span style="color:#0000cc">&gt;</span><span style="color:#0000cc">;</span><br> <br> <span style="color:#0000ff">int</span> main<span style="color:#0000cc">(</span><span style="color:#0000ff">int</span> argc<span style="color:#0000cc">,</span> <span style="color:#0000ff">char</span> <span style="color:#0000cc">*</span>argv<span style="color:#0000cc">[</span><span style="color:#0000cc">]</span><span style="color:#0000cc">)</span><br> <span style="color:#0000cc">{<!-- --></span><br>     CURL <span style="color:#0000cc">*</span>curl<span style="color:#0000cc">;</span>                        </span> 
 <span style="font-family:Fixedsys"><span style="color:#ff9900">//定义CURL类型的指针<br> </span><br>     CURLcode res<span style="color:#0000cc">;</span>                </span> 
 <span style="font-family:Fixedsys"><span style="color:#ff9900">//定义CURLcode类型的变量<br> </span><br> <br>     <span style="color:#0000ff">if</span><span style="color:#0000cc">(</span>argc!=2<span style="color:#0000cc">)</span><br>     <span style="color:#0000cc">{<!-- --></span><br>         <span style="color:#ff0000">printf</span><span style="color:#0000cc">(</span><span style="color:#ff00ff">"Usage : file &lt;url&gt;;\n"</span><span style="color:#0000cc">)</span><span style="color:#0000cc">;</span><br>         <span style="color:#ff0000">exit</span><span style="color:#0000cc">(</span>1<span style="color:#0000cc">)</span><span style="color:#0000cc">;</span><br>     <span style="color:#0000cc">}</span><br> <br>     curl <span style="color:#0000cc">=</span> curl_easy_init<span style="color:#0000cc">(</span><span style="color:#0000cc">)</span><span style="color:#0000cc">;</span>        </span> 
 <span style="font-family:Fixedsys"><span style="color:#ff9900">//初始化一个CURL类型的指针<br> </span><br>     <span style="color:#0000ff">if</span><span style="color:#0000cc">(</span>curl!=NULL<span style="color:#0000cc">)</span><br>     <span style="color:#0000cc">{<!-- --></span><br>         </span> 
 <span style="font-family:Fixedsys"><span style="color:#ff9900">//设置curl选项. 其中CURLOPT_URL是让用户指定url. argv[1]中存放的命令行传进来的网址<br> </span><br>         curl_easy_setopt<span style="color:#0000cc">(</span>curl<span style="color:#0000cc">,</span> CURLOPT_URL<span style="color:#0000cc">,</span> argv<span style="color:#0000cc">[</span>1<span style="color:#0000cc">]</span><span style="color:#0000cc">)</span><span style="color:#0000cc">;</span>        <br>         </span> 
 <span style="font-family:Fixedsys"><span style="color:#ff9900">//调用curl_easy_perform 执行我们的设置.并进行相关的操作. 在这里只在屏幕上显示出来.<br> </span><br>         res <span style="color:#0000cc">=</span> curl_easy_perform<span style="color:#0000cc">(</span>curl<span style="color:#0000cc">)</span><span style="color:#0000cc">;</span><br>         </span> 
 <span style="font-family:Fixedsys"><span style="color:#ff9900">//清除curl操作.<br> </span><br>         curl_easy_cleanup<span style="color:#0000cc">(</span>curl<span style="color:#0000cc">)</span><span style="color:#0000cc">;</span><br>     <span style="color:#0000cc">}</span><br>     <span style="color:#0000ff">return</span> 0<span style="color:#0000cc">;</span><br> <span style="color:#0000cc">}</span></span> 
</div> 
<div> 
 <span style="font-family:Fixedsys; color:#0000cc"></span>  
</div> 
<div> 
 <span style="font-family:Fixedsys; color:#0000cc">注：官网上有很多资料<br> <a target="_blank" href="http://curl.haxx.se/libcurl/" rel="nofollow noopener noreferrer"><span style="color:#800080">http://curl.haxx.se/libcurl/</span></a><br> 教程、手册、例子，应有尽有。<br> <br> 另外，往屏幕上输出是 libcurl 的缺省动作，如果要想改变，可以看下如下几个连接：<br> <a target="_blank" href="http://curl.haxx.se/libcurl/c/curl_easy_setopt.html#CURLOPTREADDATA" rel="nofollow noopener noreferrer"><span style="color:#800080">http://curl.haxx.se/libcurl/c/cu ... tml#CURLOPTREADDATA</span></a><br> <a target="_blank" href="http://curl.haxx.se/libcurl/c/curl_easy_setopt.html#CURLOPTREADFUNCTION" rel="nofollow noopener noreferrer"><span style="color:#800080">http://curl.haxx.se/libcurl/c/cu ... CURLOPTREADFUNCTION</span></a></span> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f188e85d2365e46d2a3703e2257320f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">QtCreator:没有CDB二进制档可用为二进制格式在&#39;x86-windows-msvc2008-pe-32bit&#39;&#34;</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/acea2cd3cfca5fba0b7ba773f92f04cc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">openCV python 安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>