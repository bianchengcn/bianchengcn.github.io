<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>内网离线地图 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="内网离线地图" />
<meta property="og:description" content="1.第一种瓦片数据源
MapDownloader：
链接：https://pan.baidu.com/s/1Hz__HcA5QhtGmjLNezC_pQ
提取码：6lek
GISMysqlToLocalFile：
链接：https://pan.baidu.com/s/1rzVsj_DJxKr6OyvRwve4dg
提取码：pp6f
自测可以使用
教程来自：https://www.cnblogs.com/kanyun/p/8571711.html
使用 Leaflet 加载地图瓦片：
&lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;title&gt;web 版离线地图测试页面&lt;/title&gt; &lt;link rel=&#34;stylesheet&#34; href=&#34;https://unpkg.com/leaflet@1.4.0/dist/leaflet.css&#34; /&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=&#34;map&#34; style=&#34;width:90%;height:600px;margin-top:30px;text-align:center;margin:0 auto;&#34;&gt; &lt;/div&gt; &lt;script src=&#34;https://unpkg.com/leaflet@1.4.0/dist/leaflet.js&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34;&gt; window.onload=function () { var map = L.map(&#39;map&#39;).setView([34.3195,108.9131], 11); L.tileLayer(&#39;./map/{z}/{x}/{y}.png&#39; //瓦片路径 , { minZoom: 1, maxZoom: 18, attribution: &#39;&lt;b style=&#34;color:#dddddd&#34;&gt;百度地图&lt;/b&gt;&#39; }) .addTo(map); }; &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; leaflet更多复杂操作可以查看中文文档：
https://blog.csdn.net/YXWik/article/details/103389800
2.第二种瓦片数据源
全能电子地图下载器（破解版）
链接：https://pan.baidu.com/s/1EBa0Ck8UGiFK0G7DCUhw1w
提取码：i8yc
自测可以使用
教程来自：https://blog.csdn.net/qq_41619796/article/details/90241491" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/b6a53d4cfea45a39145c3f52650fd4ba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-30T17:00:44+08:00" />
<meta property="article:modified_time" content="2020-10-30T17:00:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">内网离线地图</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>1.第一种瓦片数据源</strong><br> MapDownloader：<br> 链接：<code>https://pan.baidu.com/s/1Hz__HcA5QhtGmjLNezC_pQ</code><br> 提取码：<code>6lek</code><br> GISMysqlToLocalFile：<br> 链接：<code>https://pan.baidu.com/s/1rzVsj_DJxKr6OyvRwve4dg</code><br> 提取码：<code>pp6f</code><br> 自测可以使用<br> 教程来自：<a href="https://www.cnblogs.com/kanyun/p/8571711.html" rel="nofollow">https://www.cnblogs.com/kanyun/p/8571711.html</a><br> 使用 Leaflet 加载地图瓦片：</p> 
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;web 版离线地图测试页面&lt;/title&gt;
    
    &lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" /&gt;    
    
&lt;/head&gt;
&lt;body&gt;

    &lt;div id="map" style="width:90%;height:600px;margin-top:30px;text-align:center;margin:0 auto;"&gt;
    &lt;/div&gt;

    &lt;script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"&gt;&lt;/script&gt;
    
    &lt;script type="text/javascript"&gt;
        window.onload=function () {
            var map = L.map('map').setView([34.3195,108.9131], 11);
            L.tileLayer('./map/{z}/{x}/{y}.png' //瓦片路径
                , {
                    minZoom: 1,
                    maxZoom: 18,
                    attribution: '&lt;b style="color:#dddddd"&gt;百度地图&lt;/b&gt;'
                })
            .addTo(map);
            
        };    
    &lt;/script&gt;
    
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
<p>leaflet更多复杂操作可以查看中文文档：<br> <a href="https://blog.csdn.net/YXWik/article/details/103389800">https://blog.csdn.net/YXWik/article/details/103389800</a></p> 
<p><strong>2.第二种瓦片数据源</strong><br> 全能电子地图下载器（破解版）<br> 链接：<code>https://pan.baidu.com/s/1EBa0Ck8UGiFK0G7DCUhw1w</code><br> 提取码：<code>i8yc</code><br> 自测可以使用<br> 教程来自：<a href="https://blog.csdn.net/qq_41619796/article/details/90241491">https://blog.csdn.net/qq_41619796/article/details/90241491</a><br> <strong>3.第三种来源网上，需要自测</strong><br> 来源：<a href="https://www.jianshu.com/p/ad9ce1b3c442" rel="nofollow">https://www.jianshu.com/p/ad9ce1b3c442</a></p> 
<p>内容：<br> Web GIS离线解决方案:<br> 在CS系统中可以基于GMap.Net来做，参考《百度谷歌离线地图解决方案》</p> 
<p>下面介绍下Web系统如何使用GIS切片数据，开发web GIS系统。</p> 
<p>首先开发web GIS 主要是采用一些前端框架，目前主流的gis前端框架是 openlayers 和 Leaflet 至于两者优劣，读者可自行百度，我在项目中使用的是 Leaflet</p> 
<p>打开地图下载器（工具在底部的github项目里，可自行下载）</p> 
<p>找到 MapDownloader.exe.config 文件 进行修改<br> <img src="https://images2.imgbox.com/a4/6c/5eoSngzD_o.png" alt="在这里插入图片描述"></p> 
<p>具体的就是修改我红框中的内容：该数据库地址，用户名密码等扽，改成自己的就行</p> 
<p>修改保存，双击 <img src="https://images2.imgbox.com/6e/74/AnSNqHOp_o.png" alt="在这里插入图片描述"></p> 
<p>然后做一些设置<br> <img src="https://images2.imgbox.com/a1/62/sDpUk9Ad_o.png" alt="在这里插入图片描述"></p> 
<p>首先选择mysql数据库，其次选择你要下载地图的地方，我这里选择的是北京，根据自己的需求进行选择，选择的位置过大，下载的时间就会很长</p> 
<p>接下来选择地图，这一步操作十分重要我在这一步耽误了很长时间，一开始的时候没有选择地图，结果出现地图不显示的情况，后台换百度，谷歌都不行，换了高德就没问题了，个人可以依情况选择</p> 
<p><img src="https://images2.imgbox.com/27/cf/joQqfwqr_o.png" alt="在这里插入图片描述"></p> 
<p>就是这个菜单，选择需要下载的地图提供方，选择完毕之后，双击弹出提示框</p> 
<p><img src="https://images2.imgbox.com/d9/61/Ut3LS16g_o.png" alt="在这里插入图片描述"></p> 
<p>这是让你选择下载的级别，通俗来说就是地图的精细程度，级别越大地图就能显示的越精准，需要注意的是，当级别超过15，地图的数据量会特别大，这里给出级别为15的地图的样子，个人可以根据情况来判定</p> 
<p>级别选到15大概就是这个样子<br> <img src="https://images2.imgbox.com/87/a4/fkuSyN2T_o.png" alt="在这里插入图片描述"></p> 
<p>等待下载完成之后，进入你的mysql 数据库 发现新建了一张数据表</p> 
<p><img src="https://images2.imgbox.com/87/a1/KMcF54Db_o.png" alt="在这里插入图片描述"></p> 
<p>接下来要做的就是把这张数据库表的数据，导出成瓦片地图（其实就是一张张有规律的256*256图片）</p> 
<p>打开 GISMysqlToLocal.exe（后面会给出下载地址）<br> <img src="https://images2.imgbox.com/a8/b9/mxSWypbE_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c7/15/hnXmiQhW_o.png" alt="在这里插入图片描述"></p> 
<p>该填写的填写完整，然后点击导出就可以导出图片了，导出完成后，进入你导出的文件夹内 ，可以看到导出的内容是这样的<br> <img src="https://images2.imgbox.com/e4/2a/qIncvc06_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/92/6c/dJ0thTGN_o.png" alt="在这里插入图片描述"></p> 
<p>都是文件夹套文件夹的形式，然后会到导出的文件夹下，使用Ngix启动服务，也就是把这里图片都放到web服务器里面，你可以使用Nginx,也可以使用Apache,甚至于tomcat</p> 
<p>这里我只介绍一下用tomcat配置静态资源访问</p> 
<p>我们都知道tomcat可以配置静态资源和动态资源，但是实际工作过程中，我们都是把静态资源跟动态资源放到一个项目的源代码里，进行打包部署，那么对于我们的离线地图，静态资源是十分大的，</p> 
<p>把离线地图跟我们的代码放到一个项目里面显然不现实，所以我们需要把静态资源放到其他路径</p> 
<p>如：</p> 
<pre><code class="prism language-java"><span class="token operator">/</span>data<span class="token operator">/</span>googlemaps
</code></pre> 
<p>那我们把文件放到这个目录，浏览器如何访问呢，使用tomcat的话，在此处配置</p> 
<pre><code class="prism language-java">​<span class="token operator">&lt;</span>Host name<span class="token operator">=</span><span class="token string">"localhost"</span> appBase<span class="token operator">=</span><span class="token string">"webapps"</span> unpackWARs<span class="token operator">=</span><span class="token string">"true"</span> autoDeploy<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>Valve className<span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.AccessLogValve"</span> directory<span class="token operator">=</span><span class="token string">"logs"</span> prefix<span class="token operator">=</span><span class="token string">"localhost_access_log."</span>  
        suffix<span class="token operator">=</span><span class="token string">".txt"</span> pattern<span class="token operator">=</span><span class="token string">"%h %l %u %t "</span><span class="token operator">%</span>r<span class="token string">" %s %b"</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>在Host标签下加入Context标签，path指的是服务器url请求地址（例如<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">/</span>data）， 
        docBase指的是服务器文件的路径，reloadable指的是在omcat不重启的情况下实时同步本地目录<span class="token punctuation">,</span>
      一个虚拟主机下可以配置多个Comtext标签<span class="token operator">--</span><span class="token operator">&gt;</span>     
    <span class="token operator">&lt;</span>Context path<span class="token operator">=</span><span class="token string">"/"</span> docBase<span class="token operator">=</span><span class="token string">"//usr/local/tomcat/webapps/officeMap"</span>     reloadable<span class="token operator">=</span><span class="token string">"true"</span> debug<span class="token operator">=</span><span class="token string">"0"</span>  crossContext<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Context path<span class="token operator">=</span><span class="token string">"/googleMap"</span> docBase<span class="token operator">=</span><span class="token string">"/data/googleMap"</span> reloadable<span class="token operator">=</span><span class="token string">"true"</span> debug<span class="token operator">=</span><span class="token string">"0"</span> crossContext<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span><span class="token operator">/</span>Host<span class="token operator">&gt;</span>
</code></pre> 
<p>注意标注颜色的地方，一般我们都只是在Host标签下配置一个Context标签(你的应用)，其实是可以配置两个标签，表示同一个端口的不同地址，重启tomcat之后，这样当你访问 http://localhost:8080/googleMap/hello.png，就可以访问静态资源了</p> 
<p>当然你直接访问你的应用 localhost:8080 也是没有问题的</p> 
<p>当然你习惯哪个都行(生产环境推荐Nginx，测试环境推荐使用tomcat，因为可以省的配置Nginx)，只要我之后可以通过浏览器去访问就可以（我这里使用了一个http-server的一个工具，不过需要先安装Node，具体看个人需求了），启动完成之后，测试使用浏览器访问 具体就是 “ip+端口+路径” 能访问到图片说明服务已经启动成功， 暂且先不用管他</p> 
<p>接下来编写html页面</p> 
<p>第一步引入js css</p> 
<p>标箭头的是必须要引入的</p> 
<p>接下来</p> 
<pre><code class="prism language-java">#定义一个DIV作为地图的容器，一定要为它设置wdith<span class="token punctuation">,</span>height
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"map"</span><span class="token operator">&gt;</span>


<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> 
<p>接下来写js</p> 
<pre><code class="prism language-java">  var map
    #这个地址就是你刚才启动服务器的地址 <span class="token number">788865972</span> 代表你导出图片的最上层文件夹，这个文件夹也是自动生成的
    var osmUrl <span class="token operator">=</span> <span class="token string">'http://localhost/788865972/{z}/{x}/{y}.png'</span><span class="token punctuation">;</span>
    var osmAttrib <span class="token operator">=</span> <span class="token string">'&lt;b style="color:#dddddd"&gt;高德地图&lt;/b&gt;'</span><span class="token punctuation">;</span>
    var osm<span class="token punctuation">;</span>
    $<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        osm <span class="token operator">=</span> L<span class="token punctuation">.</span><span class="token function">tileLayer</span><span class="token punctuation">(</span>osmUrl<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            minZoom<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            maxZoom<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
            attribution<span class="token operator">:</span> osmAttrib

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　map <span class="token operator">=</span> L<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'map'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setView</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">39.908419</span><span class="token punctuation">,</span> <span class="token number">116.397743</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>osm<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
</code></pre> 
<p>以上就是地图的初始化方法：</p> 
<p>写完之后，保存双击html 就应该可以看到地图了</p> 
<p><img src="https://images2.imgbox.com/3f/a0/U3sveBni_o.png" alt="在这里插入图片描述"></p> 
<p>红框是我后加的内容，至此离线地图基本已经创建完成了，要想实现更多的功能，比如地图搜索，地图标记可以看我的源码，以及官网的API</p> 
<p><img src="https://images2.imgbox.com/31/d3/tlNn3wYc_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fa/11/xMpoF2AZ_o.png" alt="在这里插入图片描述"></p> 
<p>特别需要提一点的是关于离线地图的搜索，是需要你内网的数据库里面有位置信息，然后把第三方的位置信息抓取过来，放到自己的数据库里进行搜索等等，并非leafletjs所自有的</p> 
<p>不过Leaflet的功能还是非常丰富的</p> 
<p>可以自行到官网查看：http://leafletjs.com/</p> 
<p>关于搜索的扩展功能，我的后台源码里已经写了，首先自己需要创建一张数据库表，此表需要有你抓取坐标的经纬度，名称，位置信息等字段，坐标抓取方法，可自行百度，单需要记住一点，你用地图下载器下载的什么地图，抓取坐标信息</p> 
<p>就抓取哪个地图的坐标信息，我测试的数据是在网上下载的，如果你需要最新的数据，那么需要自己去抓取。我后台使用springboot写的，建表sql，已经下载地图工具都包含在里面了，直接下载源码，打开地图下载器，下载地图，然后导出瓦片图片</p> 
<p>再抓取一些坐标信息，就可以看到地图，并且实现搜索功能了</p> 
<p>源码连接：https://github.com/chenwuwen/OffineMap</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3c499466c0ecb4f74712cd6bb879984f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue  设置背景颜色及透明度</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6549624a69b72208ccc6b45214d1eae2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python恶搞-python—做一个恶搞程序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>