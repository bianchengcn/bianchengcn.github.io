<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Godot】时间线（技能）节点 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Godot】时间线（技能）节点" />
<meta property="og:description" content="4.1
游戏中一般都会有各种各样的技能，或者其他需要按一定的时间顺序去执行的功能。
这里我写出了一个时间线节点，就像是在播放动画一样，按一定的阶段去执行某些功能
#============================================================ # Timeline #============================================================ # - author: zhangxuetu # - datetime: 2023-09-24 23:10:53 # - version: 4.1 #============================================================ class_name _TimeLine extends Node ## 执行完这个阶段时发出这个信号 signal executed_stage(stage, data) ## 手动停止执行 signal stopped ## 暂停执行 signal paused ## 继续执行 signal resumed ## 执行完成 signal finished ## process 执行方式 enum ProcessExecuteMode { PROCESS, ## _process 执行 PHYSICS, ## _physics_process 执行 } enum { UNEXECUTED, ## 未执行 EXECUTING, ## 执行中 PAUSED, ## 暂停中 } ## 时间阶段名称。这关系到 [method execute] 方法中的数据获取的时间数据 @export var stages : Array = [] ## process 执行方式。如果设置为 [member PROCESS] 或 [member PHYSICS] 以外的值， ## 则当前节点的线程将不会执行 @export var process_execute_mode : ProcessExecuteMode = ProcessExecuteMode." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/065dfe68b64981f5017edee2a01a021f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-07T14:29:10+08:00" />
<meta property="article:modified_time" content="2023-10-07T14:29:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Godot】时间线（技能）节点</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>4.1</p> 
</blockquote> 
<p>游戏中一般都会有各种各样的技能，或者其他需要按一定的时间顺序去执行的功能。</p> 
<p>这里我写出了一个时间线节点，就像是在播放动画一样，按一定的阶段去执行某些功能</p> 
<pre><code class="prism language-js">#<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span>
#    Timeline
#<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span>
# <span class="token operator">-</span> author<span class="token operator">:</span> zhangxuetu
# <span class="token operator">-</span> datetime<span class="token operator">:</span> <span class="token number">2023</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">53</span>
# <span class="token operator">-</span> version<span class="token operator">:</span> <span class="token number">4.1</span>
#<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span>
class_name _TimeLine
<span class="token keyword">extends</span> <span class="token class-name">Node</span>


## 执行完这个阶段时发出这个信号
signal <span class="token function">executed_stage</span><span class="token punctuation">(</span>stage<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
## 手动停止执行
signal stopped
## 暂停执行
signal paused
## 继续执行
signal resumed
## 执行完成
signal finished


## process 执行方式
<span class="token keyword">enum</span> ProcessExecuteMode <span class="token punctuation">{<!-- --></span>
	<span class="token constant">PROCESS</span><span class="token punctuation">,</span> ## _process 执行
	<span class="token constant">PHYSICS</span><span class="token punctuation">,</span> ## _physics_process 执行
<span class="token punctuation">}</span>

<span class="token keyword">enum</span> <span class="token punctuation">{<!-- --></span>
	<span class="token constant">UNEXECUTED</span><span class="token punctuation">,</span> ## 未执行
	<span class="token constant">EXECUTING</span><span class="token punctuation">,</span> ## 执行中
	<span class="token constant">PAUSED</span><span class="token punctuation">,</span> ## 暂停中
<span class="token punctuation">}</span>


## 时间阶段名称。这关系到 <span class="token punctuation">[</span>method execute<span class="token punctuation">]</span> 方法中的数据获取的时间数据
@<span class="token keyword">export</span> <span class="token keyword">var</span> <span class="token literal-property property">stages</span> <span class="token operator">:</span> Array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
## process 执行方式。如果设置为 <span class="token punctuation">[</span>member <span class="token constant">PROCESS</span><span class="token punctuation">]</span> 或 <span class="token punctuation">[</span>member <span class="token constant">PHYSICS</span><span class="token punctuation">]</span> 以外的值，
## 则当前节点的线程将不会执行
@<span class="token keyword">export</span> <span class="token keyword">var</span> <span class="token literal-property property">process_execute_mode</span> <span class="token operator">:</span> ProcessExecuteMode <span class="token operator">=</span> ProcessExecuteMode<span class="token punctuation">.</span><span class="token constant">PROCESS</span>


<span class="token keyword">var</span> <span class="token literal-property property">_last_data</span> <span class="token operator">:</span> Dictionary
<span class="token keyword">var</span> <span class="token literal-property property">_point</span> <span class="token operator">:</span> int <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span>
	<span class="token function">set</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token operator">:</span>
		<span class="token keyword">if</span> _point <span class="token operator">!=</span> v<span class="token operator">:</span>
			_point <span class="token operator">=</span> v
			<span class="token keyword">if</span> _point <span class="token operator">&gt;=</span> <span class="token number">0</span> and _point <span class="token operator">&lt;</span> stages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
				self<span class="token punctuation">.</span>executed_stage<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>stages<span class="token punctuation">[</span>_point<span class="token punctuation">]</span><span class="token punctuation">,</span> _last_data<span class="token punctuation">)</span>
<span class="token keyword">var</span> <span class="token literal-property property">_time</span> <span class="token operator">:</span> float
<span class="token keyword">var</span> <span class="token literal-property property">_execute_state</span> <span class="token operator">:</span> int <span class="token operator">=</span> <span class="token constant">UNEXECUTED</span><span class="token operator">:</span>
	<span class="token function">set</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token operator">:</span>
		<span class="token keyword">if</span> _execute_state <span class="token operator">==</span> v<span class="token operator">:</span>
			<span class="token keyword">return</span>

		_execute_state <span class="token operator">=</span> v
		match _execute_state<span class="token operator">:</span>
			<span class="token constant">UNEXECUTED</span><span class="token operator">:</span>
				<span class="token function">set_process</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
				<span class="token function">set_physics_process</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
			<span class="token constant">EXECUTING</span><span class="token operator">:</span>
				<span class="token keyword">if</span> process_execute_mode <span class="token operator">==</span> ProcessExecuteMode<span class="token punctuation">.</span><span class="token constant">PROCESS</span><span class="token operator">:</span>
					<span class="token function">set_process</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
				elif process_execute_mode <span class="token operator">==</span> ProcessExecuteMode<span class="token punctuation">.</span><span class="token constant">PHYSICS</span><span class="token operator">:</span>
					<span class="token function">set_physics_process</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
			<span class="token constant">PAUSED</span><span class="token operator">:</span>
				<span class="token function">set_process</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
				<span class="token function">set_physics_process</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>


func <span class="token function">_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token function">set_process</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token function">set_physics_process</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

func <span class="token function">_process</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token function">_exec</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span>

func <span class="token function">_physics_process</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token function">_exec</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span>

func <span class="token function">_exec</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token operator">:</span>
	_time <span class="token operator">-=</span> delta
	<span class="token keyword">while</span> _time <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token operator">:</span>
		_point <span class="token operator">+=</span> <span class="token number">1</span>
		<span class="token keyword">if</span> _point <span class="token operator">&lt;</span> stages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
			_time <span class="token operator">+=</span> _last_data<span class="token punctuation">[</span>stages<span class="token punctuation">[</span>_point<span class="token punctuation">]</span><span class="token punctuation">]</span>
		<span class="token keyword">else</span><span class="token operator">:</span>
			_point <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
			_execute_state <span class="token operator">=</span> <span class="token constant">UNEXECUTED</span>
			self<span class="token punctuation">.</span>finished<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">break</span>

func <span class="token function">get_time_left</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token keyword">return</span> _time

func <span class="token function">get_last_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dictionary<span class="token operator">:</span>
	<span class="token keyword">return</span> _last_data

func <span class="token function">get_last_stage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token keyword">return</span> stages<span class="token punctuation">[</span>_point<span class="token punctuation">]</span>

## 执行功能。这个数据里需要有 <span class="token punctuation">[</span>member stages<span class="token punctuation">]</span> 中的 key 的数据，且需要是 <span class="token punctuation">[</span>int<span class="token punctuation">]</span> 或 <span class="token punctuation">[</span>float<span class="token punctuation">]</span>
## 类型作为判断执行的时间。否则默认时间为 <span class="token number">0</span>
func <span class="token function">execute</span><span class="token punctuation">(</span>data<span class="token operator">:</span> Dictionary<span class="token punctuation">)</span><span class="token operator">:</span>
	_last_data <span class="token operator">=</span> data
	_time <span class="token operator">=</span> <span class="token number">0</span>
	_point <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">if</span> not stages<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
		_execute_state <span class="token operator">=</span> <span class="token constant">EXECUTING</span>
		<span class="token keyword">for</span> stage <span class="token keyword">in</span> <span class="token literal-property property">stages</span><span class="token operator">:</span>
			_last_data<span class="token punctuation">[</span>stage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">float</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>stage<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		# 执行时会先执行一下
		_time <span class="token operator">=</span> _last_data<span class="token punctuation">[</span>stages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
		<span class="token function">_exec</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

	<span class="token keyword">else</span><span class="token operator">:</span>
		<span class="token function">printerr</span><span class="token punctuation">(</span><span class="token string">"没有设置 stages，必须要设置每个执行的阶段的 key 值！"</span><span class="token punctuation">)</span>

## 获取执行状态
func <span class="token function">get_execute_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token keyword">return</span> _execute_state

## 是否正在执行
func <span class="token function">is_executing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token keyword">return</span> _execute_state <span class="token operator">==</span> <span class="token constant">EXECUTING</span>

## 停止执行
func <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token keyword">if</span> _execute_state <span class="token operator">==</span> <span class="token constant">EXECUTING</span><span class="token operator">:</span>
		_execute_state <span class="token operator">=</span> <span class="token constant">UNEXECUTED</span>
		self<span class="token punctuation">.</span>stopped<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

## 暂停执行
func <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token keyword">if</span> _execute_state <span class="token operator">==</span> <span class="token constant">EXECUTING</span><span class="token operator">:</span>
		_execute_state <span class="token operator">=</span> <span class="token constant">PAUSED</span>

## 恢复执行
func <span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token keyword">if</span> _execute_state <span class="token operator">==</span> <span class="token constant">PAUSED</span><span class="token operator">:</span>
		_execute_state <span class="token operator">=</span> <span class="token constant">EXECUTING</span>
		self<span class="token punctuation">.</span>resumed<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

## 跳跃到这个阶段
func <span class="token function">goto</span><span class="token punctuation">(</span>stage<span class="token punctuation">,</span> <span class="token literal-property property">emit_stage_changed_signal</span><span class="token operator">:</span> bool <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token keyword">if</span> _execute_state <span class="token operator">==</span> <span class="token constant">EXECUTING</span><span class="token operator">:</span>
		<span class="token keyword">if</span> stages<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>stage<span class="token punctuation">)</span><span class="token operator">:</span>
			_point <span class="token operator">=</span> stage
			_time <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token keyword">if</span> <span class="token literal-property property">emit_stage_changed_signal</span><span class="token operator">:</span>
				self<span class="token punctuation">.</span>executed_stage<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">else</span><span class="token operator">:</span>
			<span class="token function">printerr</span><span class="token punctuation">(</span><span class="token string">"stages 中没有 "</span><span class="token punctuation">,</span> stage<span class="token punctuation">,</span> <span class="token string">". 所有 stage: "</span><span class="token punctuation">,</span> stages<span class="token punctuation">)</span>
</code></pre> 
<p>这里我进行添加整个时间中有哪些阶段，我想一个技能需要有下面几个阶段：</p> 
<p>start（开始执行功能，一般用于判断这个条件下是否可以进行执行这个功能，以便进行功能的打断等操作）；before 执行功能时的施放动作前摇；execute 具体执行出的功能；after 执行功能后的动画结束；refresh 技能刷新阶段。</p> 
<p>这是我的理解，可以自行随意设计。</p> 
<p>下面的代码我创建了只有一个 Node2D 作为根节点的场景，进行测试</p> 
<pre><code class="prism language-js">#<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span>
#    Time Line Test
#<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span>
# <span class="token operator">-</span> author<span class="token operator">:</span> zhangxuetu
# <span class="token operator">-</span> datetime<span class="token operator">:</span> <span class="token number">2023</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">51</span><span class="token operator">:</span><span class="token number">11</span>
# <span class="token operator">-</span> version<span class="token operator">:</span> <span class="token number">4.1</span>
#<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span>
<span class="token keyword">extends</span> <span class="token class-name">Node2D</span>


<span class="token keyword">var</span> timeline <span class="token operator">=</span> _TimeLine<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

func <span class="token function">_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	timeline<span class="token punctuation">.</span>stages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token string">"start"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">"before"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">"execute"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">"after"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">"refresh"</span><span class="token punctuation">]</span>
	<span class="token function">add_child</span><span class="token punctuation">(</span>timeline<span class="token punctuation">)</span>

	timeline<span class="token punctuation">.</span>executed_stage<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>_executed_stage<span class="token punctuation">)</span>

	timeline<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"技能名称"</span><span class="token punctuation">,</span>
		<span class="token operator">&amp;</span><span class="token string">"start"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token operator">&amp;</span><span class="token string">"before"</span><span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
		<span class="token operator">&amp;</span><span class="token string">"execute"</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
		<span class="token operator">&amp;</span><span class="token string">"after"</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
		<span class="token operator">&amp;</span><span class="token string">"refresh"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>


func <span class="token function">_executed_stage</span><span class="token punctuation">(</span>stage<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token operator">:</span>
	match stage<span class="token operator">:</span>
		<span class="token operator">&amp;</span><span class="token string">"start"</span><span class="token operator">:</span>
			<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"   开始执行: "</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token operator">&amp;</span><span class="token string">"before"</span><span class="token operator">:</span>
			<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"   播放动作"</span><span class="token punctuation">)</span>
			# 临时修改执行时间，延长或缩短时间
			data<span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token string">"execute"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>
		<span class="token operator">&amp;</span><span class="token string">"execute"</span><span class="token operator">:</span>
			<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"   实际执行功能，这里写这个阶段要做的事情"</span><span class="token punctuation">)</span>
		<span class="token operator">&amp;</span><span class="token string">"after"</span><span class="token operator">:</span>
			<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"   已经执行完功能，进行后续结束动作"</span><span class="token punctuation">)</span>
		<span class="token operator">&amp;</span><span class="token string">"refresh"</span><span class="token operator">:</span>
			<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" 结束动作完成，开始进行倒计时刷新"</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里我在执行这个技能的时候，传入上面各个阶段所需要的时间的数据，然后在 executed_stage 信号中进行判断各个阶段所需要处理的功能。</p> 
<p>这样一个技能节点即可完成，使用时调用 execute 方法即可</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6a92fe04f6d2ba07d5a5a555347d0d3d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Proteus仿真】【STM32单片机】智能饮水机</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bad89324391a04e8bdda02d64f540bbd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CTF 全讲解：[SWPUCTF 2021 新生赛]Do_you_know_http</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>