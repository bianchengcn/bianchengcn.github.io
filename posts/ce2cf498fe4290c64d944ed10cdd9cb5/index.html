<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>unity对于window下的资源管理器的基本操作 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="unity对于window下的资源管理器的基本操作" />
<meta property="og:description" content="最近项目中，在做项目插件的时候涉及到了对资源管理器的一些基本操作，这里主要讲下在window下对资源管理器的选择，打开，保存的三个基本操作。
一、对指定文件的路径选择
/* * 选择某个文件夹 */ [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)] public class SelectFile { public IntPtr hwndOwner = IntPtr.Zero; public IntPtr pidlRoot = IntPtr.Zero; public String pszDisplayName = null; public String lpszTitle = null; public UInt32 ulFlags = 0; public IntPtr lpfn = IntPtr.Zero; public IntPtr lParam = IntPtr.Zero; public int iImage = 0; } public class SelectFileLog { [DllImport(&#34;shell32.dll&#34;, SetLastError = true, ThrowOnUnmappableChar = true, CharSet = CharSet.Auto)] public static extern IntPtr SHBrowseForFolder([In, Out] SelectFile ofn); [DllImport(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ce2cf498fe4290c64d944ed10cdd9cb5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-20T09:57:17+08:00" />
<meta property="article:modified_time" content="2019-04-20T09:57:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">unity对于window下的资源管理器的基本操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近项目中，在做项目插件的时候涉及到了对资源管理器的一些基本操作，这里主要讲下在window下对资源管理器的选择，打开，保存的三个基本操作。</p> 
<p>一、对指定文件的路径选择</p> 
<pre class="has"><code class="language-cs">/*
* 选择某个文件夹
*/
[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
public class SelectFile
{
    public IntPtr hwndOwner = IntPtr.Zero;
    public IntPtr pidlRoot = IntPtr.Zero;
    public String pszDisplayName = null;
    public String lpszTitle = null;
    public UInt32 ulFlags = 0;
    public IntPtr lpfn = IntPtr.Zero;
    public IntPtr lParam = IntPtr.Zero;
    public int iImage = 0;
}

public class SelectFileLog
{
    [DllImport("shell32.dll", SetLastError = true, ThrowOnUnmappableChar = true, CharSet = CharSet.Auto)]
    public static extern IntPtr SHBrowseForFolder([In, Out] SelectFile ofn);

    [DllImport("shell32.dll", SetLastError = true, ThrowOnUnmappableChar = true, CharSet = CharSet.Auto)]
    public static extern bool SHGetPathFromIDList([In] IntPtr pidl, [In, Out] char[] fileName);

    public static string GetSelectFileName()
    {
        SelectFile selectFileName = new SelectFile();
        selectFileName.pszDisplayName = new string(new char[2000]);
        selectFileName.lpszTitle = "选择文件夹";
        IntPtr intPtr = SHBrowseForFolder(selectFileName);
        char[] chArray = new char[2000];
        for (int i = 0; i &lt; chArray.Length; i++)
        {
            chArray[i] = '\0';
        }
        SHGetPathFromIDList(intPtr, chArray);
        string fullPath = new string(chArray);
        fullPath = fullPath.Substring(0, fullPath.IndexOf('\0'));
        return fullPath;
  }
}</code></pre> 
<p> </p> 
<p>我们这里采用editor下调用选择指定文件夹</p> 
<pre class="has"><code class="language-cs">[MenuItem("Tool/SelectFile")] 
private static void SeleclFile()
{
    string selectPath =  SelectFileLog.GetSelectFileName();
    Debug.LogError("选择的路径:" + selectPath);
}</code></pre> 
<p>下面调用结果：</p> 
<p><img alt="" class="has" height="410" src="https://images2.imgbox.com/f0/91/lgIUdZjL_o.png" width="675"></p> 
<p>二、关于打开文件的操作</p> 
<p>我们这里以打开一张本地图片，并加载到场景中显示为例：</p> 
<pre class="has"><code class="language-cs">/*
* 打开指定文件或文件夹
*/
[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
public class OpenFileName
{
    public int structSize = 0;
    public IntPtr dlgOwner = IntPtr.Zero;
    public IntPtr instance = IntPtr.Zero;
    public String filter = null;
    public String customFilter = null;
    public int maxCustFilter = 0;
    public int filterIndex = 0;
    public String file = null;
    public int maxFile = 0;
    public String fileTitle = null;
    public int maxFileTitle = 0;
    public String initialDir = null;
    public String title = null;
    public int flags = 0;
    public short fileOffset = 0;
    public short fileExtension = 0;
    public String defExt = null;
    public IntPtr custData = IntPtr.Zero;
    public IntPtr hook = IntPtr.Zero;
    public String templateName = null;
    public IntPtr reservedPtr = IntPtr.Zero;
    public int reservedInt = 0;
    public int flagsEx = 0;    
}

public class OpenFileLog
{
    [DllImport("Comdlg32.dll", SetLastError = true, ThrowOnUnmappableChar = true, 
    CharSet = CharSet.Auto)]
    public static extern bool GetOpenFileName([In, Out] OpenFileName ofn);

    public static bool openFileName([In, Out] OpenFileName ofn)
    {
         return GetOpenFileName(ofn);
    }

    public static void OpenFileName_()
    {
        OpenFileName openFile = new OpenFileName();
        openFile.structSize = Marshal.SizeOf(openFile);
        openFile.filter = "图片文件(*.jpg*.png)\0*.jpg;*.png";
        openFile.file = new string(new char[256]);
        openFile.maxFile = openFile.file.Length;
        openFile.fileTitle = new string(new char[64]);
        openFile.maxFileTitle = openFile.fileTitle.Length;
        //这里设置默认路径
        string path = Application.streamingAssetsPath;
        path = path.Replace('/', '\\');
        openFile.initialDir = path;
        openFile.title = "打开文件夹";
        openFile.flags = 0x00080000 | 0x00001000 | 0x00000800 | 0x00000200 | 0x00000008;

        if (GetOpenFileName(openFile))
        {            
             FileStream fileStream = new FileStream(openFile.file, FileMode.Open, FileAccess.Read);
             fileStream.Seek(0, SeekOrigin.Begin);
             //创建文件长度的缓冲区
             byte[] bytes = new byte[fileStream.Length];
             //读取文件
             fileStream.Read(bytes, 0, (int)fileStream.Length);            
             fileStream.Close();
             fileStream.Dispose();
             fileStream = null;

             //创建Texture           
             Texture2D texture2D = new Texture2D(100,100);
             texture2D.LoadImage(bytes);
             RawImage image = GameObject.Find("image").GetComponent&lt;RawImage&gt;();
             if(image==null)
             {
                  Debug.LogError("查找RawImages失败");
                  return;
             }
             image.texture = texture2D;
             image.SetNativeSize();
      }
   }
}</code></pre> 
<p>加载结果：</p> 
<p><img alt="" class="has" height="360" src="https://images2.imgbox.com/68/9a/rNlmIMbU_o.png" width="673"></p> 
<p>三、选择将文件保存到本地指定路径</p> 
<p>我们以保存一个txt文件为例进行操作：</p> 
<pre class="has"><code class="language-cs">public static void SaveFileName()
{
    OpenFileName openFile = new OpenFileName();
    openFile.structSize = Marshal.SizeOf(openFile);
    openFile.filter = "txt文件(*.txt)\0*.txt";
    openFile.file = new string(new char[256]);
    openFile.maxFile = openFile.file.Length;
    openFile.fileTitle = new string(new char[64]);
    openFile.maxFileTitle = openFile.fileTitle.Length;
    //这里设置默认路径
    string path = Application.streamingAssetsPath;
    path = path.Replace('/', '\\');
    openFile.initialDir = path;
    openFile.title = "保存本地文件";
    openFile.flags = 0x00080000 | 0x00001000 | 0x00000800 | 0x00000200 | 0x00000008;

    if (GetSaveFileName(openFile))
    {                      
        FileInfo file = new FileInfo(openFile.file);
        StreamWriter sw = file.CreateText();
        sw.Write("test");
        sw.Dispose();
        sw.Close();            
    }
}
保存结束内容：</code></pre> 
<p><img alt="" class="has" height="386" src="https://images2.imgbox.com/06/72/p3orXz9D_o.png" width="669">链接：https://pan.baidu.com/s/13sQ7e0Bh4lLX48LFTDeewQ <br> 提取码：34md</p> 
<p>想了解更多unity相关知识，可以关注下方公众号哦！！！</p> 
<p><img alt="" class="has" height="402" src="https://images2.imgbox.com/58/df/ajecBNQk_o.png" width="397"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2281b13e60ff281befb4341c1d6fea16/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue.js 动态文字向上滚动广播中奖信息代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bfc1136a02f97108c8331264ac925442/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Win10下安装elasticsearch6.5.0</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>