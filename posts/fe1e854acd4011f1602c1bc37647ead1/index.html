<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用docker搭建php7cms靶机 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用docker搭建php7cms靶机" />
<meta property="og:description" content="前言 今天应师父要求，写一篇利用docker搭建渗透靶机的文章来记录一下自己的菜鸟时光，要求是小白照着一步一步走就能搭建成功(即使我也是小白)。想来想去还是从docker的安装说起吧。
一、docker的安装及相关配置 系统版本：centos7
内核版本：3.10.0
1、yum更新 yum update 2、安装需要的软件包 yum install -y yum-utils device-mapper-persistent-data lvm2 3、设置yum源 国外镜像一般很难访问，建议配置阿里云镜像。
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 4、安装docker 这里默认安装最新版本。
yum install docker-ce 5、启动并加入开机启动 systemctl start docker systemctl enable docker 6、验证安装是否成功 (有client和service两部分表示docker安装启动都成功了) docker version 7、配置加速器 这个纯属个人喜好，因为dockerhub国内访问的限制加上国内几个加速器个人感觉不好用，所以我选择了阿里云的容器镜像服务中的加速器(免费的，个人感觉超赞)。
获取镜像加速器后，阿里云非常贴心的给出了使用配置步骤：
二、对于docker的理解和基本使用命令 1、仓库、镜像和容器之间的关系 镜像：本人理解的docke镜像就像Vmware虚拟及里面的快照，可恢复成运行中的虚拟机，也可以保存在本地。容器：镜像运行起来便是容器。如果按照上面这个比喻的话，容器就是快照恢复后的虚拟机。仓库：用来存储镜像，比较大的有docker hub和阿里云。 2、仓库、镜像和容器之间的命令使用 仓库—镜像：从仓库拉取(下载)镜像docker pull [仓库地址及镜像版本]镜像—仓库：从本地上传镜像到仓库docker push [仓库地址及镜像版本]镜像—容器：镜像运行成容器docker run [参数] [镜像名称或ID]容器—镜像：将容器保存为镜像docker commit [容器ID] [参数及其他] 三、docker搭建php7cms靶场 1、php7cms下载 本次搭建靶机是为了写poc验证漏洞，对应的php7cms版本是2018-10-09，
下载地址：https://www.a5xiazai.com/php/138976.html
下载后：
2、拉取所需环境的docker镜像 这个php7cms需要php版本为php7以上和mysql数据库5.6以上，而docker的强大之处之一就是非常方便，可以拉取别人搭建好的环境直接使用。
对应这次搭建靶场所需环境，本人推荐一个链接，里面有php几个常用版本的lamp镜像。
比如我们要拉取php7.1版本：
docker pull thiagobarradas/lamp:php-7.1 然后就进入了等待中：
当然也可以搜索官方的镜像仓库：docker search [关键词]" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/fe1e854acd4011f1602c1bc37647ead1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-20T15:52:00+08:00" />
<meta property="article:modified_time" content="2023-12-20T15:52:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用docker搭建php7cms靶机</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>前言</h4> 
<p>今天应师父要求，写一篇利用<a href="https://so.csdn.net/so/search?q=docker&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" rel="noopener noreferrer">docker</a>搭建渗透靶机的文章来记录一下自己的菜鸟时光，要求是小白照着一步一步走就能搭建成功(即使我也是小白)。想来想去还是从docker的安装说起吧。</p> 
<h5><a id="docker_2"></a>一、docker的安装及相关配置</h5> 
<p><strong>系统版本：centos7</strong><br> <strong>内核版本：3.10.0</strong></p> 
<h6><a id="1yum_6"></a>1、yum更新</h6> 
<pre><code>yum update
</code></pre> 
<h6><a id="2_10"></a>2、安装需要的软件包</h6> 
<pre><code>yum install -y yum-utils device-mapper-persistent-data lvm2
</code></pre> 
<h6><a id="3yum_14"></a>3、设置yum源</h6> 
<p>国外镜像一般很难访问，建议配置阿里云镜像。</p> 
<pre><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre> 
<h6><a id="4docker_19"></a>4、安装docker</h6> 
<p>这里默认安装最新版本。</p> 
<pre><code>yum install docker-ce
</code></pre> 
<h6><a id="5_24"></a>5、启动并加入开机启动</h6> 
<pre><code>systemctl start docker
systemctl enable docker
</code></pre> 
<h6><a id="6_clientservicedocker_29"></a>6、验证安装是否成功 (有client和service两部分表示docker安装启动都成功了)</h6> 
<pre><code>docker version
</code></pre> 
<h6><a id="7_33"></a>7、配置加速器</h6> 
<p>这个纯属个人喜好，因为dockerhub国内访问的限制加上国内几个加速器个人感觉不好用，所以我选择了阿里云的容器镜像服务中的加速器(免费的，个人感觉超赞)。<img src="https://images2.imgbox.com/8c/15/pg8YADD2_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f1/af/ttHmccyG_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/b2/38/wALK4yQN_o.png" alt="在这里插入图片描述"><br> 获取镜像加速器后，阿里云非常贴心的给出了使用配置步骤：<img src="https://images2.imgbox.com/e1/c0/ec7aqEcv_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="docker_40"></a>二、对于docker的理解和基本使用命令</h5> 
<h6><a id="1_41"></a>1、仓库、镜像和容器之间的关系</h6> 
<ul><li>镜像：本人理解的docke镜像就像Vmware虚拟及里面的快照，可恢复成运行中的虚拟机，也可以保存在本地。</li><li>容器：镜像运行起来便是容器。如果按照上面这个比喻的话，容器就是快照恢复后的虚拟机。</li><li>仓库：用来存储镜像，比较大的有docker hub和阿里云。</li></ul> 
<h6><a id="2_47"></a>2、仓库、镜像和容器之间的命令使用</h6> 
<ul><li>仓库—镜像：从仓库拉取(下载)镜像<code>docker pull [仓库地址及镜像版本]</code></li><li>镜像—仓库：从本地上传镜像到仓库<code>docker push [仓库地址及镜像版本]</code></li><li>镜像—容器：镜像运行成容器<code>docker run [参数] [镜像名称或ID]</code></li><li>容器—镜像：将容器保存为镜像<code>docker commit [容器ID] [参数及其他]</code></li></ul> 
<h5><a id="dockerphp7cms_52"></a>三、docker搭建php7cms靶场</h5> 
<h6><a id="1php7cms_53"></a>1、php7cms下载</h6> 
<p>本次搭建靶机是为了写poc验证漏洞，对应的php7cms版本是2018-10-09，<br> 下载地址：https://www.a5xiazai.com/php/138976.html<br> 下载后：<br> <img src="https://images2.imgbox.com/c9/17/9S6lhlvG_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2docker_58"></a>2、拉取所需环境的docker镜像</h6> 
<p>这个php7cms需要php版本为php7以上和mysql数据库5.6以上，而docker的强大之处之一就是非常方便，可以拉取别人搭建好的环境直接使用。<br> 对应这次搭建靶场所需环境，本人推荐一个<a href="https://hub.docker.com/r/thiagobarradas/lamp" rel="nofollow">链接</a>，里面有php几个常用版本的lamp镜像。<br> <img src="https://images2.imgbox.com/dc/96/C7ihFFbh_o.png" alt="在这里插入图片描述">比如我们要拉取php7.1版本：</p> 
<pre><code> docker pull thiagobarradas/lamp:php-7.1
</code></pre> 
<p>然后就进入了等待中：<br> <img src="https://images2.imgbox.com/b4/9e/ClCxZhLX_o.png" alt="在这里插入图片描述">当然也可以搜索官方的镜像仓库：<code>docker search [关键词]</code><br> <img src="https://images2.imgbox.com/7b/a8/ETx98cd7_o.png" alt="在这里插入图片描述">或者还有阿里云仓库：<br> <img src="https://images2.imgbox.com/f7/34/WybMKJpu_o.png" alt="在这里插入图片描述"></p> 
<p>拉取成功之后查看一下本地的镜像：</p> 
<pre><code>docker images
</code></pre> 
<p><img src="https://images2.imgbox.com/0e/57/nLt6jxa3_o.png" alt="在这里插入图片描述">如果要删除镜像使用命令<code>docker rmi [仓库:版本]</code>就行。如：<code>docker rmi thiagobarradas/lamp:php-7.1</code></p> 
<h6><a id="3_78"></a>3、启动容器</h6> 
<p>启动容器用 <code>docker run</code>，这里我使用了 <code>-it -d -p80:80 --privileged=true</code>这几个参数。解释一下：<code>-d</code> 后台运行；<code>-p80:80</code> 将docker容器的80端口映射到系统系统的80端口；<code>-it</code> 可以理解为稳定运行；<code>privileged=true</code> 是使容器内用户权限为真正的root权限。</p> 
<pre><code>docker run -it -d -p80:80 --privileged=true thiagobarradas/lamp:php-7.1
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/c5/LlnhDMi5_o.png" alt="在这里插入图片描述">注意命令下回显的这一长串数字加字母就是容器ID，一般在使用容器ID时不用全部输进去，输入前几位能识别就行。可以利用命令<code>docker ps</code>查看开启的容器。<br> <img src="https://images2.imgbox.com/90/01/8hXLKbt3_o.png" alt="在这里插入图片描述">如果要删除容器使用<code>docker rm -f [容器ID]</code>就行了。</p> 
<h6><a id="4php7cmsdocker_86"></a>4、将解压后的php7cms拷贝到docker容器内</h6> 
<p>命令：<code>docker cp [文件路径] [目的路径]</code>这里说一下，目的路径一般为<br> <code>[容器ID]:[容器内路径]</code></p> 
<pre><code>docker cp /PHP7CMS 48:/app
</code></pre> 
<h6><a id="5_92"></a>5、进入容器</h6> 
<pre><code>docker exec -it 48 bash
</code></pre> 
<h6><a id="6cms_97"></a>6、配置cms的安装环境并安装</h6> 
<p><img src="https://images2.imgbox.com/7e/d1/AtysRubH_o.png" alt="在这里插入图片描述"><br> 我拉取的这个镜像是里面吧网站根目录设置成了/app，进入后看到了我们刚刚拷贝的PHP7CMS，还有index.html和phpinfo.php，咱们再浏览器上访问一下看看能否正常访问服务。<br> <img src="https://images2.imgbox.com/25/78/iVGaGUiY_o.png" alt="在这里插入图片描述">注意这里的ip地址是<a href="https://so.csdn.net/so/search?q=centos7&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" rel="noopener noreferrer">centos7</a>的虚拟机地址，因为在启动容器时我把容器的80端口映射到了外部的80端口。这时候我们就要保证虚拟机centos7的80端口仅被docker服务占用。<br> 删除多余文件，将PHP7CMS目录中的文件拷贝到 /app</p> 
<pre><code>rm -f index.html phpinfo.php
cp -r PHP7CMS/. /app
</code></pre> 
<p><img src="https://images2.imgbox.com/46/7d/Yw383DUF_o.png" alt="在这里插入图片描述">这时候按照php7cms的说明文档直接访问install.php安装。<br> 这时候提醒我们目录不可写<br> <img src="https://images2.imgbox.com/6d/2b/nb301aJH_o.png" alt="在这里插入图片描述"><br> 因为本人比较懒，而且说不定还有其它不可写问题，所以直接把网站根目录及里面的所有文件设置成了 777 命令：<code>chmod -R 777 /app</code>再访问：<br> <img src="https://images2.imgbox.com/64/05/tiafzOmT_o.png" alt="在这里插入图片描述">这时候我们看到需要使用数据库，经本人测试，这个镜像的mysql数据库root密码为空，所以密码不用填就行<br> <img src="https://images2.imgbox.com/86/b6/J56qqY3J_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/7b/94/hPn0RDSO_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_113"></a>四、将靶场保存为镜像并推送至仓库</h5> 
<h6><a id="1_114"></a>1、将搭建好的靶场保存为镜像</h6> 
<p>首先在容器内输入<code>exit</code>退出容器，使用命令</p> 
<pre><code>docker commit 48 php7cms
</code></pre> 
<p>将容器保存为镜像(我这里是把ID为48的容器保存为name是php7cms的镜像)<br> 利用<code>docker images</code>查看本地镜像发现保存成功。<img src="https://images2.imgbox.com/25/7a/ES4cxNVZ_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2_122"></a>2、将本地镜像上传到仓库</h6> 
<p>因个人喜好，我这里使用的是阿里云的仓库<br> 先创建镜像仓库：<br> <img src="https://images2.imgbox.com/2a/88/qv6j3vRE_o.png" alt="在这里插入图片描述">然后选择本地仓库就行。<br> <img src="https://images2.imgbox.com/ac/21/pl39NqcX_o.png" alt="在这里插入图片描述">进入仓库后可以发现阿里云很贴心的把使用方法给了出来<img src="https://images2.imgbox.com/6d/0b/DsLBbxjm_o.png" alt="在这里插入图片描述">登录：<br> <img src="https://images2.imgbox.com/1b/9d/pmJ8Yikv_o.png" alt="登录"><br> 标记本地镜像(用IMAGE ID标记),将其归入仓库<img src="https://images2.imgbox.com/c3/28/8k0vA94N_o.png" alt="改名字">上传&amp;等待<br> <img src="https://images2.imgbox.com/cf/31/eCDYk2k2_o.png" alt="在这里插入图片描述">上传后刷新仓库<br> <img src="https://images2.imgbox.com/dd/2e/MKjeoqv4_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6aba5e7e0b3c9f442601336c6d9ec1c5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第二章：垃圾回收</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6333d5261fa64d88663cc8ff023ba59d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SemEval2016语义角色标注的理解与补充</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>