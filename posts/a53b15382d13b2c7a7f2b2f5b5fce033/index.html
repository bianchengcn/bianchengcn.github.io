<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>39.linux下安装libssh2：测试远程执行shell命令 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="39.linux下安装libssh2：测试远程执行shell命令" />
<meta property="og:description" content="目录 一：libssh2介绍：二：安装：三：测试ssh2功能：远程执行主机shell命令：四：移植libssh2:报错1：报错2：遇到的问题3: 六：ARM设备上测试：(暂未成功) 一：libssh2介绍： 1.libssh2是一个C 函数库，用来实现SSH2协议。
SSH2是一套安全通讯协议框架（早期的SSH1由于存在安全漏洞），基于SSH2协议的产品主要有openssh，putty，SSH Secure Shell Client等，这些都是开源的，但是这些代码非常难懂而且复杂，一个个函数深层次的调用很快就让人在C语言代码的海洋中迷失了方向，妄图通过从这些开源软件中抽取程序代码段来“组装”自己的应用程序是非一般人所能实现的。不过还好网络上出现了一些开源的SSH2开发库，利用这些开发库开发自己的SSH2程序却要简单得多，由于这些开发库都是开源的，往往是针对linux平台的，而且一般只提供了源代码。
二：安装： 1.下载：
https://www.libssh2.org/ 2.解压安装：
sudo tar -zxvf libssh2-1.9.0.tar.gz -C . mkdir install_lib sudo ./configure --prefix=/home/aston/huawei/libssh2-1.9.0/install_lib --with-openssl CPPFLAGS=&#34;-I/home/aston/huawei/openssl-1.1.1d/install_lib/include&#34; LDFLAGS=&#34;-L/home/aston/huawei/openssl-1.1.1d/install_lib/lib&#34; sudo make sudo make install 注：
CPPFLAGS需指定openssl的头文件路径；
LDFLAGS需指定openssl的库路径；
3.安装完成：
三：测试ssh2功能：远程执行主机shell命令： 测试文件：
&#34;D:\share\source_insight\main_135\obs_sdk\libssh2-1.9.0\example\ssh2_exec.c&#34; 代码：
/* * Sample showing how to use libssh2 to execute a command remotely. * * The sample code has fixed values for host name, user name, password * and command to run." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/a53b15382d13b2c7a7f2b2f5b5fce033/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-24T10:25:49+08:00" />
<meta property="article:modified_time" content="2021-01-24T10:25:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">39.linux下安装libssh2：测试远程执行shell命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#libssh2_1" rel="nofollow">一：libssh2介绍：</a></li><li><a href="#_6" rel="nofollow">二：安装：</a></li><li><a href="#ssh2shell_32" rel="nofollow">三：测试ssh2功能：远程执行主机shell命令：</a></li><li><a href="#libssh2_382" rel="nofollow">四：移植libssh2:</a></li><li><ul><li><a href="#1_400" rel="nofollow">报错1：</a></li><li><a href="#2_405" rel="nofollow">报错2：</a></li><li><a href="#3_425" rel="nofollow">遇到的问题3:</a></li></ul> 
  </li><li><a href="#ARM_445" rel="nofollow">六：ARM设备上测试：(暂未成功)</a></li></ul> 
</div> 
<p></p> 
<h2><a id="libssh2_1"></a>一：libssh2介绍：</h2> 
<p>1.libssh2是一个C 函数库，用来实现SSH2协议。<br> SSH2是一套安全通讯协议框架（早期的SSH1由于存在安全漏洞），基于SSH2协议的产品主要有openssh，putty，SSH Secure Shell Client等，这些都是开源的，但是这些代码非常难懂而且复杂，一个个函数深层次的调用很快就让人在C语言代码的海洋中迷失了方向，妄图通过从这些开源软件中抽取程序代码段来“组装”自己的应用程序是非一般人所能实现的。不过还好网络上出现了一些开源的SSH2开发库，利用这些开发库开发自己的SSH2程序却要简单得多，由于这些开发库都是开源的，往往是针对linux平台的，而且一般只提供了源代码。</p> 
<h2><a id="_6"></a>二：安装：</h2> 
<p>1.下载：</p> 
<pre><code class="prism language-c">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>libssh2<span class="token punctuation">.</span>org<span class="token operator">/</span>
</code></pre> 
<p>2.解压安装：</p> 
<pre><code class="prism language-c">sudo tar <span class="token operator">-</span>zxvf libssh2<span class="token operator">-</span><span class="token number">1.9</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span>C <span class="token punctuation">.</span>
mkdir install_lib
sudo <span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span>prefix<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>aston<span class="token operator">/</span>huawei<span class="token operator">/</span>libssh2<span class="token operator">-</span><span class="token number">1.9</span><span class="token number">.0</span><span class="token operator">/</span>install_lib <span class="token operator">--</span>with<span class="token operator">-</span>openssl CPPFLAGS<span class="token operator">=</span><span class="token string">"-I/home/aston/huawei/openssl-1.1.1d/install_lib/include"</span> LDFLAGS<span class="token operator">=</span><span class="token string">"-L/home/aston/huawei/openssl-1.1.1d/install_lib/lib"</span>

sudo make
sudo make install
</code></pre> 
<p>注：<br> CPPFLAGS需指定openssl的头文件路径；<br> LDFLAGS需指定openssl的库路径；</p> 
<p>3.安装完成：</p> 
<p><img src="https://images2.imgbox.com/61/9d/xOC9vS19_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="ssh2shell_32"></a>三：测试ssh2功能：远程执行主机shell命令：</h2> 
<p>测试文件：</p> 
<pre><code class="prism language-c"><span class="token string">"D:\share\source_insight\main_135\obs_sdk\libssh2-1.9.0\example\ssh2_exec.c"</span>
</code></pre> 
<p>代码：</p> 
<pre><code class="prism language-c"><span class="token comment">/*
 * Sample showing how to use libssh2 to execute a command remotely.
 *
 * The sample code has fixed values for host name, user name, password
 * and command to run.
 *
 * Run it like this:
 *
 * $ ./ssh2_exec 127.0.0.1 user password "uptime"
 *
 */</span>

<span class="token comment">//#include "libssh2_config.h"</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;libssh2.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>


<span class="token macro property">#<span class="token directive keyword">ifdef</span> HAVE_WINSOCK2_H</span>
<span class="token macro property"># <span class="token directive keyword">include</span> <span class="token string">&lt;winsock2.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> HAVE_SYS_SOCKET_H</span>
<span class="token macro property"># <span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> HAVE_NETINET_IN_H</span>
<span class="token macro property"># <span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> HAVE_SYS_SELECT_H</span>
<span class="token macro property"># <span class="token directive keyword">include</span> <span class="token string">&lt;sys/select.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property"># <span class="token directive keyword">ifdef</span> HAVE_UNISTD_H</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> HAVE_ARPA_INET_H</span>
<span class="token macro property"># <span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> HAVE_SYS_TIME_H</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> HAVE_STDLIB_H</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h&gt;</span></span>

<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">waitsocket</span><span class="token punctuation">(</span><span class="token keyword">int</span> socket_fd<span class="token punctuation">,</span> LIBSSH2_SESSION <span class="token operator">*</span>session<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> timeval timeout<span class="token punctuation">;</span>
    <span class="token keyword">int</span> rc<span class="token punctuation">;</span>
    fd_set fd<span class="token punctuation">;</span>
    fd_set <span class="token operator">*</span>writefd <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    fd_set <span class="token operator">*</span>readfd <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> dir<span class="token punctuation">;</span>

    timeout<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    timeout<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token function">FD_ZERO</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">FD_SET</span><span class="token punctuation">(</span>socket_fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* now make sure we wait in the correct direction */</span>
    dir <span class="token operator">=</span> <span class="token function">libssh2_session_block_directions</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>dir <span class="token operator">&amp;</span> LIBSSH2_SESSION_BLOCK_INBOUND<span class="token punctuation">)</span>
        readfd <span class="token operator">=</span> <span class="token operator">&amp;</span>fd<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>dir <span class="token operator">&amp;</span> LIBSSH2_SESSION_BLOCK_OUTBOUND<span class="token punctuation">)</span>
        writefd <span class="token operator">=</span> <span class="token operator">&amp;</span>fd<span class="token punctuation">;</span>

    rc <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span>socket_fd <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> readfd<span class="token punctuation">,</span> writefd<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> rc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>hostname <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>commandline <span class="token operator">=</span> <span class="token string">"uptime"</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>username    <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>password    <span class="token operator">=</span> <span class="token string">"password"</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> hostaddr<span class="token punctuation">;</span>
    <span class="token keyword">int</span> sock<span class="token punctuation">;</span>
	
    <span class="token keyword">struct</span> sockaddr_in sin<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fingerprint<span class="token punctuation">;</span>
    LIBSSH2_SESSION <span class="token operator">*</span>session<span class="token punctuation">;</span>
    LIBSSH2_CHANNEL <span class="token operator">*</span>channel<span class="token punctuation">;</span>
    <span class="token keyword">int</span> rc<span class="token punctuation">;</span>
    <span class="token keyword">int</span> exitcode<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>exitsignal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">"none"</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> bytecount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    size_t len<span class="token punctuation">;</span>
    LIBSSH2_KNOWNHOSTS <span class="token operator">*</span>nh<span class="token punctuation">;</span>
    <span class="token keyword">int</span> type<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment">/* must be ip address only */</span>
        hostname <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        username <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        password <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        commandline <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    rc <span class="token operator">=</span> <span class="token function">libssh2_init</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rc <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"libssh2 initialization failed (%d)\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    hostaddr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Ultra basic "connect to port 22 on localhost"
     * Your code is responsible for creating the socket establishing the
     * connection
     */</span>
    sock <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    sin<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    sin<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sin<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> hostaddr<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sin<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr_in<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"failed to connect!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Create a session instance */</span>
    session <span class="token operator">=</span> <span class="token function">libssh2_session_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">/* tell libssh2 we want it all done non-blocking */</span>
    <span class="token function">libssh2_session_set_blocking</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* ... start it up. This will trade welcome banners, exchange keys,
     * and setup crypto, compression, and MAC layers
     */</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rc <span class="token operator">=</span> <span class="token function">libssh2_session_handshake</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> sock<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span>
           LIBSSH2_ERROR_EAGAIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Failure establishing SSH session: %d\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    nh <span class="token operator">=</span> <span class="token function">libssh2_knownhost_init</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nh<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* eeek, do cleanup here */</span>
        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* read all hosts from here */</span>
    <span class="token function">libssh2_knownhost_readfile</span><span class="token punctuation">(</span>nh<span class="token punctuation">,</span> <span class="token string">"known_hosts"</span><span class="token punctuation">,</span>
                               LIBSSH2_KNOWNHOST_FILE_OPENSSH<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* store all known hosts to here */</span>
    <span class="token function">libssh2_knownhost_writefile</span><span class="token punctuation">(</span>nh<span class="token punctuation">,</span> <span class="token string">"dumpfile"</span><span class="token punctuation">,</span>
                                LIBSSH2_KNOWNHOST_FILE_OPENSSH<span class="token punctuation">)</span><span class="token punctuation">;</span>

    fingerprint <span class="token operator">=</span> <span class="token function">libssh2_session_hostkey</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">,</span> <span class="token operator">&amp;</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fingerprint<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">struct</span> libssh2_knownhost <span class="token operator">*</span>host<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">if</span> LIBSSH2_VERSION_NUM &gt;= 0x010206</span>
        <span class="token comment">/* introduced in 1.2.6 */</span>
        <span class="token keyword">int</span> check <span class="token operator">=</span> <span class="token function">libssh2_knownhost_checkp</span><span class="token punctuation">(</span>nh<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span>
                                             fingerprint<span class="token punctuation">,</span> len<span class="token punctuation">,</span>
                                             LIBSSH2_KNOWNHOST_TYPE_PLAIN<span class="token operator">|</span>
                                             LIBSSH2_KNOWNHOST_KEYENC_RAW<span class="token punctuation">,</span>
                                             <span class="token operator">&amp;</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
        <span class="token comment">/* 1.2.5 or older */</span>
        <span class="token keyword">int</span> check <span class="token operator">=</span> <span class="token function">libssh2_knownhost_check</span><span class="token punctuation">(</span>nh<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span>
                                            fingerprint<span class="token punctuation">,</span> len<span class="token punctuation">,</span>
                                            LIBSSH2_KNOWNHOST_TYPE_PLAIN<span class="token operator">|</span>
                                            LIBSSH2_KNOWNHOST_KEYENC_RAW<span class="token punctuation">,</span>
                                            <span class="token operator">&amp;</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Host check: %d, key: %s\n"</span><span class="token punctuation">,</span> check<span class="token punctuation">,</span>
                <span class="token punctuation">(</span>check <span class="token operator">&lt;=</span> LIBSSH2_KNOWNHOST_CHECK_MISMATCH<span class="token punctuation">)</span><span class="token operator">?</span>
                host<span class="token operator">-&gt;</span>key<span class="token punctuation">:</span><span class="token string">"&lt;none&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*****
         * At this point, we could verify that 'check' tells us the key is
         * fine or bail out.
         *****/</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* eeek, do cleanup here */</span>
        <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">libssh2_knownhost_free</span><span class="token punctuation">(</span>nh<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* We could authenticate via password */</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rc <span class="token operator">=</span> <span class="token function">libssh2_userauth_password</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span>
               LIBSSH2_ERROR_EAGAIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Authentication by password failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">goto</span> shutdown<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* Or by public key */</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rc <span class="token operator">=</span> <span class="token function">libssh2_userauth_publickey_fromfile</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> username<span class="token punctuation">,</span>
                                                         <span class="token string">"/home/user/"</span>
                                                         <span class="token string">".ssh/id_rsa.pub"</span><span class="token punctuation">,</span>
                                                         <span class="token string">"/home/user/"</span>
                                                         <span class="token string">".ssh/id_rsa"</span><span class="token punctuation">,</span>
                                                         password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span>
               LIBSSH2_ERROR_EAGAIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"\tAuthentication by public key failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">goto</span> shutdown<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">if</span> 0</span>
    <span class="token function">libssh2_trace</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token operator">~</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

    <span class="token comment">/* Exec non-blocking on the remove host */</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>channel <span class="token operator">=</span> <span class="token function">libssh2_channel_open_session</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span>
          <span class="token function">libssh2_session_last_error</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span>
          LIBSSH2_ERROR_EAGAIN<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">waitsocket</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>channel <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rc <span class="token operator">=</span> <span class="token function">libssh2_channel_exec</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> commandline<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span>
           LIBSSH2_ERROR_EAGAIN<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">waitsocket</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rc <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* loop until we block */</span>
        <span class="token keyword">int</span> rc<span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">0x4000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            rc <span class="token operator">=</span> <span class="token function">libssh2_channel_read</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>rc <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">int</span> i<span class="token punctuation">;</span>
                bytecount <span class="token operator">+</span><span class="token operator">=</span> rc<span class="token punctuation">;</span>
                <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"We read:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rc<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
                    <span class="token function">fputc</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">stderr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>rc <span class="token operator">!=</span> LIBSSH2_ERROR_EAGAIN<span class="token punctuation">)</span>
                    <span class="token comment">/* no need to output this for the EAGAIN case */</span>
                    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"libssh2_channel_read returned %d\n"</span><span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>rc <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* this is due to blocking that would occur otherwise so we loop on
           this condition */</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rc <span class="token operator">==</span> LIBSSH2_ERROR_EAGAIN<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">waitsocket</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> session<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    exitcode <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rc <span class="token operator">=</span> <span class="token function">libssh2_channel_close</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> LIBSSH2_ERROR_EAGAIN<span class="token punctuation">)</span>
        <span class="token function">waitsocket</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> session<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>rc <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        exitcode <span class="token operator">=</span> <span class="token function">libssh2_channel_get_exit_status</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">libssh2_channel_get_exit_signal</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token operator">&amp;</span>exitsignal<span class="token punctuation">,</span>
                                        <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>exitsignal<span class="token punctuation">)</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"\nGot signal: %s\n"</span><span class="token punctuation">,</span> exitsignal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"\nEXIT: %d bytecount: %d\n"</span><span class="token punctuation">,</span> exitcode<span class="token punctuation">,</span> bytecount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">libssh2_channel_free</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    channel <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

shutdown<span class="token punctuation">:</span>

    <span class="token function">libssh2_session_disconnect</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span>
                               <span class="token string">"Normal Shutdown, Thank you for playing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">libssh2_session_free</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"all done\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">libssh2_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<p>2.报错：没有libssh2_config.h头文件：<br> 解决：注释掉，再添加必要的C库头文件即可。</p> 
<pre><code class="prism language-c"><span class="token comment">//#include "libssh2_config.h"</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;libssh2.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span> </span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
</code></pre> 
<p>3.执行本地aston用户的命令：显示主目录文件列表：</p> 
<pre><code class="prism language-c"><span class="token punctuation">.</span><span class="token operator">/</span>app<span class="token punctuation">.</span>out <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> aston root ls
</code></pre> 
<p><img src="https://images2.imgbox.com/4e/aa/cqvwUm1H_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a4/d7/8TPvaCMY_o.png" alt="在这里插入图片描述"><br> 4.如需要指令长指令，如：ls -l ，则需要使用双引号括起来"ls -l"<br> <img src="https://images2.imgbox.com/fc/17/Nan7s9sL_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="libssh2_382"></a>四：移植libssh2:</h2> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">tar</span> -zxvf libssh2-1.9.0.tar.gz -C <span class="token keyword">.</span>
<span class="token function">sudo</span> <span class="token function">chown</span> -R aston libssh2-1.9.0
<span class="token function">mkdir</span> install_lib

<span class="token function">sudo</span> ./configure --prefix<span class="token operator">=</span>/home/aston/huawei_linux/libssh2-1.9.0/install_lib --host<span class="token operator">=</span>arm-linux CC<span class="token operator">=</span>/opt/hisi-linux/x86-arm/arm-hisiv300-linux/target/bin/arm-hisiv300-linux-gcc CXX<span class="token operator">=</span>/opt/hisi-linux/x86-arm/arm-hisiv300-linux/target/bin/arm-hisiv300-linux-g++ --with-openssl CFLAGS<span class="token operator">=</span><span class="token string">"-I/home/aston/huawei_linux/openssl-1.1.1d/install_lib/include -I/home/aston/huawei_linux/zlib-1.2.11/install_lib/include"</span> LDFLAGS<span class="token operator">=</span><span class="token string">"-L/home/aston/huawei_linux/openssl-1.1.1d/install_lib/lib -L/home/aston/huawei_linux/zlib-1.2.11/install_lib/lib -lcrypto -lssl -ldl -lpthread -lz"</span>

/home/aston/huawei_linux/zlib-1.2.11/install_lib/lib
<span class="token function">sudo</span> <span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>注：<br> CPPFLAGS 需指定openssl的头文件路径；<br> LDFLAGS 需指定openssl的库路径；</p> 
<h3><a id="1_400"></a>报错1：</h3> 
<p>…/src/.libs/libssh2.so: undefined reference to `dlopen’<br> 解决： ./configure的LDFLAGS添加参数： -ldl -lpthread<br> LDFLAGS="-L/home/aston/huawei_linux/openssl-1.1.1d/install_lib/lib -ldl -lpthread"</p> 
<h3><a id="2_405"></a>报错2：</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable"><span class="token variable">`</span>deflate'
<span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable">`</span></span>inflate<span class="token string">'
../src/.libs/libssh2.so: undefined reference to <span class="token variable"><span class="token variable">`</span>inflateInit_'
<span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable">`</span></span>deflateInit_'</span>
<span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable"><span class="token variable">`</span>zError'
<span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable">`</span></span>pthread_atfork<span class="token string">'
../src/.libs/libssh2.so: undefined reference to <span class="token variable"><span class="token variable">`</span>inflateEnd'
<span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable">`</span></span>deflateEnd'</span>
collect2: error: ld returned 1 <span class="token keyword">exit</span> status
</code></pre> 
<p>解决： ./configure的LDFLAGS添加参数： -lz</p> 
<pre><code class="prism language-bash">LDFLAGS<span class="token operator">=</span><span class="token string">"-L/home/aston/huawei_linux/openssl-1.1.1d/install_lib/lib -L/home/aston/huawei_linux/zlib-1.2.11/install_lib/lib -ldl -lpthread -lz"</span>
</code></pre> 
<h3><a id="3_425"></a>遇到的问题3:</h3> 
<pre><code class="prism language-bash">/opt/hisi-linux/x86-arm/arm-himix400-linux/host_bin/<span class="token punctuation">..</span>/lib/gcc/arm-linux-gnueabi/7.3.0/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/arm-linux-gnueabi/bin/ld: warning: libssl.so.1.1, needed by <span class="token punctuation">..</span>/src/.libs/libssh2.so, not found <span class="token punctuation">(</span>try using -rpath or -rpath-link<span class="token punctuation">)</span>
/opt/hisi-linux/x86-arm/arm-himix400-linux/host_bin/<span class="token punctuation">..</span>/lib/gcc/arm-linux-gnueabi/7.3.0/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/arm-linux-gnueabi/bin/ld: warning: libcrypto.so.1.1, needed by <span class="token punctuation">..</span>/src/.libs/libssh2.so, not found <span class="token punctuation">(</span>try using -rpath or -rpath-link<span class="token punctuation">)</span>
/opt/hisi-linux/x86-arm/arm-himix400-linux/host_bin/<span class="token punctuation">..</span>/lib/gcc/arm-linux-gnueabi/7.3.0/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/arm-linux-gnueabi/bin/ld: <span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable"><span class="token variable">`</span>EVP_MD_CTX_free@OPENSSL_1_1_0'
/opt/hisi-linux/x86-arm/arm-himix400-linux/host_bin/<span class="token punctuation">..</span>/lib/gcc/arm-linux-gnueabi/7.3.0/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/arm-linux-gnueabi/bin/ld: <span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable">`</span></span>EVP_PKEY2PKCS8@OPENSSL_1_1_0<span class="token string">'
/opt/hisi-linux/x86-arm/arm-himix400-linux/host_bin/../lib/gcc/arm-linux-gnueabi/7.3.0/../../../../arm-linux-gnueabi/bin/ld: ../src/.libs/libssh2.so: undefined reference to <span class="token variable"><span class="token variable">`</span>DSA_free@OPENSSL_1_1_0'
/opt/hisi-linux/x86-arm/arm-himix400-linux/host_bin/<span class="token punctuation">..</span>/lib/gcc/arm-linux-gnueabi/7.3.0/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/arm-linux-gnueabi/bin/ld: <span class="token punctuation">..</span>/src/.libs/libssh2.so: undefined reference to <span class="token variable">`</span></span>BN_rand@OPENSSL_1_1_0'</span>
</code></pre> 
<p>原因是:未添加库的连接:-lcrypto -lssl 参数:</p> 
<pre><code class="prism language-bash">LDFLAGS<span class="token operator">=</span><span class="token string">"-L/opt/huawei_linux/openssl-1.1.1d/install_lib/lib -L/opt/huawei_linux/zlib-1.2.11/install_lib/lib -lcrypto -lssl -ldl -lpthread -lz"</span>
</code></pre> 
<p>重新编译成功.</p> 
<h2><a id="ARM_445"></a>六：ARM设备上测试：(暂未成功)</h2> 
<p>测试：</p> 
<pre><code class="prism language-bash">./app.out 127.0.0.1 root root <span class="token string">"ls"</span>
./app.out 127.0.0.1 <span class="token string">""</span> <span class="token string">""</span> <span class="token string">"ls"</span>
./app.out 127.0.0.1 <span class="token string">""</span> <span class="token string">""</span> <span class="token string">"ls"</span>
./app.out 127.0.0.1 <span class="token string">""</span> <span class="token string">""</span> <span class="token string">"ls"</span>
./app.out 127.0.0.1 root <span class="token string">""</span> <span class="token function">ls</span>
./app.out 127.0.0.1 root root <span class="token function">ls</span>
./app.out 192.168.1.141 aston root <span class="token string">"ls"</span>
./app.out 192.168.1.141 root root <span class="token string">"ls"</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/23d342264a08757908052d397dfa87d0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pandas两个表格_便捷高效！Python数据分析的必备利器--Pandas入门教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/64966c5438f7115d3cd747f1a0c03ed0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">spring5框架中AOP中使用AspectJ注解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>