<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue 视频上传组件 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue 视频上传组件" />
<meta property="og:description" content="组件：
&lt;template&gt; &lt;div class=&#34;upload-box&#34;&gt; &lt;div class=&#34;avatar-uploader-box&#34;&gt; &lt;!-- 图片预览 --&gt; &lt;div :key=&#34;index&#34; class=&#34;video-preview&#34; v-for=&#34;(item, index) in videoList&#34;&gt; &lt;video v-if=&#34;item.videoLink&#34; :src=&#34;`${videoBaseUrl}${item.videoLink}`&#34; @mouseover.stop=&#34;item.isShowPopup = true&#34; class=&#34;avatar&#34;&gt; 您的浏览器不支持视频播放 &lt;/video&gt; &lt;video v-else :src=&#34;item.url&#34; @mouseover.stop=&#34;item.isShowPopup = true&#34; class=&#34;avatar&#34;&gt; 您的浏览器不支持视频播放 &lt;/video&gt; &lt;!-- 显示查看和删除的按钮弹窗 --&gt; &lt;div @mouseleave=&#34;item.isShowPopup = false&#34; class=&#34;avatar-uploader-popup&#34; v-show=&#34;(item.videoLink || item.url) &amp;&amp; item.isShowPopup&#34; &gt; &lt;i @click=&#34;previewVideo(item)&#34; class=&#34;el-icon-zoom-in&#34;&gt;&lt;/i&gt; &lt;i @click=&#34;deleteVideo(index)&#34; class=&#34;el-icon-delete&#34;&gt;&lt;/i&gt; &lt;/div&gt; &lt;/div&gt; &lt;!-- 方框样式 --&gt; &lt;el-upload :action=&#34;actionUrl&#34; :auto-upload=&#34;false&#34; :on-change=&#34;handleAvatarChange&#34; :show-file-list=&#34;false&#34; class=&#34;avatar-uploader&#34; ref=&#34;avatarUploader&#34; v-show=&#34;uploadShow&#34; &gt; &lt;span element-loading-background=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/25c7f7dc234edab3ec0a93f92a8e1f11/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-22T17:08:54+08:00" />
<meta property="article:modified_time" content="2024-01-22T17:08:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue 视频上传组件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/23/c1/BbcOyxK9_o.png"></p> 
<p>组件：</p> 
<p></p> 
<pre><code class="hljs">&lt;template&gt;
  &lt;div class="upload-box"&gt;
    &lt;div class="avatar-uploader-box"&gt;
      &lt;!-- 图片预览 --&gt;
      &lt;div :key="index" class="video-preview" v-for="(item, index) in videoList"&gt;
        &lt;video v-if="item.videoLink" :src="`${videoBaseUrl}${item.videoLink}`" @mouseover.stop="item.isShowPopup = true" class="avatar"&gt;
          您的浏览器不支持视频播放
        &lt;/video&gt;
        &lt;video v-else :src="item.url" @mouseover.stop="item.isShowPopup = true" class="avatar"&gt;
          您的浏览器不支持视频播放
        &lt;/video&gt;
        &lt;!-- 显示查看和删除的按钮弹窗 --&gt;
        &lt;div
          @mouseleave="item.isShowPopup = false"
          class="avatar-uploader-popup"
          v-show="(item.videoLink || item.url) &amp;&amp; item.isShowPopup"
        &gt;
          &lt;i @click="previewVideo(item)" class="el-icon-zoom-in"&gt;&lt;/i&gt;
          &lt;i @click="deleteVideo(index)" class="el-icon-delete"&gt;&lt;/i&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- 方框样式 --&gt;
      &lt;el-upload
        :action="actionUrl"
        :auto-upload="false"
        :on-change="handleAvatarChange"
        :show-file-list="false"
        class="avatar-uploader"
        ref="avatarUploader"
        v-show="uploadShow"
      &gt;
        &lt;span
          element-loading-background="rgba(0, 0, 0, 0.8)"
          element-loading-spinner="el-icon-loading"
          element-loading-text="上传中"
          style="display:block;"
          v-loading="loading"
        &gt;
          &lt;i class="el-icon-plus avatar-uploader-icon"&gt;&lt;/i&gt;
        &lt;/span&gt;
      &lt;/el-upload&gt;

      &lt;!-- 上传提示文字样式 --&gt;
      &lt;div class="upload-tip"&gt;
        &lt;slot&gt;&lt;/slot&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- 查看大图 --&gt;
    &lt;el-dialog :visible.sync="dialogVisible" append-to-body center title="视频查看" :before-close="handleClose"&gt;
      &lt;video :src="videoSrc" ref="video" controls alt width="100%"&gt;您的浏览器不支持视频播放&lt;/video&gt;
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: 'UploadVideo',
  components: {},
  props: {
    videos: {
      type: Array,
      default: function() {
        return []
      }
    },
    numLimit: {
      // 最大允许上传个数
      type: Number,
      default: 1
    },
    sizeLimit: {
      // 最大单文件大小
      type: Number,
      default: 50
    },
    videoBaseUrl: {
      // 已上传图片服务器路径
      type: String,
      required: true
    }
  },
  data() {
    return {
      loading: false,
      dialogVisible: false,
      videoList: [],
      videoSrc: '',
      actionUrl: ''
    }
  },
  computed: {
    uploadShow() {
      return this.videos.length &lt; this.numLimit
    }
  },
  watch: {
    videos: {
      handler() {
        const isArray = Array.isArray(this.videos)
        if (isArray &amp;&amp; this.videos.length &gt; 0) {
          this.videos.map(item =&gt; {
            item.isShowPopup = false
          })
          this.videoList = JSON.parse(JSON.stringify(this.videos))
        } else {
          this.videoList = []
        }
      },
      deep: true,
      immediate: true
    }
  },
  created() {},
  methods: {
    // 上传之前
    beforeAvatarUpload(file) {
      return new Promise((resolve, reject) =&gt; {
        if (['video/mp4', 'video/ogg', 'video/flv', 'video/avi', 'video/wmv', 'video/rmvb', 'video/mov'].indexOf(file.raw.type) == -1) {
          // eslint-disable-next-line prefer-promise-reject-errors
          return reject('请上传正确的视频格式!')
        }

        if (file.size / 1024 / 1024 &gt; this.sizeLimit) {
          // eslint-disable-next-line prefer-promise-reject-errors
          return reject(`视频大小不能超过${this.sizeLimit}M!`)
        }

        if (this.videoList.length === this.numLimit) {
          // eslint-disable-next-line prefer-promise-reject-errors
          return reject(`最多上传${this.numLimit}个视频`)
        }

        resolve('符合表單規則')
      })
    },
    // 上传改变
    async handleAvatarChange(file, fileList) {
      try {
        await this.beforeAvatarUpload(file)
        this.uploadImgApi(file)
      } catch (e) {
        this.$message.warning(JSON.stringify(e))
      }
    },
    // 上传视频准备
    uploadImgApi(data) {
      console.log(data, 'upload**')
      const videoSrc = URL.createObjectURL(data.raw)
      this.videoList.push({
        videoFile: data,
        url: videoSrc,
        isShowPopup: false
      })
      this.$emit('change', this.videoList)
    },
    // 预览视频
    previewVideo(data) {
      if (data.videoLink) {
        this.videoSrc = `${this.videoBaseUrl}${data.videoLink}`
      } else {
        this.videoSrc = data.url
      }
      this.dialogVisible = true
    },
    // 删除视频
    deleteVideo(index) {
      this.$emit('delete', index)
    },
    handleClose() {
      const video = document.getElementsByTagName('video')[1]
      if (!video.paused) {
        video.currentTime = 0
        video.pause()
      }
      this.dialogVisible = false
    }
  }
}
&lt;/script&gt;

&lt;style lang="scss"&gt;
$width: 90px;
$height: 90px;

.upload-box {
  .avatar-uploader-box {
    position: relative;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    padding-bottom: 20px;
    min-width: 350px;
    .avatar-uploader {
      .el-upload {
        width: $width;
        height: $height;
        border: 1px dashed #d9d9d9;
        border-radius: 6px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        &amp;:hover {
          border-color: #409eff;
        }
        .el-loading-spinner {
          width: $width;
          height: $height;
          position: relative;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          margin-top: 0;
          top: 0;
          .el-loading-text {
            margin: 0;
          }
        }
      }
      .avatar-uploader-icon {
        font-size: 28px;
        color: #8c939d;
        width: $width;
        height: $height;
        line-height: $height;
        text-align: center;
      }
    }
    .video-preview {
      position: relative;
      padding-right: 20px;
      .avatar {
        width: $width;
        height: $height;
        display: block;
        border-radius: 6px;
      }
      .avatar-uploader-popup {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 2;
        width: $width;
        height: $height;
        background: rgba($color: #000000, $alpha: 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        font-size: 20px;
        border-radius: 6px;
        i {
          width: 30%;
          text-align: center;
          padding: 0 5%;
          font-size: 24px;
        }
      }
    }
    .upload-tip {
      position: absolute;
      bottom: 0;
      left: 0;
      font-size: 12px;
      color: #606266;
      max-width: 350px;
      line-height: 20px;
    }
  }
}
&lt;/style&gt;
</code></pre> 
<p>页面引入：</p> 
<pre><code class="hljs">import UploadVideo from '@c/UploadVideo'
</code></pre> 
<pre><code>components: { UploadVideo }
</code></pre> 
<pre><code>&lt;upload-video
  :videos="videoInfo.allVideo"
  :videoBaseUrl="IMAGEURL"
  @delete="deleteVideo"
  @change="getVideo" &gt;
&lt;/upload-video&gt;
</code></pre> 
<p>data数据：</p> 
<pre><code>videoInfo: {
   allVideo: [],
   deleteVideo: []
}
</code></pre> 
<p>视频上传：（此处只是上传到暂存区，真正上传是在提交表单时）</p> 
<pre><code>getVideo(event) {
  this.videoInfo.allVideo = event
}
</code></pre> 
<p>视频删除：</p> 
<pre><code>deleteVideo(index) {
  const video = this.videoInfo.allVideo[index]
  if (video.videoLink) {
  this.videoInfo.deleteVideo.push(video)
  }
  this.videoInfo.allVideo.splice(index, 1)
}
</code></pre> 
<p>在提交表单时上传：</p> 
<pre><code>uploadFiles() {
  const uploadList = []
  this.videoInfo.allVideo.map(item =&gt; {
        console.log(item, 'video')
        const videoFile = new FormData()
        if (!item.videoLink) {
          videoFile.append('file', item.videoFile.raw)
          videoFile.append('fileTag', 'video')
          uploadList.push(
            new Promise((resolve, reject) =&gt; {
              return ImgServe.uploadSingleFile(videoFile).then(res =&gt; {
                if (res.data.code === 200) {
                  resolve(res.data.data)
                } else {
                  this.$message('上传视频失败！')
                }
              })
            })
          )
        }
      })
      return Promise.all(uploadList)
}
</code></pre> 
<p>原文：<a href="https://codeleading.com/article/63204986980/" rel="nofollow" title="vue 视频上传组件 - 代码先锋网">vue 视频上传组件 - 代码先锋网</a></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a74b512aa7923380b3026c1eddadc843/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用Python PIL库和UUID自动命名实现图片批量缩放与重命名</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6fdf841b38fd038908cc4cdd16053fc6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">「优选算法刷题」：长度最小的子数组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>