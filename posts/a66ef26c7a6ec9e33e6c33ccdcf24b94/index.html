<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AutoJs制作简易自动化脚本（持续更新） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="AutoJs制作简易自动化脚本（持续更新）" />
<meta property="og:description" content="一、环境搭建 代码编程建议使用vscode编写
下载安装autojs（建议还是下载4.1.1版本）：​​​​​​Auto.js Pro (autojs.org)
2023-2-18免费版已经无法使用，建议使用 autox.js：Releases · kkevsekk1/AutoX · GitHub
调试建议下载雷电模拟器 ：雷电安卓模拟器 (ldmnq.com)
安装好auto.js之后记得开启以下操作：
1、先在vscode中下载auto.js插件，并且在查看--控制面板 中输入auto.js回车，就会有相应的命令，
2、开启auto.js的无障碍服务、悬浮窗、连接电脑
3、查看电脑ip:
二、auto.js官方文档 Auto.js Pro文档 (autojs.org)
注意！！！！
因为抖音短视频的机制是，当进入页面的时候会有上下视频先进性加载缓存，如下图，所以当我们直接按照控件属性去寻找控件的时候，会一次性找到好多个，一般往往都会取第一个，所以我们一般都要加上visibleToUser()这个属性表示在可视范围内的。
三、开发遇到问题记录 1、当使用截图找相似图的时候，最好不要采用scrcpy的投屏形式进行截屏，直接采用手机截图（因为这样分辨率一样，更好找）
因为有些手机没法永久设置同意截图的权限，导致每次运行都要在截图的时候进行同意权限，那么在刚开始运行脚本的时候就进行设置权限，而这个权限只需要同意一次就可，请求截图只要请求一次，否则会堵塞。
//封装一个截图函数 function imageClick(smallImgpath, saveImgPath, threshold, screen) { for (var i=0; i&lt;=5; i&#43;&#43;) { if (screen) { if (sig) { if (!requestScreenCapture()) { // 请求截图 // console.log(&#34;请求截图失败&#34;); exit(); } sig = false } var img = captureScreen(); //截图 images.saveImage(img, &#34;/sdcard/Download/&#34; &#43; saveImgPath); } var bg = images." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/a66ef26c7a6ec9e33e6c33ccdcf24b94/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-28T14:47:38+08:00" />
<meta property="article:modified_time" content="2023-04-28T14:47:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AutoJs制作简易自动化脚本（持续更新）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一、环境搭建</h3> 
<blockquote> 
 <p>代码编程建议使用vscode编写</p> 
 <p>下载安装autojs（建议还是下载4.1.1版本）：<a href="https://pro.autojs.org/" rel="nofollow" title="​​​​​​Auto.js Pro (autojs.org)">​​​​​​Auto.js Pro (autojs.org)</a></p> 
 <p>2023-2-18免费版已经无法使用，建议使用 autox.js：<a href="https://github.com/kkevsekk1/AutoX/releases" title="Releases · kkevsekk1/AutoX · GitHub">Releases · kkevsekk1/AutoX · GitHub</a></p> 
 <p>调试建议下载雷电模拟器 ：<a href="https://www.ldmnq.com/" rel="nofollow" title="雷电安卓模拟器 (ldmnq.com)">雷电安卓模拟器 (ldmnq.com)</a></p> 
</blockquote> 
<p> 安装好auto.js之后记得开启以下操作：</p> 
<blockquote> 
 <p>1、先在vscode中下载auto.js插件，并且在查看--控制面板 中输入auto.js回车，就会有相应的命令，</p> 
 <p> <img alt="" height="234" src="https://images2.imgbox.com/bd/f8/NBICGOuO_o.png" width="488"></p> 
 <p>2、开启auto.js的<strong>无障碍服务、悬浮窗、连接电脑</strong></p> 
 <p>3、查看电脑ip:<img alt="" height="203" src="https://images2.imgbox.com/6b/79/hBIMyZW9_o.png" width="832"></p> 
</blockquote> 
<h3>二、auto.js官方文档</h3> 
<p><a href="https://pro.autojs.org/docs/zh/v8/automator/selector.html" rel="nofollow" title=" Auto.js Pro文档 (autojs.org)"> Auto.js Pro文档 (autojs.org)</a></p> 
<p><span style="color:#fe2c24;"><strong>注意！！！！</strong></span></p> 
<p>因为抖音短视频的机制是，当进入页面的时候会有上下视频先进性加载缓存，如下图，所以当我们直接按照控件属性去寻找控件的时候，会一次性找到好多个，一般往往都会取第一个，所以我们一般都要加上visibleToUser()这个属性表示在可视范围内的。</p> 
<p><img alt="" height="241" src="https://images2.imgbox.com/d3/fe/WOMAr5RE_o.png" width="159"></p> 
<h3>三、开发遇到问题记录</h3> 
<p>1、当使用截图找相似图的时候，最好不要采用scrcpy的投屏形式进行截屏，直接采用手机截图（因为这样分辨率一样，更好找）</p> 
<p>因为有些手机没法永久设置同意截图的权限，导致每次运行都要在截图的时候进行同意权限，那么在刚开始运行脚本的时候就进行设置权限，而这个权限只需要同意一次就可，请求截图只要请求一次，否则会堵塞。</p> 
<pre><code>//封装一个截图函数
function imageClick(smallImgpath, saveImgPath, threshold, screen) {
    for (var i=0; i&lt;=5; i++) {
        if (screen) {
            if (sig) {
                if (!requestScreenCapture()) { // 请求截图
                    // console.log("请求截图失败");
                    exit();
                }
                sig = false
            }
            var img = captureScreen();  //截图
            images.saveImage(img, "/sdcard/Download/" + saveImgPath);
        }
        var bg = images.read("/sdcard/Download/" + saveImgPath);
        var smallImg = images.read("/sdcard/Download/" + smallImgpath);
        var p = findImage(bg, smallImg, {
            threshold: threshold
        });
        if (p) {
            click(p.x, p.y)
            return 1
        }
        sleep(1000)
    }
}


//在需要的地方的调用即可
imageClick("send.jpg", "3.png", 0.6, true)   //第一个参数是需要找的小图，第二参数是大图，第三个参数是相似度，第四个参数是是否需要截图</code></pre> 
<h4><strong>2、安装问题：</strong></h4> 
<p>2.1  launchApp(‘应用名’);会失效：因为存在同名软件，这时候使用包名；</p> 
<p>2.2  无障碍服务经常被停止，导致AutoJs或者Apk不干活了：给软件设置允许【后台弹出界面】权限</p> 
<p>2.3  使用图片识别的方法打包成apk，无法正常执行脚本，应该是打包后的图片路径与代码中的路径不一致，所以导致无法正确识别找到，可以换成计算图形位置来进行计算。</p> 
<p>2.4  进行http请求，需要把http写在线程中，吧请求写在关闭弹窗--即关闭脚本处时，会产生异步问题，往往会直接先执行关闭脚本再进行请求——这样就是错的请求不出去，所以可以采用settimeout进行异步处理。</p> 
<p></p> 
<h4><strong>3、 控件属性</strong></h4> 
<p>    <strong> 3.1 选择框：单选框和多选框都是利用 attr()方法进行塞值</strong></p> 
<pre><code>// 修改cb3的checked属性
$ui.cb3.attr("checked", "true");</code></pre> 
<p>    <strong>3.2 bounds范围使用坐标：</strong>可以用bounds这个范围来定位这个控件。尽管用这个方法定位控件对于静态页面十分准确，却无法兼容不同分辨率的设备；同时对于列表页面等动态页面无法达到效果，因此使用不推荐该选择器。 </p> 
<p>   3.3 </p> 
<h4> 4、UI界面</h4> 
<p>      <strong>4.1 列表展示：直接渲染出来一个数组里面的数据</strong></p> 
<p>      参考文章： <a href="https://zhuanlan.zhihu.com/p/363082643" rel="nofollow" title="autojs之同一种布局的多种实现方式 - 知乎">autojs之同一种布局的多种实现方式 - 知乎</a></p> 
<p><img alt="" height="164" src="https://images2.imgbox.com/20/05/0fXXvO1X_o.png" width="514"></p> 
<p><img alt="" height="333" src="https://images2.imgbox.com/07/1f/dDd0ap5d_o.png" width="1047"> 而<strong>&lt;list&gt;&lt;/list&gt;布局只能是垂直布局，不能横向列表遍历</strong></p> 
<p> <strong>    4.2 在子线程中更改UI的操作</strong></p> 
<p>     参考文章：<a href="https://www.cnblogs.com/x666-6/p/15006044.html" rel="nofollow" title="https://www.cnblogs.com/x666-6/p/15006044.html">https://www.cnblogs.com/x666-6/p/15006044.html</a></p> 
<p>要在ui.run()中进行操作UI界面的改动 - 增删改</p> 
<p> <img alt="" height="248" src="https://images2.imgbox.com/c3/cf/NT9hlK17_o.png" width="633"></p> 
<p>     4.3 引用VIew，使用setVisibility属性</p> 
<p>参考文章： <a href="https://blog.csdn.net/minghao1039/article/details/128215922" title="autojs一个经典的飘浮工具栏界面源码_autojs悬浮窗ui界面  ">autojs一个经典的飘浮工具栏界面源码_autojs悬浮窗ui界面  </a> </p> 
<p><img alt="" height="51" src="https://images2.imgbox.com/14/81/nwOieS3p_o.png" width="528"></p> 
<p><img alt="" height="181" src="https://images2.imgbox.com/7c/a2/GjJ2vVIT_o.png" width="576"></p> 
<p></p> 
<p></p> 
<h4>5、悬浮窗</h4> 
<p>      <strong>5.1 悬浮窗拖动：</strong>主要是setOnTouchListener监听事件</p> 
<p><img alt="" height="632" src="https://images2.imgbox.com/92/a4/XuQBjlOm_o.png" width="1182"></p> 
<p>   在同一个id控件上，既可以移动也可以进行点击事件，这就是监听移动事件，根据移动的距离足够短，我们就可以认为这是点击事件。 </p> 
<p><img alt="" height="330" src="https://images2.imgbox.com/c4/95/mDWE72Tl_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<h3>6、按钮</h3> 
<p>     <strong> 6.1 按钮修改状态 </strong></p> 
<p><img alt="" height="157" src="https://images2.imgbox.com/c6/7a/4DlIApHc_o.png" width="743"></p> 
<p></p> 
<h2>四、打包后运行速度很慢</h2> 
<p>参考文章： <a href="https://blog.csdn.net/qq_30931547/article/details/115028333" title="autojs内存处理机制代码，避免经常崩溃_autojs运行久了崩溃_">autojs内存处理机制代码，避免经常崩溃_autojs运行久了崩溃_</a> </p> 
<p> <em><strong>autojs本身的线程代码threads.start(action)有内存泄露</strong></em></p> 
<p><img alt="" height="345" src="https://images2.imgbox.com/7d/cb/VeUwVUCm_o.png" width="568"></p> 
<p><strong>但是使用 Java 的线程存在问题：</strong> thread线程中的代码执行结束就会关闭，但是如果该线程代码未执行完毕，即时主线程关闭，该线程也不会关闭 ，没有一种能够安全关闭线程的方法。</p> 
<blockquote> 
 <p>如果线程中有死循环.线程是不会运行完就结束的.</p> 
 <p>因为未跳出子程序.所以结束不了线程.反之,跳出子程序了就说明自动结束了线程.</p> 
 <p>死循环子程序的解决方法.可以用强制结束线程 ()或用变量来结束线程</p> 
</blockquote> 
<p></p> 
<p></p> 
<p></p> 
<h2>题外话：脱离打包插件，自主打包</h2> 
<p><img alt="" height="286" src="https://images2.imgbox.com/94/df/LFOVM8G6_o.png" width="1200"><img alt="" height="727" src="https://images2.imgbox.com/cb/83/7g0FN5yP_o.png" width="1077"></p> 
<p><img alt="" height="280" src="https://images2.imgbox.com/bc/c3/IEbog2BM_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/512d9d86ccb7c07a97dae5ce1d399b19/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows常用硬件信息查看（命令行）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bcfe9ae6c5d50cac3937296fb8e0ab64/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python学习笔记-19(闭包函数,装饰器，匿名函数等案例)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>