<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nodejs连接有密码的redis、连接有密码的mongoDB - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nodejs连接有密码的redis、连接有密码的mongoDB" />
<meta property="og:description" content="nodejs连接redis redis版本5.0.6
nodejs依赖包redis版本2.6.2
import redis from &#39;redis&#39; const redisLink = &#39;redis://127.0.0.1:6379&#39; const pwd = &#39;289181&#39; const opts = { auth_pass: pwd, } const redisClient = redis.createClient(redisLink, opts) redisClient .on(&#39;error&#39;, err =&gt; console.log(&#39;------ Redis connection failed ------&#39; &#43; err)) .on(&#39;connect&#39;, () =&gt; console.log(&#39;------ Redis connection succeed ------&#39;)) export default { redis: redis, redisClient: redisClient, } nodejs连接mongoDB nodejs依赖包mongoose版本4.6.0 ; mongoomise版本0.0.8；bluebird版本3.4.6；
nodejs v12.13.0
mongoDB 版本4.2.1
在mongoDB中执行以下命令创建用户：
db.createUser({ user:&#39;admin&#39;,pwd:&#39;test123&#39;,roles:[ { role:&#39;userAdminAnyDatabase&#39;, db: &#39;admin&#39;}]}); nodejs连接代码如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/80e60aa590e39d6ac690120ce39f70e9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-27T18:50:29+08:00" />
<meta property="article:modified_time" content="2020-06-27T18:50:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nodejs连接有密码的redis、连接有密码的mongoDB</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3><a name="t0"></a><a id="nodejsredis_3"></a>nodejs连接redis</h3> 
<blockquote> 
 <p>redis版本5.0.6</p> 
 <p>nodejs依赖包redis版本2.6.2</p> 
</blockquote> 
<pre><code class="language-javascript">import redis from 'redis'

const redisLink = 'redis://127.0.0.1:6379'
const pwd = '289181'
const opts = {
	auth_pass: pwd,
}
const redisClient = redis.createClient(redisLink, opts)

redisClient
	.on('error', err =&gt; console.log('------ Redis connection failed ------' + err))
	.on('connect', () =&gt; console.log('------ Redis connection succeed ------'))

export default {
	redis: redis, 
	redisClient: redisClient, 
}</code></pre> 
<h3><a name="t1"></a><a id="nodejsmongoDB_29"></a>nodejs连接mongoDB</h3> 
<blockquote> 
 <p>nodejs依赖包mongoose版本4.6.0 ; mongoomise版本0.0.8；bluebird版本3.4.6；<br> nodejs v12.13.0<br> mongoDB 版本4.2.1</p> 
</blockquote> 
<p>在mongoDB中执行以下命令创建用户：</p> 
<pre><code class="language-javascript">db.createUser({ user:'admin',pwd:'test123',roles:[ { role:'userAdminAnyDatabase', db: 'admin'}]});
</code></pre> 
<p> nodejs连接代码如下：</p> 
<pre><code class="language-javascript">import bluebird from 'bluebird'
import mongoose from 'mongoose'
import mongoomise from 'mongoomise'

class Mongo{
	constructor(app, config) {
		Object.assign(this, {
			app, 
			config, 
		})

		this.init()
	}

	init() {
		const opts = {
			useMongoClient: true,
			server: {
				socketOptions: { 
					keepAlive: 1 
				}
			}
		}

		mongoose
			.connect('mongodb://mall:test123@127.0.0.1:27017/mall', opts)
			.connection
			.on('error', err =&gt; console.log('------ Mongodb connection failed ------' + err))
			.on('open', () =&gt; console.log('------ Mongodb connection succeed ------'))

		mongoose.Promise = global.Promise
			
		mongoomise.promisifyAll(mongoose, bluebird)
	}
}

export default Mongo</code></pre> 
<p>连接时报错：</p> 
<p>D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb\lib\utils.js:98                                                         <br>     process.nextTick(function() { throw err; });                                                                                                                        <br>                                   ^                                                                                                                                     <br> Error [MongoError]: Authentication failed.                                                                                                                              <br>     at Function.MongoError.create (D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\error.js:31:11)             <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\connection\pool.js:462:72                               <br>     at authenticateStragglers (D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\connection\pool.js:410:16)      <br>     at Connection.messageHandler (D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\connection\pool.js:444:5)    <br>     at Socket.&lt;anonymous&gt; (D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\connection\connection.js:306:22)    <br>     at Socket.emit (events.js:210:5)                                                                                                                                    <br>     at Socket.EventEmitter.emit (domain.js:476:20)                                                                                                                      <br>     at addChunk (_stream_readable.js:308:12)                                                                                                                            <br>     at readableAddChunk (_stream_readable.js:289:11)                                                                                                                    <br>     at Socket.Readable.push (_stream_readable.js:223:10)                                                                                                                <br>     at TCP.onStreamRead (internal/stream_base_commons.js:182:23)                                                                                                        <br> Emitted 'error' event on NativeConnection instance at:                                                                                                                  <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongoose\lib\connection.js:288:17                                        <br>     at NativeConnection.Connection.error (D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongoose\lib\connection.js:451:12)    <br>     at open (D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongoose\lib\connection.js:503:13)                                 <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongoose\lib\connection.js:524:7                                         <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb\lib\db.js:1545:20                                                <br>     at handleCallback (D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb\lib\utils.js:96:12)                              <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb\lib\db.js:1504:22                                                <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\connection\pool.js:701:7                                <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\connection\pool.js:677:20                               <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\auth\scram.js:190:18                                    <br>     at D:\SoftwareAndProgram\program\weixin\miniprogram\mini-mall\mini-mall-admin\node_modules\mongodb-core\lib\connection\pool.js:436:18                               <br>     at processTicksAndRejections (internal/process/task_queues.js:75:11) {                                                                                              <br>   name: 'MongoError',                                                                                                                                                   <br>   message: 'Authentication failed.',                                                                                                                                    <br>   ok: 0,                                                                                                                                                                <br>   errmsg: 'Authentication failed.',                                                                                                                                     <br>   code: 18,                                                                                                                                                             <br>   codeName: 'AuthenticationFailed'                                                                                                                                      <br> }                                                                                                                                                                       <br> npm ERR! code ELIFECYCLE                                                                                                                                                <br> npm ERR! errno 1                                                                                                                                                        <br> npm ERR! m-mall-admin@1.0.0 start: `babel-node ./bin/www`                                                                                                               <br> npm ERR! Exit status 1                                                                                                                                                  <br> npm ERR!                                                                                                                                                                <br> npm ERR! Failed at the m-mall-admin@1.0.0 start script.                                                                                                                 <br> npm ERR! This is probably not a problem with npm. There is likely additional logging output above.                                                                      <br>                                                                                                                                                                         <br> npm ERR! A complete log of this run can be found in:                                                                                                                    <br> npm ERR!     C:\Users\lenovo\AppData\Roaming\npm-cache\_logs\2019-11-29T16_19_51_799Z-debug.log                                   <br> 因为用mall用户连接mall这个db，所以需要在mongoDB中执行以下命令，新建mall用户，对mall这个db有读写权限，密码为<code>test123</code></p> 
<pre><code class="language-javascript">use mall;
db.createUser({ user:'mall',pwd:'test123',roles:[ { role:'readWrite', db: 'mall'}]});</code></pre> 
<p>修改后重新启动项目，连接成功。</p> 
<p><img alt="" src="https://images2.imgbox.com/c8/10/pfOTCOhW_o.png"></p> 
<h3><a name="t2"></a><a id="_137"></a>参考</h3> 
<p><a href="https://www.cnblogs.com/zhongweiv/p/node_redis.html" rel="nofollow">Nodejs学习笔记（九）— 与Redis的交互（mranney/node_redis）入门目录</a></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef4f2a96bd6274f91ee2ab234cb95a8f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">uniapp 工作经验:详情页样式(哪些样式需要统一,哪些样式不需要封装)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8fcbc58c09406f14496f20e089480314/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">华为认证HCIE考试认证相关问题解答</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>