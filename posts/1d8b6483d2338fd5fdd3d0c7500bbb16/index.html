<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2023新版Onenet&#43;AndroidStudio（GET获取数据，Onenet安全鉴权） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2023新版Onenet&#43;AndroidStudio（GET获取数据，Onenet安全鉴权）" />
<meta property="og:description" content="文章目录 概要整体架构流程技术名词解释两个类的声明鉴权生成（Token）MainActivity代码(Java)小结 概要 最近做了个大作业，是用AndroidStudio获取Onenet上面数据的。
本文介绍两个方法，GET（）和POST()。用的是java语言，kotlin语言可以直接搜kotlin，get方法，和java的没什么区别。
整体架构流程 首先要引入依赖和库，比如联网的，Okhttp的库
然后是核心的GET和POST代码，这里要注意的是鉴权，我找了好久才在官网找到安全鉴权的方式。（这里吐槽一下Onenet的开发者文档的可查询性实在是太弱了）
最后是获取到返回数据。
技术名词解释 1，Okhttp:OkHttp是一个开源的Java库，用于处理HTTP请求。它是Square公司开发的，设计简单而灵活，是Android开发中广泛使用的HTTP客户端。
示例代码：
import okhttp3.OkHttpClient; import okhttp3.Request; import okhttp3.Response; public class OkHttpExample { public static void main(String[] args) throws Exception { OkHttpClient client = new OkHttpClient(); Request request = new Request.Builder() .url(&#34;https://www.baidu.com&#34;) .build(); try (Response response = client.newCall(request).execute()) { System.out.println(response.body().string()); } } } 2，安全鉴权：在OkHttp中，.header 方法用于设置HTTP请求头。通过这个方法，你可以添加自定义的请求头信息。以下是一个简单的示例，演示如何在OkHttp中使用.header方法：
import okhttp3.OkHttpClient; import okhttp3.Request; import okhttp3.Response; public class OkHttpHeaderExample { public static void main(String[] args) throws Exception { OkHttpClient client = new OkHttpClient(); // 构建请求时使用 ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/1d8b6483d2338fd5fdd3d0c7500bbb16/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-26T11:07:57+08:00" />
<meta property="article:modified_time" content="2024-01-26T11:07:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2023新版Onenet&#43;AndroidStudio（GET获取数据，Onenet安全鉴权）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_2"></a>文章目录</h5> 
<ul><li> 
  <ul><li>概要</li><li>整体架构流程</li><li>技术名词解释</li><li>两个类的声明</li><li>鉴权生成（Token）</li><li>MainActivity代码(Java)</li><li>小结</li></ul> </li></ul> 
<h4><a id="httpsblogcsdnnetMenaceRobertarticledetails134893470spm1001210030017377utm_mediumdistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecasedepth_1utm_sourcedistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecase_12"></a><a href="https://blog.csdn.net/MenaceRobert/article/details/134893470?spm=1001.2100.3001.7377&amp;utm_medium=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase&amp;depth_1-utm_source=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase"></a>概要</h4> 
<p>最近做了个大作业，是用AndroidStudio获取Onenet上面数据的。<br> 本文介绍两个方法，GET（）和POST()。用的是java语言，kotlin语言可以直接搜kotlin，get方法，和java的没什么区别。</p> 
<h4><a id="httpsblogcsdnnetMenaceRobertarticledetails134893470spm1001210030017377utm_mediumdistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecasedepth_1utm_sourcedistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecase_17"></a><a href="https://blog.csdn.net/MenaceRobert/article/details/134893470?spm=1001.2100.3001.7377&amp;utm_medium=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase&amp;depth_1-utm_source=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase"></a>整体架构流程</h4> 
<p>首先要引入依赖和库，比如联网的，Okhttp的库<br> 然后是核心的GET和POST代码，这里要注意的是<strong>鉴权</strong>，我找了好久才在官网找到安全鉴权的方式。（这里吐槽一下Onenet的开发者文档的可查询性实在是太弱了）<br> 最后是获取到返回数据。<br> <img src="https://images2.imgbox.com/cb/aa/5l7fOuRi_o.png" alt="所有文件"></p> 
<h4><a id="httpsblogcsdnnetMenaceRobertarticledetails134893470spm1001210030017377utm_mediumdistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecasedepth_1utm_sourcedistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecase_24"></a><a href="https://blog.csdn.net/MenaceRobert/article/details/134893470?spm=1001.2100.3001.7377&amp;utm_medium=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase&amp;depth_1-utm_source=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase"></a>技术名词解释</h4> 
<p>1，Okhttp:OkHttp是一个开源的Java库，用于处理HTTP请求。它是Square公司开发的，设计简单而灵活，是Android开发中广泛使用的HTTP客户端。<br> 示例代码：</p> 
<pre><code>import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;

public class OkHttpExample {
    public static void main(String[] args) throws Exception {
        OkHttpClient client = new OkHttpClient();

        Request request = new Request.Builder()
                .url("https://www.baidu.com")
                .build();

        try (Response response = client.newCall(request).execute()) {
            System.out.println(response.body().string());
        }
    }
}


</code></pre> 
<p>2，安全鉴权：在OkHttp中，.header 方法用于设置HTTP请求头。通过这个方法，你可以添加自定义的请求头信息。以下是一个简单的示例，演示如何在OkHttp中使用.header方法：</p> 
<pre><code>import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;

public class OkHttpHeaderExample {
    public static void main(String[] args) throws Exception {
        OkHttpClient client = new OkHttpClient();

        // 构建请求时使用 .header 方法添加自定义的请求头
        Request request = new Request.Builder()
                .url("https://www.example.com")
                .header("Authorization", "Bearer your_access_token") // 添加 Authorization 请求头
                .build();

        try (Response response = client.newCall(request).execute()) {
            System.out.println(response.body().string());
        }
    }
}

</code></pre> 
<h4><a id="httpsblogcsdnnetMenaceRobertarticledetails134893470spm1001210030017377utm_mediumdistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecasedepth_1utm_sourcedistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecase_76"></a><a href="https://blog.csdn.net/MenaceRobert/article/details/134893470?spm=1001.2100.3001.7377&amp;utm_medium=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase&amp;depth_1-utm_source=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase"></a>两个类的声明</h4> 
<p>第一个是JsonRootBean.java文件（这个文件和MainActivity平行）</p> 
<pre><code>package com.example.myapplication;

import java.util.List;

public class JsonRootBean {//Json转换
    int code;
List&lt;Data&gt; data;
    String msg;
    String request_id;

}


</code></pre> 
<p>第二个是data.java</p> 
<pre><code>package com.example.myapplication;
import androidx.annotation.VisibleForTesting;

import java.util.List;
public class Data {//用list存放获取的数据流
    String identifier;
    String time;
    String value;
    String data_type;
    String access_mode;
    String name;
    String description;
}


</code></pre> 
<h4><a id="httpsblogcsdnnetMenaceRobertarticledetails134893470spm1001210030017377utm_mediumdistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecasedepth_1utm_sourcedistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecaseToken_116"></a><a href="https://blog.csdn.net/MenaceRobert/article/details/134893470?spm=1001.2100.3001.7377&amp;utm_medium=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase&amp;depth_1-utm_source=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase"></a>鉴权生成（Token）</h4> 
<p>Onenet的鉴权介绍网址：<a href="https://open.iot.10086.cn/doc/v5/fuse/detail/1464" rel="nofollow">安全鉴权</a><br> 鉴权码生成代码：<a href="https://open.iot.10086.cn/doc/v5/fuse/detail/635" rel="nofollow">API鉴权</a><br> 我贴一下我的代码token.java</p> 
<pre><code>package com.example.myapplication;

import android.os.Build;

import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.util.Base64;

import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;

public class Token {
    public static String TOKEN = "默认值";

    public static void setMyString(String newValue) {
        TOKEN = newValue;
    }
    public static String assembleToken(String version, String resourceName, String expirationTime, String signatureMethod, String accessKey)
            throws UnsupportedEncodingException, NoSuchAlgorithmException, InvalidKeyException {
        StringBuilder sb = new StringBuilder();
        String res = URLEncoder.encode(resourceName, "UTF-8");
        String sig = URLEncoder.encode(generatorSignature(version, resourceName, expirationTime, accessKey, signatureMethod), "UTF-8");
        sb.append("version=")
                .append(version)
                .append("&amp;res=")
                .append(res)
                .append("&amp;et=")
                .append(expirationTime)
                .append("&amp;method=")
                .append(signatureMethod)
                .append("&amp;sign=")
                .append(sig);
        return sb.toString();
    }

    public static String generatorSignature(String version, String resourceName, String expirationTime, String accessKey, String signatureMethod)
            throws NoSuchAlgorithmException, InvalidKeyException {
        String encryptText = expirationTime + "\n" + signatureMethod + "\n" + resourceName + "\n" + version;
        String signature = null;
        byte[] bytes = HmacEncrypt(encryptText, accessKey, signatureMethod);
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
            signature = Base64.getEncoder().encodeToString(bytes);
        }
        return signature;
    }

    public static byte[] HmacEncrypt(String data, String key, String signatureMethod)
            throws NoSuchAlgorithmException, InvalidKeyException {
        //根据给定的字节数组构造一个密钥,第二参数指定一个密钥算法的名称
        SecretKeySpec signinKey = null;
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
            signinKey = new SecretKeySpec(Base64.getDecoder().decode(key),
                    "Hmac" + signatureMethod.toUpperCase());
        }

        //生成一个指定 Mac 算法 的 Mac 对象
        Mac mac = null;
        mac = Mac.getInstance("Hmac" + signatureMethod.toUpperCase());

        //用给定密钥初始化 Mac 对象
        mac.init(signinKey);

        //完成 Mac 操作
        return mac.doFinal(data.getBytes());
    }

    public enum SignatureMethod {
        SHA1, MD5, SHA256;
    }

    public static void main(String args) throws UnsupportedEncodingException, NoSuchAlgorithmException, InvalidKeyException {
        String version = "2022-05-01";
        String resourceName = "userid/这里写你的用户id";
        String expirationTime = System.currentTimeMillis() / 1000 + 100 * 24 * 60 * 60 + "";
        String signatureMethod = SignatureMethod.SHA1.name().toLowerCase();
        String accessKey = "这里放你的AccessKey（在Onenet官网的账户信息里面）";
        String token = assembleToken(version, resourceName, expirationTime, signatureMethod, accessKey);
        setMyString(token);
    }
}


</code></pre> 
<h4><a id="httpsblogcsdnnetMenaceRobertarticledetails134893470spm1001210030017377utm_mediumdistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecasedepth_1utm_sourcedistributepc_feed_blog_categorynonetaskblogclassify_tag7134893470nullnullnonecaseMainActivityJava_209"></a><a href="https://blog.csdn.net/MenaceRobert/article/details/134893470?spm=1001.2100.3001.7377&amp;utm_medium=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase&amp;depth_1-utm_source=distribute.pc_feed_blog_category.none-task-blog-classify_tag-7-134893470-null-null.nonecase"></a>MainActivity代码(Java)</h4> 
<pre><code> public class MainActivity extends AppCompatActivity {
 String token="鉴权参数";
 protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);//UI的基本布局
        try {
            Token.main("拿鉴权码，这里参数无所谓的");
        } catch (UnsupportedEncodingException | NoSuchAlgorithmException | InvalidKeyException e) {
            throw new RuntimeException(e);
        }
        token=Token.TOKEN;//赋值Token，把鉴权信息拿到
`        requestPermissions(new String[]{"android.permission.INTERNET"}, 1);
        Get();}
        

</code></pre> 
<p>如图上面是主函数代码，获取网络请求后直接GET就好了。</p> 
<pre><code>public void Get(){
         new Thread(new Runnable() {
                    @Override
                    public void run() {
               		while (true) {
                    try {
                        OkHttpClient client = new OkHttpClient();
                        //http(s)://iot-api.heclouds.com/thingmodel/query-device-property?product_id=w50WLDzGBb&amp;device_name=light
                        //http://iot-api.heclouds.com/thingmodel/query-thing-model?product_id=w50WLDzGBb
                        Request request = new Request.Builder().url("http://iot-api.heclouds.com/thingmodel/query-device-property?product_id=这里输入你的产品id&amp;device_name=你的设备名称")
                                .header("Authorization",token)
                                .build();
                        Response response = client.newCall(request).execute();
                        String responseData = response.body().string();
                          JsonRootBean app = new Gson().fromJson(responseData, JsonRootBean.class);

                       value=app.data.get(0).value.toString();//获得亮度
                        brightnessDisplay.post(new Runnable() {
                            @Override
                            public void run() {
                                brightnessDisplay.setText(String.format("BrightnessRightNow:%s", value));
                            }
                        });
                    } catch (IOException e) {
                        e.printStackTrace();}
                   try {
                       Thread.sleep(1000);
                   } catch (InterruptedException e) {
                       throw new RuntimeException(e);
                   }//延时一秒获取一次亮度
               }
            }
        }).start();

</code></pre> 
<p>在.header后面这个token，就是我们要的鉴权码。<br> 上面代码中的jsonRootbean是我自己的一个类，我GET获取的数据是一段json格式的数组</p> 
<pre><code>{"code":0,
"data":[{"identifier":"bright","time":1700127636130,"value":"0.600000","data_type":"float","access_mode":"读写","name":"bright"},
{"identifier":"setbright","data_type":"int32","access_mode":"读写","name":"setbright"},
{"identifier":"state","time":1698234341316,"value":"2","data_type":"enum","access_mode":"读写","name":"state","description":"工作模式"},
{"identifier":"time","data_type":"date","access_mode":"读写","name":"time"}],
"msg":"succ",
"request_id":"f97096fb25a94f2884a043c510821485"}

</code></pre> 
<p><a href="https://open.iot.10086.cn/doc/v5/fuse/detail/1421" rel="nofollow">ONENET官网关于GET方法的返回数组</a><br> 可以看到有4个大参数，code,data,msg,request_id<br> data是一个数组，在数组的每一个项里面又包含4个小参数(如下图），<img src="https://images2.imgbox.com/70/26/WstTKEbZ_o.png" alt="identifier,data_type,access_mode,name"><br> 所以我们核心的是获取到data里面的这个value值，因此GET获取到数据后，采用了下面这个方式提取到value</p> 
<pre><code> Response response = client.newCall(request).execute();
                        String responseData = response.body().string();
                          JsonRootBean app = new Gson().fromJson(responseData, JsonRootBean.class);

                       value=app.data.get(0).value.toString();//获得亮度

</code></pre> 
<p><a href="https://blog.csdn.net/Java_ZZZZZ/article/details/135558334?spm=1001.2014.3001.5502"></a><a href="https://blog.csdn.net/2301_82000445/article/details/135502608?spm=1001.2014.3001.5502"></a>黑客学习资源推荐</p> 
<p>最后给大家分享一份全套的网络安全学习资料，给那些想学习 网络安全的小伙伴们一点帮助！</p> 
<p>对于从来没有接触过网络安全的同学，我们帮你准备了详细的学习成长路线图。可以说是最科学最系统的学习路线，大家跟着这个大的方向学习准没问题。</p> 
<p>😝朋友们如果有需要的话，可以V扫描下方二维码联系领取~</p> 
<p><img src="https://images2.imgbox.com/ff/f7/8imECUm8_o.png" alt=""></p> 
<h6><a id="1_310"></a>1️⃣零基础入门</h6> 
<h6><a id="_312"></a>学习路线</h6> 
<p>对于从来没有接触过网络安全的同学，我们帮你准备了详细的<strong>学习成长路线图</strong>。可以说是<strong>最科学最系统的学习路线</strong>，大家跟着这个大的方向学习准没问题。</p> 
<p><img src="https://images2.imgbox.com/3d/f8/g0y8WJkG_o.gif" alt="image"></p> 
<p>需要详细路线图的，下面获取</p> 
<p><img src="https://images2.imgbox.com/5e/9c/qy3sDQbv_o.png" alt=""></p> 
<h6><a id="_322"></a>路线对应学习视频</h6> 
<p>同时每个成长路线对应的板块都有配套的视频提供：</p> 
<p><img src="https://images2.imgbox.com/9a/a2/AuMqmjH1_o.png" alt="image-20231025112050764"></p> 
<h6><a id="2_328"></a>2️⃣视频配套工具&amp;国内外网安书籍、文档</h6> 
<h6><a id="_330"></a>工具</h6> 
<p><img src="https://images2.imgbox.com/bd/e3/BnjaSvEs_o.png" alt=""></p> 
<p>######视频</p> 
<p><img src="https://images2.imgbox.com/fa/f0/mikg15Vy_o.png" alt="image1"></p> 
<p>######书籍</p> 
<p><img src="https://images2.imgbox.com/b5/a0/xuI1VDuv_o.png" alt="image2"></p> 
<p>资源较为敏感，未展示全面，需要的下面获取</p> 
<p><img src="https://images2.imgbox.com/a3/db/sW7OInG1_o.png" alt=""> ### 3️⃣Python面试集锦</p> 
<h6><a id="_346"></a>面试资料</h6> 
<p><img src="https://images2.imgbox.com/87/2c/tfljCOrS_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/07/8c/hGG0fLP0_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_350"></a>简历模板</h6> 
<p><img src="https://images2.imgbox.com/e7/2e/YaVU3epH_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/b6/cf/HfBi2gI1_o.png" alt=""></p> 
<p><strong>因篇幅有限，资料较为敏感仅展示部分资料，添加上方即可获取👆</strong></p> 
<p><strong>------ 🙇‍♂️ 本文转自网络，如有侵权，请联系删除 🙇‍♂️ ------</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3f9ccba324b775eb66ce71ce48769795/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">看书标记【数据科学：R语言实战 2】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a705a5be840c74ae857a3dd526d228d1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">每日一题 力扣2846 边权重均等查询</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>