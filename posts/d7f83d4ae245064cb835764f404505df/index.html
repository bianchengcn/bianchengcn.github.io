<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>搭建个人深度学习工作站（捡垃圾） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="搭建个人深度学习工作站（捡垃圾）" />
<meta property="og:description" content="1 硬件平台 工作站考虑性价比和后续的扩展性，在二手平台搜索了几天，发现捡垃圾真香。
考虑到深度学习有多卡的需求，平台选择需要有足够多的 pcie 通道，平台选择了 Intel 十代 X 系列 CPU &#43; X299 主板，能够提供 48 条 pcie lane，二手主板&#43;CPU总价低于十四代 i9 CPU。大模型的显存需求比较大，魔改 22GB 显存的 2080ti 看起来很香，就先入手一块试试水，真香之后，再考虑组多卡（2080ti 支持 Nvlink）。另外内存硬盘电源这些还是要求稳，入手了新的。
配置如下：
CPU：i9-10940xGPU：魔改 22GB 2080ti内存：长城马甲条 32GBx2（平台最大支持8槽4通道256GB，后续需要再加）主板：技嘉x299x AORUS MASTER（四个 PCIE 插槽，可以拆分 x16x8x8x8）固态：2TB长城 m.2 SSD（平台可以插3块 m.2 固态，后续需要再加）电源：长城金牌 1250W 模组电源散热器：idcooling 360 水冷&#43;120机箱风扇若干机箱：长城 KM7 塔式机箱 2 系统安装 作为开发机器用来自己捯饬，使用的是 Ubuntu 系统
使用的是 ultralOS 来制作 Ubuntu 的系统启动盘
ultralOS 下载
下载试用版即可。安装完成后，打开 ultralOS，选择继续试用。
当然，如果有能力，也支持购买完全版。ubuntu18.04 下载： 清华大学开源软件镜像站-ubuntu18.04使用 ultralOS 打开刚才下载的 iso 文件制作启动盘 启动 → 写入硬盘映像 → 写入方式： U S B − H D D &#43; 或者 U S B − H D D → 便捷启动 → 写入新的驱动器引导扇区 → s y s l i n u x → 写入 \boxed{启动} \rightarrow \boxed{写入硬盘映像} \rightarrow \boxed{写入方式：USB-HDD&#43;或者USB-HDD} \rightarrow \boxed{便捷启动} \rightarrow \boxed{写入新的驱动器引导扇区} \rightarrow \boxed{syslinux} \rightarrow \boxed{写入} 启动​→写入硬盘映像​→写入方式：USB−HDD&#43;或者USB−HDD​→便捷启动​→写入新的驱动器引导扇区​→syslinux​→写入​后续等待写入完成即可 安装系统，基本就是按部就班，网络上各种教程非常多，就不过多赘述了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/d7f83d4ae245064cb835764f404505df/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T00:52:53+08:00" />
<meta property="article:modified_time" content="2024-01-02T00:52:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">搭建个人深度学习工作站（捡垃圾）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="1__0"></a>1 硬件平台</h4> 
<p>工作站考虑性价比和后续的扩展性，在二手平台搜索了几天，发现捡垃圾真香。<br> 考虑到深度学习有多卡的需求，平台选择需要有足够多的 pcie 通道，平台选择了 Intel 十代 X 系列 CPU + X299 主板，能够提供 48 条 pcie lane，二手主板+CPU总价低于十四代 i9 CPU。大模型的显存需求比较大，魔改 22GB 显存的 2080ti 看起来很香，就先入手一块试试水，真香之后，再考虑组多卡（2080ti 支持 Nvlink）。另外内存硬盘电源这些还是要求稳，入手了新的。<br> 配置如下：</p> 
<ul><li>CPU：i9-10940x</li><li>GPU：魔改 22GB 2080ti</li><li>内存：长城马甲条 32GBx2（平台最大支持8槽4通道256GB，后续需要再加）</li><li>主板：技嘉x299x AORUS MASTER（四个 PCIE 插槽，可以拆分 x16x8x8x8）</li><li>固态：2TB长城 m.2 SSD（平台可以插3块 m.2 固态，后续需要再加）</li><li>电源：长城金牌 1250W 模组电源</li><li>散热器：idcooling 360 水冷+120机箱风扇若干</li><li>机箱：长城 KM7 塔式机箱</li></ul> 
<h4><a id="2__14"></a>2 系统安装</h4> 
<p>作为开发机器用来自己捯饬，使用的是 Ubuntu 系统</p> 
<ul><li> <p>使用的是 ultralOS 来制作 Ubuntu 的系统启动盘</p> 
  <ul><li><a href="https://www.cn.ultraiso.net/xiazai.html" rel="nofollow">ultralOS 下载</a><br> 下载试用版即可。安装完成后，打开 ultralOS，选择继续试用。<br> 当然，如果有能力，也支持购买完全版。</li><li>ubuntu18.04 下载：<a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/18.04/" rel="nofollow"> 清华大学开源软件镜像站-ubuntu18.04</a></li><li>使用 ultralOS 打开刚才下载的 iso 文件</li><li>制作启动盘 
    <ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
          
           
            
             
              
               
                
                
                  启动 
                 
                
               
              
             
            
              → 
             
             
              
               
                
                
                  写入硬盘映像 
                 
                
               
              
             
            
              → 
             
             
              
               
                
                 
                 
                   写入方式： 
                  
                 
                   U 
                  
                 
                   S 
                  
                 
                   B 
                  
                 
                   − 
                  
                 
                   H 
                  
                 
                   D 
                  
                 
                   D 
                  
                 
                   + 
                  
                 
                   或者 
                  
                 
                   U 
                  
                 
                   S 
                  
                 
                   B 
                  
                 
                   − 
                  
                 
                   H 
                  
                 
                   D 
                  
                 
                   D 
                  
                 
                
               
              
             
            
              → 
             
             
              
               
                
                
                  便捷启动 
                 
                
               
              
             
            
              → 
             
             
              
               
                
                
                  写入新的驱动器引导扇区 
                 
                
               
              
             
            
              → 
             
             
              
               
                
                 
                 
                   s 
                  
                 
                   y 
                  
                 
                   s 
                  
                 
                   l 
                  
                 
                   i 
                  
                 
                   n 
                  
                 
                   u 
                  
                 
                   x 
                  
                 
                
               
              
             
            
              → 
             
             
              
               
                
                
                  写入 
                 
                
               
              
             
            
           
             \boxed{启动} \rightarrow \boxed{写入硬盘映像} \rightarrow \boxed{写入方式：USB-HDD+或者USB-HDD} \rightarrow \boxed{便捷启动} \rightarrow \boxed{写入新的驱动器引导扇区} \rightarrow \boxed{syslinux} \rightarrow \boxed{写入} 
            
           
         </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.3633em; vertical-align: -0.34em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0233em;"><span class="" style="top: -3.3633em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="boxpad"><span class="mord"><span class="mord"><span class="mord cjk_fallback">启动</span></span></span></span></span><span class="" style="top: -3.0233em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="stretchy fbox" style="height: 1.3633em; border-style: solid; border-width: 0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.34em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.3633em; vertical-align: -0.34em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0233em;"><span class="" style="top: -3.3633em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="boxpad"><span class="mord"><span class="mord"><span class="mord cjk_fallback">写入硬盘映像</span></span></span></span></span><span class="" style="top: -3.0233em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="stretchy fbox" style="height: 1.3633em; border-style: solid; border-width: 0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.34em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.4467em; vertical-align: -0.4233em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0233em;"><span class="" style="top: -3.4467em;"><span class="pstrut" style="height: 3.4467em;"></span><span class="boxpad"><span class="mord"><span class="mord"><span class="mord cjk_fallback">写入方式：</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mord mathnormal" style="margin-right: 0.0502em;">SB</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">HDD</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord cjk_fallback">或者</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mord mathnormal" style="margin-right: 0.0502em;">SB</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">HDD</span></span></span></span></span><span class="" style="top: -3.0233em;"><span class="pstrut" style="height: 3.4467em;"></span><span class="stretchy fbox" style="height: 1.4467em; border-style: solid; border-width: 0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4233em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.3633em; vertical-align: -0.34em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0233em;"><span class="" style="top: -3.3633em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="boxpad"><span class="mord"><span class="mord"><span class="mord cjk_fallback">便捷启动</span></span></span></span></span><span class="" style="top: -3.0233em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="stretchy fbox" style="height: 1.3633em; border-style: solid; border-width: 0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.34em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.3633em; vertical-align: -0.34em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0233em;"><span class="" style="top: -3.3633em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="boxpad"><span class="mord"><span class="mord"><span class="mord cjk_fallback">写入新的驱动器引导扇区</span></span></span></span></span><span class="" style="top: -3.0233em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="stretchy fbox" style="height: 1.3633em; border-style: solid; border-width: 0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.34em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.5689em; vertical-align: -0.5344em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0344em;"><span class="" style="top: -3.5689em;"><span class="pstrut" style="height: 3.5689em;"></span><span class="boxpad"><span class="mord"><span class="mord"><span class="mord mathnormal">sys</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">in</span><span class="mord mathnormal">ux</span></span></span></span></span><span class="" style="top: -3.0344em;"><span class="pstrut" style="height: 3.5689em;"></span><span class="stretchy fbox" style="height: 1.5689em; border-style: solid; border-width: 0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.5344em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.3633em; vertical-align: -0.34em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0233em;"><span class="" style="top: -3.3633em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="boxpad"><span class="mord"><span class="mord"><span class="mord cjk_fallback">写入</span></span></span></span></span><span class="" style="top: -3.0233em;"><span class="pstrut" style="height: 3.3633em;"></span><span class="stretchy fbox" style="height: 1.3633em; border-style: solid; border-width: 0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.34em;"><span class=""></span></span></span></span></span></span></span></span></span></li><li>后续等待写入完成即可</li></ul> </li></ul> </li><li> <p>安装系统，基本就是按部就班，网络上各种教程非常多，就不过多赘述了。</p> </li></ul> 
<h4><a id="3__29"></a>3 系统环境配置</h4> 
<ul><li> <p>更换镜像源</p> <pre><code class="prism language-bash">  <span class="token comment"># 备份镜像源列表</span>
  <span class="token function">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bk
  <span class="token comment"># 编辑镜像源列表文件，这里替换的是中科大的镜像源</span>
  <span class="token comment">#  中科大源</span>
  deb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse
  deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse
  deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse
  deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse
  deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse
  deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse
  deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse
  deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse
  deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse
  deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse

  <span class="token comment"># 国内的其他源</span>
  <span class="token comment">#  阿里源</span>
  deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
  deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
  deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
  deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
  deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse

   <span class="token comment"># 清华源</span>
   deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse
   deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse
   deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse
   deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse
   deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse
   deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse
   deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse
   deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse
   deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse
   deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse
</code></pre> </li><li> <p>必要软件安装</p> <pre><code class="prism language-bash">  <span class="token comment"># 更新软件列表</span>
  <span class="token function">sudo</span> <span class="token function">apt-get</span> update
  <span class="token function">sudo</span> <span class="token function">apt-get</span> upgrade

  <span class="token comment"># install software</span>
  <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">vim</span>
  <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">ssh</span>
  <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> net-tools
  <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">git</span>
</code></pre> </li><li> <p>配置 ssh<br> 这里没有配置远程桌面，主要是两方面的考虑：</p> 
  <ul><li>一个是自己平时开发基本用不上，使用 ssh 远程连接上去有个 terminal 就基本够用了；</li><li>另一方面是我的工作站主机就放在桌底墙角，主显示器很容易就可以切换到工作站的视频信号输出，因此没必要远程桌面。</li></ul> <pre><code class="prism language-bash">  <span class="token comment"># 查看本机 IP</span>
  <span class="token function">ifconfig</span>

  <span class="token comment"># 在 ~/.bashrc 中添加sshd自启动脚本，其他应用程序同理</span>
  <span class="token comment"># 下面的代码添加在 ~/.bashrc 末尾</span>
  <span class="token comment"># 初始化sshd</span>
  <span class="token keyword">if</span> pgrep <span class="token parameter variable">-x</span> <span class="token string">"sshd"</span> <span class="token operator">&gt;</span>/dev/null
    <span class="token keyword">then</span>
      <span class="token builtin class-name">echo</span> <span class="token string">" &gt; sshd started"</span>
    <span class="token keyword">else</span>
      sshd <span class="token operator">&gt;</span>/dev/null
      <span class="token builtin class-name">echo</span> <span class="token string">" &gt; sshd start success"</span>
  <span class="token keyword">fi</span>
</code></pre> </li><li> <p>安装 python 和 pip</p> <pre><code class="prism language-bash">  <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3
  <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3-pip
</code></pre> <p>如果需要指定版本的 python，可以在后面安装完 conda 环境之后再安装，也方便管理</p> 
  <ul><li>替换 pip 源<pre><code class="prism language-bash">  <span class="token function">sudo</span> <span class="token function">vim</span> ~/.pip/pip.conf
  <span class="token comment"># 把文件内容修改为如下内容（清华源）</span>
  <span class="token punctuation">[</span>global<span class="token punctuation">]</span>
  index-url <span class="token operator">=</span> https://pypi.tuna.tsinghua.edu.cn/simple/ 
  <span class="token punctuation">[</span>install<span class="token punctuation">]</span>
  trusted-host <span class="token operator">=</span> pypi.tuna.tsinghua.edu.cn
</code></pre> </li><li>更改默认python版本<br> 我的习惯是 python 链接到 python2，python3 链接到 python3，python3-pip 链接到 python-pip3<pre><code class="prism language-bash">  <span class="token comment"># 删除原来的python软链接</span>
  <span class="token function">sudo</span> <span class="token function">rm</span> /usr/bin/python
  <span class="token function">sudo</span> <span class="token function">rm</span> /usr/bin/python3

  <span class="token comment"># 新建软链接</span>
  <span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/bin/python2 /usr/bin/python
  <span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/bin/pip3 /usr/bin/pip
  <span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/bin/python3 /usr/bin/python3
</code></pre> </li></ul> </li></ul> 
<h4><a id="4_DeepLearning__135"></a>4 DeepLearning 开发环境配置</h4> 
<ul><li> <p>安装 NVIDIA 显卡驱动</p> <p>在图形化界面安装比较方便<br> <span class="katex--inline">KaTeX parse error: Expected '}', got '&amp;' at position 16: \boxed{software&amp;̲update} \righta…</span></p> <p>之后选择 NVIDIA 的最近新的驱动 apply 即可，稍等几分钟就可以安装完成<br> 安装完成之后，更新软件列表</p> <pre><code class="prism language-bash">  <span class="token function">sudo</span> <span class="token function">apt</span> update
  <span class="token function">sudo</span> <span class="token function">apt</span> upgrade
</code></pre> <p>此时运行 <code>nvidia-smi</code> 可能会报错，重启机器即可</p> </li><li> <p>安装 cuda<br> 如果之前安装了旧版本的cuda和cudnn的话，需要先卸载后再安装：</p> <pre><code class="prism language-bash">   <span class="token function">sudo</span> <span class="token function">apt-get</span> remove <span class="token parameter variable">--purge</span> nvidia*
</code></pre> <p>然后按照前面的方法重新安装显卡驱动，安装好了之后开始安装CUDA，如果没有安装过 cuda，可以不卸载</p> 
  <ul><li>在 NVIDIA 官网下载 cuda 安装包：https://developer.nvidia.com/cuda-toolkit-archive。网站进去可能会很慢，下载速度还是很快的 
    <ul><li>我这里用的显卡是 2080ti，因此选择版本是：linux-x86_64-ubuntu-18.04-runfile(local)</li></ul> </li><li>运行下面的命令进行安装:<pre><code class="prism language-bash">  <span class="token function">chmod</span> +x cuda_10.1.105_418.39_linux.run
  <span class="token function">sudo</span> <span class="token function">sh</span> ./cuda_10.1.105_418.39_linux.run
</code></pre> 安装过程中需要选择要安装选项，不要勾选第一个安装显卡驱动的，因为之前已经安装过了。</li><li>设置环境变量<pre><code class="prism language-bash">  <span class="token function">vim</span> ~/.bashrc
  <span class="token comment"># 在文件末尾添加</span>
  <span class="token builtin class-name">export</span> <span class="token assign-left variable">CUDA_HOME</span><span class="token operator">=</span>/usr/local/cuda-10.1/
  <span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">${CUDA_HOME}</span>/lib64
  <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">${CUDA_HOME}</span>/bin:<span class="token variable">${<!-- --><span class="token environment constant">PATH</span>}</span>
</code></pre> 使环境变量生效<pre><code class="prism language-bash">  <span class="token builtin class-name">source</span> ~/.bashrc
</code></pre> </li><li>查看安装版本信息<code>nvcc -V</code> 
    <ul><li>也可以编译 sample 程序来验证是否成功</li></ul> <pre><code class="prism language-bash">  <span class="token builtin class-name">cd</span> NVIDIA_CUDA-10.1_Samples/1_Utilities/deviceQuery
  <span class="token function">make</span>
  ./deviceQuery
</code></pre> 若安装成功，会打印出显卡信息</li></ul> </li><li> <p>安装 CuDNN<br> 在 CUDNN 官网下载 CUDNN：https://developer.nvidia.com/rdp/cudnn-download</p> 
  <ul><li>选择和之前cuda版本对应的cudnn版本下载，下载之后是一个 tgz 压缩文件，解压该文件：</li></ul> <pre><code class="prism language-bash">  <span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> cudnn-10.1-linux-x64-v8.0.5.39.tgz
</code></pre> 
  <ul><li>复制相应文件到 cuda 目录：<pre><code class="prism language-bash">  <span class="token function">sudo</span> <span class="token function">cp</span> cuda/lib64/* /usr/local/cuda-10.1/lib64
  <span class="token function">sudo</span> <span class="token function">cp</span> cuda/include/* /usr/local/cuda-10.1/include/
</code></pre> </li><li>拷贝完成之后，可以使用以下命令查看CUDNN的版本信息<pre><code class="prism language-bash">  <span class="token function">cat</span> /usr/local/cuda/include/cudnn_version.h <span class="token operator">|</span> <span class="token function">grep</span> CUDNN_MAJOR <span class="token parameter variable">-A</span> <span class="token number">2</span>
</code></pre> </li></ul> </li><li> <p>安装 conda 环境<br> 不同的训练框架和版本可能会需要不同的python版本相对应，而且有的包比如numpy也对版本有要求。频繁切换 python 和一些包的版本，容易造成包版本冲突的问题，conda 可以给每个配置建立一个虚拟的python环境，在需要的时候可以随时切换，而不需要的时候也能删除不浪费磁盘资源。</p> 
  <ul><li>conda 官网下载 conda 的 linux 安装包：https://www.anaconda.com/download</li><li>安装：<pre><code class="prism language-bash">  <span class="token function">chmod</span> +x Anaconda3-2023.09-0-Linux-x86_64.sh
  ./Anaconda3-2023.09-0-Linux-x86_64.sh
</code></pre> 后续就一路 enter 安装下去即可。最后会问是否要初始化conda，输入yes确认，重开终端窗口之后，就可以看到conda环境可用了（base代表默认环境）</li><li>conda 创建新环境<pre><code class="prism language-bash">   conda create <span class="token parameter variable">--name</span> python_38 <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.8</span>
</code></pre> </li><li>进入指定的 conda 环境：<pre><code class="prism language-bash">   conda activate python_38
</code></pre> </li><li>退出当前 conda 环境：<pre><code class="prism language-bash">  conda deactivate
</code></pre> </li></ul> </li><li> <p>安装 nvidia-docker<br> 有时候不同的项目可能会用到不同的 gcc 版本的编译环境，或者是有不同的工具链需求。如果这些操作都在服务器本地上进行，那时间久了就会让服务器的文件系统非常杂乱，而且还会遇到各种软件版本冲突问题。<br> docker 可以理解为一个轻量化的虚拟环境，与服务器的本地环境隔离，可以在宿主服务器上新建很多个这种被称为容器的虚拟机，然后在里面配置我们的开发环境，且这些配置好的环境是可以打包成镜像的，方便随时做分享和重用。在使用完不需要的时候，可以直接删除容器。<br> Nvidia-Docker 可以把GPU暴露给Docker的容器。</p> 
  <ul><li>Nvidia-Docker 安装：<pre><code class="prism language-bash">  <span class="token function">sudo</span> <span class="token function">apt-get</span> update
  <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker.io
  systemctl start <span class="token function">docker</span>
  systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
</code></pre> 验证是否安装成功：<pre><code class="prism language-bash">  <span class="token function">docker</span> version
</code></pre> </li><li>安装 NVIDIA Container Toolkit<pre><code class="prism language-bash">   <span class="token comment">##首先要确保已经安装了nvidia driver</span>
   <span class="token comment"># 2. 添加源</span>
   <span class="token assign-left variable">distribution</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">.</span> /etc/os-release<span class="token punctuation">;</span><span class="token builtin class-name">echo</span> $ID$VERSION_ID<span class="token variable">)</span></span>
   <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-L</span> https://nvidia.github.io/nvidia-docker/gpgkey <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
   <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-L</span> https://nvidia.github.io/nvidia-docker/<span class="token variable">$distribution</span>/nvidia-docker.list <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/nvidia-docker.list
   ​
   <span class="token comment"># 2. 安装并重启</span>
   <span class="token function">sudo</span> <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> nvidia-container-toolkit
   <span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre> 安装完成后可以新建一个容器测试一下：<pre><code class="prism language-bash">  <span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> test_nvidia_docker <span class="token parameter variable">--gpus</span> all nvidia/cuda:10.1-base 
</code></pre> 进入容器之后可以跑一下nvidia-smi命令看看 GPU 状态</li></ul> </li></ul> 
<h4><a id="5__256"></a>5 工作站维护</h4> 
<ul><li>工作站系统备份还原 
  <ul><li>备份<br> 由于 Linux 本身具有万物皆文件的设计理念，另外 root 用户对几乎全部的系统文件都有访问和更改的权限，因此可以直接打包整个根文件系统来备份。<br> 在打包的时候，需要排除掉一些不需要的文件和与新系统文件冲突的文件，包括/tmp、/proc、/lost+found 等目录。对于需要备份的目录：<pre><code class="prism language-bash">  <span class="token function">tar</span> <span class="token parameter variable">-cvpzf</span> ubuntu_backup@<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y-%m+%d<span class="token variable">`</span></span>.tar.gz <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/proc <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/tmp <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/boot  <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/lost+found <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/media <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/mnt <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/run /
</code></pre> 可以得到一个名为backup.tgz的压缩文件，这个文件包含我们需要备份的系统的全部内容</li><li>还原<br> 如果系统没有出问题可以正常启动的话，那直接在刚刚的压缩包找到想还原的文件替换就好了。而如果系统无法启动了，或者说想换一块硬盘克隆一样的系统，那么可以按一下步骤操作： 
    <ul><li>重装干净的Ubuntu系统，跟上面介绍的一样，使用U盘给目标磁盘重装一个干净的系统，这一步是为了省去自己分配存储空间和挂载的麻烦，如果你自己配置的话那也可以不做这一步</li><li>再次使用U盘进入系统，这次选择try ubuntu without installing，然后可以看到挂载好的刚刚安装了干净系统的另一个盘，我们在这里对盘里的根文件系统进行一些文件的提取<pre><code class="prism language-bash">  <span class="token function">sudo</span> <span class="token function">su</span>

  <span class="token comment"># 在tryUbuntu根目录下有media文件夹，里面是U盘文件夹和新安装的系统文件夹，在在里分别用（U盘）和（UBUNTU）表示</span>
  <span class="token builtin class-name">cd</span> /media/（U盘）
  <span class="token function">mount</span> <span class="token parameter variable">-o</span> remount rw ./
   ​
  <span class="token comment"># 将新系统根目录下/boot/grub/grub.cfg文件备份到U盘中</span>
  <span class="token function">sudo</span> <span class="token function">cp</span> /media/<span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>/boot/grub/grub.cfg ./    
   ​
  <span class="token comment"># 将新系统根目录下/etc/fstab文件备份到U盘中，fstab是与系统开机挂载有关的文件，grub.cfg是与开机引导有关的文件，所以这一步至关重要</span>
  <span class="token function">sudo</span> <span class="token function">cp</span> /media/<span class="token punctuation">(</span>UBUNTU<span class="token punctuation">)</span>/etc/fstab ./
   ​
  <span class="token comment"># 这一步删除新装ubuntu全部的系统文件，有用的fstab及grub.cfg已经备份</span>
  <span class="token builtin class-name">cd</span> /media/<span class="token punctuation">(</span>UBUNTU<span class="token punctuation">)</span>
  <span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> ./*
   ​
  <span class="token comment"># 将U盘中backup.tgz复制到该目录下并解压缩</span>
  <span class="token function">cp</span> /media/<span class="token punctuation">(</span>U盘<span class="token punctuation">)</span>/backup.tgz ./
  <span class="token function">sudo</span> <span class="token function">tar</span> xvpfz backup.tgz ./
   ​
  <span class="token comment"># 创建打包系统时排除的文件</span>
  <span class="token function">sudo</span> <span class="token function">mkdir</span> proc lost+found mnt sys media
</code></pre> </li></ul> 这一步完成后，再用我们在新系统中备份的fatab及grub.cfg 文件去替换压缩包中解压出来的同名文件，sudo reboot重启后就发现系统已经恢复到备份时的状态，包括各种框架，环境，系统设置~</li></ul> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d712149476f3f982c8cce115ebcb75a2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">看书标记【R语言数据分析项目精解：理论、方法、实战 6】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b9fc338be7b11bc2d6d28a464f5922cc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL数据库死锁语句查询结果</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>