<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Jquery的$.ajax防止重复提交的方法 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Jquery的$.ajax防止重复提交的方法" />
<meta property="og:description" content="1、第一种，对于onclick事件触发的的ajax 可以采用如下方法： 即在beforeSend中使点击按钮不可用，ajax结果返回后置为可用
$.ajax( { type: &#39;POST&#39;, url: APP&#43;&#39;?m=Shopping&amp;a=ajaxSubmitorder&amp;sid=&#39;&#43;sid&#43;&#39;&amp;src=&#39;&#43;src, cache:false, dataType: &#39;json&#39;, data: {&#39;src&#39;:src,&#34;uid&#34;: uid,&#39;shipping_id&#39;:shipping_id,&#39;order_amount&#39;:order_amount,&#39;amount&#39;:amount,&#39;postscript&#39;:postscript,&#39;addr_id&#39;:addr_id}, async: false, beforeSend:function() { //触发ajax请求开始时执行 $(&#39;#submit_font&#39;).text(&#39;提交订单中...&#39;); $(&#39;.pay_alipay&#39;).attr(&#39;onclick&#39;,&#39;javascript:void();&#39;);//改变提交按钮上的文字并将按钮设置为不可点击 }, success: function (msg, textStatus) { if(msg.result==1) { $.Alert(&#39;成功提交订单&#39;, 160); window.location.href=APP&#43;&#39;?m=Pay&amp;a=index&amp;sid=&#39;&#43; sid &#43; &#39;&amp;fuid=&#39;&#43; fuid &#43; &#39;&amp;parent_order_sn=&#39;&#43;msg.parent_order_sn; } else { $.Alert(msg.msg, 160); $(&#39;#submit_font&#39;).text(&#39;提交订单&#39;); $(&#39;.pay_alipay&#39;).attr(&#39;onclick&#39;,&#39;submitorder();&#39;);//改变提交按钮上的文字并将按钮设置为可点击 } }, error: function (textStatus) { $.Alert(&#39;网络繁忙，请稍后再试...&#39;, 160); $(&#39;#submit_font&#39;).text(&#39;提交订单&#39;); $(&#39;.pay_alipay&#39;).attr(&#39;onclick&#39;,&#39;submitorder();&#39;);//改变提交按钮上的文字并将按钮设置为可点击 }, complete: function(msg, textStatus) { //ajax请求完成时执行 if(msg.result==1) { $(&#39;#submit_font&#39;).text(&#39;提交订单&#39;); $(&#39;.pay_alipay&#39;).attr(&#39;onclick&#39;,&#39;javascript:void();&#39;);//改变提交按钮上的文字并将按钮设置为可以点击 } } }); 2、利用jquery ajaxPrefilter中断请求 1）Prefilters是一个预过滤器，在每个请求之前被发送和$." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c194a92f869efcd68bd206ef906b5742/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-09-22T19:23:33+08:00" />
<meta property="article:modified_time" content="2016-09-22T19:23:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Jquery的$.ajax防止重复提交的方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 id="1第一种对于onclick事件触发的的ajax">1、第一种，对于onclick事件触发的的ajax</h3> 
<p>可以采用如下方法： <br> 即在beforeSend中使点击按钮不可用，ajax结果返回后置为可用</p> 
<pre class="prettyprint"><code class=" hljs javascript">   $.ajax(
    {
        type: <span class="hljs-string">'POST'</span>,
        url: APP+<span class="hljs-string">'?m=Shopping&amp;a=ajaxSubmitorder&amp;sid='</span>+sid+<span class="hljs-string">'&amp;src='</span>+src,
        cache:<span class="hljs-literal">false</span>,
        dataType: <span class="hljs-string">'json'</span>,
        data: {<!-- --><span class="hljs-string">'src'</span>:src,<span class="hljs-string">"uid"</span>: uid,<span class="hljs-string">'shipping_id'</span>:shipping_id,<span class="hljs-string">'order_amount'</span>:order_amount,<span class="hljs-string">'amount'</span>:amount,<span class="hljs-string">'postscript'</span>:postscript,<span class="hljs-string">'addr_id'</span>:addr_id},
        async: <span class="hljs-literal">false</span>,
        beforeSend:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
        {<!-- --></span>   <span class="hljs-comment">//触发ajax请求开始时执行</span>
            $(<span class="hljs-string">'#submit_font'</span>).text(<span class="hljs-string">'提交订单中...'</span>);
            $(<span class="hljs-string">'.pay_alipay'</span>).attr(<span class="hljs-string">'onclick'</span>,<span class="hljs-string">'javascript:void();'</span>);<span class="hljs-comment">//改变提交按钮上的文字并将按钮设置为不可点击</span>
        },                
        success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(msg, textStatus)</span> 
        {<!-- --></span>
            <span class="hljs-keyword">if</span>(msg.result==<span class="hljs-number">1</span>)
            {
                $.Alert(<span class="hljs-string">'成功提交订单'</span>, <span class="hljs-number">160</span>);
                window.location.href=APP+<span class="hljs-string">'?m=Pay&amp;a=index&amp;sid='</span>+ sid + <span class="hljs-string">'&amp;fuid='</span>+ fuid + <span class="hljs-string">'&amp;parent_order_sn='</span>+msg.parent_order_sn;
            }
            <span class="hljs-keyword">else</span>
            {
                $.Alert(msg.msg, <span class="hljs-number">160</span>);
                $(<span class="hljs-string">'#submit_font'</span>).text(<span class="hljs-string">'提交订单'</span>);
                $(<span class="hljs-string">'.pay_alipay'</span>).attr(<span class="hljs-string">'onclick'</span>,<span class="hljs-string">'submitorder();'</span>);<span class="hljs-comment">//改变提交按钮上的文字并将按钮设置为可点击                    </span>
            }
        },
        error: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(textStatus)</span> 
        {<!-- --></span>
            $.Alert(<span class="hljs-string">'网络繁忙，请稍后再试...'</span>, <span class="hljs-number">160</span>);
            $(<span class="hljs-string">'#submit_font'</span>).text(<span class="hljs-string">'提交订单'</span>);
            $(<span class="hljs-string">'.pay_alipay'</span>).attr(<span class="hljs-string">'onclick'</span>,<span class="hljs-string">'submitorder();'</span>);<span class="hljs-comment">//改变提交按钮上的文字并将按钮设置为可点击                    </span>
        },
        complete: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(msg, textStatus)</span>
        {<!-- --></span>   
                <span class="hljs-comment">//ajax请求完成时执行</span>
            <span class="hljs-keyword">if</span>(msg.result==<span class="hljs-number">1</span>)
            {
                $(<span class="hljs-string">'#submit_font'</span>).text(<span class="hljs-string">'提交订单'</span>);
                $(<span class="hljs-string">'.pay_alipay'</span>).attr(<span class="hljs-string">'onclick'</span>,<span class="hljs-string">'javascript:void();'</span>);<span class="hljs-comment">//改变提交按钮上的文字并将按钮设置为可以点击</span>
            }
        }                
    });   </code></pre> 
<h3 id="2利用jquery-ajaxprefilter中断请求">2、利用jquery ajaxPrefilter中断请求</h3> 
<p>1）Prefilters是一个预过滤器，在每个请求之前被发送和$.ajax()处理它们前处理。</p> 
<pre class="prettyprint"><code class=" hljs apache"><span class="hljs-keyword"><span class="hljs-common">options</span></span> 是请求的选项

<span class="hljs-keyword">originalOptions</span> 值作为提供给Ajax方法未经修改的选项，因此，没有ajaxSettings设置中的默认值

<span class="hljs-keyword">jqXHR</span> 是请求的jqXHR对象</code></pre> 
<p>以上内容的核心思想是维护一个队列，发送请求时，将请求加入队列，请求响应后，从队列中清除，这就保证了在任一时刻只能有一个同样的请求发送.</p> 
<p>局限性：仅仅是前台防止jquery的ajax请求。对于非jquery的ajax请求，不起作用。因为使用的是jquery的ajaxPreFilter函数，仅仅对jquery的ajax请求有作用。</p> 
<p>2）按钮每次点击都会向后端发送请求，下面的demo实现了多次点击按钮之后，只保证最后一次点击的请求能够成功。</p> 
<pre class="prettyprint"><code class=" hljs actionscript">&lt;button id=<span class="hljs-string">"button1"</span>&gt;button1&lt;/button&gt;
&lt;button id=<span class="hljs-string">"button2"</span>&gt;button2&lt;/button&gt;
&lt;button id=<span class="hljs-string">"button3"</span>&gt;button3&lt;/button&gt;       
 &lt;script type=<span class="hljs-string">"text/javascript"</span> src=<span class="hljs-string">"jquery.min.js"</span>&gt;&lt;/script&gt;
&lt;script&gt;
        <span class="hljs-keyword">var</span> pendingRequests = {};
        jQuery.ajaxPrefilter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options, originalOptions, jqXHR )</span> {<!-- --></span>
            <span class="hljs-keyword">var</span> key = options.url;
            console.log(key);
            <span class="hljs-keyword">if</span> (!pendingRequests[key]) {
                pendingRequests[key] = jqXHR;
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-comment">//jqXHR.abort();    //放弃后触发的提交</span>
                pendingRequests[key].abort();   <span class="hljs-comment">// 放弃先触发的提交</span>
            }

            <span class="hljs-keyword">var</span> complete = options.complete;
            options.complete = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jqXHR, textStatus)</span> {<!-- --></span>
                pendingRequests[key] = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">if</span> (jQuery.isFunction(complete)) {
                complete.apply(<span class="hljs-keyword">this</span>, arguments);
                }
            };
        });
        &lt;!-- 异步加载应用列表开始 --&gt;

        $(<span class="hljs-string">"#button1"</span>).live(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
              $.ajax(<span class="hljs-string">'config/ajax/appinfoListFetcher.json'</span>, {
                type:<span class="hljs-string">'POST'</span>,
                data:   {param1:<span class="hljs-number">1</span>,
                         param2:<span class="hljs-number">2</span>,
                      },
                success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{<!-- --></span>
                        <span class="hljs-comment">//后端数据回写到页面中</span>
                },
                error:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jqXHR, textStatus, errorThrown)</span>{<!-- --></span>
                    <span class="hljs-keyword">if</span>(errorThrown != <span class="hljs-string">'abort'</span>){
                        alert(<span class="hljs-string">'应用加载失败！'</span>);
                    }
                }
              });
              &lt;!-- 异步加载应用列表结束 --&gt;
         });
&lt;/script&gt;</code></pre> 
<p>调用abort后jquery会执行error的方法，抛出abort的异常信息。可以使用以下方式区分出该类型的异常。</p> 
<p><strong>3）注意事项：对于嵌套的点击事件的代码，是不起作用的。</strong></p> 
<pre class="prettyprint"><code class=" hljs javascript">$(<span class="hljs-string">'.btn-cancel-all'</span>).live(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
{<!-- --></span>
    $(<span class="hljs-string">'.confirm-dialog .confirm'</span>).live(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
    {<!-- --></span>
        $.ajax({
            <span class="hljs-comment">//这里面的ajax事件是不能起作用的</span>
        })
    }
}</code></pre> 
<p>参考链接：<a href="http://www.hollischuang.com/archives/931" rel="nofollow">http://www.hollischuang.com/archives/931</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ca581cb0c2d27b7cc7ac4eecb5d3ee3e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">STM32F103按键操作的另一种实现——状态机</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7a89a8abc2cf3d0628fce070f25cc574/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jQuery的LG的自定义插件。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>