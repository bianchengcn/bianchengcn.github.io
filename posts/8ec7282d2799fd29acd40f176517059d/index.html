<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用fileupload组件上传文件出现乱码解决方法 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="用fileupload组件上传文件出现乱码解决方法" />
<meta property="og:description" content="用fileupload组件上传文件出现乱码解决方法www.yjyunda.com/art 2006-5-20 星语文章我们用apache的fileupload组件上传文件,如果不做任何出理,通常会出现文件名乱码或普通text文本框值的乱码,那么,我们该如何处理呢?其实,fileupload组件提供了一个设置编码的接口,在没有指定编码时使用系统缺省的encoding,如果需要使用gbk,可以使用该接口进行设置,如://FileUploadBase fb = new FileUpload(new DefaultFileItemFactory());//fb.setHeaderEncoding(&#34;GBK&#34;);DiskFileUpload fu = new DiskFileUpload();fu.setHeaderEncoding(&#34;GBK&#34;);这样,获取的文件名就不会乱码了,但普通文本框的值却还是乱码,我们还要对文本值进行处理,中文的text字段可以通过title = new String((fileItem.getString(&#34;iso8859-1&#34;)).getBytes(&#34;iso8859-1&#34;),&#34;GBK&#34;); 来获取UTF-8的也是同理,祝在家好运.http://www.yjyunda.com/art/list.asp?id=729
common-fileupload是jakarta项目组开发的一个功能很强大的上传文件组件
下面先介绍上传文件到服务器（多文件上传）：
import javax.servlet.*;
import javax.servlet.http.*;
import java.io.*;
import java.util.*;
import java.util.regex.*;
import org.apache.commons.fileupload.*;
public class upload extends HttpServlet {
private static final String CONTENT_TYPE = &#34;text/html; charset=GB2312&#34;;
//Process the HTTP Post request
public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
response.setContentType(CONTENT_TYPE);
PrintWriter out=response.getWriter();
try {
DiskFileUpload fu = new DiskFileUpload();" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/8ec7282d2799fd29acd40f176517059d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-03-30T21:32:08+08:00" />
<meta property="article:modified_time" content="2012-03-30T21:32:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用fileupload组件上传文件出现乱码解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">用fileupload组件上传文件出现乱码解决方法</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">www.yjyunda.com/art  2006-5-20  星语文章</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">我们用apache的fileupload组件上传文件,</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">如果不做任何出理,通常会出现文件名乱码或普通text文本框值的乱码,那么,我们该如何处理呢?</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">其实,fileupload组件提供了一个设置编码的接口,在没有指定编码时使用系统缺省的encoding,如果需要使用gbk,可以使用该接口进行设置,如:</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">//FileUploadBase fb = new FileUpload(new DefaultFileItemFactory());</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">//fb.setHeaderEncoding("GBK");</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">DiskFileUpload fu = new DiskFileUpload();</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">fu.setHeaderEncoding("GBK");</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">这样,获取的文件名就不会乱码了,但普通文本框的值却还是乱码,我们还要对文本值进行处理,中文的text字段可以通过title =  new String((fileItem.getString("iso8859-1")).getBytes("iso8859-1"),"GBK");  来获取</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">UTF-8的也是同理,祝在家好运.</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><span style="font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;line-height:25px;text-align:left;">http://www.yjyunda.com/art/list.asp?id=729</span><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"><br style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;"></p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">common-fileupload是jakarta项目组开发的一个功能很强大的上传文件组件</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">下面先介绍上传文件到服务器（多文件上传）：</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">import javax.servlet.*;<br>import javax.servlet.http.*;<br>import java.io.*;<br>import java.util.*;<br>import java.util.regex.*;<br>import org.apache.commons.fileupload.*;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">public class upload extends HttpServlet {<!-- --><br>  private static final String CONTENT_TYPE = "text/html; charset=GB2312";<br>  //Process the HTTP Post request<br>  public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<!-- --><br>    response.setContentType(CONTENT_TYPE);<br>    PrintWriter out=response.getWriter();<br>    try {<!-- --><br>    DiskFileUpload fu = new DiskFileUpload();<br> // 设置允许用户上传文件大小,单位:字节，这里设为2m<br> fu.setSizeMax(2*1024*1024);<br> // 设置最多只允许在内存中存储的数据,单位:字节<br> fu.setSizeThreshold(4096);<br> // 设置一旦文件大小超过getSizeThreshold()的值时数据存放在硬盘的目录<br> fu.setRepositoryPath("c:\\windows\\temp");<br> //开始读取上传信息<br> List fileItems = fu.parseRequest(request);<br> // 依次处理每个上传的文件<br>   Iterator iter = fileItems.iterator();</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">//正则匹配，过滤路径取文件名<br>   String regExp=".+\\\\(.+)$";</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">//过滤掉的文件类型<br>String[] errorType={".exe",".com",".cgi",".asp"};<br>   Pattern p = Pattern.compile(regExp);<br>      while (iter.hasNext()) {<!-- --><br>       FileItem item = (FileItem)iter.next();<br>       //忽略其他不是文件域的所有表单信息<br>       if (!item.isFormField()) {<!-- --><br>           String name = item.getName();<br>           long size = item.getSize();<br>           if((name==null||name.equals("")) &amp;&amp; size==0)<br>               continue;<br>        Matcher m = p.matcher(name);<br>       boolean result = m.find();<br>       if (result){<!-- --><br>           for (int temp=0;temp&lt;errorType.length;temp++){<!-- --><br>           if (m.group(1).endsWith(errorType[temp])){<!-- --><br>                 throw new IOException(name+": wrong type");<br>           }<br>           }<br>           try{<!-- --></p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">//保存上传的文件到指定的目录</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">//在下文中上传文件至数据库时，将对这里改写<br>             item.write(new File("d:\\" + m.group(1)));</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">           out.print(name+"&amp;nbsp;&amp;nbsp;"+size+"&lt;br&gt;");<br>           }<br>           catch(Exception e){<!-- --><br>             out.println(e);<br>           }</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        }<br>       else<br>       {<!-- --><br>         throw new IOException("fail to upload");<br>       }<br>       }<br>   }<br>}<br> catch (IOException e){<!-- --><br>   out.println(e);<br> }<br> catch (FileUploadException e){<!-- --><br>      out.println(e);<br> }<br> <br>  }<br>}</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">下面是个html的上传页面：</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">&lt;h1&gt;文件上传演示&lt;/h1&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">&lt;form name="uploadform" method="POST" action="/upload" ENCTYPE="multipart/form-data"&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;table border="1" width="450" cellpadding="4" cellspacing="2" bordercolor="#9BD7FF"&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;tr&gt;&lt;td width="100%" colspan="2"&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">                        文件1：&lt;input name="x" size="40" type="file"&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;/td&gt;&lt;/tr&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;tr&gt;&lt;td width="100%" colspan="2"&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">                        文件2：&lt;input name="y" size="40" type="file"&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;/td&gt;&lt;/tr&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;tr&gt;&lt;td width="100%" colspan="2"&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">                        文件3：&lt;input name="z" size="40" type="file"&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;/td&gt;&lt;/tr&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;/table&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;br/&gt;&lt;br/&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;table&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">        &lt;tr&gt;&lt;td align="center"&gt;&lt;input name="upload" type="submit" value="开始上传"/&gt;&lt;/td&gt;&lt;/tr&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">       &lt;/table&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">&lt;/form&gt;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">现在介绍上传文件到服务器，下面只写出相关代码：</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">以sql2000为例，表结构如下：</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">字段名：name    filecode</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">类型： varchar     image</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">数据库插入代码为：PreparedStatement pstmt=conn.prepareStatement("insert into test values(?,?)");</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">代码如下：</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">。。。。。。</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">           try{<!-- --><br>             //item.write(new File("d:\\" + m.group(1)));//这段代码如果不去掉，将一同写入到服务器中</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">             int byteread=0;</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">             InputStream inStream=item.getInputStream();  //读取输入流，也就是上传的文件内容<br>             pstmt.setString(1,m.group(1));<br>             pstmt.setBinaryStream(2,inStream,(int)size);<br>             pstmt.executeUpdate();<br>             inStream.close();</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">             out.println(name+"&amp;nbsp;&amp;nbsp;"+size+"&lt;br&gt;");<br>           }</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">。。。。。。</p> 
<p style="line-height:25px;font-family:Arial, Helvetica, simsun, u5b8bu4f53;font-size:14px;text-align:left;">这样就实现了上传文件至数据库</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d62e984efdb3dd7c183ec90fbdd41bfc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Source Insight宏 -  头文件与源文件切换（不限目录）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/48dfd9f7a7777db56b90243b5ab8a3cc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Cocos2d 如何暂停一个动作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>