<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>记录一次Vue2迁移Vue3的基本流程 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="记录一次Vue2迁移Vue3的基本流程" />
<meta property="og:description" content="现有一个基于vue-cli2的项目（不支持ES新语法，使用ElementUI组件库），目前vue-cli已经迭代到4版本，且已经处于维护模式；vue2在2023年底终止支持，vue2.7是最后一个版本。所以打算即升级现有项目至vue3（使用ElementPlus组件库）。
技术分析 GoGoCode是一个由阿里妈妈开源的基于 AST 的 JavaScript/Typescript/HTML 代码转换工具，通过分析词法分析、语法分析、语义分析等，直接编译Vue2代码至Vue3。
根据GoGoCode文档介绍，目前 GoGoCode 仅支持新版本 vue-cli ，对于 vue-cli2 的项目不能进行编译处理，所以处理思路就是：
vue-cli2 ---(手动复制文件并解决错误)---&gt; vue-cli4 ---(使用gogocode编译)---&gt; Vue3 根据GoGoCode官网给出文档vue-cli2的项目升级到vue-cli4做了哪些事情手动复制文件升级至vue-cli4，根据Vue2 到 Vue3 升级指南及Element UI 到 Element Plus 升级指南升级至Vue3
主要流程 升级vue-cli2至vue-cli4 流程 拿到源码新建分支vuecli4，在vuecli4分支使用 vue create 命令新建一个vuecli4的空项目（必须是vuecli4的项目），把vuecli2项目中的 src 源码目录及 index.html 模版复制到vuecli4项目中直接运行项目，根据报错提示进行反复重启（安装依赖、webpack配置、eslint配置等） 期间遇到的问题 Cant’t resolve ‘xxxx’ in filename
直接安装相应依赖，再次运行项目（使用less需要同时安装less和less-loader、）
error in ./node/modules/stompjs.js Cant’t resolve ‘net’
直接安装 net 依赖模块，参考：https://www.cnblogs.com/sphjy/p/15500806.html
eslint问题：Parsing error: ‘import’ and ‘export’ may appear only with ‘sourceType: module’
// 要添加eslint配置，不限制import使用位置 module.exports = { root: true, env: { node: true, }, extends: [], rules: {}, parser: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/14a5725c8ee71ecdf4163ee8ef75bc7f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-26T15:05:57+08:00" />
<meta property="article:modified_time" content="2023-11-26T15:05:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">记录一次Vue2迁移Vue3的基本流程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>现有一个基于vue-cli2的项目（不支持ES新语法，使用ElementUI组件库），目前vue-cli已经迭代到4版本，且已经处于维护模式；vue2在2023年底终止支持，vue2.7是最后一个版本。所以打算即升级现有项目至vue3（使用ElementPlus组件库）。</p> 
<h3><a id="_1"></a>技术分析</h3> 
<p><a href="https://gogocode.io/zh" rel="nofollow">GoGoCode</a>是一个由阿里妈妈开源的基于 AST 的 JavaScript/Typescript/HTML 代码转换工具，通过分析词法分析、语法分析、语义分析等，直接编译Vue2代码至Vue3。<br> 根据GoGoCode文档介绍，目前 GoGoCode 仅支持新版本 vue-cli ，对于 vue-cli2 的项目不能进行编译处理，所以处理思路就是：</p> 
<pre><code>vue-cli2 ---(手动复制文件并解决错误)---&gt; vue-cli4 ---(使用gogocode编译)---&gt; Vue3
</code></pre> 
<p>根据GoGoCode官网给出文档<a href="https://blog.liuyunzhuge.com/2019/12/19/vue-cli2%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7%E5%88%B0vue-cli4%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E4%BA%8B%E6%83%85/" rel="nofollow">vue-cli2的项目升级到vue-cli4做了哪些事情</a>手动复制文件升级至vue-cli4，根据<a href="https://gogocode.io/zh/docs/vue/vue2-to-vue3" rel="nofollow">Vue2 到 Vue3 升级指南</a>及<a href="https://gogocode.io/zh/docs/vue/element-ui-to-element-plus" rel="nofollow">Element UI 到 Element Plus 升级指南</a>升级至Vue3</p> 
<h3><a id="_9"></a>主要流程</h3> 
<h5><a id="vuecli2vuecli4_10"></a>升级vue-cli2至vue-cli4</h5> 
<h6><a id="_11"></a>流程</h6> 
<ol><li>拿到源码新建分支vuecli4，在vuecli4分支使用 <code>vue create</code> 命令新建一个vuecli4的空项目（必须是vuecli4的项目），把vuecli2项目中的 <code>src</code> 源码目录及 <code>index.html</code> 模版复制到vuecli4项目中</li><li>直接运行项目，根据报错提示进行反复重启（安装依赖、webpack配置、eslint配置等）</li></ol> 
<h6><a id="_15"></a>期间遇到的问题</h6> 
<ol><li> <p>Cant’t resolve ‘xxxx’ in filename<br> <img src="https://images2.imgbox.com/fd/d7/310ODJO1_o.png" alt="在这里插入图片描述"><br> 直接安装相应依赖，再次运行项目（使用less需要同时安装less和less-loader、）</p> </li><li> <p>error in ./node/modules/stompjs.js Cant’t resolve ‘net’<br> 直接安装 net 依赖模块，参考：<a href="https://www.cnblogs.com/sphjy/p/15500806.html" rel="nofollow">https://www.cnblogs.com/sphjy/p/15500806.html</a></p> </li><li> <p>eslint问题：Parsing error: ‘import’ and ‘export’ may appear only with ‘sourceType: module’</p> </li></ol> 
<pre><code class="prism language-js"><span class="token comment">//  要添加eslint配置，不限制import使用位置</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">"vue-eslint-parser"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">allowImportExportEverywhere</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 不限制eslint对import使用位置</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// https://blog.csdn.net/weixin_45454773/article/details/124220049</span>
</code></pre> 
<ol start="4"><li>axios请求报错 Error: Request failed with status code 404<br> 需要配置vuec-cli代理（新建项目还未添加代理配置的话）</li></ol> 
<h6><a id="vuecli4vue3_46"></a>升级vue-cli4至vue3</h6> 
<p>流程</p> 
<ol><li>安装工具：全局安装 gogocode-cli</li></ol> 
<pre><code>npm install gogocode-cli -g
</code></pre> 
<ol start="2"><li>处理源文件<br> 在终端（terminal）中跳转到需要升级的Vue项目路径。如果需要升级src路径下的vue代码，执行如下命令：</li></ol> 
<pre><code>gogocode -s ./src -t gogocode-plugin-vue -o ./src-out
</code></pre> 
<p>注意：-s 后面是原文件的目录/文件名，-o 后面是输出的目录/文件名，如果两者相同，转换插件会覆盖你的代码，在此操作前请做好备份（建议新建分支）。转换操作执行完毕后新的Vue3代码会被写入到src-out目录中。</p> 
<ol start="3"><li>依赖升级<br> 除了升级源码，还需要升级 Vue3 相关依赖，这可以自动完成，在终端（terminal）中跳转到需要升级的Vue项目路径，执行如下命令：</li></ol> 
<pre><code>gogocode -s package.json -t gogocode-plugin-vue -o package.json
</code></pre> 
<p>这条命令会把 package.json 里面的 Vue/Vuex/Vue-router/Vue 编译工具 升级到适配 Vue3 的版本</p> 
<pre><code>npm install
</code></pre> 
<p>即可完成Vue3相关依赖的安装​</p> 
<blockquote> 
 <p>由于 Vue3 全局对象变成 createApp()创建。转换工具将 createApp() 返回对象传递给 window.$vueApp。此时使用者需要将 <code>window.\$vueApp = Vue.createApp(App)</code>代码块移动到调用 window.$vueApp 代码的最前面。避免window.$vueApp为 undefined的情况出现。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c5/f4/eQ5ucGHf_o.png" alt="在这里插入图片描述"></p> 
<ol start="4"><li>使用工具把代码从 ElementUI 转换成 Element Plus<br> 使用 gogocode-element-plugin 插件把项目代码从 ElementUI 升级到 Element Plus</li></ol> 
<pre><code>gogocode -s ./src -t gogocode-plugin-element  -o ./src
</code></pre> 
<ol start="5"><li>手动修改package.json，package.json，element-ui 换成 element-plus，如果使用了图标，@element-plus/icons 也需要安装</li></ol> 
<pre><code class="prism language-js"><span class="token comment">// 引入（之前elementui的就不需要了）</span>
<span class="token keyword">import</span> ElementPlus  <span class="token keyword">from</span> <span class="token string">'element-plus'</span>
<span class="token keyword">import</span> <span class="token string">'element-plus/theme-chalk/index.css'</span>
</code></pre> 
<ol start="6"><li>升级依赖和构建<br> 每个人的构建环境不同，可以通过下面的命令更新 package.json 里面的 vue 和 vue-cli 的版本号</li></ol> 
<pre><code>gogocode -s ./package.json -t gogocode-plugin-vue  -o ./package.json
</code></pre> 
<ol start="7"><li>启动项目，根据报错提示一一修改</li></ol> 
<h6><a id="_91"></a>期间遇到的问题</h6> 
<ol><li>Cannot read properties of undefined (reading ‘install‘) at Vue.use<br> gogocode编译代码有问题，在main.js中（提示找不到Vue实例的都可以看一下是不是这个原因）</li></ol> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token operator">...</span>

window<span class="token punctuation">.</span>$vueApp <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
</code></pre> 
<p>改为</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>

<span class="token operator">...</span>

window<span class="token punctuation">.</span>$vueApp <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li>vue-i18问题<br> 需要升级vue-i18n至0.9.5，不要使用旧版本的vue-i18n，新版本的vue-i18n使用已经更改</li></ol> 
<pre><code class="prism language-js"><span class="token comment">// 原vue-i18n使用</span>
<span class="token keyword">import</span> VueI18n <span class="token keyword">from</span> <span class="token string">'vue-i18n'</span>
<span class="token keyword">import</span>  Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// window.$vueApp.use(VueI18n)</span>

<span class="token keyword">const</span> i18n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueI18n</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">locale</span><span class="token operator">:</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'lang'</span><span class="token punctuation">)</span> <span class="token operator">||</span>  <span class="token string">'1'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> i18n


<span class="token comment">// vue-i18n 0.9.5使用方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createI18n <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue-i18n"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> i18n <span class="token operator">=</span> <span class="token function">createI18n</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">legacy</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">locale</span><span class="token operator">:</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"lang"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token comment">// 默认显示语言</span>
  <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">'1'</span><span class="token operator">:</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"clientLangData"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> i18n<span class="token punctuation">;</span>
</code></pre> 
<p>新版vue-i18n设置语言api也需更改<br> <img src="https://images2.imgbox.com/c6/09/BvrWJOu8_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>路由问题：Catch all routes (“<em>“) must now be defined using a param with a custom regexp.<br> router4必须使用自定义的 regex 参数来定义所有路由(</em>、/*)：</li></ol> 
<pre><code class="prism language-js">  <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/:catchAll(.*)*"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> Notfound<span class="token punctuation">,</span>
    <span class="token literal-property property">hidden</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>参考：<a href="https://router.vuejs.org/zh/guide/migration/" rel="nofollow">https://router.vuejs.org/zh/guide/migration/</a></p> 
<ol start="4"><li> <p>this.$store.state.xxx获取不到？<br> 需要在mount之前use(store)</p> </li><li> <p>插槽问题：v-slot‘ directive must be owned by a custom element, but ‘div‘ is not<br> 目前先注释代码，没有问题，后续看一下v-slot新用法</p> </li><li> <p>v-if/else的问题</p> </li><li> <p><img src="https://images2.imgbox.com/c5/2f/1g41aDli_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<p>解决办法，添加webpack配置 overlay: false<br> https://blog.csdn.net/ligaoming_123/article/details/131939973</p> 
<pre><code class="prism language-js"><span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">client</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">overlay</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h3><a id="gogocode_171"></a>gogocode做了哪些事情？</h3> 
<p>beforeDestroy-beforeUnmount生命周期<br> <img src="https://images2.imgbox.com/3b/7b/iDO2WuIe_o.png" alt="在这里插入图片描述"></p> 
<p>emit方式变化<br> <img src="https://images2.imgbox.com/d9/ad/K96nLT3L_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/68/fa/qZqsfrh7_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/a6/6f/TGkL31In_o.png" alt="在这里插入图片描述"></p> 
<p>filter替代方案</p> 
<p><img src="https://images2.imgbox.com/5e/38/bDOZbz8t_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/da/e2/Ugwc7L6s_o.png" alt="在这里插入图片描述"></p> 
<p>v-model的更改，参考https://v3-migration.vuejs.org/zh/breaking-changes/v-model.html<br> <img src="https://images2.imgbox.com/8f/2d/yinCqVQK_o.png" alt="在这里插入图片描述"></p> 
<p>$set()<br> <img src="https://images2.imgbox.com/8b/9e/5lXfUipR_o.png" alt="在这里插入图片描述"></p> 
<p>gogocode的需要优化的地方<br> 编译后样式混乱（已经不符合语法），直接error，项目启动直接失败<br> <img src="https://images2.imgbox.com/2d/41/VOfb693k_o.png" alt="在这里插入图片描述"></p> 
<p>至此项目已经可以正常打包运行，但是基本上每个页面样式都存在问题需要修改。<br> 参考：<br> Vue3迁移指南：<a href="https://v3-migration.vuejs.org/" rel="nofollow">https://v3-migration.vuejs.org/</a><br> Vue CLI创建一个项目：<a href="https://cli.vuejs.org/zh/guide/creating-a-project.html" rel="nofollow">https://cli.vuejs.org/zh/guide/creating-a-project.html</a><br> Vue3 v-model 变更：<a href="https://blog.csdn.net/qq_38290251/article/details/112146427">https://blog.csdn.net/qq_38290251/article/details/112146427</a><br> Router4 从Vue2迁移：<a href="https://router.vuejs.org/zh/guide/migration/" rel="nofollow">https://router.vuejs.org/zh/guide/migration/</a><br> vue2老项目升级vue3落地实践(一)：<a href="https://juejin.cn/post/7174424073575858236" rel="nofollow">https://juejin.cn/post/7174424073575858236</a><br> Vue2 升级 Vue3 - 过程记录：<a href="https://juejin.cn/post/7209863093671755835" rel="nofollow">https://juejin.cn/post/7209863093671755835</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b08bbf1539c37b2766fe0fba008f983f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">用Python写的自动答题脚本，正确率99%，刷课必备</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b2b3e9e1b2fcda6e51480f3083e59e5c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">*Http详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>