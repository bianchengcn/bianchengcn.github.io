<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>文件上传漏洞（一） upload-labs靶场练习 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="文件上传漏洞（一） upload-labs靶场练习" />
<meta property="og:description" content="upload-labs靶场练习 1.环境搭建2.关卡解析2.1 less-1 - 基于前端JS的检测2.2 less-2 - MIME头认证2.3 less-3 php3,4,5扩展解析2.4 less-4 .htaccess文件绕过2.5 less-5 点空点空绕过2.6 less-6 大小写文件名混淆2.7 less-7 空格绕过2.8 less-8 小圆点绕过2.9 less-9 Win文件流特性绕过2.10 less-10 点空桡过2.11 less-11 文件名置空 双写绕过2.12 less-12 get传参中的00截断2.13 less-13 post传参中的00截断2.14 less-14 文件包含结合文件上传2.15 less 15-16 文件包含结合文件上传2.16 less-17 文件包含与二次渲染的绕过2.17 less-18 竞争型漏洞 3.总结 文件上传漏洞的目标就是向服务器上传一些服务器可以解析的恶意文件，这类文件可以达到与攻击者建立连接并执行恶意命令的作用(又名webshell)。其危害之大，早已引起业界的关注。
本文将通过对upload-labs的练习，重现一些绕过手法，当然也是对文件上传漏洞基础部分的一个系统总结。
1.环境搭建 这里大家可以直接访问作者的github进行下载：
https://github.com/c0ny1/upload-labs
完事按照说明文档进行安装即可，不得不说，真心感谢作者为我们提供这么优秀的平台进行练习与学习。这里就厚脸皮的贴上作者的脑图了：
上图为大体的绕过思路，现在不理解没关系，我们一起去做一遍就明白了。
2.关卡解析 2.1 less-1 - 基于前端JS的检测 最早期的检测，当然也是最弱的。我们先来查看页面内的过滤语句：
function checkFile() { var file = document.getElementsByName(&#39;upload_file&#39;)[0].value; if (file == null || file == &#34;&#34;) { alert(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c64ead29331d3aa3370d84ab3fba2d49/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-18T20:02:24+08:00" />
<meta property="article:modified_time" content="2023-03-18T20:02:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">文件上传漏洞（一） upload-labs靶场练习</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>upload-labs靶场练习</h4> 
 <ul><li><a href="#1_6" rel="nofollow">1.环境搭建</a></li><li><a href="#2_16" rel="nofollow">2.关卡解析</a></li><li><ul><li><a href="#21_less1__JS_17" rel="nofollow">2.1 less-1 - 基于前端JS的检测</a></li><li><a href="#22_less2__MIME_70" rel="nofollow">2.2 less-2 - MIME头认证</a></li><li><a href="#23_less3__php345_121" rel="nofollow">2.3 less-3 php3,4,5扩展解析</a></li><li><a href="#24_less4_htaccess_131" rel="nofollow">2.4 less-4 .htaccess文件绕过</a></li><li><a href="#25_less5__161" rel="nofollow">2.5 less-5 点空点空绕过</a></li><li><a href="#26_less6__207" rel="nofollow">2.6 less-6 大小写文件名混淆</a></li><li><a href="#27_less7__215" rel="nofollow">2.7 less-7 空格绕过</a></li><li><a href="#28_less8__229" rel="nofollow">2.8 less-8 小圆点绕过</a></li><li><a href="#29_less9_Win_240" rel="nofollow">2.9 less-9 Win文件流特性绕过</a></li><li><a href="#210_less10__251" rel="nofollow">2.10 less-10 点空桡过</a></li><li><a href="#211_less11___253" rel="nofollow">2.11 less-11 文件名置空 双写绕过</a></li><li><a href="#212_less12_get00_276" rel="nofollow">2.12 less-12 get传参中的00截断</a></li><li><a href="#213_less13_post00_319" rel="nofollow">2.13 less-13 post传参中的00截断</a></li><li><a href="#214_less14__333" rel="nofollow">2.14 less-14 文件包含结合文件上传</a></li><li><a href="#215_less_1516__363" rel="nofollow">2.15 less 15-16 文件包含结合文件上传</a></li><li><a href="#216_less17___435" rel="nofollow">2.16 less-17 文件包含与二次渲染的绕过</a></li><li><a href="#217_less18__507" rel="nofollow">2.17 less-18 竞争型漏洞</a></li></ul> 
  </li><li><a href="#3_572" rel="nofollow">3.总结</a></li></ul> 
</div> 
<p></p> 
<p>文件上传漏洞的目标就是向服务器上传一些服务器可以解析的恶意文件，这类文件可以达到与攻击者建立连接并执行恶意命令的作用(又名webshell)。其危害之大，早已引起业界的关注。</p> 
<p>本文将通过对upload-labs的练习，重现一些绕过手法，当然也是对文件上传漏洞基础部分的一个系统总结。</p> 
<h2><a id="1_6"></a>1.环境搭建</h2> 
<p>这里大家可以直接访问作者的github进行下载：</p> 
<p>https://github.com/c0ny1/upload-labs</p> 
<p>完事按照说明文档进行安装即可，不得不说，真心感谢作者为我们提供这么优秀的平台进行练习与学习。这里就厚脸皮的贴上作者的脑图了：</p> 
<p><img src="https://images2.imgbox.com/64/67/EvM00tFU_o.png" alt="请添加图片描述"><br> 上图为大体的绕过思路，现在不理解没关系，我们一起去做一遍就明白了。</p> 
<h2><a id="2_16"></a>2.关卡解析</h2> 
<h3><a id="21_less1__JS_17"></a>2.1 less-1 - 基于前端JS的检测</h3> 
<p>最早期的检测，当然也是最弱的。我们先来查看页面内的过滤语句：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">'upload_file'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> file <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请选择要上传的文件!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//定义允许上传的文件类型</span>
    <span class="token keyword">var</span> allow_ext <span class="token operator">=</span> <span class="token string">".jpg|.png|.gif"</span><span class="token punctuation">;</span>
    <span class="token comment">//提取上传文件的类型</span>
    <span class="token keyword">var</span> ext_name <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断上传文件类型是否允许上传</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>allow_ext<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ext_name <span class="token operator">+</span> <span class="token string">"|"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> errMsg <span class="token operator">=</span> <span class="token string">"该文件不允许上传，请上传"</span> <span class="token operator">+</span> allow_ext <span class="token operator">+</span> <span class="token string">"类型的文件,当前文件类型为："</span> <span class="token operator">+</span> ext_name<span class="token punctuation">;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/42/34/f18kJpkG_o.png" alt="在这里插入图片描述"></p> 
<p>解决方案1：直接禁用浏览器的JS进行上传</p> 
<blockquote> 
 <p>1.URL地址栏内部输入about:config<br> 2.搜索存在的JavaScript.enable选项<br> 3.设置禁用<br> <img src="https://images2.imgbox.com/a9/93/raEI7czK_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<p>尝试上传我们的<code>”webshell“</code>。此处的<code>webshell</code>均用<code>phpinfo</code>来代替：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/d1/yL7Dphee_o.png" alt="在这里插入图片描述"></p> 
<p>解决方案2：burp 代理修改数据类型</p> 
<blockquote> 
 <p>我们上传一个JPG的后缀绕过限制后，再burp里面修改我们的后缀为.php再次进行绕过</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/e4/22/9NeZphcW_o.png" alt="在这里插入图片描述"></p> 
<p>抓包修改文件后缀：</p> 
<p><img src="https://images2.imgbox.com/f0/b0/v3tdxLSI_o.png" alt="在这里插入图片描述"></p> 
<p>测试效果：</p> 
<p><img src="https://images2.imgbox.com/5e/a9/pL7kFKyD_o.png" alt="在这里插入图片描述"></p> 
<p>到此，我们发现前端限制不仅消耗脑细胞还很无用。</p> 
<h3><a id="22_less2__MIME_70"></a>2.2 less-2 - MIME头认证</h3> 
<p>我们先进行源码分析：</p> 
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span>            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'文件类型不正确，请重新上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>为了看的更清晰一点我们把FILE变量打印出来：</p> 
<p><img src="https://images2.imgbox.com/00/e2/QuQT0CVs_o.png" alt="在这里插入图片描述"><br> 可以看到文件数据结构：</p> 
<p><img src="https://images2.imgbox.com/dc/7f/htptAXHa_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">[</span><span class="token string">"upload_file"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span> array<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span> 	
		<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span> string<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"web.php"</span> 
		<span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span> string<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token string">"application/octet-stream"</span> 
		<span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span> string<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token string">"/tmp/phpPYzq7W"</span> 
		<span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span> int<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
		<span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span> int<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span> 
	<span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> 
<p>到这里可以大致梳理出上面的源码的运行流程。我们的文件到达服务器之后会进行一次请求数据包的MIME类型判断，类型不对的话直接拒绝上传。此时我们需要使用burp代理修改文件的MIME类型进行上传：</p> 
<p><img src="https://images2.imgbox.com/87/55/FQ33863J_o.png" alt="在这里插入图片描述"></p> 
<p>测试：</p> 
<p><img src="https://images2.imgbox.com/ad/9e/o50bLBpa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23_less3__php345_121"></a>2.3 less-3 php3,4,5扩展解析</h3> 
<p>此题比较特殊，在服务器过滤不严的情况下，且开启了扩展php解析功能的时候我们可以尝试扩展解析的方案。</p> 
<p><img src="https://images2.imgbox.com/ae/dd/ZmcEt0r2_o.png" alt="在这里插入图片描述"></p> 
<p>执行效果查看：</p> 
<p><img src="https://images2.imgbox.com/64/52/IYK2vNUG_o.png" alt="在这里插入图片描述"><br> 我们可以看到并没有进行解析，这其实是因为我们并未在apache内部进行对应危险的配置。我们需要在apache配置文件内部配置解析对应后缀的文件才能引发这样的文件上传绕过。</p> 
<h3><a id="24_less4_htaccess_131"></a>2.4 less-4 .htaccess文件绕过</h3> 
<p>查看源码发现过滤了很多后缀，但是没有过滤<code>.htaccess</code>文件。</p> 
<blockquote> 
 <p><code>.htaccess</code>文件的作用：<br> htaccess文件时Apache服务中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮助我们实现：网页301重定向、自定义404错误页面，改变文件扩展名、允许/阻止特定的用户或者目录的访问，禁止目录列表，配置默认文档等功能<br> <br> 当然，最常用的作用就是实现一个伪静态页面，SetHandler application/x-http-php的意思是设置当前目录所有文件都使用php解析，一方面我们文件的后缀更改为html依然可以被当作php进行解析。另一方面，如果在上传目录不进行限制，一旦出现恶意上传.htaccess文件的行为，立刻就会引发安全隐患。无论上传任何文件，只要符合php语言代码规范，就会被当做PHP执行。</p> 
</blockquote> 
<p>要启用这个文件还得在apache的配置文件中添加这样一条规则进去：</p> 
<pre><code class="prism language-bash">AllowOverride All
</code></pre> 
<p><img src="https://images2.imgbox.com/a8/19/s7mVpVtn_o.png" alt="在这里插入图片描述"></p> 
<p>上传示例：</p> 
<p>先上传我们写好的<code>.htaccess</code>文件</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>FilesMatch <span class="token string">"/.jpg"</span><span class="token operator">&gt;</span>
  SetHandler application/x-httpd-php
<span class="token operator">&lt;</span>/FilesMatch<span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3d/d7/cMrKD2FO_o.png" alt="在这里插入图片描述"><br> 测试解析情况：<br> <img src="https://images2.imgbox.com/f8/56/v5TemAuR_o.png" alt="在这里插入图片描述"></p> 
<p>解析失败，问题未知。各位解决后可以私我，哈哈哈</p> 
<h3><a id="25_less5__161"></a>2.5 less-5 点空点空绕过</h3> 
<p>源码审计：</p> 
<pre><code class="prism language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//删除文件名末尾的点</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//截取第一个.到末尾的数据</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//转换为小写</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//去除字符串::$DATA</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//首尾去空</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'此文件类型不允许上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>复述一下这里的代码执行流程：上传的文件会被进行后缀名的合法性处理，处理完毕后，得到的后缀字符串file_ext和黑名单一起被传递到过滤程序中进行对比，匹配到黑名单则报错终止上传。没匹配到黑名单则允许上传。</p> 
<p>也就是说，如果我们能让处理程序在处理我们的后缀名时出现盈余，即让我们匹配不到黑名单，就可以实现绕过。我们可以给出一个payload:</p> 
<pre><code class="prism language-bash"><span class="token comment">#()为空格，也可以自己编写，只要保证被处理后可以掏出黑名单并且可以被当成PHP进行解析即可</span>
web.php.<span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/52/e7/l00XDf17_o.png" alt="在这里插入图片描述"></p> 
<p>这里可以看到，我们修改的文件名被送到后边的处理语句中进行处理，去除了一个点和一个空格后成功上传。</p> 
<p><img src="https://images2.imgbox.com/40/b8/142PBqFa_o.png" alt="在这里插入图片描述"></p> 
<p>测试：</p> 
<p><img src="https://images2.imgbox.com/66/17/mAxR4RDT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="26_less6__207"></a>2.6 less-6 大小写文件名混淆</h3> 
<p>观看这里的源码，少了一行，没有进行大小写的转换，直接小写绕过。<br> <img src="https://images2.imgbox.com/4e/c0/iF7QaiF3_o.png" alt="在这里插入图片描述"></p> 
<p>测试：成功绕过上传了文件上去，但是很遗憾，并不解析。推测为php版本问题，还是一样，诸位解决了的话欢迎私信。</p> 
<p><img src="https://images2.imgbox.com/04/67/5eLbt689_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="27_less7__215"></a>2.7 less-7 空格绕过</h3> 
<p>这里观察源码发现少了<code>$file_ext = trim($file_ext); //首尾去空</code>这一条处理语句。也就是说我们可以往后缀后面添加看空格尝试进行绕过。</p> 
<pre><code class="prism language-bash">web.php<span class="token punctuation">(</span>此处空格<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/49/f2/Wz9hovPc_o.png" alt="在这里插入图片描述"></p> 
<p>测试：</p> 
<p><img src="https://images2.imgbox.com/d8/d5/ki7XAm6I_o.png" alt="在这里插入图片描述"></p> 
<p>成功上传。</p> 
<h3><a id="28_less8__229"></a>2.8 less-8 小圆点绕过</h3> 
<p>这里源码里面又少了关于小圆点的过滤，思路同第七关我们继续进行绕过：</p> 
<pre><code class="prism language-bash">web.php.
</code></pre> 
<p><img src="https://images2.imgbox.com/8a/7f/AWDRjhsd_o.png" alt="在这里插入图片描述"><br> 测试效果：</p> 
<p><img src="https://images2.imgbox.com/a7/28/Q71Aj50y_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="29_less9_Win_240"></a>2.9 less-9 Win文件流特性绕过</h3> 
<p>经过源码分析发现,未使用str_ireplace()替换字符函数去除 <code>::$DATA </code>字符。采用<code>Windows</code>流特性绕过，在这里意思是php运行在Windows上时如果<code>文件名+::D A T A "</code>会 把<code>::DATA</code>之后的数据当作文件流处理，不会检测后缀名，且保持<code>::$DATA</code>之前的文件名，目的即不检查后缀名。</p> 
<pre><code class="prism language-bash">web.php::<span class="token variable">$data</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0d/08/3sUW9VOg_o.png" alt="在这里插入图片描述"><br> 检测：</p> 
<p><img src="https://images2.imgbox.com/97/c6/u9dUR3d0_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="210_less10__251"></a>2.10 less-10 点空桡过</h3> 
<p><img src="https://images2.imgbox.com/2a/67/ZrXRCm6Y_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="211_less11___253"></a>2.11 less-11 文件名置空 双写绕过</h3> 
<p>源码分析：</p> 
<pre><code class="prism language-php"> <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htaccess"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">//首位去除空格</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//直接将黑单内部的字符替换为空</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$deny_ext</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>所以我们直接进行双写文件名绕过：</p> 
<pre><code class="prism language-bash">web.pphphp
</code></pre> 
<p><img src="https://images2.imgbox.com/82/7b/ZW1rCsTq_o.png" alt="在这里插入图片描述"></p> 
<p>测试：</p> 
<p><img src="https://images2.imgbox.com/fc/dc/rJmbxaVF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="212_less12_get00_276"></a>2.12 less-12 get传参中的00截断</h3> 
<p>源码分析：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//定义白名单</span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//复合使用strrops获取后缀名定位，截取后缀名</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//白名单验证上传文件的合法性，合法文件才允许进行下一步处理</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//get接收参数save_path来确定文件的存储路径，利用随机数加日期来拼接出图片文件的名称</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'save_path'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>从上边的源码中我们似乎发现一旦使用白名单限制上传文件，基本无解了。但是这里作者还是给我们留了一手，这里的文件上传路径是通过get传参的形式获取的。也就是说我们是否能在上传路径上动手脚呢？</p> 
<p>其实我们可以利用<code>00截断</code>这样一个出现在PHP5.3版本之前的安全漏洞来进行绕过，这是因为<code>\0</code>代表的就是C语言中的停止符，在用C语言写的PHP中含义并未发生转变。</p> 
<p>我们先上传一个正常的<code>.jpg</code>后缀文件。进行抓包，修改上传路径为.php后缀的文件并添加%00即\0的URL编码格式。</p> 
<p><img src="https://images2.imgbox.com/62/c9/8BHQQVev_o.png" alt="在这里插入图片描述"></p> 
<p>我们看到上传失败了，经过资料查询，我们使用的环境是5.3.29，超过了漏洞触发最低版本5.2，故无法实现复现，同学们可以尝试进行解决。同时要注意关闭php.ini文件中的<code>magic_quotes_gpc</code></p> 
<p>即就是</p> 
<pre><code class="prism language-bash">magic_quotes_gpc <span class="token operator">=</span> off
</code></pre> 
<h3><a id="213_less13_post00_319"></a>2.13 less-13 post传参中的00截断</h3> 
<p>源码分析可知，文件保存路径又通过POST传参的方法进行传递了。我们进行抓包，修改路径为<code>.php%00</code>再将其进一步URL解码即可进行传参：</p> 
<p><img src="https://images2.imgbox.com/a1/45/EQNWRdCF_o.png" alt="在这里插入图片描述"></p> 
<p>进行数据包的修改：</p> 
<p><img src="https://images2.imgbox.com/10/e4/ekuzrsPf_o.png" alt="在这里插入图片描述"><br> 修改完毕后进行传参：</p> 
<p><img src="https://images2.imgbox.com/87/4d/oT24ZlyS_o.png" alt="在这里插入图片描述"></p> 
<p>当然，由于版本过高，无法再次使用PHP的00截断漏洞，但是在大家遇到类似的代码结构时，这样的上传方案也不失为一种思路。</p> 
<h3><a id="214_less14__333"></a>2.14 less-14 文件包含结合文件上传</h3> 
<p>这一关我们先来看看提示：</p> 
<p><img src="https://images2.imgbox.com/2f/29/ffdMlu91_o.png" alt="在这里插入图片描述"><br> 摆明了让我们使用文件包含，那么我们就直接开始图片马的制作：</p> 
<pre><code class="prism language-bash"><span class="token comment">#1.将目标文本文件和图片放到同一个目录下，并在此目录运行cmd</span>
<span class="token comment">#2.输入copy命令生成图片马</span>
copy src.jpg/b + web.txt web.jpg
copy 图片文件/b + 敏感文本文件 web.jpg
</code></pre> 
<p>文件马制作好后可以拖到010editor里面即可看到我们的木马信息：</p> 
<p><img src="https://images2.imgbox.com/14/3b/7gm8qA54_o.png" alt="在这里插入图片描述"></p> 
<p>进行上传：</p> 
<p><img src="https://images2.imgbox.com/bc/f4/CWGpq1QH_o.png" alt="在这里插入图片描述"></p> 
<p>测试包含情况：</p> 
<pre><code class="prism language-bash">http://127.0.0.1/upload-labs/include.php?file<span class="token operator">=</span>http://127.0.0.1/upload-labs/upload/1620230315204119.jpg
</code></pre> 
<p><img src="https://images2.imgbox.com/42/7b/79k5F9RO_o.png" alt="在这里插入图片描述"><br> 这里文件包含不理解的老铁。可以姑且把它理解为file参数接的数据直接被当成PHP文件执行即可。</p> 
<p>也就是说因为我们的图片内含敏感PHP语句。所以被包含进来之后被服务器当成PHP进行解析，加之我们的图片内部本身就存在PHP代码。故引发了这样的安全隐患问题。</p> 
<h3><a id="215_less_1516__363"></a>2.15 less 15-16 文件包含结合文件上传</h3> 
<p>这里对二者的源码同时进行分析：</p> 
<pre><code class="prism language-php"><span class="token comment">#15关的过滤语句</span>

<span class="token comment">//定义过滤函数</span>
<span class="token keyword">function</span> <span class="token function-definition function">isImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//定义白名单上的文件后缀</span>
    <span class="token variable">$types</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'.jpeg|.png|.gif'</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//使用getimagessize确定任何支持的指定图像文件的大小，并返回尺寸以及文件类型和 height/width 文本字符串，以在标准 HTML IMG 标签和对应的 HTTP 内容类型中使用。</span>
        <span class="token variable">$info</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//从info的前两个字节中截取出文件后缀名</span>
        <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">image_type_to_extension</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//stripos返回types在ext中首次出现的数字位置，这里是在进行白名单匹配</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$types</span><span class="token punctuation">,</span><span class="token variable">$ext</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$ext</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">#16关的过滤语句</span>
<span class="token keyword">function</span> <span class="token function-definition function">isImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//需要开启php_exif模块,exif_imagetype() 读取一个图像的第一个字节并检查其签名。</span>
    <span class="token variable">$image_type</span> <span class="token operator">=</span> <span class="token function">exif_imagetype</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$image_type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token constant">IMAGETYPE_GIF</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string double-quoted-string">"gif"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">IMAGETYPE_JPEG</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">IMAGETYPE_PNG</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string double-quoted-string">"png"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>    
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>可以看出，依旧是对图片类型的一种判断，只要准才文件包含漏洞，我们随便制作一个图片马即可轻松绕过上边的函数：</p> 
<p><strong>less-15</strong></p> 
<p>1.制作图片马</p> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>HP<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>muma<span class="token operator">&gt;</span>copy tailuo.png/b + web.txt web.png
tailuo.png
web.txt
已复制         <span class="token number">1</span> 个文件。
</code></pre> 
<p>2.文件上传</p> 
<p><img src="https://images2.imgbox.com/55/cd/4NfgzCLa_o.png" alt="在这里插入图片描述"></p> 
<p>3.文件包含进行解析</p> 
<p><img src="https://images2.imgbox.com/a0/dd/9oXxYE6Y_o.png" alt="在这里插入图片描述"></p> 
<p>less-16 故技重施即可。</p> 
<h3><a id="216_less17___435"></a>2.16 less-17 文件包含与二次渲染的绕过</h3> 
<p>我们继续进行源码分析：</p> 
<pre><code class="prism language-php"> <span class="token comment">//判断文件后缀与类型，合法才进行上传操作</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$fileext</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token operator">==</span><span class="token string double-quoted-string">"image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmpname</span><span class="token punctuation">,</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//使用上传的图片生成新的图片 --- 二次渲染</span>
            <span class="token variable">$im</span> <span class="token operator">=</span> <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$im</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"该文件不是jpg格式的图片！"</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">//给新图片指定文件名</span>
                <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$newfilename</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".jpg"</span><span class="token punctuation">;</span>
                <span class="token comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                <span class="token function">imagejpeg</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>上面一段比较核心的代码向我们展示了本官卡中独特的过滤方案，即使在我们图片上传后仍然会进行图片重组。我们可以尝试以下过滤强度：</p> 
<p>继续上传我们先前的web.jpg图片马。</p> 
<p><img src="https://images2.imgbox.com/63/54/8VUGv2mq_o.png" alt="在这里插入图片描述"><br> 解析失败，我们尝试把图片拉下来，分析上传前后的差异：</p> 
<p><img src="https://images2.imgbox.com/e9/7b/WBBoH5Ag_o.png" alt="在这里插入图片描述"></p> 
<p>使用010editor进行二进制分析：</p> 
<p><img src="https://images2.imgbox.com/07/dd/n1QsHfve_o.png" alt="在这里插入图片描述"></p> 
<p>我们可以看到已经有很明显的数据打乱行为，我们之前的PHP语句也已经消失了。此时我们可以尝试在未进行变动的地方插入语句，理论上此种方案可行，但是因为不同的图片在同一个二次渲染的函数下运行的结果不尽相同。并且尝试过的jpg格式的图片明显打乱的次序很多，多次尝试均已失败告终。</p> 
<p>我们尝试上传gif图片马，再次拉取上传图片到本地进行编码的对比，在未修改的部分尝试注入php代码：</p> 
<p>1.制作gif木马</p> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>HP<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>muma<span class="token operator">&gt;</span>copy dijia.gif/b + web.txt web.gif
dijia.gif
web.txt
已复制         <span class="token number">1</span> 个文件。
</code></pre> 
<p>2.上传文件，再次保存到本地</p> 
<p><img src="https://images2.imgbox.com/d8/9c/jGuHGyjT_o.png" alt="在这里插入图片描述"></p> 
<p>3.edit二进制对比分析</p> 
<p><img src="https://images2.imgbox.com/04/2a/jY1Nsb8i_o.png" alt="在这里插入图片描述"><br> 点击这一部分进行代码注入测试：</p> 
<p><img src="https://images2.imgbox.com/1d/21/TGnLnKgr_o.png" alt="在这里插入图片描述"></p> 
<p>经过n多次测试之后：终于在这个位置可以实现webshell的上传</p> 
<p><img src="https://images2.imgbox.com/a9/81/OZs9kWV4_o.png" alt="在这里插入图片描述"></p> 
<p>总的来说，二次渲染它也逃不过有些约定俗成的位置不进行二次转换。我们就是通过不断地测试，最终定位到二进制文件中没有被转换且不影响文件结构的那一那一小块二进制区域，完成我们的php代码注入。</p> 
<p>图片马上传上去之后，我们就需要结合文件包含漏洞实现恶意的webshell解析。整个过程就是需要多次的尝试。才能达到预期的效果。不过若失可以对<code>jpg,png，gif</code>等图片的编码格式有一个系统的了解，这个东西做起来会更快。还是需要多多学习才是。</p> 
<h3><a id="217_less18__507"></a>2.17 less-18 竞争型漏洞</h3> 
<p>竞争型漏洞对于我们大多数初学者来说是一个新颖的概念，对于这类漏洞的理解我们就需要搞清楚一个很重要的点，谁和谁竞争什么。清楚了这一点我们就可以在后续的学习中有的放矢。</p> 
<p>源码分析：</p> 
<pre><code class="prism language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//定义白名单</span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//截取文件后缀</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$upload_file</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$file_name</span><span class="token punctuation">;</span>
    <span class="token comment">//先将文件移动到上传路径</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$upload_file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//判断是否在白名单内部 如果是则重命名放置到文件夹内部</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
             <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
             <span class="token function">rename</span><span class="token punctuation">(</span><span class="token variable">$upload_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//判断非法文件直接进行删除</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$upload_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我们再来理一理这里的思路，文件先上传到文件夹底下，之后开始检测后缀名的合法性。合法重命名保留，不合法直接删除。</p> 
<p>听着似乎没毛病，但是细细一想，坏了。文件先存到目录里的，存在一个时间窗口，那么如果我们足够快，能够包含到窗口期的恶意文件。岂不是直接让这个恶意文件生成一个webshell就行了？</p> 
<p>这是我们的第一个恶意PHP文件：</p> 
<pre><code class="prism language-php"><span class="token comment">#webat.php</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>php <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php phpinfo();?&gt;'</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>然后我们使用burp启动两个进程，一个进程快速上传，一个进程快速请求上传文件地址。最终我们的恶意代码会被执行生成我们的webshell。</p> 
<p>我们在这里进行两个数据包的抓取，并将其ctrl+i传送至爆破模块进行处理：</p> 
<p><img src="https://images2.imgbox.com/41/3a/DoZzyhuX_o.png" alt="在这里插入图片描述"></p> 
<p>我们再抓取请求包，进行同样的操作：</p> 
<p><img src="https://images2.imgbox.com/79/4c/R7h2CQDQ_o.png" alt="在这里插入图片描述"><br> 配置上传模块：<br> <img src="https://images2.imgbox.com/3a/69/kuwRilto_o.png" alt="在这里插入图片描述"></p> 
<p>配置请求模块：</p> 
<p><img src="https://images2.imgbox.com/ee/9b/71OuJszq_o.png" alt="在这里插入图片描述"></p> 
<p>结果获取：</p> 
<p><img src="https://images2.imgbox.com/a9/fa/RSWJasYe_o.png" alt="在这里插入图片描述"><br> 测试webshell：</p> 
<p><img src="https://images2.imgbox.com/be/09/wfS7FTcD_o.png" alt="在这里插入图片描述"><br> 上传成功！！！</p> 
<p>小结一下，本例中的竞争点是我们上传上去的<code>webat.php</code>文件先被删除还是先被我们请求到。我们使用了两个进程，一个进程无线上传，一个进程有限请求。最终根据回显状态码确认了上传状态，进行<code>webshell</code>的上传。</p> 
<h2><a id="3_572"></a>3.总结</h2> 
<p>这里先说一下常见的文件上传检测方案。可以大体按照作者给出的分类方案，分为客户端和服务端的限制。</p> 
<p>客户端主要可以进行JS层面的合法性检测(防君子不放小人)，而服务端可以检查文件的后缀，检查文件的内容。在服务端的检测中可以按照黑白名单进行一个分类，黑名单的安全系数较低，通常会因为大小写过滤不严谨，过滤后缀代码不严谨，程序版本过低等问题引发绕过。</p> 
<p>而白名单则安全很多，即使想要绕过白名单检测实现webshell的上传，也需要结合可能存在的文件上传漏洞进行攻击。大大提升攻击者的攻击难度。</p> 
<p>当然，还有一类上传问题则是出现在代码的运行逻辑上，在确认文件的合法性之前，让文件以任何形式出现在服务器上都是很危险的行为。特别是出现在上传目录里面，攻击者可以使用多进程竞争请求的方式抢在我们删除恶意文件之前，执行恶意代码，实现webshell的生成。这一部分需要代码审计才能发现相应的问题。</p> 
<p><img src="https://images2.imgbox.com/97/1f/vps8vNWR_o.png" alt="请添加图片描述"></p> 
<p>这里附上作者的上传思路：大体就是判断前后端过滤，判断过滤类型(内容检测，后缀检测、代码逻辑问题)<br> <img src="https://images2.imgbox.com/dc/9c/8YNZ7PWV_o.png" alt="请添加图片描述"></p> 
<p>当然，如果有人问起文件上传怎么防御那么我肯定会立刻回答：前后端同时白名单过滤，前端过滤后缀，后端文件内容检测，并进行随机次数的多次渲染。保证先判断文件合法性，在上传文件到目录下，并进行重命名。</p> 
<p>如此一来，安全系数可以拉到百分之九十九，彻底封死黑客们梦寐以求的"插shell大梦"</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/166b247fbccdb6d5bc737f74773ea86e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Linux】GDB的安装与使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/80846a3e7886e7c7235b34937bdabb17/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java学习星球，Java学习路线</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>