<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用CUDA_VISIBLE_DEVICES设置显卡 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用CUDA_VISIBLE_DEVICES设置显卡" />
<meta property="og:description" content="一. 读卡规则 当服务器有多个GPU时，设置CUDA_VISIBLE_DEVICES 环境变量可以改变CUDA程序所能使用的GPU设备。在默认情况下，标号为0的显卡为主卡，如主机中有4块显卡，那么每张显卡的默认标号为[0,1,2,3]。多卡设置规则如下：
Environment Variable SyntaxResultsCUDA_VISIBLE_DEVICES=1Only device 1 will be seenCUDA_VISIBLE_DEVICES=0,1Devices 0 and 1 will be visibleCUDA_VISIBLE_DEVICES=&#34;0,1&#34;Same as above, quotation marks are optionaCUDA_VISIBLE_DEVICES=0,2,3lDevices 0, 2, 3 will be visible；device 1 is masked CUDA应用运行时，CUDA将遍历当前可见的设备，并从零开始为可见设备编号。第一种情况，卡1设置为主卡，但CUDA遍历时会设置为可见编号0。最后一种情况，设备0,2,3将显示为设备0,1,2。如果将字符串的顺序更改为“2,3,0”，则设备2,3,0将分别被设置为0,1,2。如果为CUDA_VISIBLE_DEVICES 设置了不存在的设备，所有实际设备将被隐藏，CUDA 应用将无法使用GPU设备；如果设备序列是存在和不存在设备的混合，那么不存在设备前的所有存在设备将被重新编号，不存在设备之后的所有设备将被屏蔽。当前可见的（重新编号后的）设备可使用CUDA 程序来查看。
举例：
import torch print(torch.cuda.current_device()) 运行：
结果：
虽然指定使用设备为卡1，但CUDA会编号为0，因此显示的编号还是0
二. 设置GPU 1. 临时设置 1.1. 直接设置
export CUDA_VISIBLE_DEVICES=1 1.2. 运行bash脚本时指定GPU
CUDA_VISIBLE_DEVICES=gpu_ids sh test.sh 1.3. 在代码中指定GPU
import os os.environ[&#39;CUDA_VISIBLE_DEVICES&#39;] = gpu_ids 1.4. 运行程序时指定GPU
CUDA_VISIBLE_DEVICES=gpu_ids python test.py 注意：这种设置方法一定要在第一次使用 cuda 之前进行设置" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/4755bd9c372af37f369ab98d67a59214/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-03T00:04:40+08:00" />
<meta property="article:modified_time" content="2022-11-03T00:04:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用CUDA_VISIBLE_DEVICES设置显卡</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><strong>一. 读卡规则</strong></h2> 
<p>当服务器有多个GPU时，设置CUDA_VISIBLE_DEVICES 环境变量可以改变CUDA程序所能使用的GPU设备。在默认情况下，标号为0的显卡为主卡，如主机中有4块显卡，那么每张显卡的默认标号为[0,1,2,3]。多卡设置规则如下：</p> 
<table border="1" cellpadding="1" cellspacing="1" style="width:600px;"><tbody><tr><td>Environment Variable Syntax</td><td>Results</td></tr><tr><td>CUDA_VISIBLE_DEVICES=1</td><td>Only device 1 will be seen</td></tr><tr><td>CUDA_VISIBLE_DEVICES=0,1</td><td>Devices 0 and 1 will be visible</td></tr><tr><td>CUDA_VISIBLE_DEVICES="0,1"</td><td>Same as above, quotation marks are optiona</td></tr><tr><td>CUDA_VISIBLE_DEVICES=0,2,3</td><td>lDevices 0, 2, 3 will be visible；device 1 is masked</td></tr></tbody></table> 
<p style="text-align:justify;">CUDA应用运行时，CUDA将遍历当前可见的设备，并从零开始为可见设备编号。第一种情况，卡1设置为主卡，但CUDA遍历时会设置为可见编号0。最后一种情况，设备0,2,3将显示为设备0,1,2。如果将字符串的顺序更改为“2,3,0”，则设备2,3,0将分别被设置为0,1,2。如果为CUDA_VISIBLE_DEVICES 设置了不存在的设备，所有实际设备将被隐藏，CUDA 应用将无法使用GPU设备；如果设备序列是存在和不存在设备的混合，那么不存在设备前的所有存在设备将被重新编号，不存在设备之后的所有设备将被屏蔽。当前可见的（重新编号后的）设备可使用CUDA 程序来查看。</p> 
<p>举例：</p> 
<pre><code class="language-python">import torch
print(torch.cuda.current_device())</code></pre> 
<p>运行：</p> 
<p class="img-center"><img alt="" height="77" src="https://images2.imgbox.com/f6/cd/47L5ZvRo_o.png" width="537"></p> 
<p>结果：</p> 
<p class="img-center"><img alt="" height="30" src="https://images2.imgbox.com/1c/07/141Vwk4k_o.png" width="423"></p> 
<p><span style="color:#4d4d4d;"><span style="background-color:#ffffff;">虽然指定使用设备为卡1，</span></span><span style="color:#ff0000;">但CUDA会编号为0</span><span style="color:#4d4d4d;"><span style="background-color:#ffffff;">，因此显示的编号还是0</span></span></p> 
<h2></h2> 
<h2><strong>二. 设置GPU</strong></h2> 
<h3><strong>1. 临时设置</strong></h3> 
<p><strong>1.1. 直接设置</strong></p> 
<pre><code class="language-python">export CUDA_VISIBLE_DEVICES=1
</code></pre> 
<p><strong>1.2. 运行bash脚本时指定GPU</strong></p> 
<div> 
 <pre><code class="language-python">CUDA_VISIBLE_DEVICES=gpu_ids sh test.sh</code></pre> 
</div> 
<p><strong>1.3. 在代码中指定GPU</strong></p> 
<div></div> 
<div> 
 <pre><code class="language-python">import os 
os.environ['CUDA_VISIBLE_DEVICES'] = gpu_ids </code></pre> 
</div> 
<p><strong>1.4. 运行程序时指定GPU</strong></p> 
<div> 
 <pre><code class="language-python">CUDA_VISIBLE_DEVICES=gpu_ids python test.py</code></pre> 
</div> 
<p><strong>注意：这种设置方法一定要在第一次使用 cuda 之前进行设置</strong></p> 
<h3>2. 永久设置</h3> 
<p>管理员身份运行</p> 
<pre><code class="language-python">~/.bashrc</code></pre> 
<p>在最后加上</p> 
<pre><code class="language-python">export CUDA_VISIBLE_DEVICES=gpu_ids</code></pre> 
<p>然后</p> 
<pre><code class="language-python">source ~/.bashrc</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/129043ae8cae7a1402572e3eaad36057/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构：常见算法的时间复杂度汇总</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6b1735b5d0e77ff846826872f4cf9f0e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">git push 出错error: failed to push some refs to ....</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>