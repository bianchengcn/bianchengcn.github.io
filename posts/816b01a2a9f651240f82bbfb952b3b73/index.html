<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>libcurl教程 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="libcurl教程" />
<meta property="og:description" content="最近一段时间无事，等待入职。以前把libcurl的easy Interface 的那些函数用法手册翻译了，这次也把 libcurl-tutorial翻译一下，多有不足，请多指教。
原文是网址是 ：http://curl.haxx.se/libcurl/c/libcurl-tutorial.html
之前也有人翻译过，我参考了很多，在这里表示感谢，链接是：
http://blog.csdn.net/jgood/article/details/4787670
我有些是逐句翻译的，有些是省略了，只翻译出自己认为重要的地方。还有些地方我也有困惑，不知道如何翻译是好。有些我认为用的不多的主题，比如代理，简略了。也许翻译久了有些枯燥了，渐渐后面的多的不如刚开始的好。有上面诸多缺点，希望我翻译的不要误导到大家。能够大家一个参考，我就感到足矣。
名称
libcurl 的编程教程
目标
本文档介绍使用libcurl编程的一般原则和一些基本方法。本文主要是介绍 c 语言的调用接口，同时也可能很好的适用于其他类 c 语言的接口。
跨平台的可移植代码
libcurl库背后的开发人员投入了相当大的努力确保libcurl可以在很多不同的系统和环境里工作。
全局的准备
程序必须初始化一些libcurl的全局函数。这意味着不管你准备使用libcurl多少次，你都应该，且只初始化一次。当你的程序开始的时候，使用
curl_global_init()
这个函数需要一个参数来告诉它如何来初始化。使用CURL_GLOBAL_ALL ,它将用通常是比较好的默认参数来初始化所有已知的内部子模块。还有两个可选值：
CURL_GLOBAL_WIN32
这个参数只被用在windows 操作系统上。它让libcurl初始化win32套接字的的东西。没有正确的初始化，你的程序将不能正确的使用套接字。你应该只为每个程序做一次这样的操作，如果你的程序的其他库这样了，你就不要再让libcurl这样做。
CURL_GLOBAL_SSL
这个参数会使libcurl具有SSL的能力。你应该只为每个程序做一次这样的操作，如果你的程序的其他库这样了，你就不要再让libcurl这样做。
libcurl有个默认的保护机制，检测如果curl_global_init没有在curl_easy_perform之前被调用，那么libcurl会猜测该使用的初始化模式来执行程序。请注意，依靠默认的保护机制来这么做一点都不好。
当程序不再使用libcurl，请调用curl_global_cleanup函数来对应初始化函数所做的工作，它会做逆向的工作来清理curl_global_init所初始化的资源。
请避免重复的调用curl_global_init和 curl_global_cleanup。他们每个仅被调用一次。
libcurl所支持的功能
确定libcurl所提供功能的最佳办法是在运行的时候而不是在编译的时候。通过调用curl_version_info函数，然后查看返回信息的结构体，你知道当前的libcurl版本所支持的功能了。
使用libcurl的简单接口
首先介绍libcurl的简单接口(easy interface)，这些接口都有curl_easy的前缀。 libcurl的最近版本还提供了复杂接口(multi interface)。更多关系该接口的信息将另作讨论，为了更好的理解复杂接口，你仍然需要先了解简单接口。
为了使用简单接口，你先需要创建一个简单接口的句柄。每一个简单接口的数据通信都需要这个句柄。一般来说，你需要为每个准备传输数据的线程使用一个句柄。但你绝不能在多线程里共享相同的句柄。
获取简单句柄
easyhandle = curl_easy_init();
这个函数返回一个简单接口句柄。接下来的操作力，可以在这个`easyhandle设置各种选项。在随后的一个或者多次数据传输中，句柄只是一个逻辑实体。 通过curl_easy_setopt设置句柄的属性和选项，它们控制随后的数据传输。这些属性和选项的设置一个保存在句柄里直到它再次被设置为其他值。多次网络请求使用相同的句柄，它们的句柄选择和属性也是相同的。
很多用于设置libcurl属性都是字符串，一个指向一段以0结尾数据。当你用字符串设置 curl_easy_setopt(），libcurl会复制这个字符串的一个副本，所以你在设置后不用再保存那个字符串的内存。
在句柄上最经常设置的属性是URL。你可以这样设置它
curl_easy_setopt(handle, CURLOPT_URL, &#34;http://domain.com/&#34;);
假如你希望得到指定URL上的远程主机的数据资源到本地。如果你想自己处理得到的数据而不是直接显示在标准输出里，你可以写一个符合下面原型的函数
size_t write_data(void *buffer, size_t size, size_t nmemb, void *userp);
你可以用类似下面这样的代码来控制libcurl将得到的数据传递到你写的函数里
curl_easy_setopt(easyhandle, CURLOPT_WRITEFUNCTION, write_data);
你还可以控制你的回调函数第四个参数得到的数据，用这样的函数原型" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/816b01a2a9f651240f82bbfb952b3b73/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-10-19T15:45:20+08:00" />
<meta property="article:modified_time" content="2012-10-19T15:45:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">libcurl教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin:10px auto; padding-top:0px; padding-bottom:0px; line-height:19px; font-size:13px; font-family:verdana,'ms song',宋体,Arial,微软雅黑,Helvetica,sans-serif; background-color:rgb(254,254,242)"> 最近一段时间无事，等待入职。以前把libcurl的easy Interface 的那些函数用法手册翻译了，这次也把 libcurl-tutorial翻译一下，多有不足，请多指教。</p> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; line-height:19px; font-size:13px; font-family:verdana,'ms song',宋体,Arial,微软雅黑,Helvetica,sans-serif; background-color:rgb(254,254,242)"> 原文是网址是 ：<a href="http://curl.haxx.se/libcurl/c/libcurl-tutorial.html" rel="nofollow noopener noreferrer" target="_blank" style="margin:0px; padding:0px; color:rgb(7,93,179)">http://curl.haxx.se/libcurl/c/libcurl-tutorial.html</a></p> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; line-height:19px; font-size:13px; font-family:verdana,'ms song',宋体,Arial,微软雅黑,Helvetica,sans-serif; background-color:rgb(254,254,242)"> 之前也有人翻译过，我参考了很多，在这里表示感谢，链接是：</p> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; line-height:19px; font-size:13px; font-family:verdana,'ms song',宋体,Arial,微软雅黑,Helvetica,sans-serif; background-color:rgb(254,254,242)"> <a href="http://blog.csdn.net/jgood/article/details/4787670" target="_blank" style="margin:0px; padding:0px; color:rgb(7,93,179)" rel="noopener noreferrer">http://blog.csdn.net/jgood/article/details/4787670</a></p> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; line-height:19px; font-size:13px; font-family:verdana,'ms song',宋体,Arial,微软雅黑,Helvetica,sans-serif; background-color:rgb(254,254,242)"> 我有些是逐句翻译的，有些是省略了，只翻译出自己认为重要的地方。还有些地方我也有困惑，不知道如何翻译是好。有些我认为用的不多的主题，比如代理，简略了。也许翻译久了有些枯燥了，渐渐后面的多的不如刚开始的好。有上面诸多缺点，希望我翻译的不要误导到大家。能够大家一个参考，我就感到足矣。</p> 
<p style="margin:10px auto; padding-top:0px; padding-bottom:0px; line-height:19px; font-size:13px; font-family:verdana,'ms song',宋体,Arial,微软雅黑,Helvetica,sans-serif; background-color:rgb(254,254,242)">  </p> 
<div class="Section0" style="margin:0px; padding:0px; font-family:verdana,'ms song',宋体,Arial,微软雅黑,Helvetica,sans-serif; font-size:13px; line-height:19px; background-color:rgb(254,254,242)"> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5">  </p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5">  </p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>名称</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">libcurl <span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的编程教程</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>目标</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">本文档介绍使用<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">编程的一般原则和一些基本方法。本文主要是介绍 </span><span style="margin:0px; padding:0px; line-height:1.5">c </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">语言的调用接口，同时也可能很好的适用于其他类 </span><span style="margin:0px; padding:0px; line-height:1.5">c </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">语言的接口。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>跨平台的可移植代码</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">库背后的开发人员投入了相当大的努力确保</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">可以在很多不同的系统和环境里工作。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>全局的准备</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">程序必须初始化一些<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的全局函数。这意味着不管你准备使用</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">多少次，你都应该，且只初始化一次。当你的程序开始的时候，使用</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_global_init()</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">这个函数需要一个参数来告诉它如何来初始化。使用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURL_GLOBAL_ALL </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">,<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">它将用通常是比较好的默认参数来初始化所有已知的内部子模块。还有两个可选值：</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURL_GLOBAL_WIN32</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">这个参数只被用在<span style="margin:0px; padding:0px; line-height:1.5">windows </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">操作系统上。它让</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">初始化</span><span style="margin:0px; padding:0px; line-height:1.5">win32</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">套接字的的东西。没有正确的初始化，你的程序将不能正确的使用套接字。你应该只为每个程序做一次这样的操作，如果你的程序的其他库这样了，你就不要再让</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">这样做。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURL_GLOBAL_SSL</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">这个参数会使<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">具有</span><span style="margin:0px; padding:0px; line-height:1.5">SSL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的能力。你应该只为每个程序做一次这样的操作，如果你的程序的其他库这样了，你就不要再让</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">这样做。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">有个默认的保护机制，检测如果</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_global_init</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">没有在</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">之前被调用，那么<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会猜测该使用的初始化模式来执行程序。请注意，依靠默认的保护机制来这么做一点都不好。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当程序不再使用<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">，请调用</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_global_cleanup</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">函数来对应初始化函数所做的工作，它会做逆向的工作来清理</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_global_init</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">所初始化的资源。</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">请避免重复的调用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_global_init</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">和</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_global_cleanup</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">。他们每个仅被调用一次。</span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">所支持的功能</span></strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">确定<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">所提供功能的最佳办法是在运行的时候而不是在编译的时候。通过调用</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_version_info</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">函数，然后查看返回信息的结构体，你知道当前的<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">版本所支持的功能了。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>使用<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的简单接口</span></strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">首先介绍<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的简单接口</span><span style="margin:0px; padding:0px; line-height:1.5">(easy interface)</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">，这些接口都有</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">的前缀。 <span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的最近版本还提供了复杂接口</span><span style="margin:0px; padding:0px; line-height:1.5">(multi interface)</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。更多关系该接口的信息将另作讨论，为了更好的理解复杂接口，你仍然需要先了解简单接口。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">为了使用简单接口，你先需要创建一个简单接口的句柄。每一个简单接口的数据通信都需要这个句柄。一般来说，你需要为每个准备传输数据的线程使用一个句柄。但你绝不能在多线程里共享相同的句柄。</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">获取简单句柄</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle = curl_easy_init();</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">这个函数返回一个简单接口句柄。接下来的操作力，可以在这个</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">`easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">设置各种选项。在随后的一个或者多次数据传输中，句柄只是一个逻辑实体。 通过</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">设置句柄的属性和选项，它们控制随后的数据传输。这些属性和选项的设置一个保存在句柄里直到它再次被设置为其他值。多次网络请求使用相同的句柄，它们的句柄选择和属性也是相同的。</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">很多用于设置<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">属性都是字符串，一个指向一段以</span><span style="margin:0px; padding:0px; line-height:1.5">0</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">结尾数据。当你用字符串设置</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_easy_setopt(<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">）</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">，<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会复制这个字符串的一个副本，所以你在设置后不用再保存那个字符串的内存。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">在句柄上最经常设置的属性是<span style="margin:0px; padding:0px; line-height:1.5">URL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。你可以这样设置它</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(handle, CURLOPT_URL, "http://domain.com/");</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">假如你希望得到指定<span style="margin:0px; padding:0px; line-height:1.5">URL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">上的远程主机的数据资源到本地。如果你想自己处理得到的数据而不是直接显示在标准输出里，你可以写一个符合下面原型的函数</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">size_t write_data(void *buffer, size_t size, size_t nmemb, void *userp);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">你可以用类似下面这样的代码来控制<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">将得到的数据传递到你写的函数里</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(easyhandle, CURLOPT_WRITEFUNCTION, write_data);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">你还可以控制你的回调函数第四个参数得到的数据，用这样的函数原型</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(easyhandle, CURLOPT_WRITEDATA, &amp;internal_struct);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">使用这种原型，你可以很容易在你程序和被<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">调用函数之间传递本地数据。使用 </span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_WRITEDATA</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">,libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">不会处理你所传递的数据。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">假如你没用使用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_WRITEFUNCTION</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">设置回调函数，<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会有默认的处理。它只是把接收到的数据输出到标准输出里。你可以使用传递一个</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">FILE *</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">的打开文件参数，设置默认处理函数</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_WRITEDATA </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">,<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">它把得到的数据存放在一个文件里。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">这里有一个与平台有关的缺陷。有时候<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">不能操作一个呗程序所打开的文件。如果你用</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_WRITEDATA</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">给默认的回调函数传递一个打开的文件，程序可能崩溃。<span style="margin:0px; padding:0px; line-height:1.5">(</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_WRITEDATA</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt"> 原来的名称为</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_FILE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">,<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">它们是同样的工作机理</span><span style="margin:0px; padding:0px; line-height:1.5">)</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">如果你以 <span style="margin:0px; padding:0px; line-height:1.5">win32 dll</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的方式使用</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">，如果你设置了，</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_WRITEDATA </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">，也必须用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_WRITEFUNCTION </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">，否则你会遇到程序崩溃。 还有其他很多的选项可以设置，我们放在后面再详细讨论，接着往下看</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">success = curl_easy_perform(easyhandle);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">函数将会连接远程的站点，发送必要的命令和接受传输的数据。当它收到了数据，它就会调用我们先前设置的回调函数。这个函数可能一次得到一个字节或者几千个字节。<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会尽可能多的，尽可能快的传回数据。我们回调函数返回它所得到数据的大小。如果返回的数据大小与传递给它数据大小不一致，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">将会终止操作，并返回一个错误代码。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当数据传输完成，</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">返回一个代码来告诉你是否成功。如果你仅返回一个代码还不够，你可以使用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_ERRORBUFFER </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">,<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">让</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">缓存许多可读的错误信息</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">如果你还想传输其他数据，已有的句柄可以多次使用。记住，鼓励你使用现有的句柄来传输其他数据，<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会尝试已经先前已经建立好的连接。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">对于某些协议，下载文件可能涉及到很多复杂的协议用来记录信息，设置传输模式，更改当前的目录并最终传递数据。传递一个文件的<span style="margin:0px; padding:0px; line-height:1.5">URL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会为你掌管所有细节，把文件从一台机器移动到两一台机器。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>多线程问题</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">最基本的原则是绝对不要同时在多个线程之间共享一个<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的句柄。确保任何时候一个句柄只是在一个线程里使用。你可以在多个线程之间传递句柄，但是你不能使用。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">是线程安全的，除了以下两种情况：信号量和</span><span style="margin:0px; padding:0px; line-height:1.5">SSL/TLS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">句柄。信号量用于超时失效名字解析</span><span style="margin:0px; padding:0px; line-height:1.5">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">在域名解析的时候</span><span style="margin:0px; padding:0px; line-height:1.5">)</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">如果你通过多线程方式来访问<span style="margin:0px; padding:0px; line-height:1.5">HTTPS </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">或者 </span><span style="margin:0px; padding:0px; line-height:1.5">FTPS </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">网址，你可以使用底层的</span><span style="margin:0px; padding:0px; line-height:1.5">SSL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">库，多线程库。这些库可能有它们独有的要求，你要多加注意详细参考</span></span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(238,238,238)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,0,102); font-size:9pt">OpenSSL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        http</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">:</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">//www.openssl.org/docs/crypto/threads.html#DESCRIPTION</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,0,102); font-size:9pt">GnuTLS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        http</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">:</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">//www.gnu.org/software/gnutls/manual/html_node/Multi_002dthreaded-applications.html</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">NSS <span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">它宣称是线程安全，没有任何特殊的要求。 </span><span style="margin:0px; padding:0px; line-height:1.5">PolarSSL </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">未知。</span><span style="margin:0px; padding:0px; line-height:1.5">yassl </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">未知。</span><span style="margin:0px; padding:0px; line-height:1.5">axTLS </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">未知。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当你使用多线程的时候，你应当为所有的句柄设置</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_NOSIGNAL </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">选项。所有的时候都可以工作正常除了<span style="margin:0px; padding:0px; line-height:1.5">DNS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">查询超时的时候。 同样，</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_DNS_USE_GLOBAL_CACHE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">也不是线程安全的。</span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>当<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">实际无法工作</span></strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">总是有各种原因导致网络传输失败。你可能设置错误的<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">选项，误解了</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">某些选项的实际作用，或者远程服务器返回</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">一个非标准的应答。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当发生错误的时候，这里有一个黄金法<span style="margin:0px; padding:0px; line-height:1.5">:</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">设置</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_VERBOSE </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">选项为<span style="margin:0px; padding:0px; line-height:1.5">1</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。这将导致</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">显示出所有发送的实体协议的细节，或者还有一些内部的信息和一些收到协议的数据</span><span style="margin:0px; padding:0px; line-height:1.5">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">尤其是 </span><span style="margin:0px; padding:0px; line-height:1.5">FTP)</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。如果你使用</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP ,</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_HEADER</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">设为<span style="margin:0px; padding:0px; line-height:1.5">1,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">请求头</span><span style="margin:0px; padding:0px; line-height:1.5">/</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">响应头也会被输出</span><span style="margin:0px; padding:0px; line-height:1.5">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">这些头信息将出现在消息的内容中。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">如果</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_VERBOSE </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">还不够，你设置</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_DEBUGFUNCTION</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">来调试你的数据。</span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>上传数据到远程站点</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">尽量保持与协议无关性，就是上传文件到远程的</span><span style="margin:0px; padding:0px; line-height:1.5">FTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">跟用</span><span style="margin:0px; padding:0px; line-height:1.5">PUT</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">方式上传数据到</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">服务器和非常类似的。 我们写一个程序，很可能想</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">按照我们的要求上传数据。我需要设置如下函数原型的读数据的回调函数</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">size_t function(char *bufptr, size_t size, size_t nitems, void *userp);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">bufptr</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt"> 参数指向一段准备上传数据的缓冲区，</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">nitem</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">是这段缓冲区的大小，</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">userp</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">是一个用户自定义指针，<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">不对该指针作任何操作，它只是简单的传递该指针。可以使用该指针在应用程序与</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">之间传递信息。</span></span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(238,238,238)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_READFUNCTION</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> read_function</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_READDATA</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">filedata</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,0,102); font-size:9pt">Tell</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> libcurl that we want to upload</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">:</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_UPLOAD</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,102,102); font-size:9pt">1L</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">有几个协议将不能正常工作当上传的时候没有告诉上传文件的大小。所以设置上传文件的大小请使用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_INFILESIZE_LARGE</span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(238,238,238)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">         </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* in this example, file_size must be an curl_off_t variable */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">         curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_INFILESIZE_LARGE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> file_size</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当你调用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_perform()</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">的时候，<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会执行所有的必要动作，当开始上传的时候，它会调用我的回调函数。程序会尽可能多，尽可能快的的上传数据。回调函数返回写入缓冲区的数据的大小。返回</span><span style="margin:0px; padding:0px; line-height:1.5">0</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的时候就表示上传结束了。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>密码</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">许多协议要求用户名和密码才能下载或者上传你所选择的数据。<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">提供了指定的几种方法。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">许多协议都支持用户名和密码包含在指定的<span style="margin:0px; padding:0px; line-height:1.5">URL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">里。</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会检测并相应的使用它们。可以按照这样的格式写</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">protocol://user:password@example.com/path/</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">如果你的用户名和密码需要一些奇特的字符，你应该使用<span style="margin:0px; padding:0px; line-height:1.5">URLd</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">编码，像</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">%XX</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">，其中</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">ＸＸ</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">是两位十六进制的数字。</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">同事也提供了一个设置各种类型密码的选项。设置</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_USERPWD </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">选项如下</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(easyhandle, CURLOPT_USERPWD, "myname:thesecret");</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">在某些情况下可能会多次用到用户名和密码，可以使用代码来验证身份。<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">提供一个</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_PROXYUSERPWD</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">选项来实现这种功能<span style="margin:0px; padding:0px; line-height:1.5">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">跟</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_USERPWD </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">选项很类似</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(easyhandle, CURLOPT_PROXYUSERPWD, "myname:thesecret");</span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>HTTP <span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">认证</span></strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">先前的章节我们显示了如何为需要验证的<span style="margin:0px; padding:0px; line-height:1.5">URL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">设置用户和密码。当我们使用</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">协议的时候，客户端有许多不同的向服务器发送身份验证。最基本的</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">认证为</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">Basic</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">认证，它发送</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">base64</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">编码的明文用户和密码，这不安全。 如今，<span style="margin:0px; padding:0px; line-height:1.5">libcrul</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">支持使用</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">Basic, Digest, NTLM, Negotiate, GSS-Negotiate and SPNEGO</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">等方式的认证，你可以设置</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_HTTPAUTH </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">告诉<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">使用那种认证。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(easyhandle, CURLOPT_HTTPAUTH, CURLAUTH_DIGEST);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当你想代理服务器认证的时候，你可以使用</span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(238,238,238)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        CURLOPT_PROXYAUTH</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">:</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_PROXYAUTH</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLAUTH_NTLM</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">你可以组合多种认证方式，<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会以合理的方式处理 </span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(easyhandle, CURLOPT_HTTPAUTH, CURLAUTH_DIGEST|CURLAUTH_BASIC);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">为了方便起见，你还可以使用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLAUTH_ANY</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">，它允许<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">使用任何想要的方法。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>HTTP POSTing</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">HTML</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">最简单的也是最常见的<span style="margin:0px; padding:0px; line-height:1.5">POST</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">是使用</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">&lt;form&gt;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">这个标签来实现的。我们提供了一个指向数据段 指针，然后告诉<span style="margin:0px; padding:0px; line-height:1.5">licurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">把它发送到远程站点：</span></span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(238,238,238)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">char</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">*</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">data</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">=</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"name=daniel&amp;project=curl"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_POSTFIELDS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> data</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_URL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"http://posthere.com/"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* post away! */</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">是不是很简单。当你设置了</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_POSTFIELDS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">选项，它会自动切换句柄来</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">POST</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">接下的请求。</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">如果你想发送二进制的数据，需要设置一下数据头，用来知名数据的类型和数据的大小。如下</span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">struct</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_slist </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">*</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">headers</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">=</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">NULL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        headers </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">=</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_slist_append</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">headers</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"Content-Type: text/xml"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* post binary data */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_POSTFIELDS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> binaryptr</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* set the size of the postfields data */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_POSTFIELDSIZE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,102,102); font-size:9pt">23L</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* pass our list of custom made headers */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_HTTPHEADER</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> headers</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* post away! */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_slist_free_all</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">headers</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* free the header list */</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">还有一种是</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">multi-part </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">表单提交<span style="margin:0px; padding:0px; line-height:1.5">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">这被认为是一种更好的方法提交二进制的数据。</span><span style="margin:0px; padding:0px; line-height:1.5">libcrul</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">同样也支持这种方法。下面是例子</span><span style="margin:0px; padding:0px; line-height:1.5">:</span></span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">struct</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_httppost </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">*</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">post</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">=</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">NULL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">struct</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_httppost </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">*</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">last</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">=</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">NULL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_formadd</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">post</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">last</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_COPYNAME</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"name"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_COPYCONTENTS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"daniel"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLFORM_END</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_formadd</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">post</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">last</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_COPYNAME</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"project"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_COPYCONTENTS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"curl"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLFORM_END</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_formadd</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">post</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">last</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_COPYNAME</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"logotype-image"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_FILECONTENT</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"curl.png"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        CURLFORM_END</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* Set the form info */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_setopt</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> CURLOPT_HTTPPOST</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> post</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* post away! */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* free the post data again */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_formfree</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">post</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">还允许你在每个定义的部分设置头。下面就是例子</span></span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(238,238,238)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">struct</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_slist </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">*</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">headers</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">=</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">NULL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        headers </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">=</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_slist_append</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">headers</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"Content-Type: text/xml"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_formadd</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">post</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">&amp;</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">last</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_COPYNAME</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"logotype-image"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_FILECONTENT</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,136,0); font-size:9pt">"curl.xml"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        CURLFORM_CONTENTHEADER</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> headers</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   CURLFORM_END</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">easyhandle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* post away! */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">         curl_formfree</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">post</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">         </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* free post */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">         curl_slist_free_all</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">headers</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">         </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* free custom header list */</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">所有对简单接口句柄都是</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">"<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">粘的</span><span style="margin:0px; padding:0px; line-height:1.5">"</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">，这些属性会一直保持不变除非你在调用</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">之前改过。通过将</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_HTTPGET</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">设为<span style="margin:0px; padding:0px; line-height:1.5">1</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">可以使简单接口句柄回到最原始的状态：</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(easyhandle, CURLOPT_HTTPGET, 1L);</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">只设置</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_POSTFIELDS </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">的只为</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">""</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">或者</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">NULL</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">是不会停止<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">做</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">POST</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">请求的，这只会做提交空数据的</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">POST</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">。</span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>显示进度</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">通过将</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_NOPROCESS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">设置为<span style="margin:0px; padding:0px; line-height:1.5">0</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">开启进度支持。该选项默认值为</span><span style="margin:0px; padding:0px; line-height:1.5">1</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。对大多数应用程序，我们需要提供一个进度显示回调。</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">会不定期的将当前传输的进度通过回调函数告诉你的程序。</span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(238,238,238)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">//<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">回调函数原型</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">int</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> progress_callback</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">void</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">*</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">clientp</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">double</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> dltotal</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">double</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> dlnow</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">double</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> ultotal</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">double</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> ulnow</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">);</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/*<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">通过</span><span style="margin:0px; padding:0px; line-height:1.5">CURLOPT_PROGRESSFUNCTION</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">注册该回调函数。</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">        参数<span style="margin:0px; padding:0px; line-height:1.5">clientp</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">是一个用户自定义指针，应用程序通过</span><span style="margin:0px; padding:0px; line-height:1.5">CURLOPT_PROCESSDATA</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">        属性将该自定义指定传递给<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">对该参数不作任何处理，</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">        只是简单将其传递给回调函数。<span style="margin:0px; padding:0px; line-height:1.5">*/</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">和</span><span style="margin:0px; padding:0px; line-height:1.5">c++</span></strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">只有一件需要特别注意的是回调函数不能使类的非静态成员函数。如</span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(238,238,238)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">class</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,0,102); font-size:9pt">AClass</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> <br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">{<!-- --></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">                </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">static</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> size_t write_data</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">(</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">void</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">*</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">ptr</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> size_t size</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> size_t nmemb</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">,</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">                </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(0,0,136); font-size:9pt">void</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">*</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">ourpointer</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">)</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">                </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">{<!-- --></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">                        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(136,0,0); font-size:9pt">/* do what you want with the data */</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">   </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">                </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">}</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">  </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt"><br style="margin:0px; padding:0px"> </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">        </span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; color:rgb(102,102,0); font-size:9pt">}</span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>代理</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">略过，有兴趣请参考原文。</span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>持久化的好处</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当需要发送多次请求时，应该重复使用<span style="margin:0px; padding:0px; line-height:1.5">easy handle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">每次执行完</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_perform</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">，</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">licurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">会继续保持与服务器的连接。接下来的请求可以使用这个连接而不必创建新的连接（如果目标主机是同一个的话）。这样可以减少网络开销。 即使连接被释放了，</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">也会缓存这些连接的会话信息，这样下次再连接到目标主机上时，就可以使用这些信息，从而减少重新连接所需的时间。</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">FTP<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">连接可能会被保存较长的时间。因为客户端要与</span><span style="margin:0px; padding:0px; line-height:1.5">FTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">服务器进行频繁的命令交互。对于有访问人数上限的</span><span style="margin:0px; padding:0px; line-height:1.5">FTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">服务器，保持一个长连接，可以使你不需要排除等待，就直接可以与</span><span style="margin:0px; padding:0px; line-height:1.5">FTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">服务器通信。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会缓存</span><span style="margin:0px; padding:0px; line-height:1.5">DNS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的解析结果。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">在今后的<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">版本中，还会添加一些特性来提高数据通信的效率。 每个简单接口句柄都会保存最近使用的几个连接，以备重用。默认是</span><span style="margin:0px; padding:0px; line-height:1.5">5</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">个。可以通过</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_MAXCONNECTS</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">属性来设置保存连接的数量。</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">如果你不想重用连接，将</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_FRESH_CONNECT</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">属性设置为<span style="margin:0px; padding:0px; line-height:1.5">1</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。这样每次提交请求时，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">都会先关闭以前创建的连接，然后重新创建一个新的连接。也可以将</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_FORBID_REUSE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">设置为<span style="margin:0px; padding:0px; line-height:1.5">1</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">，这样每次执行完请求，连接就会马上关闭。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>libcurl<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">使用</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">消息头</span></strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当使用<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">发送</span><span style="margin:0px; padding:0px; line-height:1.5">http</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">请求时，它会自动添加一些</span><span style="margin:0px; padding:0px; line-height:1.5">http</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">头。我们可以通过</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_HTTPHEADER</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">属性手动替换、添加或删除相应的<span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">消息头。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">例外：以<span style="margin:0px; padding:0px; line-height:1.5">POST</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的方式向</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">服务器提交请求时，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会设置该消息头为</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">"100-continue"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">，它要求服务器在正式处理该请求之前，返回一个<span style="margin:0px; padding:0px; line-height:1.5">"OK"</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">消息。如果</span><span style="margin:0px; padding:0px; line-height:1.5">POST</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的数据很小，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">可能不会设置该消息头。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>自定义的操作</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">当前越来越多的协议都构建在<span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">协议之上（如：</span><span style="margin:0px; padding:0px; line-height:1.5">soap</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">），这主要归功于</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的可靠性，以及被广泛使用的代理支持（可以穿透大部分防火墙）。 这些协议的使用方式与传统</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">可能有很大的不同。对此，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">作了很好的支持。</span></span></p> 
 <p class="p0" style="margin:8.7pt auto; padding:0pt; line-height:1.5"><a target="_blank" style="margin:0px; padding:0px"></a><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:18pt"><strong>cookies</strong></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">cookie<span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">是一个键值对的集合，</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">服务器发给客户端的</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">，客户端提交请求的时候，也会将</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">发送到服务器。服务器可以根据</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">来跟踪用户的会话信息。</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">有过期时间，超时后</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">就会失效。</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">有域名和路径限制，</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">只能发给指定域名和路径的</span><span style="margin:0px; padding:0px; line-height:1.5">HTTP</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">服务器。</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">在<span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">中，可以通过</span></span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">CURLOPT_COOKIE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">属性来设置发往服务器的<span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">：</span></span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Monaco; font-size:9pt">curl_easy_setopt(easyhandle, CURLOPT_COOKIE, "name1=var1; name2=var2;");</span></p> 
 <p class="p0" style="margin:15pt; padding-top:0px; padding-bottom:0px; line-height:1.5; background-color:rgb(255,255,255)"> <span style="margin:0px; padding:0px; line-height:1.5; font-family:Arial; font-size:9.5pt">在实在的应用场景中，你可能需要保存服务器发送给你的<span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">，并在接下来的请求中，把这些</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">一并发往服务器。所以，可以把上次从服务器收到的所有响应头信息保存到文本文件中，当下次需要向服务器发送请求时，通过</span><span style="margin:0px; padding:0px; line-height:1.5">CURLOPT_COOKIEFILE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">属性告诉</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">从该文件中读取</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息。 设置</span><span style="margin:0px; padding:0px; line-height:1.5">CURLOPT_COOKIEFILE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">属性意味着激活</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的</span><span style="margin:0px; padding:0px; line-height:1.5">cookie parser</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。在</span><span style="margin:0px; padding:0px; line-height:1.5">cookie parser</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">被激活之前，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">忽略所以之前接收到的</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息。</span><span style="margin:0px; padding:0px; line-height:1.5">cookie parser</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">被激活之后，</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息将被保存内存中，在接下来的请求中，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会自动将这些</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息添加到消息头里，你的应用程序不需要做任何事件。大多数情况下，这已经足够了。需要注意的是，通过</span><span style="margin:0px; padding:0px; line-height:1.5">CURLOPT_COOKIEFILE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">属性来激活</span><span style="margin:0px; padding:0px; line-height:1.5">cookie parser</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">，给</span><span style="margin:0px; padding:0px; line-height:1.5">CURLOPT_COOKIEFILE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">属性设置的一个保存</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息的文本文件路径，可能并不需要在磁盘上物理存在。 如果你需要使用</span><span style="margin:0px; padding:0px; line-height:1.5">NetScape</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">或者</span><span style="margin:0px; padding:0px; line-height:1.5">FireFox</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">浏览器的</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">文件，你只要用这些浏览器的</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">文件的路径来初始化</span><span style="margin:0px; padding:0px; line-height:1.5">CURLOPT_COOKIEFILE</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">属性，</span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">会自动分析</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">文件，并在接下来的请求过程中使用这些</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息。 </span><span style="margin:0px; padding:0px; line-height:1.5">libcurl</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">甚至能够把接收到的</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息保存成能被</span><span style="margin:0px; padding:0px; line-height:1.5">Netscape/Mozilla</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的浏览器所识别的</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">文件。通过把这些称为</span><span style="margin:0px; padding:0px; line-height:1.5">cookie-jar</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">。通过设置</span><span style="margin:0px; padding:0px; line-height:1.5">CURLOPT_COOKIEJAR</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">选项，在调用</span><span style="margin:0px; padding:0px; line-height:1.5">curl_easy_cleanup</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">释放</span><span style="margin:0px; padding:0px; line-height:1.5">easy handle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">的时候，所有的这些</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息都会保存到</span><span style="margin:0px; padding:0px; line-height:1.5">cookie-jar</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">文件中。这就使得</span><span style="margin:0px; padding:0px; line-height:1.5">cookie</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">信息能在不同的</span><span style="margin:0px; padding:0px; line-height:1.5">easy handle</span><span style="margin:0px; padding:0px; line-height:1.5; font-family:宋体">甚至在浏览器之间实现共享。</span></span></p> 
 <p class="p0" style="margin:0pt auto; padding-top:0px; padding-bottom:0px; line-height:1.5">  </p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5c2dc8a762c6728ab1b7a9b1a5aa813c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用ibatis时让控制台打印sql文的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62156227d934e26e8c1587eb421118d3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">htaccess不起作用的解决方法,AllowOverride All打开后出现403错误时解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>