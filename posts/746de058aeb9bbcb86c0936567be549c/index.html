<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>史上最详细sqlmap入门教程 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="史上最详细sqlmap入门教程" />
<meta property="og:description" content="最近做安全测试，遇到了SQL盲注的漏洞，从发现漏洞，确认漏洞，协助开发复现漏洞，验证漏洞一整套流程下来，有了亿点点收获，下面分享给大家，希望对软件测试同学有所启发，难度不大，小白看完也能上手的那种。
话不多说，先上图！！！
一、sqlmap工具简介
sqlmap 是一个自动化的 SQL 注入和渗透测试工具，是开源免费的， 支持 MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、IBM DB2、SQLite、Firebird、Sybase 和 SAP MaxDB 等数据库管理系统， 可以帮助渗透测试人员自动化地检测和利用 SQL 注入漏洞，获取数据库服务器上的数据，甚至可以在某些情况下获取操作系统的shell。
sqlmap支持五种不同的注入模式:
基于布尔的盲注，即可以根据返回页面判断条件真假的注入；
基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断；
基于报错注入，即页面会返回错误信息，或者把注入语句的结果直接返回在页面中；
联合查询注入，可以使用 union 情况下的注入；
堆查询注入，可以同时执行多条语句执行时的注入。
二、sqlmap工具安装
1、安装Python
此次演示的Python版本是Python 3.6.6
2、在官网：sqlmap: automatic SQL injection and database takeover tool，下载sqlmap安装包，选择任意一种格式均可
3、解压sqlmap，并将解压的文件复制到Python安装路径下
演示的Python安装目录在：D:\Python36
4、在桌面创建一个cmd的快捷方式，并命名为sqlmap
5、在快捷方式sqlmap上鼠标右键，选择“属性”，把起始位置修改为sqlmap所在路径后，点击“确定”按钮
6、双击快捷方式sqlmap，并输入：sqlmap.py -h
这样，sqlmap就安装成功了。
三、sqlmap参数讲解
1、-u &#34;URL&#34;
指定URL，一般用于get请求
用法：python sqlmap.py -u &#34;接口地址&#34;
例如：python sqlmap.py -u &#34;https://xxxx/saler/list?customerId=2&#34;
2、-r
sqlmap可以从一个文本中读取原始的 HTTP 请求，通过这种方式，能够免于设置部分选项（例如：设置 Cookies，POST 数据等参数）
例如：python sqlmap.py -r D:\user.txt --dbs" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/746de058aeb9bbcb86c0936567be549c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-16T11:49:17+08:00" />
<meta property="article:modified_time" content="2023-05-16T11:49:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">史上最详细sqlmap入门教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="ub7e58035">最近做安全测试，遇到了SQL盲注的漏洞，从发现漏洞，确认漏洞，协助开发复现漏洞，验证漏洞一整套流程下来，有了亿点点收获，下面分享给大家，希望对软件测试同学有所启发，难度不大，小白看完也能上手的那种。</p> 
<p id="u5246c466"></p> 
<p id="uc38e9a4f">话不多说，先上图！！！</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1a/cd/hCU5lTNC_o.png"></p> 
<p id="u0046a6a0"></p> 
<p id="uc15dfdbf"><strong>一、sqlmap工具简介</strong></p> 
<p id="u6bdf90e0">sqlmap 是一个自动化的 SQL 注入和渗透测试工具，是开源免费的， 支持 MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、IBM DB2、SQLite、Firebird、Sybase 和 SAP MaxDB 等数据库管理系统， 可以帮助渗透测试人员自动化地检测和利用 SQL 注入漏洞，获取数据库服务器上的数据，甚至可以在某些情况下获取操作系统的shell。</p> 
<p id="u1954ccf9"></p> 
<p id="u6e1eeffa"><strong>sqlmap支持五种不同的注入模式:</strong></p> 
<p id="ub9a1ef85">基于布尔的盲注，即可以根据返回页面判断条件真假的注入；</p> 
<p id="ue7a1c3ef">基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断；</p> 
<p id="ud0396298">基于报错注入，即页面会返回错误信息，或者把注入语句的结果直接返回在页面中；</p> 
<p id="u96887b9a">联合查询注入，可以使用 union 情况下的注入；</p> 
<p id="ua51a889f">堆查询注入，可以同时执行多条语句执行时的注入。</p> 
<p id="ub83a8a27"></p> 
<p id="u7a0c53ef"><strong>二、sqlmap工具安装</strong></p> 
<p id="u01c310ab"></p> 
<p id="ud037b9dc">1、安装Python</p> 
<p id="u1ecef99d">此次演示的Python版本是Python 3.6.6</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e6/5f/P0e4k5Wu_o.png"></p> 
<p id="uc45cea3b"></p> 
<p id="u03958874">2、在官网：<a href="https://sqlmap.org/" rel="nofollow" title="sqlmap: automatic SQL injection and database takeover tool">sqlmap: automatic SQL injection and database takeover tool</a>，下载sqlmap安装包，选择任意一种格式均可</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6b/a7/dRjhUlqY_o.png"></p> 
<p id="ub54eef06"></p> 
<p id="u0a9fb3cc">3、解压sqlmap，并将解压的文件复制到Python安装路径下</p> 
<p id="ue741b85f">演示的Python安装目录在：D:\Python36</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/10/d9/gI7wxaYu_o.png"></p> 
<p id="uca1f31a4"></p> 
<p id="u9b9fa1a6">4、在桌面创建一个cmd的快捷方式，并命名为sqlmap</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3e/e2/NbNpC9do_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3a/37/Eu4HAXMc_o.png"></p> 
<p id="u99c2881f"></p> 
<p id="u6c2aa735">5、在快捷方式sqlmap上鼠标右键，选择“属性”，把起始位置修改为sqlmap所在路径后，点击“确定”按钮</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8a/e2/gxue84nh_o.png"></p> 
<p id="u4e0ced32"></p> 
<p id="u58a4d440">6、双击快捷方式sqlmap，并输入：sqlmap.py -h</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/65/71/Kz6CdriS_o.png"></p> 
<p id="u4c4ea32b"></p> 
<p id="u1379237c">这样，sqlmap就安装成功了。</p> 
<p id="u812edac2"></p> 
<p id="ud66a8ade"><strong>三、sqlmap参数讲解</strong></p> 
<p id="u6436cd42">1、-u "URL"</p> 
<p id="ub9d39037">指定URL，一般用于get请求</p> 
<p id="u31c6f1a8">用法：python sqlmap.py -u "接口地址"</p> 
<p id="u7af4ca02">例如：python sqlmap.py -u "<a href="https://crm-ir-test.stnts.com/crm/saler/l" rel="nofollow" title="https://xxxx/saler/l">https://xxxx/saler/l</a>ist?customerId=2"</p> 
<p id="ub6e722e8"></p> 
<p id="u89fd3c0d">2、-r</p> 
<p id="u26fc765d">sqlmap可以从一个文本中读取原始的 HTTP 请求，通过这种方式，能够免于设置部分选项（例如：设置 Cookies，POST 数据等参数）</p> 
<p id="u9c76ec57">例如：python sqlmap.py -r D:\user.txt --dbs</p> 
<p id="u81a8812f"></p> 
<p id="ua1dd053e">如果相关的请求是 HTTPS，可以结合 --force-ssl 开关强制使用 SSL 进行 443/tcp 连接。或者，在 Host 头部信息后面直接加上 :443，使用 Google dork 结果作为目标地址</p> 
<p id="u89c5aeb6"></p> 
<p id="u1a5a2ef1">3、--dbs</p> 
<p id="u46fd7d6b">如果当前会话用户对数据库系统表有读取权限，则可以枚举出当前数据库名称</p> 
<p id="u98fdeeb8">例如：python sqlmap.py -r D:\user.txt --dbs</p> 
<p id="u4307d043"></p> 
<p id="uffb06bb5">4、--exclude-sysdbs</p> 
<p id="u7263a28b">排除所有的系统数据库</p> 
<p id="u6a3ceb1f">例如：python sqlmap.py -r D:\user.txt --dbs --exclude-sysdbs "information_schema,mysql,performance_schema"</p> 
<p id="uad7de5b0"></p> 
<p id="uaeddbd40">5、--tables</p> 
<p id="ue2139eb3">如果当前会话用户对数据库系统表有读取权限，则可以枚举出当前数据库表</p> 
<p id="u96327149">例如：python sqlmap.py -r D:\user.txt --tables</p> 
<p id="u6a452a39"></p> 
<p id="uf97f21ae">6、-D</p> 
<p id="ue0e6d94d">用来指定数据库，如果不加该参数， sqlmap 将枚举所有 DBMS 数据库的表</p> 
<p id="u1164c6dc">例如：python sqlmap.py -r D:\user.txt -D test --tables</p> 
<p id="uee459f85"></p> 
<p id="u5ff1a92e">7、--columns</p> 
<p id="ua8c442b2">如果当前会话用户对数据库系统表有读取权限，则可以枚举出当前数据库表的列名</p> 
<p id="u7f724d29">例如：python sqlmap.py -r D:\user.txt --columns -D testdb -T users -C name</p> 
<p id="u4a5f677c"></p> 
<p id="uc053ce4b">8、-D</p> 
<p id="u3364b84e">用来指定数据库名称</p> 
<p id="ua015de5d">例如：python sqlmap.py -r D:\user.txt --columns -D testdb -T users -C name</p> 
<p id="u737e82d8"></p> 
<p id="u915fd06c">9、-T</p> 
<p id="ubfed41a2">用来指定数据库表名</p> 
<p id="ub4dd6873">例如：python sqlmap.py -r D:\user.txt --columns -D testdb -T users -C name</p> 
<p id="ud9f1cd3c"></p> 
<p id="u4e5ee811">10、-C</p> 
<p id="uf3a642dc">用来指定要枚举的数据库表的列名称</p> 
<p id="u2e67d3c4">例如：python sqlmap.py -r D:\user.txt --columns -D testdb -T users -C name</p> 
<p id="u37409ed4"></p> 
<p id="u91c23dd9">11、--fresh-queries</p> 
<p id="u57c56953">使用这个参数sqlmap将不会从缓存里面加载数据，从而能将最新的数据注入到数据库</p> 
<p id="u8d095f57">例如：python sqlmap.py -r D:\user.txt --dbs --fresh-queries</p> 
<p id="ub3c1fd2c"></p> 
<p id="u21f232cd">12、<strong>--level</strong></p> 
<p id="uad6b9d50"><strong>如果 SQL 注入检测的难度越高，则需要设定越高的--level 值，最高级别是5</strong></p> 
<p id="uf30ba8f8"><strong>例如：</strong>python sqlmap.py -r D:\user.txt --level=5 --risk=3</p> 
<p id="u9d319505"></p> 
<p id="ue471c5dc">13、--risk</p> 
<p id="ue54769be">风险级别，默认级别是1，风险级别是2时，会在默认的基础上添加大量的时间型盲注语句进行测试，风险级别是3时，会在原基础上添加大量OR类型的布尔型盲注语句进行测试</p> 
<p id="u9fc8e6df">例如：python sqlmap.py -r D:\user.txt --level=5 --risk=3</p> 
<p id="uc4869c68">这个命令，执行时间会比较久</p> 
<p id="u0386d98f"></p> 
<p id="ubdcb67e0"><strong>四、sqlmap实践应用</strong></p> 
<p id="u4717a6a9">一）通过工具AppScan扫描SQL盲注漏洞</p> 
<p id="u2b1031e0">查看AppScan工具的扫描结果，看是否有SQL盲注漏洞，如果存在，就会有如下图所示的标注</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a7/4c/pd5qa75b_o.png"></p> 
<p id="uf195f6a3"></p> 
<p id="u42a52e98">二）分析存在SQL盲注的接口</p> 
<p id="ufd31c195">注入的接口一般分为POST注入和GET注入，两种类型的接口使用工具的方式不一样。</p> 
<p id="u69eb2dfc"></p> 
<p id="u6b9e0b99"><strong>1、POST注入</strong></p> 
<p id="u86b865df">1）如果接口是POST类型的，就需要把AppScan上该接口的请求信息（请求头+请求体），全部复制到一个txt文件下保存，放到一个本地文件下，例如D:\saler.txt</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1d/30/KBe6kwYG_o.png"></p> 
<p id="u84dec536"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/26/90/1HtxfvZG_o.png"></p> 
<p id="ud1e31f29"></p> 
<p id="u3e5b85c5">2）手动登录系统，将D:\saler.txt文件的Cookie值更新为最新值</p> 
<p id="u1760680d">复制最新的Cookie值</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/fd/b6/bTndhwZk_o.png"></p> 
<p id="ud32db059"></p> 
<p id="u40b003c2">粘贴至D:\saler.txt文件中</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b8/eb/CtN6tIaL_o.png"></p> 
<p id="ubb20d0d2"></p> 
<p id="u8a70fc04">3）打开cmd窗口，通过桌面快捷方式进入sqlmap所在目录，执行命令：python sqlmap.py -r D:\user.txt --dbs</p> 
<p id="ua1e9a592">命令的格式为：python sqlmap.py -r 请求报文txt文件所在目录位置 --dbs</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c5/c6/pPBdt9Pf_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/35/ef/VjhHZYvD_o.png"></p> 
<p id="ue34ebe47"></p> 
<p id="u61105fb4">4）命令执行完成后，分析结果</p> 
<p id="ud612d149">如果有注入，结果如下（因为我们演示的时候，执行命令的参数是--dbs，所以暴露的是数据库名）：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a3/62/a5OYKgjc_o.png"></p> 
<p id="u47ffdca7"></p> 
<p id="u6b142774">5）将SQL盲注的漏洞反馈给开发同学，让开发同学修复</p> 
<p id="u08efdc73">参考AppScan扫描时的参数，利用抓包工具例如Fiddler或者Charles进行重现</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3a/f0/FqoC1lbZ_o.png"></p> 
<p id="ue912f9c1"></p> 
<p id="u4ca4c466">尝试传这四个参数，验证结果是不是不同，如果不一样，则证明存在SQL盲注漏洞</p> 
<p id="u0efecf92"></p> 
<p id="u09088e92">6）待开发修复漏洞后，进行验证</p> 
<p id="ue35e6935">注意验证的时候清除缓存，带--fresh-queries参数，该参数表示<em>sqlmap将不会从缓存里面加载数据，从而能注入到数据库最新的数据</em></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/bd/2e/QA50e5SI_o.png"></p> 
<p id="u8c52a6f7"></p> 
<p id="ub81556e2">3分钟左右，脚本跑完后，查看结果，如下是已修复的结果</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/cd/07/i9NZ364b_o.png"></p> 
<p id="uf96b1cf0"></p> 
<p id="u28ee63ba"><em>2、GET注入</em></p> 
<p id="u6258ea0b"><em>1）</em>打开cmd窗口，通过桌面快捷方式进入sqlmap所在目录，执行命令：python sqlmap.py -u "<a href="https://crm-ir-test.stnts.com/crm/saler/l" rel="nofollow" title="https://xxxx/saler/l">https://xxxx/saler/l</a>ist?customerId=2" --dbs</p> 
<p id="u62b9b14d">命令的格式为：python sqlmap.py -u "接口地址" --dbs</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/29/7c/Fo3seBZb_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/81/85/Z3mlH8Lf_o.png"></p> 
<p id="u5707b223"></p> 
<p id="u2d5da15d">2）命令执行完成后，分析结果</p> 
<p id="ue69b1a26">如果有注入，结果如下：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/9b/b8/jltmBuDa_o.png"></p> 
<p id="u0bb9bb82"></p> 
<p id="u43762fb1">如果没有注入，结果如下:</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8a/e5/7q9Qxbom_o.png"></p> 
<p id="uff4db8c5"></p> 
<p id="ub72b4483">3)将SQL盲注的漏洞反馈给开发同学，让开发同学修复</p> 
<p id="ucb0344f8">参考POST注入的方式，GET注入重现也可以不抓包，直接手动登录系统，在浏览器中访问接口地址即可</p> 
<p id="uef01e89b"></p> 
<p id="uf5baffb2">4）待开发修复漏洞后，进行验证</p> 
<p id="u397ab228">注意验证的时候清除缓存，带--fresh-queries参数，该参数表示<em>sqlmap将不会从缓存里面加载数据，从而能注入到数据库最新的数据</em></p> 
<p id="uf39268ba"></p> 
<p id="u3ded2a58"><em>请参考</em>POST注入的方式</p> 
<p id="u76f775df"></p> 
<p id="ud9ff7f34">相信大家看完了整个SQL盲注测试流程，对SQL盲注也有了一定的了解，今天的分享就到这里，希望对大家有所启发。（全网同名，转载请注明出处）</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd4dba3c0bc6b1cd5b38d0a2fdc3c6cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据总线、地址总线、字、字长、字节和位的概念及关系</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/33db2e75140d08df4a4f4799839df34d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c# string的常用方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>