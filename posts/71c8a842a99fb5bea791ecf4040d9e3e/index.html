<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qtæºç é˜…è¯»(å››) äº‹ä»¶å¾ªç¯ - ç¼–ç¨‹ä¸­å›½çš„åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qtæºç é˜…è¯»(å››) äº‹ä»¶å¾ªç¯" />
<meta property="og:description" content="äº‹ä»¶ç³»ç»Ÿ æ–‡ç« ä¸ºæœ¬äººç†è§£ï¼Œå¦‚æœ‰ç†è§£ä¸åˆ°ä½ä¹‹å¤„ï¼Œçƒ¦è¯·å„ä½æŒ‡æ­£ã€‚ğŸ™‹â€â™‚ï¸
æ–‡ç« ç›®å½• äº‹ä»¶ç³»ç»Ÿä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯ï¼Ÿäº‹ä»¶æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿäº‹ä»¶æ˜¯å¦‚ä½•å¤„ç†çš„ï¼ŸsendEventpostEvent äº‹ä»¶å¾ªç¯æ˜¯æ€ä¹ˆéå†çš„ï¼Ÿäº‹ä»¶è¿‡æ»¤å™¨å¤¹å¸¦ç§è´§æ—¶é—´ Qtçš„äº‹ä»¶å¾ªç¯æ˜¯æ‰€æœ‰Qtå¼€å‘è€…éƒ½æ— æ³•é¿å…çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å› æ­¤ï¼Œæœ¬ç¯‡åšå®¢å°†ä»‹ç»Qtæºç ä¸­ä¸äº‹ä»¶å¾ªç¯ç›¸å…³çš„éƒ¨åˆ†ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£Qtäº‹ä»¶å¾ªç¯çš„æœºåˆ¶ã€‚
åœ¨æ·±å…¥æºç ä¹‹å‰ï¼Œå…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜ã€‚éšåï¼Œæˆ‘ä»¬å°†é€šè¿‡æºç ï¼Œé€ä¸€è§£æï¼Œæ­å¼€äº‹ä»¶å¾ªç¯çš„é¢çº±ã€‚
äº‹ä»¶å¾ªç¯æ˜¯ä»€ä¹ˆï¼Ÿäº‹ä»¶æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿäº‹ä»¶æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯ï¼Ÿ åœ¨ChatGPTğŸ’¬ä¸Šæœç´¢åˆ°çš„æ¦‚å¿µæ˜¯ï¼š
åœ¨Qtä¸­ï¼Œäº‹ä»¶å¾ªç¯æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨äºå¤„ç†å„ç§å¼‚æ­¥äº‹ä»¶ã€‚äº‹ä»¶å¾ªç¯é€šè¿‡ä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—æ¥ç®¡ç†å’Œè°ƒåº¦äº‹ä»¶ï¼Œå½“é˜Ÿåˆ—ä¸­æœ‰äº‹ä»¶æ—¶ï¼Œäº‹ä»¶å¾ªç¯ä¼šä»é˜Ÿåˆ—ä¸­ä¾æ¬¡å–å‡ºäº‹ä»¶å¹¶å¤„ç†ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…äº‹ä»¶å¾ªç¯è¢«ä¸­æ–­ã€‚
äº‹ä»¶çš„äº§ç”Ÿå¯ä»¥æ˜¯ç”¨æˆ·è¾“å…¥ã€ç³»ç»Ÿä¿¡å·ã€ç½‘ç»œè¯·æ±‚ã€å®šæ—¶å™¨ç­‰ï¼ŒQtæä¾›äº†ä¸€ç³»åˆ—çš„äº‹ä»¶å¤„ç†å‡½æ•°å’Œä¿¡å·æ§½æœºåˆ¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†è¿™äº›äº‹ä»¶ä¸å…·ä½“çš„æ“ä½œç›¸ç»‘å®šã€‚
å› æ­¤ï¼ŒQtçš„äº‹ä»¶å¾ªç¯æœºåˆ¶æ˜¯Qtåº”ç”¨ç¨‹åºå®ç°å¼‚æ­¥å“åº”å’Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„åŸºç¡€ã€‚
ä¸ªäººç†è§£ï¼ŒQtçš„äº‹ä»¶å¾ªç¯æ˜¯é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—æ¥å¾ªç¯å¤„ç†äº‹ä»¶çš„æœºåˆ¶ã€‚å½“é˜Ÿåˆ—ä¸­æœ‰äº‹ä»¶æ—¶ï¼Œäº‹ä»¶å¾ªç¯ä¼šå¤„ç†äº‹ä»¶ï¼›å¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰äº‹ä»¶ï¼Œåˆ™äº‹ä»¶å¾ªç¯ä¼šé˜»å¡ç­‰å¾…ã€‚
äº‹ä»¶æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ äº‹ä»¶çš„äº§ç”Ÿå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š
ç¨‹åºå¤–éƒ¨äº§ç”Ÿï¼šæŒ‡ç³»ç»Ÿäº§ç”Ÿçš„äº‹ä»¶ï¼Œä¾‹å¦‚é¼ æ ‡æŒ‰ä¸‹ï¼ˆMouseButtonPressï¼‰ã€æŒ‰é”®æŒ‰ä¸‹ï¼ˆKeyPressï¼‰ç­‰ã€‚Qté€šè¿‡æ•æ‰ç³»ç»Ÿäº‹ä»¶ï¼Œå°†å…¶å°è£…æˆè‡ªå·±çš„QEventç±»ï¼Œå†å°†äº‹ä»¶å‘é€å‡ºå»ã€‚
ç¨‹åºå†…éƒ¨äº§ç”Ÿï¼šæŒ‡åœ¨ä»£ç ä¸­æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åé€šè¿‡sendEvent/postEventå°†äº‹ä»¶å‘é€åˆ°äº‹ä»¶å¾ªç¯ä¸­ã€‚å…¶ä¸­ï¼ŒsendEventæ˜¯é˜»å¡å‹çš„å‘é€æ–¹å¼ï¼Œä¼šç­‰å¾…äº‹ä»¶å¤„ç†å®Œæˆåå†ç»§ç»­æ‰§è¡Œï¼›è€ŒpostEventæ˜¯éé˜»å¡å‹çš„å‘é€æ–¹å¼ï¼Œä¼šå°†äº‹ä»¶æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œå¹¶ç«‹å³è¿”å›ã€‚
äº‹ä»¶æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæµç¨‹å›¾ç®€å•äº†è§£äº‹ä»¶ä»å‘å‡ºåˆ°å¤„ç†çš„è¿‡ç¨‹ã€‚
åœ¨æ¥ä¸‹æ¥çš„è§£æä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡åˆ†ææºä»£ç ï¼Œé€æ­¥éªŒè¯æµç¨‹å›¾ä¸­çš„æ¯ä¸ªæ­¥éª¤ã€‚è¯·å„ä½è¯»è€…è€å¿ƒç»§ç»­å¾€ä¸‹é˜…è¯»ğŸ˜
ä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡åˆ†ææºç ï¼Œæ¥æ­ç§˜ä¸ºä»€ä¹ˆsendEvent/postEventæ˜¯é˜»å¡å’Œéé˜»å¡çš„ã€ä»¥åŠäº‹ä»¶çš„å¤„ç†æµç¨‹ã€‚
sendEvent é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹sendEventï¼š
bool QCoreApplication::sendEvent(QObject *receiver, QEvent *event) { // sendEventæ˜¯é˜»å¡è°ƒç”¨ Q_TRACE(QCoreApplication_sendEvent, receiver, event, event-&gt;type()); if (event) event-&gt;spont = false; return notifyInternal2(receiver, event); } å¯ä»¥çœ‹åˆ°ï¼ŒsendEventæ˜¯è°ƒç”¨äº†notifyInternal2è¿™ä¸ªå‡½æ•°
bool QCoreApplication::notifyInternal2(QObject *receiver, QEvent *event) { ... // Qt enforces the rule that events can only be sent to objects in // the current thread, so receiver-&gt;d_func()-&gt;threadData is // equivalent to QThreadData::current(), just without the function // call overhead." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/71c8a842a99fb5bea791ecf4040d9e3e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-13T22:37:56+08:00" />
<meta property="article:modified_time" content="2023-07-13T22:37:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹ä¸­å›½çš„åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹ä¸­å›½çš„åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qtæºç é˜…è¯»(å››) äº‹ä»¶å¾ªç¯</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>äº‹ä»¶ç³»ç»Ÿ</h2> 
<blockquote> 
 <p>æ–‡ç« ä¸ºæœ¬äººç†è§£ï¼Œå¦‚æœ‰ç†è§£ä¸åˆ°ä½ä¹‹å¤„ï¼Œçƒ¦è¯·å„ä½æŒ‡æ­£ã€‚ğŸ™‹â€â™‚ï¸</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#_1" rel="nofollow">äº‹ä»¶ç³»ç»Ÿ</a></li><li><ul><li><a href="#_15" rel="nofollow">ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯ï¼Ÿ</a></li><li><a href="#_27" rel="nofollow">äº‹ä»¶æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ</a></li><li><a href="#_35" rel="nofollow">äº‹ä»¶æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ</a></li><li><ul><li><a href="#sendEvent_41" rel="nofollow">sendEvent</a></li><li><a href="#postEvent_143" rel="nofollow">postEvent</a></li></ul> 
   </li><li><a href="#_211" rel="nofollow">äº‹ä»¶å¾ªç¯æ˜¯æ€ä¹ˆéå†çš„ï¼Ÿ</a></li><li><a href="#_415" rel="nofollow">äº‹ä»¶è¿‡æ»¤å™¨</a></li><li><a href="#_499" rel="nofollow">å¤¹å¸¦ç§è´§æ—¶é—´</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>Qtçš„äº‹ä»¶å¾ªç¯æ˜¯æ‰€æœ‰Qtå¼€å‘è€…éƒ½æ— æ³•é¿å…çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å› æ­¤ï¼Œæœ¬ç¯‡åšå®¢å°†ä»‹ç»Qtæºç ä¸­ä¸äº‹ä»¶å¾ªç¯ç›¸å…³çš„éƒ¨åˆ†ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£Qtäº‹ä»¶å¾ªç¯çš„æœºåˆ¶ã€‚</p> 
<p>åœ¨æ·±å…¥æºç ä¹‹å‰ï¼Œå…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜ã€‚éšåï¼Œæˆ‘ä»¬å°†é€šè¿‡æºç ï¼Œé€ä¸€è§£æï¼Œæ­å¼€äº‹ä»¶å¾ªç¯çš„é¢çº±ã€‚</p> 
<ol><li>äº‹ä»¶å¾ªç¯æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>äº‹ä»¶æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ</li><li>äº‹ä»¶æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ</li></ol> 
<h3><a id="_15"></a>ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯ï¼Ÿ</h3> 
<p>åœ¨ChatGPTğŸ’¬ä¸Šæœç´¢åˆ°çš„æ¦‚å¿µæ˜¯ï¼š</p> 
<p>åœ¨Qtä¸­ï¼Œäº‹ä»¶å¾ªç¯æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨äº<strong>å¤„ç†å„ç§å¼‚æ­¥äº‹ä»¶</strong>ã€‚äº‹ä»¶å¾ªç¯é€šè¿‡ä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—æ¥ç®¡ç†å’Œè°ƒåº¦äº‹ä»¶ï¼Œ<strong>å½“é˜Ÿåˆ—ä¸­æœ‰äº‹ä»¶æ—¶ï¼Œäº‹ä»¶å¾ªç¯ä¼šä»é˜Ÿåˆ—ä¸­ä¾æ¬¡å–å‡ºäº‹ä»¶å¹¶å¤„ç†ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…äº‹ä»¶å¾ªç¯è¢«ä¸­æ–­</strong>ã€‚</p> 
<p>äº‹ä»¶çš„äº§ç”Ÿå¯ä»¥æ˜¯ç”¨æˆ·è¾“å…¥ã€ç³»ç»Ÿä¿¡å·ã€ç½‘ç»œè¯·æ±‚ã€å®šæ—¶å™¨ç­‰ï¼ŒQtæä¾›äº†ä¸€ç³»åˆ—çš„äº‹ä»¶å¤„ç†å‡½æ•°å’Œä¿¡å·æ§½æœºåˆ¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†è¿™äº›äº‹ä»¶ä¸å…·ä½“çš„æ“ä½œç›¸ç»‘å®šã€‚</p> 
<p>å› æ­¤ï¼ŒQtçš„äº‹ä»¶å¾ªç¯æœºåˆ¶æ˜¯Qtåº”ç”¨ç¨‹åºå®ç°å¼‚æ­¥å“åº”å’Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„åŸºç¡€ã€‚</p> 
<p>ä¸ªäººç†è§£ï¼ŒQtçš„äº‹ä»¶å¾ªç¯æ˜¯é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—æ¥å¾ªç¯å¤„ç†äº‹ä»¶çš„æœºåˆ¶ã€‚å½“é˜Ÿåˆ—ä¸­æœ‰äº‹ä»¶æ—¶ï¼Œäº‹ä»¶å¾ªç¯ä¼šå¤„ç†äº‹ä»¶ï¼›å¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰äº‹ä»¶ï¼Œåˆ™äº‹ä»¶å¾ªç¯ä¼šé˜»å¡ç­‰å¾…ã€‚</p> 
<h3><a id="_27"></a>äº‹ä»¶æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ</h3> 
<p>äº‹ä»¶çš„äº§ç”Ÿå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p> 
<ol><li> <p><strong>ç¨‹åºå¤–éƒ¨äº§ç”Ÿ</strong>ï¼šæŒ‡ç³»ç»Ÿäº§ç”Ÿçš„äº‹ä»¶ï¼Œä¾‹å¦‚é¼ æ ‡æŒ‰ä¸‹ï¼ˆMouseButtonPressï¼‰ã€æŒ‰é”®æŒ‰ä¸‹ï¼ˆKeyPressï¼‰ç­‰ã€‚Qté€šè¿‡æ•æ‰ç³»ç»Ÿäº‹ä»¶ï¼Œå°†å…¶å°è£…æˆè‡ªå·±çš„QEventç±»ï¼Œå†å°†äº‹ä»¶å‘é€å‡ºå»ã€‚</p> </li><li> <p><strong>ç¨‹åºå†…éƒ¨äº§ç”Ÿ</strong>ï¼šæŒ‡åœ¨ä»£ç ä¸­æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åé€šè¿‡<code>sendEvent</code>/<code>postEvent</code>å°†äº‹ä»¶å‘é€åˆ°äº‹ä»¶å¾ªç¯ä¸­ã€‚å…¶ä¸­ï¼Œ<code>sendEvent</code>æ˜¯<strong>é˜»å¡å‹</strong>çš„å‘é€æ–¹å¼ï¼Œä¼š<strong>ç­‰å¾…äº‹ä»¶å¤„ç†å®Œæˆåå†ç»§ç»­æ‰§è¡Œ</strong>ï¼›è€Œ<code>postEvent</code>æ˜¯<strong>éé˜»å¡å‹</strong>çš„å‘é€æ–¹å¼ï¼Œä¼š<strong>å°†äº‹ä»¶æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œå¹¶ç«‹å³è¿”å›</strong>ã€‚</p> </li></ol> 
<h3><a id="_35"></a>äº‹ä»¶æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ</h3> 
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæµç¨‹å›¾ç®€å•äº†è§£äº‹ä»¶ä»å‘å‡ºåˆ°å¤„ç†çš„è¿‡ç¨‹ã€‚<br>åœ¨æ¥ä¸‹æ¥çš„è§£æä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡åˆ†ææºä»£ç ï¼Œé€æ­¥éªŒè¯æµç¨‹å›¾ä¸­çš„æ¯ä¸ªæ­¥éª¤ã€‚è¯·å„ä½è¯»è€…è€å¿ƒç»§ç»­å¾€ä¸‹é˜…è¯»ğŸ˜<br><img src="https://images2.imgbox.com/65/0b/h6FvGqPI_o.png" alt="äº‹ä»¶å¤„ç†æµç¨‹.png"></p> 
<p>ä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡åˆ†ææºç ï¼Œæ¥æ­ç§˜<strong>ä¸ºä»€ä¹ˆ</strong><code>sendEvent</code><strong>/</strong><code>postEvent</code><strong>æ˜¯é˜»å¡å’Œéé˜»å¡çš„ã€ä»¥åŠäº‹ä»¶çš„å¤„ç†æµç¨‹</strong>ã€‚</p> 
<h4><a id="sendEvent_41"></a>sendEvent</h4> 
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹<code>sendEvent</code>ï¼š</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">QCoreApplication</span><span class="token double-colon punctuation">::</span><span class="token function">sendEvent</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>receiver<span class="token punctuation">,</span> QEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// sendEventæ˜¯é˜»å¡è°ƒç”¨</span>
    <span class="token function">Q_TRACE</span><span class="token punctuation">(</span>QCoreApplication_sendEvent<span class="token punctuation">,</span> receiver<span class="token punctuation">,</span> event<span class="token punctuation">,</span> event<span class="token operator">-&gt;</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span>
        event<span class="token operator">-&gt;</span>spont <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">notifyInternal2</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>sendEvent</code>æ˜¯è°ƒç”¨äº†<code>notifyInternal2</code>è¿™ä¸ªå‡½æ•°</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">QCoreApplication</span><span class="token double-colon punctuation">::</span><span class="token function">notifyInternal2</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>receiver<span class="token punctuation">,</span> QEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">// Qt enforces the rule that events can only be sent to objects in</span>
    <span class="token comment">// the current thread, so receiver-&gt;d_func()-&gt;threadData is</span>
    <span class="token comment">// equivalent to QThreadData::current(), just without the function</span>
    <span class="token comment">// call overhead.</span>
    <span class="token comment">// äº‹ä»¶åªèƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹è¢«send</span>
    QObjectPrivate <span class="token operator">*</span>d <span class="token operator">=</span> receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QThreadData <span class="token operator">*</span>threadData <span class="token operator">=</span> d<span class="token operator">-&gt;</span>threadData<span class="token punctuation">;</span>
    QScopedScopeLevelCounter <span class="token function">scopeLevelCounter</span><span class="token punctuation">(</span>threadData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selfRequired<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">doNotify</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> self<span class="token operator">-&gt;</span><span class="token function">notify</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è¿›ä¸€æ­¥è·Ÿè¸ªåˆ°å…¶<code>doNotify</code>å‡½æ•°</p> 
<pre><code class="prism language-cpp"><span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">doNotify</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>receiver<span class="token punctuation">,</span> QEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>receiver <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                        <span class="token comment">// serious error</span>
        <span class="token function">qWarning</span><span class="token punctuation">(</span><span class="token string">"QCoreApplication::notify: Unexpected null receiver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">QT_NO_DEBUG</span></span>
	<span class="token comment">// æ£€æŸ¥æ¥å—çº¿ç¨‹ä¸å½“å‰æ˜¯å¦åŒçº¿ç¨‹</span>
    <span class="token class-name">QCoreApplicationPrivate</span><span class="token double-colon punctuation">::</span><span class="token function">checkReceiverThread</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

	<span class="token comment">// QWidgetç±»å¿…é¡»ç”¨QApplication</span>
    <span class="token keyword">return</span> receiver<span class="token operator">-&gt;</span><span class="token function">isWidgetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token class-name">QCoreApplicationPrivate</span><span class="token double-colon punctuation">::</span><span class="token function">notify_helper</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æœ€ååˆ°äº†å’±ä»¬è¿™æ¬¡åˆ†æçš„ç¬¬ä¸€ä¸ªé‡ç‚¹â€”â€”<strong>äº‹ä»¶é€šçŸ¥</strong>ï¼š<code>QCoreApplicationPrivate::notify_helper</code></p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">QCoreApplicationPrivate</span><span class="token double-colon punctuation">::</span><span class="token function">notify_helper</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>receiver<span class="token punctuation">,</span> QEvent <span class="token operator">*</span> event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>é€šè¿‡åˆ†æè¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤§è‡´çŸ¥é“äº‹ä»¶å¤„ç†çš„å‡ ä¸ªæµç¨‹ï¼š</p> 
<ol><li>åˆ¤æ–­<strong>QCoreApplication</strong>æœ‰æ²¡æœ‰å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨ï¼Œæœ‰å°±æŠŠä¿¡å·å‘é€åˆ°<strong>QCoreApplication</strong>æ‰€å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨é‡Œï¼Œç”±äº‹ä»¶è¿‡æ»¤å™¨å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†ã€‚</li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">// send to all application event filters (only does anything in the main thread)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>QCoreApplication<span class="token double-colon punctuation">::</span>self
    <span class="token operator">&amp;&amp;</span> receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>threadData<span class="token punctuation">.</span><span class="token function">loadRelaxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>thread<span class="token punctuation">.</span><span class="token function">loadAcquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;&amp;</span> QCoreApplication<span class="token double-colon punctuation">::</span>self<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">sendThroughApplicationEventFilters</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    filtered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> filtered<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>å¦‚æœ<strong>QCoreApplication</strong>æ²¡æœ‰<strong>å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨æˆ–è€…æ‰€å®‰è£…çš„äº‹ä»¶è¿‡æ»¤å™¨ä¸å¤„ç†</strong>ï¼Œåˆ™åˆ¤æ–­<strong>äº‹ä»¶æ¥å—å¯¹è±¡æœ‰æ²¡æœ‰å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨</strong>ï¼Œæœ‰å°±å°†äº‹ä»¶å‘é€åˆ°äº‹ä»¶è¿‡æ»¤å™¨å»å¤„ç†ã€‚</li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">// send to all receiver event filters</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sendThroughObjectEventFilters</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    filtered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> filtered<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>äº‹ä»¶è¿‡æ»¤å™¨çš„å…·ä½“åˆ†æï¼Œåœ¨åé¢ä¼šåˆ†æï¼Œç°åœ¨æˆ‘ä»¬å…ˆå…³æ³¨ä¸»è¦çš„æµç¨‹ã€‚</p> 
<ol start="3"><li>åŒæ ·ï¼Œå¦‚æœäº‹ä»¶è¿‡æ»¤å™¨ä¸è¿›è¡Œå¤„ç†ï¼Œåˆ™<strong>ç›´æ¥è°ƒç”¨äº‹ä»¶æ¥å—å¯¹è±¡çš„</strong><code>**event**</code><strong>å‡½æ•°è¿›è¡Œå¤„ç†</strong>ã€‚å› ä¸ºæ˜¯<strong>ç›´æ¥è°ƒç”¨çš„å¯¹è±¡çš„</strong><code>event</code><strong>ï¼Œæ‰€ä»¥</strong><code>sendEvent</code><strong>å‡½æ•°æ˜¯é˜»å¡çš„</strong>ã€‚</li></ol> 
<pre><code class="prism language-cpp">    <span class="token comment">// deliver the event</span>
    <span class="token comment">// ç›´æ¥è°ƒç”¨å¯¹è±¡çš„eventå‡½æ•°ï¼Œæ‰€ä»¥æ˜¯é˜»å¡çš„</span>
    consumed <span class="token operator">=</span> receiver<span class="token operator">-&gt;</span><span class="token function">event</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> consumed<span class="token punctuation">;</span>
</code></pre> 
<br> 
<h4><a id="postEvent_143"></a>postEvent</h4> 
<br> 
<p>åœ¨ä¸‹é¢çš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡å¯¹<code>postEvent</code>å‡½æ•°çš„åˆ†æï¼Œæ¥è§£é‡Šä¸º<strong>ä»€ä¹ˆè¿™ä¸ªå‡½æ•°æ˜¯éé˜»å¡çš„</strong>ã€‚</p> 
<p>è®©æˆ‘ä»¬å¯¹<code>postEvent</code>å‡½æ•°è¿›è¡Œåˆ†æï¼Œä»¥ä¾¿è§£å¯†å…¶å·¥ä½œåŸç†ã€‚</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">QCoreApplication</span><span class="token double-colon punctuation">::</span><span class="token function">postEvent</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>receiver<span class="token punctuation">,</span> QEvent <span class="token operator">*</span>event<span class="token punctuation">,</span> <span class="token keyword">int</span> priority<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol><li><strong>é¦–å…ˆåˆ¤æ–­äº‹ä»¶æ¥æ”¶å¯¹è±¡æ˜¯å¦ä¸ºç©º</strong></li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">// äº‹ä»¶çš„æ¥æ”¶è€…ä¸èƒ½ä¸ºç©º</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>receiver <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">qWarning</span><span class="token punctuation">(</span><span class="token string">"QCoreApplication::postEvent: Unexpected null receiver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> event<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>å°†äº‹ä»¶æ¥æ”¶å¯¹è±¡æ‰€åœ¨çº¿ç¨‹çš„postäº‹ä»¶åˆ—è¡¨ä¸Šé”ï¼Œå¦‚æœå·²ç»è¢«é”äº†ï¼Œå°±æŠŠäº‹ä»¶åˆ é™¤æ‰ï¼Œå¹¶è¿”å›ï¼Œé˜²æ­¢æ³„éœ²ã€‚</li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">// å¯¹äº‹ä»¶æ¥å—å¯¹è±¡æ‰€åœ¨çº¿ç¨‹çš„äº‹ä»¶å¤„ç†åˆ—è¡¨ä¸Šé”</span>
<span class="token keyword">auto</span> locker <span class="token operator">=</span> <span class="token class-name">QCoreApplicationPrivate</span><span class="token double-colon punctuation">::</span><span class="token function">lockThreadPostEventList</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locker<span class="token punctuation">.</span>threadData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// posting during destruction? just delete the event to prevent a leak</span>
    <span class="token keyword">delete</span> event<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>å°†ä¸€äº›å¯ä»¥å‹ç¼©çš„äº‹ä»¶è¿›è¡Œå‹ç¼©ï¼ŒåŠå¤šä¸ªäº‹ä»¶å‹ç¼©æˆåªæ¨é€æœ€åçš„ä¸€ä¸ªäº‹ä»¶ã€‚<strong>Qtç•Œé¢çš„</strong><code>update</code><strong>å°±æ˜¯è¿™ä¸ªæ“ä½œï¼Œä¸ºäº†é˜²æ­¢å¤šæ¬¡åˆ·æ–°å¯¼è‡´å¡é¡¿ï¼ŒçŸ­æ—¶é—´å†…å¤šæ¬¡çš„è°ƒç”¨</strong><code>update</code><strong>å¯èƒ½åªä¼šåˆ·æ–°ä¸€æ¬¡</strong></li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">// if this is one of the compressible events, do compression</span>
<span class="token comment">// å°†é‡å¤çš„äº‹ä»¶ï¼Œè¿›è¡Œå‹ç¼©</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>postedEvents
    <span class="token operator">&amp;&amp;</span> self <span class="token operator">&amp;&amp;</span> self<span class="token operator">-&gt;</span><span class="token function">compressEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> receiver<span class="token punctuation">,</span> <span class="token operator">&amp;</span>data<span class="token operator">-&gt;</span>postEventList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Q_TRACE</span><span class="token punctuation">(</span>QCoreApplication_postEvent_event_compressed<span class="token punctuation">,</span> receiver<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>å°†äº‹ä»¶æ’å…¥æ¥æ”¶å¯¹è±¡<strong>æ‰€åœ¨çº¿ç¨‹çš„postäº‹ä»¶åˆ—è¡¨</strong>ä¸­ï¼Œå¹¶å”¤é†’çº¿ç¨‹çš„äº‹ä»¶è°ƒåº¦å™¨ï¼Œæ¥è¿›è¡Œäº‹ä»¶çš„å¤„ç†ã€‚æ‰€ä»¥<code>postEvent</code>æ˜¯éé˜»å¡çš„ï¼Œ<strong>å› ä¸ºå…¶åªæ˜¯æŠŠäº‹ä»¶æ’å…¥äº†çº¿ç¨‹çš„äº‹ä»¶åˆ—è¡¨ï¼Œå”¤é†’äº‹ä»¶è°ƒåº¦å™¨ä¹‹åä¾¿è¿”å›</strong>ã€‚</li></ol> 
<pre><code class="prism language-cpp">    <span class="token comment">// ...</span>

	<span class="token comment">// å°†äº‹ä»¶åŠ å…¥äº‹ä»¶é˜Ÿåˆ—</span>
    data<span class="token operator">-&gt;</span>postEventList<span class="token punctuation">.</span><span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token function">QPostEvent</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> event<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    eventDeleter<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    event<span class="token operator">-&gt;</span>posted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>postedEvents<span class="token punctuation">;</span>
    data<span class="token operator">-&gt;</span>canWait <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    locker<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// å”¤é†’äº‹ä»¶åˆ†å‘å™¨</span>
    QAbstractEventDispatcher<span class="token operator">*</span> dispatcher <span class="token operator">=</span> data<span class="token operator">-&gt;</span>eventDispatcher<span class="token punctuation">.</span><span class="token function">loadAcquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dispatcher<span class="token punctuation">)</span>
        dispatcher<span class="token operator">-&gt;</span><span class="token function">wakeUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h3><a id="_211"></a>äº‹ä»¶å¾ªç¯æ˜¯æ€ä¹ˆéå†çš„ï¼Ÿ</h3> 
<br> 
<p>åœ¨ä¸Šé¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯é€šè¿‡è·Ÿéš<code>sendEvent</code>æ¥äº†è§£äº†<strong>äº‹ä»¶å¤„ç†çš„æµç¨‹</strong>ï¼Œä½†æ˜¯<code>postEvent</code>å°†äº‹ä»¶æ’å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œäº‹ä»¶å¾ªç¯åˆæ˜¯<strong>å¦‚ä½•å»å¾ªç¯è¿è½¬</strong>çš„å‘¢ï¼Ÿ</p> 
<p>è®©æˆ‘ä»¬ä»å¸¸è§çš„<code>return a.exec()</code>å¼€å§‹ï¼Œæ·±å…¥æºç ï¼Œè¯¦ç»†äº†è§£äº‹ä»¶å¾ªç¯çš„è¿è¡Œæœºåˆ¶å§ğŸ˜¶â€ğŸŒ«ï¸ï¼</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">a</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    MainWindow w<span class="token punctuation">;</span>
    w<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ä¸Šé¢æ˜¯ä¸€ä¸ªç»å…¸çš„QtGUIç¨‹åºçš„mainå‡½æ•°ï¼Œè°ƒç”¨äº†<code>a.exec()</code></p> 
<br> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token class-name">QCoreApplication</span><span class="token double-colon punctuation">::</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
    threadData<span class="token operator">-&gt;</span>quitNow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    QEventLoop eventLoop<span class="token punctuation">;</span>
    self<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>in_exec <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    self<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>aboutToQuitEmitted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> returnCode <span class="token operator">=</span> eventLoop<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è€Œçœ‹<code>QApplication::exec</code>çš„æºç ï¼Œå®é™…ä¸Šå°±æ˜¯<strong>å¼€å¯äº†ä¸€ä¸ªäº‹ä»¶å¾ªç¯</strong>ï¼ˆ<code>QEventLoop</code>ï¼‰ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å»çœ‹<code>QEventLoop::exec</code>çš„æºç ï¼Œè¿›ä¸€æ­¥äº†è§£<strong>å¤„ç†äº‹ä»¶é˜Ÿåˆ—çš„æ­¥éª¤</strong>æ˜¯ä»€ä¹ˆã€‚<br> <br></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token class-name">QEventLoop</span><span class="token double-colon punctuation">::</span><span class="token function">exec</span><span class="token punctuation">(</span>ProcessEventsFlags flags<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token operator">-&gt;</span>exit<span class="token punctuation">.</span><span class="token function">loadAcquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">processEvents</span><span class="token punctuation">(</span>flags <span class="token operator">|</span> WaitForMoreEvents <span class="token operator">|</span> EventLoopExec<span class="token punctuation">)</span><span class="token punctuation">;</span>

    ref<span class="token punctuation">.</span>exceptionCaught <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> d<span class="token operator">-&gt;</span>returnCode<span class="token punctuation">.</span><span class="token function">loadRelaxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œ<code>QEvenLoop::exec</code>é‡Œï¼Œæ˜¯ä¸€ä¸ª<code>while</code>å¾ªç¯ï¼Œå¾ªç¯çš„å»è°ƒç”¨<code>processEvent</code>ï¼Œè€Œä¸”è®¾ç½®äº†<code>WaitForMoreEvents</code>å°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰äº‹ä»¶ï¼Œå°±é˜»å¡ç­‰å¾…ã€‚</p> 
<br> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">QCoreApplication</span><span class="token double-colon punctuation">::</span><span class="token function">processEvents</span><span class="token punctuation">(</span>QEventLoop<span class="token double-colon punctuation">::</span>ProcessEventsFlags flags<span class="token punctuation">,</span> <span class="token keyword">int</span> ms<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QThreadData <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token class-name">QThreadData</span><span class="token double-colon punctuation">::</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token operator">-&gt;</span><span class="token function">hasEventDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    QElapsedTimer start<span class="token punctuation">;</span>
    start<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>data<span class="token operator">-&gt;</span>eventDispatcher<span class="token punctuation">.</span><span class="token function">loadRelaxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">processEvents</span><span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> <span class="token operator">~</span>QEventLoop<span class="token double-colon punctuation">::</span>WaitForMoreEvents<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> ms<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>é˜…è¯»<code>processEvent</code>ï¼Œå…¶è°ƒç”¨äº†çº¿ç¨‹çš„äº‹ä»¶è°ƒåº¦å™¨<code>QAbstrctEventDispatcher</code>ï¼Œè€Œè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ï¼Œæ ¹æ®ä¸åŒçš„å¹³å°ï¼Œæœ‰ä¸åŒçš„å®ç°ï¼Œæˆ‘ä»¬ä»¥windowsä¸‹(<code>QEventDispatcherWin32</code>)çš„ä¸ºä¾‹ï¼Œæ¥ç€åˆ†æäº‹ä»¶å¤„ç†çš„æµç¨‹ã€‚<br> <br></p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">QEventDispatcherWin32</span><span class="token double-colon punctuation">::</span><span class="token function">processEvents</span><span class="token punctuation">(</span>QEventLoop<span class="token double-colon punctuation">::</span>ProcessEventsFlags flags<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">Q_D</span><span class="token punctuation">(</span>QEventDispatcherWin32<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment">// To prevent livelocks, send posted events once per iteration.</span>
    <span class="token comment">// QCoreApplication::sendPostedEvents() takes care about recursions.</span>
    <span class="token function">sendPostedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">QEventDispatcherWin32</span><span class="token double-colon punctuation">::</span><span class="token function">sendPostedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">Q_D</span><span class="token punctuation">(</span>QEventDispatcherWin32<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token operator">-&gt;</span>sendPostedEventsTimerId <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">KillTimer</span><span class="token punctuation">(</span>d<span class="token operator">-&gt;</span>internalHwnd<span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>sendPostedEventsTimerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    d<span class="token operator">-&gt;</span>sendPostedEventsTimerId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// Allow posting WM_QT_SENDPOSTEDEVENTS message.</span>
    d<span class="token operator">-&gt;</span>wakeUps<span class="token punctuation">.</span><span class="token function">storeRelaxed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">QCoreApplicationPrivate</span><span class="token double-colon punctuation">::</span><span class="token function">sendPostedEvents</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>threadData<span class="token punctuation">.</span><span class="token function">loadRelaxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹ä»¶è°ƒåº¦å™¨å…œå…œè½¬è½¬æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†<code>QCoreApplication</code>çš„<code>sendPostEvents</code><br> <br></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">QCoreApplicationPrivate</span><span class="token double-colon punctuation">::</span><span class="token function">sendPostedEvents</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>receiver<span class="token punctuation">,</span> <span class="token keyword">int</span> event_type<span class="token punctuation">,</span>
                                               QThreadData <span class="token operator">*</span>data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// ...</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>receiver <span class="token operator">&amp;&amp;</span> receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>threadData <span class="token operator">!=</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">qWarning</span><span class="token punctuation">(</span><span class="token string">"QCoreApplication::sendPostedEvents: Cannot send "</span>
                 <span class="token string">"posted events for objects in another thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> data<span class="token operator">-&gt;</span>postEventList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token comment">// first, we diddle the event so that we can deliver</span>
        <span class="token comment">// it, and that no one will try to touch it later.</span>
        pe<span class="token punctuation">.</span>event<span class="token operator">-&gt;</span>posted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        QEvent <span class="token operator">*</span>e <span class="token operator">=</span> pe<span class="token punctuation">.</span>event<span class="token punctuation">;</span>
        QObject <span class="token operator">*</span> r <span class="token operator">=</span> pe<span class="token punctuation">.</span>receiver<span class="token punctuation">;</span>

        <span class="token operator">--</span>r<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>postedEvents<span class="token punctuation">;</span>
        <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>r<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>postedEvents <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// next, update the data structure so that we're ready</span>
        <span class="token comment">// for the next event.</span>
        <span class="token generic-function"><span class="token function">const_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>QPostEvent <span class="token operator">&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pe<span class="token punctuation">)</span><span class="token punctuation">.</span>event <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

        locker<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> relocker <span class="token operator">=</span> <span class="token function">qScopeGuard</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>locker<span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> locker<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        QScopedPointer<span class="token operator">&lt;</span>QEvent<span class="token operator">&gt;</span> <span class="token function">event_deleter</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// will delete the event (with the mutex unlocked)</span>

        <span class="token comment">// after all that work, it's time to deliver the event.</span>
        <span class="token class-name">QCoreApplication</span><span class="token double-colon punctuation">::</span><span class="token function">sendEvent</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// careful when adding anything below this point - the</span>
        <span class="token comment">// sendEvent() call might invalidate any invariants this</span>
        <span class="token comment">// function depends on.</span>
    <span class="token punctuation">}</span>

    cleanup<span class="token punctuation">.</span>exceptionCaught <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçš„åˆ†å—åˆ†æï¼š</p> 
<ol><li>åˆ¤æ–­æ˜¯å¦åœ¨ä¸€ä¸ªçº¿ç¨‹</li></ol> 
<pre><code class="prism language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span>receiver <span class="token operator">&amp;&amp;</span> receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>threadData <span class="token operator">!=</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">qWarning</span><span class="token punctuation">(</span><span class="token string">"QCoreApplication::sendPostedEvents: Cannot send "</span>
             <span class="token string">"posted events for objects in another thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<br> 
<ol start="2"><li>å°†äº‹ä»¶å‘é€å‡ºå»(<code>sendEvent</code>)</li></ol> 
<pre><code class="prism language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> data<span class="token operator">-&gt;</span>postEventList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token comment">// first, we diddle the event so that we can deliver</span>
        <span class="token comment">// it, and that no one will try to touch it later.</span>
        pe<span class="token punctuation">.</span>event<span class="token operator">-&gt;</span>posted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        QEvent <span class="token operator">*</span>e <span class="token operator">=</span> pe<span class="token punctuation">.</span>event<span class="token punctuation">;</span>
        QObject <span class="token operator">*</span> r <span class="token operator">=</span> pe<span class="token punctuation">.</span>receiver<span class="token punctuation">;</span>

        <span class="token operator">--</span>r<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>postedEvents<span class="token punctuation">;</span>
        <span class="token function">Q_ASSERT</span><span class="token punctuation">(</span>r<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>postedEvents <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// next, update the data structure so that we're ready</span>
        <span class="token comment">// for the next event.</span>
        <span class="token generic-function"><span class="token function">const_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>QPostEvent <span class="token operator">&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pe<span class="token punctuation">)</span><span class="token punctuation">.</span>event <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

        locker<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> relocker <span class="token operator">=</span> <span class="token function">qScopeGuard</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>locker<span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> locker<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        QScopedPointer<span class="token operator">&lt;</span>QEvent<span class="token operator">&gt;</span> <span class="token function">event_deleter</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// will delete the event (with the mutex unlocked)</span>

        <span class="token comment">// after all that work, it's time to deliver the event.</span>
        <span class="token class-name">QCoreApplication</span><span class="token double-colon punctuation">::</span><span class="token function">sendEvent</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// careful when adding anything below this point - the</span>
        <span class="token comment">// sendEvent() call might invalidate any invariants this</span>
        <span class="token comment">// function depends on.</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><br>å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒè¿˜æ˜¯<strong>è°ƒç”¨</strong><code>sendEvent</code><strong>å°†äº‹ä»¶å‘é€å‡ºå»</strong>ï¼Œè€Œå‰é¢æˆ‘ä»¬å¯¹<code>sendEvent</code>çš„æºç åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<strong>äº‹ä»¶å…ˆæ˜¯ç»è¿‡äº‹ä»¶è¿‡æ»¤å™¨ï¼Œå†ç»è¿‡å¯¹è±¡çš„eventå‡½æ•°ï¼Œæ¥è¿›è¡Œäº‹ä»¶çš„å¤„ç†</strong>ã€‚</p> 
<p>æ‰€ä»¥ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»ï¼š<strong>äº‹ä»¶è¿‡æ»¤å™¨</strong></p> 
<h3><a id="_415"></a>äº‹ä»¶è¿‡æ»¤å™¨</h3> 
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸è¦å°†æŸä¸€ä¸ªçª—å£éƒ¨ä»¶çš„æŸä¸ªäº‹ä»¶å¦‚é¼ æ ‡æ»‘è½®æ»šåŠ¨æ‹¦æˆªï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ“ä½œã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°<strong>äº‹ä»¶è¿‡æ»¤å™¨(</strong><code>EventFilter</code>**) **</p> 
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±ç¼–å†™ä¸€ä¸ª<code>eventFilter</code>å‡½æ•°ï¼Œ</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">Class</span><span class="token double-colon punctuation">::</span><span class="token function">eventFilter</span><span class="token punctuation">(</span>QObject<span class="token operator">*</span> watcher<span class="token punctuation">,</span> QEvent<span class="token operator">*</span> event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//ä»¥è¿‡æ»¤é¼ æ ‡æ»šè½®äº‹ä»¶ä¸ºä¾‹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>object <span class="token operator">==</span> m_watcherObject <span class="token operator">&amp;&amp;</span> event<span class="token operator">-&gt;</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> QEvent<span class="token double-colon punctuation">::</span>Wheel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">// do something</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>       
    <span class="token punctuation">}</span>

    <span class="token class-name">QWidget</span><span class="token double-colon punctuation">::</span><span class="token function">eventFilter</span><span class="token punctuation">(</span>watcher<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<br> 
<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¦æ‹¦æˆªçš„æŸä¸ªçª—å£éƒ¨ä»¶ï¼Œå®‰è£…äº‹ä»¶è¿‡æ»¤å™¨</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">Class</span><span class="token double-colon punctuation">::</span><span class="token function">initUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	QWidget<span class="token operator">*</span> m_watcherObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QWidget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¸ºå¯¹è±¡å®‰è£…ä¸€ä¸ªäº‹ä»¶è¿‡æ»¤å™¨</span>
	m_watcherObject<span class="token operator">-&gt;</span><span class="token function">installEventFilterr</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">initUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<p>é‚£ä¹ˆä¸€ä¸ªå¯¹è±¡å®‰è£…çš„å¤šä¸ªäº‹ä»¶è¿‡æ»¤å™¨ï¼Œä¼šä»¥ä»€ä¹ˆæ ·çš„é¡ºåºè§¦å‘å‘¢ï¼Ÿæˆ‘ä»¬åœ¨å¸®åŠ©æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°ï¼š<br><br> <strong>åå®‰è£…çš„äº‹ä»¶è¿‡æ»¤å™¨ä¼šå…ˆè§¦å‘</strong><br><br> è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æºç é‡Œå¾—åˆ°ä½è¯:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">installEventFilter</span><span class="token punctuation">(</span>QObject <span class="token operator">*</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">Q_D</span><span class="token punctuation">(</span>QObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token operator">-&gt;</span>threadData <span class="token operator">!=</span> obj<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>threadData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">qWarning</span><span class="token punctuation">(</span><span class="token string">"QObject::installEventFilter(): Cannot filter events for objects in a different thread."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token operator">-&gt;</span>extraData<span class="token punctuation">)</span>
        d<span class="token operator">-&gt;</span>extraData <span class="token operator">=</span> <span class="token keyword">new</span> QObjectPrivate<span class="token double-colon punctuation">::</span>ExtraData<span class="token punctuation">;</span>

    <span class="token comment">// clean up unused items in the list</span>
    d<span class="token operator">-&gt;</span>extraData<span class="token operator">-&gt;</span>eventFilters<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span>QObject<span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    d<span class="token operator">-&gt;</span>extraData<span class="token operator">-&gt;</span>eventFilters<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    d<span class="token operator">-&gt;</span>extraData<span class="token operator">-&gt;</span>eventFilters<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼Œäº‹ä»¶è¿‡æ»¤å™¨ï¼Œæ˜¯ä»¥<code>prepend</code>çš„å½¢å¼è¢«æ·»åŠ è¿›äº‹ä»¶è¿‡æ»¤å™¨åˆ—è¡¨çš„ã€‚<br> <br></p> 
<p>åœ¨<code>QCoreApplicationPrivate::sendThroughObjectEventFilters</code>ä¸­ï¼Œåˆ™æ˜¯éå†äº‹ä»¶è¿‡æ»¤å™¨åˆ—è¡¨ã€‚</p> 
<pre><code class="prism language-cpp">
    <span class="token keyword">if</span> <span class="token punctuation">(</span>receiver <span class="token operator">!=</span> <span class="token class-name">QCoreApplication</span><span class="token double-colon punctuation">::</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>extraData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>extraData<span class="token operator">-&gt;</span>eventFilters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            QObject <span class="token operator">*</span>obj <span class="token operator">=</span> receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>extraData<span class="token operator">-&gt;</span>eventFilters<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>threadData <span class="token operator">!=</span> receiver<span class="token operator">-&gt;</span><span class="token function">d_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>threadData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">qWarning</span><span class="token punctuation">(</span><span class="token string">"QCoreApplication: Object event filter cannot be in a different thread."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token operator">-&gt;</span><span class="token function">eventFilter</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<p>é‚£ä¹ˆï¼Œå½“æœ‰é¼ æ ‡æ»šè½®äº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>sendEvent</code>ä¼šå…ˆèµ°åˆ°äº‹ä»¶è¿‡æ»¤å™¨é‡Œ**ï¼Œå¦‚æœ**<code>eventFilter</code><strong>è¿”å›ä¸€ä¸ªtrueï¼Œé‚£ä¹ˆäº‹ä»¶å°±ä¸ä¼šè¢«ç»§ç»­æ´¾å‘ï¼Œå¦åˆ™ï¼Œå°†ä¼šå°†äº‹ä»¶å‘é€åˆ°å…¶ä»–çš„äº‹ä»¶è¿‡æ»¤å™¨é‡Œè¿›è¡Œå¤„ç†ï¼Œå¦‚æœå…¶ä»–çš„äº‹ä»¶è¿‡æ»¤å™¨å‡å¯¹è¯¥äº‹ä»¶ä¸è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆäº‹ä»¶å°†ä¼šç»§ç»­å¾€ä¸‹æ´¾å‘ï¼Œèµ°åˆ°äº‹ä»¶çš„å¤„ç†å‡½æ•°</strong><code>event</code><br> <br></p> 
<h3><a id="_499"></a>å¤¹å¸¦ç§è´§æ—¶é—´</h3> 
<ol><li>ä¹‹å‰æœ‰è¯´åˆ°<code>processEvent</code>ï¼Œæ·»åŠ ä¸€ä¸ªå°ç»éªŒã€‚å½“æˆ‘ä»¬æœ‰æ—¶å€™ä¸å¾—ä¸åœ¨ä¸»çº¿ç¨‹å¾ªç¯æ‰§è¡Œå¾ˆè€—æ—¶çš„æ“ä½œçš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç•Œé¢å°±ä¼šåˆ·æ–°ä¸è¿‡æ¥ï¼Œå°±ä¼šå¯¼è‡´ç•Œé¢å¡é¡¿ï¼Œå½±å“ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå¾ªç¯é‡Œï¼Œæ‰‹åŠ¨è°ƒç”¨<code>qApp-&gt;processEvent()</code>ï¼Œè¿™æ ·å°±å¯ä»¥<strong>æ‰‹åŠ¨è°ƒç”¨å¤„ç†æ‰æ‰€æœ‰çš„äº‹ä»¶ï¼Œå°±å¯ä»¥è§£å†³å¡é¡¿çš„é—®é¢˜</strong>ã€‚</li></ol> 
<br> 
<blockquote> 
 <p>åˆ›ä½œä¸æ˜“ï¼Œå¦‚æœå¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œç‚¹èµã€å…³æ³¨ã€æ”¶è—æ”¯æŒä¸€ä¸‹ï¼ä¸ç”šæ„Ÿæ¿€ï¼ğŸ˜Š</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7f8e1576ccad1679b07a82c0fb8af2d8/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">mysqlæŸ¥è¯¢ç»“æœè¿”å›e9</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a3988b3d4df10e11c42f3cc7e26bd76/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">mysqlæ›´æ–°å…³è”å­—æ®µé—®é¢˜</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹ä¸­å›½çš„åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>