<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MYSQL：事务 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MYSQL：事务" />
<meta property="og:description" content="事务 理解事务事务操作案例事务的特性事务的隔离级别事务的隔离级别-操作 在MySQL中的事务（Transaction）是由存储引擎实现的，在MySQL中，只有InnoDB存储引擎才支持事务。事务处理可以用来维护数据库的完整性，保证成批的 SQL 语句要么全部执行，要么全部不执行。事务用来管理 DDL、DML、DCL 操作，比如 insert,update,delete 语句，默认是自动提交的。 理解事务 事务相当于一些操作的集合，这些操作要么全都完成，要么全都不完成。
在银行转账时，必须保证转账绝对安全，这时需要事务参与:
update account set money = money - 200 where id = 1; update account set money = money &#43; 200 where id = 2; 一个人给另一个人转账，那么转账人的金额必须减少，被转账人的金额必须增加，两件事是捆绑在一起的。
假如在第一次update之后，出现了意外、异常，没有执行第二次update，这时转账是否会出现异常？
所以事务就是用来保证数据安全的一个重要举措。
事务操作 ​ 1、开启事务：Start Transaction
任何一条DML语句(insert、update、delete)执行，标志事务的开启
命令：BEGIN 或 START TRANSACTION
2、提交事务：Commit Transaction
成功的结束，将所有的DML语句操作历史记录和底层硬盘数据来一次同步，如果没有提交，会发现内存的数据发生改变，但硬盘内的数据不变。
命令：COMMIT
​ 3、回滚事务：Rollback Transaction
失败的结束，将所有的DML语句操作历史记录全部清空命令：ROLLBACK 之前的所有SQL操作其实也有事务，只是MySQL自动帮我们完成的，每执行一条SQL时MySQL就帮我们自动提交事务，因此如果想要手动控制事务，则必须关闭MySQL的事务自动提交。
在MySQL中直接用 SET 来改变 MySQL 的自动提交模式:
set autocommit=0 -- 禁止自动提交 set autocommit=1 -- 开启自动提交 案例 create database if not exists mydb12_transcation; use mydb12_transcation; -- 创建账户表 create table account( id int primary key, -- 账户id name varchar(20), -- 账户名 money double -- 金额 ); -- 插入数据 insert into account values(1,&#39;zhangsan&#39;,1000); insert into account values(2,&#39;lisi&#39;,1000); -- 设置MySQL的事务为手动提交(关闭自动提交) select @@autocommit; set autocommit = 0; -- 模拟账户转账 -- 开启事务 begin; update account set money = money - 200 where name = &#39;zhangsan&#39;; update account set money = money &#43; 200 where name = &#39;lisi&#39;; -- 提交事务 commit; -- 如果转账中的任何一条出现问题，则回滚事务 ,这个要和jdbc结合才能使用 rollback; 事务的特性 [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-lBWWRT3W-1642841655898)(C:/Users/ruisen/AppData/Roaming/Typora/typora-user-images/image-20220122161452268." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/735630b4f1e0ba453d3b5414a2c2d1ff/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-22T16:56:45+08:00" />
<meta property="article:modified_time" content="2022-01-22T16:56:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MYSQL：事务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>事务</h4> 
 <ul><li><ul><li><ul><li><a href="#_5" rel="nofollow">理解事务</a></li><li><a href="#_22" rel="nofollow">事务操作</a></li><li><a href="#_51" rel="nofollow">案例</a></li><li><a href="#_86" rel="nofollow">事务的特性</a></li><li><a href="#_90" rel="nofollow">事务的隔离级别</a></li><li><a href="#_115" rel="nofollow">事务的隔离级别-操作</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<ul><li>在MySQL中的事务（Transaction）是由存储引擎实现的，在MySQL中，只有InnoDB存储引擎才支持事务。</li><li>事务处理可以用来维护数据库的完整性，保证成批的 SQL 语句要么全部执行，要么全部不执行。</li><li>事务用来管理 DDL、DML、DCL 操作，比如 insert,update,delete 语句，默认是自动提交的。</li></ul> 
<h4><a id="_5"></a>理解事务</h4> 
<p>事务相当于一些操作的集合，这些操作要么全都完成，要么全都不完成。</p> 
<p>在银行转账时，必须保证转账绝对安全，这时需要事务参与:</p> 
<pre><code class="prism language-mysql">update account set money = money - 200 where id = 1; 
update account set money = money + 200 where id = 2;
</code></pre> 
<p>一个人给另一个人转账，那么转账人的金额必须减少，被转账人的金额必须增加，两件事是捆绑在一起的。</p> 
<p>假如在第一次update之后，出现了意外、异常，没有执行第二次update，这时转账是否会出现异常？</p> 
<p>所以事务就是用来保证数据安全的一个重要举措。</p> 
<h4><a id="_22"></a>事务操作</h4> 
<p>​ 1、开启事务：Start Transaction</p> 
<ul><li> <p>任何一条DML语句(insert、update、delete)执行，标志事务的开启</p> </li><li> <p>命令：BEGIN 或 START TRANSACTION</p> <p>2、提交事务：Commit Transaction</p> </li><li> <p>成功的结束，将所有的DML语句操作历史记录和底层硬盘数据来一次同步，如果没有提交，会发现内存的数据发生改变，但硬盘内的数据不变。</p> </li><li> <p>命令：COMMIT</p> </li></ul> 
<p>​ 3、回滚事务：Rollback Transaction</p> 
<ul><li>失败的结束，将所有的DML语句操作历史记录全部清空</li><li>命令：ROLLBACK</li></ul> 
<p>之前的所有SQL操作其实也有事务，只是MySQL自动帮我们完成的，每执行一条SQL时MySQL就帮我们自动提交事务，因此如果想要手动控制事务，则必须关闭MySQL的事务自动提交。</p> 
<p>在MySQL中直接用 SET 来改变 MySQL 的自动提交模式:</p> 
<pre><code class="prism language-mysql">set autocommit=0 -- 禁止自动提交 
set autocommit=1 -- 开启自动提交 
</code></pre> 
<h4><a id="_51"></a>案例</h4> 
<pre><code class="prism language-mysql">create database if not exists mydb12_transcation;
use mydb12_transcation;
-- 创建账户表
create table account(
    id int primary key, -- 账户id
    name varchar(20), -- 账户名
    money double -- 金额
);
 
--  插入数据
insert into account values(1,'zhangsan',1000);
insert into account values(2,'lisi',1000);
 
 -- 设置MySQL的事务为手动提交(关闭自动提交)
select @@autocommit;
set autocommit = 0;
 
-- 模拟账户转账
-- 开启事务 
begin;
update account set money = money - 200 where name = 'zhangsan';
update account set money = money + 200 where name = 'lisi';
-- 提交事务
commit;
 
 
-- 如果转账中的任何一条出现问题，则回滚事务 ,这个要和jdbc结合才能使用
rollback;
</code></pre> 
<h4><a id="_86"></a>事务的特性</h4> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-lBWWRT3W-1642841655898)(C:/Users/ruisen/AppData/Roaming/Typora/typora-user-images/image-20220122161452268.png)]</p> 
<h4><a id="_90"></a>事务的隔离级别</h4> 
<p>Isolate，顾名思义就是将事务与另一个事务隔离开，为什么要隔离呢？如果一个事务正在操作的数据被另一个事务修改或删除了，最后的执行结果可能无法达到预期。如果没有隔离性还会导致其他问题。</p> 
<ul><li><strong>读未提交(Read uncommitted)</strong></li></ul> 
<p>一个事务可以读取另一个未提交事务的数据，最低级别，任何情况都无法保证,会造成脏读。A事务读取到B事务没有提交的数据。（别的事务别没结束就去使用，比如别人取钱每次取一百取多次，你读到的钱是取钱之前某个中间点的钱，会造成脏读）</p> 
<ul><li><strong>读已提交(Read committed)</strong></li></ul> 
<p>一个事务要等另一个事务提交后才能读取数据，可避免脏读的发生，会造成不可重复读。A事务提交之前，读到的B事务操作数据是不同的。（别人取钱每次取一百，我读到的都是原始的钱数，也就是取钱之前的钱数，当他取钱结束之后，我就可以读到取完钱之后的钱数）</p> 
<ul><li><strong>可重复读(Repeatable read)</strong></li></ul> 
<p>就是在开始读取数据（事务开启）时，不再允许修改操作，可避免脏读、不可重复读的发生，但是会造成幻读。A事务在提交之前和提交之后看到的数据不一致。（别人取钱每次取一百，我读到的都是取钱之前的钱数，当取钱结束之后，我得到的还是取钱之前的钱数，只有我自己的这个事务无法查询到取完钱之后的数据，必须提交我自己的这个事务后才能查询的到）</p> 
<ul><li><strong>串行(Serializable)</strong></li></ul> 
<p>是最高的事务隔离级别，在该级别下，事务串行化顺序执行，可以避免脏读、不可重复读与幻读。但是这种事务隔离级别效率低下，比较耗数据库性能，一般不使用。（你在取钱的时候，我无法读到你的数据，无论是取钱之前还是取钱之后，必须在你的事务提交完之后我才能查询的到。是一种锁机制）</p> 
<p><mark>Mysql的默认隔离级别是Repeatable read。</mark></p> 
<p><img src="https://images2.imgbox.com/b3/17/B654GnV5_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_115"></a>事务的隔离级别-操作</h4> 
<pre><code class="prism language-mysql">-- 查看隔离级别 
show variables like '%isolation%’; 

-- 设置隔离级别
/*
set session transaction isolation level 级别字符串
级别字符串：read uncommitted、read committed、repeatable read、serializable
*/
-- 设置read uncommitted
set session transaction isolation level read uncommitted;
 
-- 设置read committed
set session transaction isolation level read committed;
 
-- 设置repeatable read
set session transaction isolation level repeatable read;
 
-- 设置serializable
set session transaction isolation level serializable;
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/77ef0f0ab907bbea15832b8e1a013bf5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">c# 实体类的克隆（复制）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/280d9fa7c3461631cdec1b2117e6d562/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python-socket模块网络编程基本使用（TCP和UDP协议）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>