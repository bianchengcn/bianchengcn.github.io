<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>若依微服务版集成滑动验证码AJ-Captcha - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="若依微服务版集成滑动验证码AJ-Captcha" />
<meta property="og:description" content="1.将ruoyi-captcha 复制到 ruoyi-modules下
并在 ruoyi-modules 的 pom.xml中增加 ruoyi-captcha
2.配置nacos，在gateway的配置文件中增加
滑动验证码 - id: ruoyi-captcha uri: lb://ruoyi-captcha predicates: - Path=/captcha/** filters: - StripPrefix=1 并且 - /captcha/get - /captcha/check - /captcha/verify 增加白名单 关闭原来的验证码校验 设置为false
3.前端
下载后打开ruoyi-vue \集成aj-captcha实现滑块验证码
在ruoyi-ui终端安装 npm install crypto-js --save-dev
再按照目录结构，把 api\login.js替换，views/login.vue替换，静态资源和组件复制进去就ok了
文件地址：
链接：https://pan.baidu.com/s/1GR4X8Y3LYvfCRUh_GDOIbQ?pwd=mku3
提取码：mku3
测试中发现滑动验证码如果使用redis存储会出现
CaptchaCacheServiceRedisImpl内的StringRedisTemplate无法注入
需要将AJ-Captcha的依赖版本1.2.7更改为1.3.0
并且将redis的引入更改为
private static final StringRedisTemplate stringRedisTemplate = SpringUtils
.getBean(“stringRedisTemplate”);
package com.carbon.common.core.utils; import org.springframework.aop.framework.AopContext; import org.springframework.beans.BeansException; import org.springframework.beans.factory.NoSuchBeanDefinitionException; import org.springframework.beans.factory.config.BeanFactoryPostProcessor; import org.springframework.beans.factory.config.ConfigurableListableBeanFactory; import org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/b7cb7bab7ea92caa43ba93cc5e843f87/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-13T15:14:22+08:00" />
<meta property="article:modified_time" content="2023-02-13T15:14:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">若依微服务版集成滑动验证码AJ-Captcha</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>1.将ruoyi-captcha 复制到 ruoyi-modules下<br> <img src="https://images2.imgbox.com/f6/71/0uRiWQu5_o.png" alt="在这里插入图片描述"><br> 并在 ruoyi-modules 的 pom.xml中增加 ruoyi-captcha<br> 2.配置nacos，在gateway的配置文件中增加</p> 
<h2><a id="_4"></a>滑动验证码</h2> 
<pre><code class="prism language-yaml">   <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ruoyi<span class="token punctuation">-</span>captcha
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//ruoyi<span class="token punctuation">-</span>captcha
      <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/captcha/<span class="token important">**</span>
      <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> StripPrefix=1    
</code></pre> 
<pre><code>并且   
	- /captcha/get
    - /captcha/check
    - /captcha/verify
 增加白名单
</code></pre> 
<p><img src="https://images2.imgbox.com/e5/31/cLLoFlF1_o.png" alt="在这里插入图片描述"><br> 关闭原来的验证码校验 设置为false<br> <img src="https://images2.imgbox.com/58/d0/mIo85h8p_o.png" alt="在这里插入图片描述"></p> 
<p>3.前端<br> 下载后打开ruoyi-vue \集成aj-captcha实现滑块验证码<br> 在ruoyi-ui终端安装 npm install crypto-js --save-dev<br> 再按照目录结构，把 api\login.js替换，views/login.vue替换，静态资源和组件复制进去就ok了</p> 
<p>文件地址：<br> 链接：<a href="https://pan.baidu.com/s/1GR4X8Y3LYvfCRUh_GDOIbQ?pwd=mku3" rel="nofollow">https://pan.baidu.com/s/1GR4X8Y3LYvfCRUh_GDOIbQ?pwd=mku3</a><br> 提取码：<code>mku3</code></p> 
<p>测试中发现滑动验证码如果使用redis存储会出现<br> CaptchaCacheServiceRedisImpl内的StringRedisTemplate无法注入<br> 需要将AJ-Captcha的依赖版本1.2.7更改为1.3.0<br> 并且将redis的引入更改为<br> private static final StringRedisTemplate stringRedisTemplate = SpringUtils<br> .getBean(“stringRedisTemplate”);</p> 
<pre><code class="prism language-yaml">package com.carbon.common.core.utils;

import org.springframework.aop.framework.AopContext;
import org.springframework.beans.BeansException;
import org.springframework.beans.factory.NoSuchBeanDefinitionException;
import org.springframework.beans.factory.config.BeanFactoryPostProcessor;
import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;
import org.springframework.stereotype.Component;

/<span class="token important">**</span>
 * spring工具类 方便在非spring管理环境中获取bean
 * 
 <span class="token important">*/</span>
@Component
public final class SpringUtils implements BeanFactoryPostProcessor
<span class="token punctuation">{<!-- --></span>
    /<span class="token important">**</span> Spring应用上下文环境 <span class="token important">*/</span>
    private static ConfigurableListableBeanFactory beanFactory;

    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException
    <span class="token punctuation">{<!-- --></span>
        SpringUtils.beanFactory = beanFactory;
    <span class="token punctuation">}</span>

    /<span class="token important">**</span>
     * 获取对象
     *
     * @param name
     * @return Object 一个以所给名字注册的bean的实例
     * @throws org.springframework.beans.BeansException
     *
     <span class="token important">*/</span>
    @SuppressWarnings("unchecked")
    public static &lt;T<span class="token punctuation">&gt;</span> T getBean(String name) throws BeansException
    <span class="token punctuation">{<!-- --></span>
        return (T) beanFactory.getBean(name);
    <span class="token punctuation">}</span>

    /<span class="token important">**</span>
     * 获取类型为requiredType的对象
     *
     * @param clz
     * @return
     * @throws org.springframework.beans.BeansException
     *
     <span class="token important">*/</span>
    public static &lt;T<span class="token punctuation">&gt;</span> T getBean(Class&lt;T<span class="token punctuation">&gt;</span> clz) throws BeansException
    <span class="token punctuation">{<!-- --></span>
        T result = (T) beanFactory.getBean(clz);
        return result;
    <span class="token punctuation">}</span>

    /<span class="token important">**</span>
     * 如果BeanFactory包含一个与所给名称匹配的bean定义，则返回true
     *
     * @param name
     * @return boolean
     <span class="token important">*/</span>
    public static boolean containsBean(String name)
    <span class="token punctuation">{<!-- --></span>
        return beanFactory.containsBean(name);
    <span class="token punctuation">}</span>

    /<span class="token important">**</span>
     * 判断以给定名字注册的bean定义是一个singleton还是一个prototype。 如果与给定名字相应的bean定义没有被找到，将会抛出一个异常（NoSuchBeanDefinitionException）
     *
     * @param name
     * @return boolean
     * @throws org.springframework.beans.factory.NoSuchBeanDefinitionException
     *
     <span class="token important">*/</span>
    public static boolean isSingleton(String name) throws NoSuchBeanDefinitionException
    <span class="token punctuation">{<!-- --></span>
        return beanFactory.isSingleton(name);
    <span class="token punctuation">}</span>

    /<span class="token important">**</span>
     * @param name
     * @return Class 注册对象的类型
     * @throws org.springframework.beans.factory.NoSuchBeanDefinitionException
     *
     <span class="token important">*/</span>
    public static Class&lt;<span class="token punctuation">?</span><span class="token punctuation">&gt;</span> getType(String name) throws NoSuchBeanDefinitionException
    <span class="token punctuation">{<!-- --></span>
        return beanFactory.getType(name);
    <span class="token punctuation">}</span>

    /<span class="token important">**</span>
     * 如果给定的bean名字在bean定义中有别名，则返回这些别名
     *
     * @param name
     * @return
     * @throws org.springframework.beans.factory.NoSuchBeanDefinitionException
     *
     <span class="token important">*/</span>
    public static String<span class="token punctuation">[</span><span class="token punctuation">]</span> getAliases(String name) throws NoSuchBeanDefinitionException
    <span class="token punctuation">{<!-- --></span>
        return beanFactory.getAliases(name);
    <span class="token punctuation">}</span>

    /<span class="token important">**</span>
     * 获取aop代理对象
     * 
     * @param invoker
     * @return
     <span class="token important">*/</span>
    @SuppressWarnings("unchecked")
    public static &lt;T<span class="token punctuation">&gt;</span> T getAopProxy(T invoker)
    <span class="token punctuation">{<!-- --></span>
        return (T) AopContext.currentProxy();
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cb7d720cf3b5a9b5e099da22149f50b9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java基础—Volatile关键字详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/178b35ad45cb5198c9704aec7d056853/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">hive的特殊函数named_struct、inline及特殊类型map＜string, array＜string＞＞</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>