<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3&#43;vite&#43;ts实现qiankun微前端子应用 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3&#43;vite&#43;ts实现qiankun微前端子应用" />
<meta property="og:description" content="本文章只是使用vue3实现在vue2主应用程序下的子应用哈，主应用创建可以看我这篇vue2使用qiankun微前端（跟着步骤走可实现）-CSDN博客
1.项目创建 我用的pnpm创建的，看你们，具体创建项目不会的话可以网上搜下，我就不多说了
pnpm create vite@latest 或者 npm create vite@latest 2.下载qiankun的vite包 vite-plugin-qiankun 3.在main.ts文件下添加如下代码（建议复制） 记得下vue-router包，不然获取不到路由啦
import { createApp } from &#34;vue&#34;; import &#34;./style.css&#34;; import App from &#34;./App.vue&#34;; import router from &#34;./router&#34;; import { renderWithQiankun, qiankunWindow, } from &#34;vite-plugin-qiankun/dist/helper&#34;; let app: any; // 判断是否在qiankun环境下 if (!qiankunWindow.__POWERED_BY_QIANKUN__) { createApp(App).use(router).mount(&#34;#app&#34;); } else { renderWithQiankun({ // qiankun的生命周期，挂载 mount(props) { // 传递的值可以获取到了 app = createApp(App); app.use(router); app.mount( props.container ? props.container.querySelector(&#34;#app&#34;) : document.getElementById(&#34;app&#34;) ); }, // 应用加载 bootstrap() { console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/290ba8b5bb9149d7886c04fff65991e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-16T17:09:02+08:00" />
<meta property="article:modified_time" content="2024-01-16T17:09:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3&#43;vite&#43;ts实现qiankun微前端子应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p> 本文章只是使用vue3实现在vue2主应用程序下的子应用哈，主应用创建可以看我这篇<a href="https://blog.csdn.net/qq_44278289/article/details/135626348?spm=1001.2014.3001.5502" title="vue2使用qiankun微前端（跟着步骤走可实现）-CSDN博客">vue2使用qiankun微前端（跟着步骤走可实现）-CSDN博客</a></p> 
</blockquote> 
<h3>1.项目创建</h3> 
<p>我用的pnpm创建的，看你们，具体创建项目不会的话可以网上搜下，我就不多说了</p> 
<pre><code class="hljs">pnpm create vite@latest

或者

npm create vite@latest</code></pre> 
<h3>2.下载qiankun的vite包</h3> 
<pre><code class="language-javascript">vite-plugin-qiankun</code></pre> 
<h3>3.在main.ts文件下添加如下代码（建议复制）</h3> 
<p>记得下vue-router包，不然获取不到路由啦</p> 
<pre><code class="language-javascript">import { createApp } from "vue";
import "./style.css";
import App from "./App.vue";
import router from "./router";
import {
  renderWithQiankun,
  qiankunWindow,
} from "vite-plugin-qiankun/dist/helper";

let app: any;
// 判断是否在qiankun环境下
if (!qiankunWindow.__POWERED_BY_QIANKUN__) {
  createApp(App).use(router).mount("#app");
} else {
  renderWithQiankun({
    // qiankun的生命周期，挂载
    mount(props) {
      // 传递的值可以获取到了
      app = createApp(App);
      app.use(router);
      app.mount(
        props.container
          ? props.container.querySelector("#app")
          : document.getElementById("app")
      );
    },
    // 应用加载
    bootstrap() {
      console.log("--bootstrap");
    },
    // 修改
    update(props) {
      console.log("--update", props);
    },
    // 销毁
    unmount() {
      console.log("--unmount");
      app?.unmount();
    },
  });
}
</code></pre> 
<h3>4.创建2个路由页面（名字随意）</h3> 
<p><img alt="" height="225" src="https://images2.imgbox.com/aa/1e/4Xc1edNx_o.png" width="338"></p> 
<p>在router/index.ts文件下添加路由</p> 
<blockquote> 
 <p><span style="color:#fe2c24;">注意！！</span></p> 
 <p><span style="color:#fe2c24;">  // 路由模式必须改为history模式，不然不生效</span></p> 
 <p><span style="color:#fe2c24;">  history: createWebHistory(import.meta.env.BASE_URL),</span></p> 
</blockquote> 
<pre><code class="language-javascript">// 通过vue-router实现路由配置
import { createRouter, createWebHistory } from "vue-router";
// import { constantRoute } from "./routers";
const constantRoute = [
  {
    path: "/",
    component: () =&gt; import("../view/admin.vue"),
    name: "login", //命名路由做菜单权限
  },
  {
    path: "/son",
    component: () =&gt; import("../view/son.vue"),
    name: "son", //命名路由做菜单权限
  },
];
// 创建路由器
let router = createRouter({
  // 路由模式必须改为history模式，不然不生效
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: constantRoute,
  //   滚动行为
  scrollBehavior() {
    return {
      left: 0,
      top: 0,
    };
  },
});
export default router;
</code></pre> 
<h3>5.在vite.config.ts文件添加如下代码</h3> 
<blockquote> 
 <p>  activeRule: '/sub-vite',和  base: "/sub-vite", //必须和基座也就是主应用的activeRule值一致</p> 
</blockquote> 
<pre><code class="language-TypeScript">import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
import qiankun from "vite-plugin-qiankun";
// const packName = require('./package').name  // 必须要指定当前子应用命名
// https://vitejs.dev/config/
export default ({ mode }) =&gt; {
  return defineConfig({
    base: "/sub-vite", //必须和基座也就是主应用的activeRule值一致
    server: {
      port: 3002, //端口号
      cors: true,
      origin: "http://localhost:3002", //运行地址
      headers: {
        "Access-Control-Allow-Origin": "*", //避免跨域
      },
    },
    plugins: [
      vue(),
      qiankun("sub-vite", {
        useDevMode: true,
      }),
    ],
  });
};
</code></pre> 
<p>记得在App.vue下写router-view哦</p> 
<p>运行的地址如下：<a href="http://127.0.0.1:3002/sub-vite/" rel="nofollow" title="http://127.0.0.1:3002/sub-vite/">http://127.0.0.1:3002/sub-vite/</a></p> 
<h3>7.在主应用main-app.js添加vue3的子应用 （主应用在我的上一篇，连接在最上面）</h3> 
<p>这个entry就是上面vue3运行的地址</p> 
<pre><code class="language-javascript">
const microApps = [
    {
        name: 'test', // 子应用名称
        entry: 'http://localhost:7663/', //子应用运行地址
        activeRule: '/test-web',//匹配的路由
        sanbox: true //解决css冲突
    },
    {
        name: 'sub-vite', // app name registered
        entry: 'http://127.0.0.1:3002/sub-vite/', //项目地址
        activeRule: '/sub-vite',
        sanbox: true //解决css冲突
    },
]

const apps = microApps.map(item =&gt; {
    return {
        ...item,
        container: '#test-web', // 子应用挂载的div
        props: {
            routerBase: item.activeRule // 下发基础路由
        }
    }
})

export default apps
</code></pre> 
<p>主应用的router/index.js添加如下</p> 
<pre><code class="language-javascript">import Vue from "vue";
import VueRouter from "vue-router";
import HomeView from "../views/HomeView.vue";
import layout from '../views/qiankun/index.vue'
Vue.use(VueRouter);

const routes = [
  {
    path: "/",
    name: "home",
    component: HomeView,
  },
  {
    path: "/about",
    name: "about",
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () =&gt;
      import(/* webpackChunkName: "about" */ "../views/AboutView.vue"),
  },
  {
    path: "/test-web/*",
    meta: 'test-web',
    component: layout
  },
  {
    path: "/sub-vite/*",
    meta: 'sub-vite',
    component: layout
  },
];

const router = new VueRouter({
  mode: "history",
  base: process.env.BASE_URL,
  routes,
});

export default router;</code></pre> 
<h3>8.效果<img alt="" height="302" src="https://images2.imgbox.com/04/e9/SD3Bur7q_o.gif" width="737"></h3> 
<p>文章到此结束，希望对你有所帮助~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f4d5c38540ab980c0ff6474f85e5ff4e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">渗透测试常用工具汇总_渗透测试实战</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8cbb2953b8c4e027dca49587514921fa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue2使用qiankun微前端（跟着步骤走可实现）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>