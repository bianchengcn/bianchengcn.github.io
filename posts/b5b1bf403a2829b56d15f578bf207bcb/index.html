<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>canvas&#43;fabric实现自定义封面 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="canvas&#43;fabric实现自定义封面" />
<meta property="og:description" content="&lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt; &lt;title&gt;Document&lt;/title&gt; &lt;style&gt; div { margin: 0 auto; } &lt;/style&gt; &lt;script src=&#34;http://cdnjs.cloudflare.com/ajax/libs/fabric.js/2.4.6/fabric.min.js&#34;&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;div&gt; &lt;button class=&#34;btn&#34;&gt;点击&lt;/button&gt; &lt;button class=&#34;add-text&#34;&gt;添加文案&lt;/button&gt; &lt;button class=&#34;to-base64&#34;&gt;生成图片&lt;/button&gt; &lt;canvas id=&#34;canvas&#34; width=&#34;500&#34; style=&#34;border:1px solid black&#34;&gt;&lt;/canvas&gt; &lt;/div&gt; &lt;script&gt; const btn = document.querySelector(&#39;.btn&#39;) const addText = document.querySelector(&#39;.add-text&#39;) const base64Image = document.querySelector(&#39;.to-base64&#39;) var canvas = document.getElementById(&#34;canvas&#34;) var ctx = canvas.getContext(&#39;2d&#39;); var left = 0 // 实例化 let fabricObj = new fabric." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/b5b1bf403a2829b56d15f578bf207bcb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T11:37:29+08:00" />
<meta property="article:modified_time" content="2024-01-11T11:37:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">canvas&#43;fabric实现自定义封面</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" height="513" src="https://images2.imgbox.com/72/c0/W1I9PFcd_o.png" width="519"></p> 
<pre><code class="language-javascript">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style&gt;
        div {
            margin: 0 auto;
        }
    &lt;/style&gt;
    &lt;script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/2.4.6/fabric.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div&gt;
        &lt;button class="btn"&gt;点击&lt;/button&gt;
        &lt;button class="add-text"&gt;添加文案&lt;/button&gt;
        &lt;button class="to-base64"&gt;生成图片&lt;/button&gt;
        &lt;canvas id="canvas" width="500" style="border:1px solid black"&gt;&lt;/canvas&gt;
    &lt;/div&gt;
    &lt;script&gt;
        const btn = document.querySelector('.btn')
        const addText = document.querySelector('.add-text')
        const base64Image = document.querySelector('.to-base64')
        var canvas = document.getElementById("canvas")
        var ctx = canvas.getContext('2d');
        var left = 0

        // 实例化
        let fabricObj = new fabric.Canvas('canvas')
        //  设置画布宽高  可以动态设置画布宽高，如果在标签上也设置了宽高，则会将其覆盖掉
        fabricObj.setWidth(500)
        fabricObj.setHeight(500)
        // 设置背景图
        function setBackImage() {
            function setPictureBg(src) {
                const newImg = new Image();
                newImg.src = src;
                newImg.onload = () =&gt; {
                    fabricObj.setBackgroundImage(src, fabricObj.renderAll.bind(fabricObj), {
                        scaleX: fabricObj.width / newImg.width,
                        scaleY: fabricObj.height / newImg.height,
                        crossOrigin: 'anonymous'
                    });
                };
            }
            setPictureBg('https://sput.xwabx.com/file/background/1/image_02.png')

            let num = -1
            const urls = [
                'https://fuss10.elemecdn.com/a/3f/3302e58f9a181d2509f3dc0fa68b0jpeg.jpeg',
                'https://fuss10.elemecdn.com/1/34/19aa98b1fcb2781c4fba33d850549jpeg.jpeg',
                'https://fuss10.elemecdn.com/0/6f/e35ff375812e6b0020b6b4e8f9583jpeg.jpeg',
                'https://fuss10.elemecdn.com/9/bb/e27858e973f5d7d3904835f46abbdjpeg.jpeg',
                'https://fuss10.elemecdn.com/d/e6/c4d93a3805b3ce3f323f7974e6f78jpeg.jpeg',
                'https://fuss10.elemecdn.com/3/28/bbf893f792f03a54408b3b7a7ebf0jpeg.jpeg',
                'https://fuss10.elemecdn.com/2/11/6535bcfb26e4c79b48ddde44f4b6fjpeg.jpeg',
            ]
            btn.onclick = () =&gt; {
                if (num == 6) {
                    num = -1
                }
                num++
                setPictureBg(urls[num])
            }
        }
        setBackImage()


        var count = 1
        var arr = [`text${count}`]
        function setTextBorder() {
            function setTextStyle(cur) {
                // 创建文本对象并设置相关属性
                cur = new fabric.Textbox(
                    '阿里士大夫艰苦', {
                    lineHeight: 1.2,
                    left: 5,
                    top: 40,
                    fontSize: 40,
                    fontFamily: 'HanKangLiJinhei',
                    fill: '#000',
                    stroke: 'blue', // 设置描边颜色为黑色
                    strokeWidth: 1, // 设置描边宽度为3像素
                    textAlign: 'center',
                    editable: false, // 不能编辑
                    hasControls: false, //没有控制角，只能移动操作
                    splitByGrapheme: true, //文字自动换行
                    lockScalingY: true, // 禁止Y轴伸缩
                    // lockMovementX: true //禁止横向移动

                }
                );
                // 将文本添加到画布上
                fabricObj.add(cur);
                cur.on('moving', function () {
                    movingFn(cur)
                });
            }
            setTextStyle(arr[0])

            // 添加文案
            addText.onclick = () =&gt; {
                count++
                arr.push(`text${count}`)
                setTextStyle(arr[count - 1])
            }
        }
        setTextBorder()


        // 移动操作限制
        function movingFn(currentText) {
            const { width: cWidth, height: cHeight } = canvas.style;
            const { width: fWidth, height: fHeight, left, top } = currentText;

            let isOutSide = false;
            //超出左边界
            if (left &lt; 0) {
                currentText.left = 10;
                isOutSide = true;
            }
            // 超出右边界
            if (left + fWidth &gt;= Number(cWidth.slice(0, -2))) {
                currentText.left = Number(cWidth.slice(0, -2)) - fWidth - 10;
                isOutSide = true;
            }
            // 超出上边界
            if (top &lt;= 0) {
                currentText.top = 0;
                isOutSide = true;
            }
            // 超出下边界
            if (top + fHeight &gt; Number(cHeight.slice(0, -2))) {
                currentText.top = Number(cHeight.slice(0, -2)) - fHeight - 10;
                isOutSide = true;
            }

            isOutSide &amp;&amp; fabricObj.renderAll();
        }


        base64Image.onclick = () =&gt; {
            const base64 = canvas.toDataURL({
                format: 'png',
                quality: 1
            })
            console.log(base64);
        }

        let timer
        window.onresize = () =&gt; {
            if (timer) {
                clearTimeout(timer)
            }
            timer = setTimeout(() =&gt; {
                const { innerHeight, innerWidth } = window
                let objects = fabricObj.getObjects();
                canvas.style.width = innerWidth - 100 + 'px'
                canvas.style.height = innerHeight - 100 + 'px'
                fabricObj.setWidth(canvas.style.width.slice(0, -2));
                fabricObj.setHeight(canvas.style.height.slice(0, -2));
                fabricObj.remove.apply(fabricObj, objects);
                resizeCanvasFn(objects)
                console.log(canvas.style.width);

                console.log('尺寸发生了变化');
            }, 1000)
        }

        function resizeCanvasFn(objects) {
            // 更新所有对象的位置和大小
            const { width, height } = canvas.style
            for (let i = 0; i &lt; objects.length; i++) {
                let object = objects[i];
                if (object.isType('image')) {
                    object.set({
                        left: width.slice(0, -2) - object.width * 0.5 - 22,
                        top: 10
                    });
                } else {
                    object.set({
                        left: width.slice(0, -2) * 0.5 - object.width * 0.5,
                        top: object.top &gt; height.slice(0, -2) ? height.slice(0, -2) - 40 : object.top
                    });
                }
            }
            //重新将所有对象添加到画布中;
            for (let i = 0; i &lt; objects.length; i++) {
                fabricObj.add(objects[i]);
            }
            // fabricObj.setPictureBg('https://fuss10.elemecdn.com/2/11/6535bcfb26e4c79b48ddde44f4b6fjpeg.jpeg'); ///static/img/img.2b735807.png'
            // 设置新的背景图片路径或URL
            setBackImage()
            fabricObj.renderAll();
        }
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4949a74ae1c68863bb72e339a7a6a57c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【⭐AI工具⭐】AI工具导航推荐</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d594cca4b5d08a07c72f61ba5076f57b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">el-table合计行单元格合并、合并行金额四舍五入保留两位小数、合计行样式修改</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>