<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Node.js - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Node.js" />
<meta property="og:description" content="目录 包和NPM查询字符串模块(querystring)URL模块(url)文件模块（fs）同步异步查看文件的状态（stat,statSync）检测文件是否存在（existsSync）创建文件（mkdir,mkdirSync）读目录（readdir,readdirSync）读文件（readFile,readFileSync）删除目录（rmdir,rmdirSync）删除文件（unlink,unlinkSync）清空写入（writeFile,writeFileSync）追加写入（appendFile,appendFileSync）文件流（createReadStream,createWriteStream）拷贝文件（copyFile,copyFileSync） HTTP协议HTTP模块（http）创建最基本的 web 服务器 Zlib压缩（zlib）创建压缩（createDeflate,createGzip） express框架介绍安装搭建服务器路由（响应对象，请求对象）路由传参（params）post请求路由器 中间件应用级中间件路由级中间件内置中间件 mysql模块初始化mysql普通连接mysql连接池连接mysql语句练习NPM NPX编写接口详情请看xz文件 包和NPM 查询字符串模块(querystring) //引入查询字符串模块 const querystring = require(&#39;querystring&#39;); //引入查询字符串模块 const querystring = require(&#39;querystring&#39;); let str = &#39;Kw=dell&amp;price=4999&#39;; //解析查询字符串为对象 let obj = querystring.parse(str); console.log(obj); //将对象格式化为查询字符串 const str2 = querystring.stringify(obj); console.log(str2); URL模块(url) //引入url模块 const url = require(&#39;url&#39;); //引入url模块 const url = require(&#39;url&#39;); const str = &#39;https://editor.csdn.net/md?not_checkout=1&amp;articleId=127028464&#39; //解析url为对象 let obj = url.parse(str); console.log(obj); //将对象格式转换为url const URL = { protocol: &#39;https:&#39;, slashes: true, auth: null, host: &#39;editor." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/3b2819dd4c24eda2faf2052eef449551/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-07T19:30:40+08:00" />
<meta property="article:modified_time" content="2022-10-07T19:30:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Node.js</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#NPM_2" rel="nofollow">包和NPM</a></li><li><a href="#querystring_6" rel="nofollow">查询字符串模块(querystring)</a></li><li><a href="#URLurl_26" rel="nofollow">URL模块(url)</a></li><li><a href="#fs_62" rel="nofollow">文件模块（fs）</a></li><li><ul><li><a href="#_69" rel="nofollow">同步异步</a></li><li><a href="#statstatSync_73" rel="nofollow">查看文件的状态（stat,statSync）</a></li><li><a href="#existsSync_97" rel="nofollow">检测文件是否存在（existsSync）</a></li><li><a href="#mkdirmkdirSync_101" rel="nofollow">创建文件（mkdir,mkdirSync）</a></li><li><a href="#readdirreaddirSync_118" rel="nofollow">读目录（readdir,readdirSync）</a></li><li><a href="#readFilereadFileSync_137" rel="nofollow">读文件（readFile,readFileSync）</a></li><li><a href="#rmdirrmdirSync_153" rel="nofollow">删除目录（rmdir,rmdirSync）</a></li><li><a href="#unlinkunlinkSync_173" rel="nofollow">删除文件（unlink,unlinkSync）</a></li><li><a href="#writeFilewriteFileSync_235" rel="nofollow">清空写入（writeFile,writeFileSync）</a></li><li><a href="#appendFileappendFileSync_253" rel="nofollow">追加写入（appendFile,appendFileSync）</a></li><li><a href="#createReadStreamcreateWriteStream_269" rel="nofollow">文件流（createReadStream,createWriteStream）</a></li><li><a href="#copyFilecopyFileSync_302" rel="nofollow">拷贝文件（copyFile,copyFileSync）</a></li></ul> 
  </li><li><a href="#HTTP_319" rel="nofollow">HTTP协议</a></li><li><a href="#HTTPhttp_333" rel="nofollow">HTTP模块（http）</a></li><li><ul><li><a href="#_web__348" rel="nofollow">创建最基本的 web 服务器</a></li></ul> 
  </li><li><a href="#Zlibzlib_538" rel="nofollow">Zlib压缩（zlib）</a></li><li><ul><li><a href="#createDeflatecreateGzip_539" rel="nofollow">创建压缩（createDeflate,createGzip）</a></li></ul> 
  </li><li><a href="#express_551" rel="nofollow">express框架</a></li><li><ul><li><a href="#_553" rel="nofollow">介绍</a></li><li><a href="#_557" rel="nofollow">安装</a></li><li><a href="#_569" rel="nofollow">搭建服务器</a></li><li><a href="#_580" rel="nofollow">路由（响应对象，请求对象）</a></li><li><a href="#params_616" rel="nofollow">路由传参（params）</a></li><li><a href="#post_641" rel="nofollow">post请求</a></li><li><a href="#_678" rel="nofollow">路由器</a></li></ul> 
  </li><li><a href="#_751" rel="nofollow">中间件</a></li><li><ul><li><a href="#_754" rel="nofollow">应用级中间件</a></li><li><a href="#_807" rel="nofollow">路由级中间件</a></li><li><a href="#_809" rel="nofollow">内置中间件</a></li></ul> 
  </li><li><a href="#mysql_842" rel="nofollow">mysql模块</a></li><li><ul><li><a href="#_843" rel="nofollow">初始化</a></li><li><a href="#mysql_852" rel="nofollow">mysql普通连接</a></li><li><a href="#mysql_870" rel="nofollow">mysql连接池连接</a></li><li><a href="#mysql_892" rel="nofollow">mysql语句</a></li><li><a href="#_924" rel="nofollow">练习</a></li><li><a href="#NPM_NPX_969" rel="nofollow">NPM NPX</a></li><li><a href="#_972" rel="nofollow">编写接口</a></li><li><a href="#xz_1038" rel="nofollow">详情请看xz文件</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="NPM_2"></a>包和NPM</h2> 
<p><img src="https://images2.imgbox.com/ac/57/FV8MQU0j_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="querystring_6"></a>查询字符串模块(querystring)</h2> 
<pre><code class="prism language-java"><span class="token comment">//引入查询字符串模块</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'querystring'<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ab/e5/XZCUnQWd_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//引入查询字符串模块</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'querystring'<span class="token punctuation">)</span><span class="token punctuation">;</span>
let str <span class="token operator">=</span> '<span class="token class-name">Kw</span><span class="token operator">=</span>dell<span class="token operator">&amp;</span>price<span class="token operator">=</span><span class="token number">4999</span>'<span class="token punctuation">;</span>
<span class="token comment">//解析查询字符串为对象</span>
let obj <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//将对象格式化为查询字符串</span>
<span class="token keyword">const</span> str2 <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="URLurl_26"></a>URL模块(url)</h2> 
<pre><code class="prism language-java"><span class="token comment">//引入url模块</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a0/a5/HMLEBf07_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//引入url模块</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> 'https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>editor<span class="token punctuation">.</span>csdn<span class="token punctuation">.</span>net<span class="token operator">/</span>md<span class="token operator">?</span>not_checkout<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>articleId<span class="token operator">=</span><span class="token number">127028464</span>'
    <span class="token comment">//解析url为对象</span>
let obj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//将对象格式转换为url</span>
<span class="token keyword">const</span> URL <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    protocol<span class="token operator">:</span> <span class="token char">'https:'</span><span class="token punctuation">,</span>
    slashes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    auth<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    host<span class="token operator">:</span> 'editor<span class="token punctuation">.</span>csdn<span class="token punctuation">.</span>net'<span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    hostname<span class="token operator">:</span> 'editor<span class="token punctuation">.</span>csdn<span class="token punctuation">.</span>net'<span class="token punctuation">,</span>
    hash<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    search<span class="token operator">:</span> '<span class="token operator">?</span>not_checkout<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>articleId<span class="token operator">=</span><span class="token number">127028464</span>'<span class="token punctuation">,</span>
    query<span class="token operator">:</span> 'not_checkout<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>articleId<span class="token operator">=</span><span class="token number">127028464</span>'<span class="token punctuation">,</span>
    pathname<span class="token operator">:</span> <span class="token char">'/md'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> '<span class="token operator">/</span>md<span class="token operator">?</span>not_checkout<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>articleId<span class="token operator">=</span><span class="token number">127028464</span>'<span class="token punctuation">,</span>
    href<span class="token operator">:</span> 'https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>editor<span class="token punctuation">.</span>csdn<span class="token punctuation">.</span>net<span class="token operator">/</span>md<span class="token operator">?</span>not_checkout<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>articleId<span class="token operator">=</span><span class="token number">127028464</span>'
<span class="token punctuation">}</span>

<span class="token keyword">const</span> str2 <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>URL<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="fs_62"></a>文件模块（fs）</h2> 
<pre><code class="prism language-java"><span class="token comment">//引入文件模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_69"></a>同步异步</h3> 
<p><img src="https://images2.imgbox.com/e4/8e/DJ3V6M3g_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/74/cb/JdmbNTL6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="statstatSync_73"></a>查看文件的状态（stat,statSync）</h3> 
<p><img src="https://images2.imgbox.com/b6/34/DJVXgaaV_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/64/dd/oJGD4fUc_o.png" alt="在这里插入图片描述"></p> 
<p>异步无需等待</p> 
<pre><code class="prism language-java"><span class="token comment">//引入文件模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>
    <span class="token comment">//查看文件的状态</span>
fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token char">'fs测试文件'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>同步，必须等待statSync执行完</p> 
<pre><code class="prism language-java"><span class="token comment">//引入文件模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span><span class="token char">'fs测试文件'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//true</span>
</code></pre> 
<h3><a id="existsSync_97"></a>检测文件是否存在（existsSync）</h3> 
<p><img src="https://images2.imgbox.com/d4/3b/VGt3i4q0_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/9f/bb/uxHbYDxh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="mkdirmkdirSync_101"></a>创建文件（mkdir,mkdirSync）</h3> 
<p><img src="https://images2.imgbox.com/84/5b/RjDUrw0s_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/87/61/29udh5lQ_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 创建目录 异步与同步
 */</span>

fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>'fs测试mkdir文件'<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> mkdirSyncResult <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>'fs测试mkdirSync文件'<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mkdirSyncResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="readdirreaddirSync_118"></a>读目录（readdir,readdirSync）</h3> 
<p><img src="https://images2.imgbox.com/b0/f7/xUdEKuT6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0b/87/6bxIjwPp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 读取目录 异步与同步
 */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"读取文件异步操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>'fs测试readdir文件'<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"读取文件同步操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> readResult <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>'fs测试readdir文件'<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>readResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="readFilereadFileSync_137"></a>读文件（readFile,readFileSync）</h3> 
<p><img src="https://images2.imgbox.com/67/c6/daMbqhdY_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 读取文件 异步与同步
 */</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token char">'练习.txt'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//同步代码需要转换为字符</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token char">'练习.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data2<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="rmdirrmdirSync_153"></a>删除目录（rmdir,rmdirSync）</h3> 
<p><img src="https://images2.imgbox.com/e1/e5/P4iiCpP1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/46/2f/yCVjfa0J_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 删除目录 异步与同步
 */</span>

fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span>'fs测试mkdir文件'<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"异步，我先执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rmdirSyncResult <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>'fs测试mkdirSync文件'<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rmdirSyncResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"同步，我后执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h3><a id="unlinkunlinkSync_173"></a>删除文件（unlink,unlinkSync）</h3> 
<p><img src="https://images2.imgbox.com/9c/64/oEPBUmEY_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 删除文件 异步与同步
 */</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token string">"练习.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token char">'练习.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"************************"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> link <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span><span class="token char">'练习.txt'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>删除文件，记得要拼接删除路径</p> 
<pre><code class="prism language-java"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//首先检测目录是否存在</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>'fs练习删除文件夹'<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"存在"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//目录存在读取目录下的文件,并返回一个数组</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>'fs练习删除文件夹'<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//循环删除文件</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>let index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">//这里注意此时执行目录为删除目录的上一级，需要拼接上一级目录才可删除</span>
        <span class="token keyword">const</span> err <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>'fs练习删除文件夹<span class="token operator">/</span>' <span class="token operator">+</span> arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> arr2 <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>'fs练习删除文件夹'<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>递归删除既有文件又有文件夹的文件</p> 
<pre><code class="prism language-java"><span class="token comment">//删除文件夹与文件</span>
function <span class="token function">delDir</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    let arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//读取目录下的文件</span>
        arr <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            curpath <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>curpath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">delDir</span><span class="token punctuation">(</span>curpath<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>curpath<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="writeFilewriteFileSync_235"></a>清空写入（writeFile,writeFileSync）</h3> 
<p><img src="https://images2.imgbox.com/ea/3c/tNBe3hsl_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 创建文件 异步与同步
 */</span>

fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>'fs创建文件<span class="token punctuation">.</span>txt<span class="token char">', '</span>这里是写入的内容，如果文件已存在，则替换'<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"文件写入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> fsWriteFileSync <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>'fs同步写文件<span class="token punctuation">.</span>txt<span class="token char">', '</span>如果文件中内容已存在，则将内容清空，写入'<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fsWriteFileSync<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h3><a id="appendFileappendFileSync_253"></a>追加写入（appendFile,appendFileSync）</h3> 
<p><img src="https://images2.imgbox.com/41/1a/Gn4D72h7_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 追加写入  异步与同步
 */</span>

fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>'fs追加文本<span class="token punctuation">.</span>txt<span class="token char">', '</span>追加内容，不会清空重写\n'<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"追加成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fsAppendFileSync <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">appendFileSync</span><span class="token punctuation">(</span>'fs追加文本<span class="token punctuation">.</span>txt<span class="token char">', '</span>同步追加内容'<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我是否成功了"</span> <span class="token operator">+</span> fsAppendFileSync<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="createReadStreamcreateWriteStream_269"></a>文件流（createReadStream,createWriteStream）</h3> 
<p>拷贝读取快，比拷贝api快<br> <img src="https://images2.imgbox.com/9d/c5/lWzM2uuh_o.png" alt="在这里插入图片描述">node中文件流是分段读取的，速度很快。</p> 
<pre><code class="prism language-java"><span class="token comment">// 文件流需要引入fs模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">//创建一个可读取的流</span>
let readStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>'新建 文本文档<span class="token punctuation">.</span>txt'<span class="token punctuation">)</span>
    <span class="token comment">//事件：监听是否有数据流入到内存</span>
    <span class="token comment">//data:事件名称  监听数据的事件 不能够随意更改</span>
readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//读取非txt文件不需要toString()</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/93/e9/WuWV2ljU_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">// 文件流需要引入fs模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">//创建可读取的流</span>
let readStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>'新建 文本文档<span class="token punctuation">.</span>zip'<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建可写入的流</span>
let writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>'<span class="token keyword">new</span><span class="token punctuation">.</span>zip'<span class="token punctuation">)</span>

<span class="token comment">//把读取的流通过管道添加到写入流</span>
readStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="copyFilecopyFileSync_302"></a>拷贝文件（copyFile,copyFileSync）</h3> 
<p><img src="https://images2.imgbox.com/ad/23/CEtS3yHz_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/ec/de/0xvwTTpe_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">// 文件流需要引入fs模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">//拷贝文件</span>
fs<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>'新建 文本文档<span class="token punctuation">.</span>zip<span class="token char">', '</span>new2<span class="token punctuation">.</span>zip'<span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>'新建 文本文档<span class="token punctuation">.</span>zip<span class="token char">', '</span>new2<span class="token punctuation">.</span>zip'<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="HTTP_319"></a>HTTP协议</h2> 
<p>浏览器和web服务器之间的通信协议<br> (1)通用头信息<br> <img src="https://images2.imgbox.com/71/64/qNTlaJDy_o.png" alt="在这里插入图片描述"></p> 
<p>(2)响应头信息<br> <img src="https://images2.imgbox.com/8e/50/MB3LN6Xd_o.png" alt="在这里插入图片描述"></p> 
<p>(3)请求头信息<br> <img src="https://images2.imgbox.com/bc/44/qkEHIbxS_o.png" alt="在这里插入图片描述"></p> 
<p>(4)请求主体</p> 
<h2><a id="HTTPhttp_333"></a>HTTP模块（http）</h2> 
<p>http 模块是 Node.js 官方提供的、用来创建 web 服务器的模块。通过 http 模块提供的 http.createServer() 方法，就能方便的把一台普通的电脑，变成一台 Web 服务器，从而对外提供 Web 资源服务。</p> 
<p>服务器和普通电脑的区别在于，服务器上安装了 web 服务器软件，例如：IIS、Apache 等。通过安装这些服务器软件，就能把一台普通的电脑变成一台 web 服务器。</p> 
<p>在 Node.js 中，我们不需要使用 IIS、Apache 等这些第三方 web 服务器软件。因为我们可以基于 Node.js 提供的 http 模块，通过几行简单的代码，就能轻松的手写一个服务器软件，从而对外提供 web 服务。</p> 
<p>在开发期间，自己的电脑既是一台服务器，也是一个客户端，为了方便测试，可以在自己的浏览器中输入 127.0.0.1 这个 IP 地址，就能把自己的电脑当做一台服务器进行访问了。<br> 在开发测试期间， 127.0.0.1 对应的域名是 localhost，它们都代表我们自己的这台电脑，在使用效果上没有任何区别。<br> 计算机中的端口号，就好像是现实生活中的门牌号一样。通过门牌号，外卖小哥可以在整栋大楼众多的房间中，准确把外卖送到你的手中。<br> 每个端口号不能同时被多个 web 服务占用。<br> 在实际应用中，URL 中的 80 端口可以被省略。</p> 
<p><img src="https://images2.imgbox.com/13/25/5FfykJFo_o.png" alt="请添加图片描述"></p> 
<h3><a id="_web__348"></a>创建最基本的 web 服务器</h3> 
<p>步骤：</p> 
<p>①导入 http 模块</p> 
<p>②创建 web 服务器实例</p> 
<p>③为服务器实例绑定 request 事件，监听客户端的请求</p> 
<p>④启动服务器</p> 
<pre><code class="prism language-java"><span class="token comment">// 1.导入 http 模块。</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.创建 web 服务器实例。</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3.为服务器实例绑定 request 事件，监听客户端请求。</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>'request'<span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'someone visit our web server'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4.启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'server runing at http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8080</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p><strong>req 请求对象</strong><br> 只要服务器接收到了客户端的请求，就会调用通过 server.on() 为服务器绑定的 request 事件处理函数。</p> 
<p>如果想在事件处理函数中，访问与客户端相关的数据或属性，可以使用如下的方式：</p> 
<pre><code class="prism language-java"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// req请求对象，包含了与客户的相关的数据和属性</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>'request'<span class="token punctuation">,</span> req <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// req.url 是客户端请求的 URL地址</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token comment">// req.method 是客户端请求的 method 类型</span>
    <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method<span class="token punctuation">;</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> `<span class="token class-name">Your</span> request url is $<span class="token punctuation">{<!-- --></span>url<span class="token punctuation">}</span><span class="token punctuation">,</span>and 
    request url is $<span class="token punctuation">{<!-- --></span>method<span class="token punctuation">}</span>`<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'server runing at http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p><strong>res请求对象</strong></p> 
<pre><code class="prism language-java"><span class="token comment">// res是响应对象，它包含了与服务器相关的数据和属性</span>
<span class="token comment">// 调用 res.end() 方法，向客户端响应一些内容。</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/01/56/onyuczbj_o.png" alt="在这里插入图片描述"><br> 也可以调用write做响应，但后面必须跟上end</p> 
<pre><code class="prism language-java"><span class="token comment">//设置响应的内容</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>'<span class="token generics"><span class="token punctuation">&lt;</span>h2<span class="token punctuation">&gt;</span></span>这是我的第一个网页<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>'<span class="token punctuation">)</span>
    <span class="token comment">//结束并发送响应</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/93/szulkjni_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//导入http模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'http'</span><span class="token punctuation">)</span>

<span class="token comment">//向服务器发送请求</span>
<span class="token comment">//通过回调函数获取响应结果</span>
http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>'http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>weather<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cn<span class="token operator">/</span>data<span class="token operator">/</span>sk<span class="token operator">/</span><span class="token number">101010100.</span>html'<span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//res响应的对象</span>
    <span class="token comment">// 响应的状态码</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取响应的结果</span>
    <span class="token comment">//事件：监听是否有数据过来</span>
    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/34/52/DbhQ4NUh_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//引入http模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'http'</span><span class="token punctuation">)</span>
    <span class="token comment">//创建web服务器</span>
let app <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//监听端口</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8082</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//事件：服务器监听是否有请求</span>
<span class="token comment">//通过回调函数做出响应</span>
<span class="token comment">//如果想让服务器做出响应，回调函数必须有两个参数 req和res 根据req返回res</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>'request'<span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"有请求进来了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 状态码为200，响应
     */</span>
    <span class="token comment">//防止乱码 设置响应文件类型与编码</span>
    <span class="token comment">// res.writeHead(200, {<!-- --></span>
    <span class="token comment">//         'Content-type': 'text/html;charset=utf-8'</span>
    <span class="token comment">//     })</span>
    <span class="token comment">//设置响应的内容</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>'<span class="token generics"><span class="token punctuation">&lt;</span>h2<span class="token punctuation">&gt;</span></span>这是我的第一个网页<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>'<span class="token punctuation">)</span>

    <span class="token comment">/**
     * 状态码为3**，跳转网页
     * 跳转到另一个URL
     */</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//3** 要有Location属性</span>
        <span class="token class-name">Location</span><span class="token operator">:</span> 'https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com'
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//结束并发送响应</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/01/25/Q5NweFkH_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//导入http模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'http'</span><span class="token punctuation">)</span>
    <span class="token comment">//导入fs模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>
    <span class="token comment">//导入gzip模块</span>
<span class="token keyword">const</span> zlib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'zlib'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建web服务器</span>
let server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//监听浏览器的请求</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>'request'<span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
        '<span class="token class-name">Content</span><span class="token operator">-</span>type<span class="token char">': '</span>text<span class="token operator">/</span>html<span class="token punctuation">;</span>charset<span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span>'
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//获取请求路径</span>
    let reqUrl <span class="token operator">=</span> req<span class="token punctuation">.</span>url
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reqUrl <span class="token operator">==</span> '<span class="token operator">/</span>index<span class="token punctuation">.</span>html'<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我是首页"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"我是首页"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reqUrl <span class="token operator">==</span> '<span class="token operator">/</span>about<span class="token punctuation">.</span>html'<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//读取文件，响应到网页上</span>
        <span class="token comment">// const readFile = fs.readFileSync('响应读取.html');</span>
        <span class="token comment">// res.write(readFile);</span>
        <span class="token comment">/**
         * 使用gzip压缩压缩大文件传输
         */</span>
        <span class="token comment">//1.告诉浏览器使用的是哪种压缩方式</span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                '<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Encoding</span><span class="token char">': '</span>gzip'
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">//2.创建gzip压缩  </span>
        let gzip <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//创建可读取的流，通过管道添加到压缩中,再把压缩通过管道响应到浏览器端</span>
        fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>'响应读取<span class="token punctuation">.</span>html'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gzip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token comment">//这里已经响应过去了，就不能加end(),否则报错</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"读取成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// res.end()</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reqUrl <span class="token operator">==</span> <span class="token char">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            location<span class="token operator">:</span> '<span class="token operator">/</span>index<span class="token punctuation">.</span>html'
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"NOT Found "</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="Zlibzlib_538"></a>Zlib压缩（zlib）</h2> 
<h3><a id="createDeflatecreateGzip_539"></a>创建压缩（createDeflate,createGzip）</h3> 
<p><img src="https://images2.imgbox.com/00/53/R4GbfyyU_o.png" alt="在这里插入图片描述">使用压缩的再次打开会在缓存中打开</p> 
<pre><code class="prism language-java">  <span class="token comment">//2.创建gzip压缩  </span>
  let gzip <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token comment">//创建可读取的流，通过管道添加到压缩中,再把压缩通过管道</span>
   <span class="token comment">//响应到浏览器端</span>
  fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>'响应读取<span class="token punctuation">.</span>html'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gzip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
   <span class="token comment">//这里已经响应过去了，就不能加end(),否则报错</span>
</code></pre> 
<h2><a id="express_551"></a>express框架</h2> 
<h3><a id="_553"></a>介绍</h3> 
<p>基于node.js平台，快速，开放，极简的web开发框架</p> 
<h3><a id="_557"></a>安装</h3> 
<pre><code class="prism language-java"> <span class="token comment">//声明package.json文件</span>
npm init <span class="token operator">-</span>y 
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">//安装express包</span>
npm install express  
</code></pre> 
<h3><a id="_569"></a>搭建服务器</h3> 
<pre><code class="prism language-java"><span class="token comment">//引入express包</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'express'<span class="token punctuation">)</span>
<span class="token comment">//创建web服务器</span>
let app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//监听端口</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_580"></a>路由（响应对象，请求对象）</h3> 
<p><img src="https://images2.imgbox.com/8f/29/ruB2DUKS_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/98/0e/loyGlUcU_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//路由:根据请求URL和方法做出响应</span>

<span class="token comment">//get  /login</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//req请求的对象</span>
    <span class="token comment">//res响应的对象</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>'<span class="token generics"><span class="token punctuation">&lt;</span>h2<span class="token punctuation">&gt;</span></span>登录成功<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>'<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//请求方法 get   /list  响应文件</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/list'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//__dirName为当前文件的绝对路径</span>
    res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> '<span class="token operator">/</span>响应读取<span class="token punctuation">.</span>html'<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//请求方法get  /study   跳转页面</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/study'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>'https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com'<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/reg'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取查询字符串，并解析为对象  </span>
    <span class="token comment">//express已经分装好了查询字符串属性 不能用以前的查询字符串属性</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token char">'注册成功'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>query <span class="token operator">+</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="params_616"></a>路由传参（params）</h3> 
<p>params:获取路由传参的数据，格式化对象<br> <img src="https://images2.imgbox.com/bd/31/iNJlgDP9_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//get /package    动态路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>'<span class="token operator">/</span><span class="token keyword">package</span><span class="token operator">/</span><span class="token operator">:</span>pname'<span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取路由传参的数据</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>`这是$<span class="token punctuation">{<!-- --></span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>pname<span class="token punctuation">}</span>包的详细介绍`<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0b/95/cISN68Dp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>'<span class="token operator">/</span>shopping<span class="token operator">/</span><span class="token operator">:</span>lid<span class="token operator">/</span><span class="token operator">:</span>price'<span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>    
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>`
    编号<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>lid<span class="token punctuation">}</span> <span class="token generics"><span class="token punctuation">&lt;</span>br<span class="token punctuation">&gt;</span></span>
    价格<span class="token operator">:</span>$<span class="token punctuation">{<!-- --></span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>price<span class="token punctuation">}</span>
    `<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ac/1a/HLihUIDs_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="post_641"></a>post请求</h3> 
<p><img src="https://images2.imgbox.com/d9/43/8HEyrFhp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//引入express模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'express'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//引入查询字符串模块</span>
<span class="token keyword">const</span> queryString <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'querystring'<span class="token punctuation">)</span>
<span class="token comment">//创建web服务器</span>
let app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//监听端口</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"执行成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> '<span class="token operator">/</span>login<span class="token punctuation">.</span>html'<span class="token punctuation">)</span>


<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>'<span class="token operator">/</span>mylogin'<span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取post请求的数据</span>
    <span class="token comment">//事件：监听是否有数据、</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"执行了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        let obj <span class="token operator">=</span> queryString<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"登录成功"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/cd/3a/nRw2YAPX_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6e/d4/u47ZqeNq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_678"></a>路由器</h3> 
<p><img src="https://images2.imgbox.com/1c/cf/ejfbAtM7_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/29/47/SMj3haJu_o.png" alt="在这里插入图片描述"><br> app.js入口文件</p> 
<pre><code class="prism language-java"><span class="token comment">//引入express模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'express'<span class="token punctuation">)</span>

<span class="token comment">//创建web服务器</span>
let app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//监听端口</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span>

<span class="token comment">//引入用户路由器</span>
<span class="token keyword">const</span> userRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'<span class="token punctuation">.</span>/routers<span class="token operator">/</span>user'<span class="token punctuation">)</span>
    <span class="token comment">//引入商品列表路由器</span>
<span class="token keyword">const</span> productRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'<span class="token punctuation">.</span>/routers<span class="token operator">/</span>product'<span class="token punctuation">)</span>
    <span class="token comment">//引入首页路由器</span>
<span class="token keyword">const</span> indexRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'<span class="token punctuation">.</span>/routers<span class="token operator">/</span>index'<span class="token punctuation">)</span>


<span class="token comment">//使用路由器，给路由器下的每个路由器添加前缀</span>
<span class="token comment">//   /login    /user/login</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token char">'/user'</span><span class="token punctuation">,</span> userRouter<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>'<span class="token operator">/</span>product'<span class="token punctuation">,</span> productRouter<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">,</span> indexRouter<span class="token punctuation">)</span>
</code></pre> 
<p>index模块</p> 
<pre><code class="prism language-java"><span class="token comment">//引入express模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'express'<span class="token punctuation">)</span>

<span class="token comment">//创建路由器对象</span>
let router <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">express<span class="token punctuation">.</span></span>Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//向路由器中挂载路由对象</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/index'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"登录界面"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">module</span><span class="token punctuation">.</span><span class="token keyword">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre> 
<p>用户模块</p> 
<pre><code class="prism language-java"><span class="token comment">//引入express模块  路由器由express提供</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'express'<span class="token punctuation">)</span>

<span class="token comment">//创建路由器对象</span>
let router <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">express<span class="token punctuation">.</span></span>Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//往路由器中挂载路由</span>

<span class="token comment">/**
 * get   /login
 */</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
        '<span class="token class-name">Content</span><span class="token operator">-</span>type<span class="token char">': '</span>text<span class="token operator">/</span>html<span class="token punctuation">;</span>charset<span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span>'
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token char">'用户登录'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//导出路由对象</span>
<span class="token keyword">module</span><span class="token punctuation">.</span><span class="token keyword">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_751"></a>中间件</h2> 
<p>浏览器向服务器发请求，中间件可以拦截（过滤）请求，最终给路由提供服务，分为：应用级中间件、路由级中间件、内置中间件、第三方中间件、错误处理中间件。</p> 
<h3><a id="_754"></a>应用级中间件</h3> 
<p><img src="https://images2.imgbox.com/21/0b/ADJD3awL_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//引入express模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'express'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建web服务器</span>
let app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//监听端口</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//添加中间件，拦截对URL为/list的请求</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token char">'/list'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'拦截到了对<span class="token operator">/</span>list的请求'<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如果不满足条件，否则执行下一个中间件，或者路由</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>username <span class="token operator">!=</span><span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"没有权限"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//获取后台数据的路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/list'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"这是后台的数据"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-java">不要忘了中间件中的next参数
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/90/d814cUBL_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 中间件练习
 * 创建购物车的路由, get/shopping，传递商品的价格price  在中间打九折，最后在路由中响应。
 */</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"/shopping"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
    req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>price <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/shopping"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"商品价格为"</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_807"></a>路由级中间件</h3> 
<p><img src="https://images2.imgbox.com/77/07/Yza1WcCi_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_809"></a>内置中间件</h3> 
<p><img src="https://images2.imgbox.com/f5/fb/ziQ6M98z_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 内置中间件
 * 托管静态资源到public目录
 */</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token char">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/09/7a/Xfh0DTzr_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//引入bodyParser模块   用于解析请求体数据为对象</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'body<span class="token operator">-</span>parser'<span class="token punctuation">)</span>
<span class="token comment">//引入compression模块  对所有请求进行压缩</span>
<span class="token keyword">const</span> compression <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'compression'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//对所有请求进行压缩  比如压缩大文件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">compression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
<span class="token comment">/**
 * 内置中间件
 * 托管静态资源到public目录
 */</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token char">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//使用body-parser 中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    extended<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//内部解析为对象使用querystring模块  true使用qs模块</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="mysql_842"></a>mysql模块</h2> 
<h3><a id="_843"></a>初始化</h3> 
<pre><code class="prism language-java"><span class="token comment">//初始化</span>
npm init <span class="token operator">-</span>y
<span class="token comment">//安装mysql包</span>
npm install mysql
</code></pre> 
<h3><a id="mysql_852"></a>mysql普通连接</h3> 
<pre><code class="prism language-java"><span class="token comment">//引入mysql模块</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建连接对象</span>
let connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    host<span class="token operator">:</span> '<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>'<span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token char">'23306'</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token char">'root'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> '<span class="token number">0071</span>hanxiaolei'<span class="token punctuation">,</span>
    database<span class="token operator">:</span> 'atguigudb'
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//执行连接</span>
connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="mysql_870"></a>mysql连接池连接</h3> 
<pre><code class="prism language-java"><span class="token comment">//引入mysql模块</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建连接池对象</span>
let pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        host<span class="token operator">:</span> '<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>'<span class="token punctuation">,</span>
        port<span class="token operator">:</span> <span class="token char">'23306'</span><span class="token punctuation">,</span>
        user<span class="token operator">:</span> <span class="token char">'root'</span><span class="token punctuation">,</span>
        password<span class="token operator">:</span> <span class="token string">"0071hanxiaolei"</span><span class="token punctuation">,</span>
        database<span class="token operator">:</span> 'atguigudb'<span class="token punctuation">,</span>
        <span class="token comment">//创建连接池数量  默认数量为15</span>
        connectionLimit<span class="token operator">:</span> <span class="token number">15</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//执行SQL命令</span>
pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>'SELECT <span class="token operator">*</span> FROM emp'<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="mysql_892"></a>mysql语句</h3> 
<pre><code class="prism language-java"><span class="token comment">//执行sql语句</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>'SELECT <span class="token operator">*</span> FROM emp where <span class="token operator">?</span>' <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>   <span class="token comment">//用?号代替5，防止sql注入 '5' OR 1=1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//插入数据</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>'INSERT INTO emp <span class="token function">VALUES</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token char">', ['</span><span class="token number">8</span><span class="token char">', '</span>王二小<span class="token char">', '</span><span class="token number">1999</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">30</span>'<span class="token punctuation">,</span> <span class="token number">3255</span><span class="token punctuation">,</span> <span class="token number">3003</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


let emp <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    id<span class="token operator">:</span> <span class="token char">'9'</span><span class="token punctuation">,</span>
    ename<span class="token operator">:</span> <span class="token string">"王八蛋2"</span><span class="token punctuation">,</span>
    joindate<span class="token operator">:</span> '<span class="token number">2001</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">20</span>'<span class="token punctuation">,</span>
    salary<span class="token operator">:</span> <span class="token number">7000</span><span class="token punctuation">,</span>
    bonus<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">//定义插入数据</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>'INSERT INTO emp SET <span class="token operator">?</span>'<span class="token punctuation">,</span> <span class="token punctuation">[</span>emp<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>这种方法要注意</strong><br> <img src="https://images2.imgbox.com/ae/28/xTE1B9Yr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_924"></a>练习</h3> 
<p><img src="https://images2.imgbox.com/7b/e4/I8aL2gg5_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//引入express模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'express'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//引入mysql模块</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建mysql连接池</span>
let pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    host<span class="token operator">:</span> '<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>'<span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token char">'23306'</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token char">'root'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> '<span class="token number">0071</span>hanxiaolei'<span class="token punctuation">,</span>
    database<span class="token operator">:</span> 'atguigudb'<span class="token punctuation">,</span>
    <span class="token comment">//创建连接池数量</span>
    connectionLimit<span class="token operator">:</span> <span class="token number">15</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//创建web服务器</span>
let app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//添加中间件  托管静态资源  注意括号中写的什么，不能直接写文件名称</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token char">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">//请求</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    let obj <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>

    pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>'INSERT INTO emp SET <span class="token operator">?</span>'<span class="token punctuation">,</span> <span class="token punctuation">[</span>obj<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"完成"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="NPM_NPX_969"></a>NPM NPX</h3> 
<p><img src="https://images2.imgbox.com/cb/80/4nT71Et7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_972"></a>编写接口</h3> 
<p><img src="https://images2.imgbox.com/76/5e/NJrpiFb5_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">//引入模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'express'<span class="token punctuation">)</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'mysql'</span><span class="token punctuation">)</span>

<span class="token comment">//创建web服务器</span>
let app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建mysql连接</span>
<span class="token keyword">const</span> pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    host<span class="token operator">:</span> '<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>'<span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token char">'23306'</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token char">'root'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> '<span class="token number">0071</span>hanxiaolei'<span class="token punctuation">,</span>
    database<span class="token operator">:</span> 'atguigudb'<span class="token punctuation">,</span>
    connectionLimit<span class="token operator">:</span> <span class="token number">15</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">//1.获取员工数据的路由 (get /v1/emp)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>'<span class="token operator">/</span>v1<span class="token operator">/</span>emp'<span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取请求中已查询字符串传递的数据</span>
    let obj <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    <span class="token comment">//如果页码为空，设置默认为1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>pho<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        obj<span class="token punctuation">.</span>pho <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//如果页码为空，设置默认为5</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        obj<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//计算开始查询的值  计算方式：（页数-1）*每页数量 </span>
    let start <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>pho <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
    <span class="token comment">//将每页的数据量转换为数值型</span>
    let count <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
        <span class="token comment">//执行mysql语句</span>
    pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>'SELECT <span class="token operator">*</span> FROM emp limit <span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span>'<span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">,</span> count<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// if (err) throw err;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//如果执行sql命令错误，响应服务端错误</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    code<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
                    msg<span class="token operator">:</span> 'serve error'
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">//不能在往后执行了，跳出当前函数</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//获取sql命令执行的结果</span>
        <span class="token comment">// console.log(result);</span>
        <span class="token comment">// res.send(result);</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token char">'OK'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> result
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="xz_1038"></a>详情请看xz文件</h3>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9c77c5595cfae5b6fc3d2f38fca7cb2f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用thymeleaf时，th:类标签失效的原因</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/702e70d3c57c996154c631a1ec5343ec/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java 递归 把层级数据转为（树形数据）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>