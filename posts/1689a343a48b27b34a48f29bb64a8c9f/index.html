<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>再学webpack - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="再学webpack" />
<meta property="og:description" content="1 优化 webpack 打包体积的思路 优化 webpack 打包体积的思路包括：
提取第三方库或通过引用外部文件的方式引入第三方库：将第三方库单独打包，并通过 CDN 引入，减少打包体积。使用代码压缩插件：例如 UglifyJsPlugin，可以压缩 JavaScript 代码，减小文件体积。启用服务器端的 Gzip 压缩：通过服务器端配置 Gzip 压缩，减少传输体积。按需加载资源文件：使用 require.ensure 或动态导入（import()）的方式按需加载资源文件，避免一次性加载所有资源，优化加载速度和体积。优化 devtool 中的 source-map：选择合适的 devtool 配置，确保在开发阶段能够提供足够的错误追踪信息，但不会增加过多的打包体积。剥离 CSS 文件：将 CSS 文件单独打包，通过 &lt;link&gt; 标签引入，利用浏览器的并行加载能力。去除不必要的插件：检查 webpack 配置中的插件，移除不必要的插件或根据环境区分开发环境和生产环境的配置，避免将开发环境的调试工具打包到生产环境中。 除了上述优化思路，还可以考虑以下几点：
使用 Tree Shaking：通过配置 webpack，将未使用的代码在打包过程中消除，减少打包体积。使用模块化引入：合理使用 ES6 模块化语法或其他模块化方案，按需引入模块，避免不必要的全局引入。按需加载第三方库：对于较大的第三方库，可以考虑按需加载，而不是一次性全部引入。优化图片资源：压缩图片，使用适当的图片格式，尽量减小图片体积。优化字体文件：如果使用了大量的字体文件，可以考虑只引入需要的字体文件，避免全部引入。使用缓存：通过配置合适的缓存策略，利用浏览器缓存机制，减少重复加载资源。 综合以上优化思路，可以有效减小 webpack 打包生成的文件体积，提升应用性能和加载速度。需要根据具体项目情况和需求，选择合适的优化策略和配置。
2 优化 webpack 打包效率的方法 使用增量构建和热更新：在开发环境下，使用增量构建和热更新功能，只重新构建修改过的模块，减少整体构建时间。避免无意义的工作：在开发环境中，避免执行无意义的工作，如提取 CSS、计算文件 hash 等，以减少构建时间。配置合适的 devtool：选择适当的 devtool 配置，提供足够的调试信息，但不会对构建性能产生太大影响。选择合适的 loader：根据需要加载的资源类型选择高效的 loader，避免不必要的解析和处理过程。启用 loader 缓存：对于耗时较长的 loader，如 babel-loader，可以启用缓存功能，避免重复处理同一文件。采用引入方式引入第三方库：对于第三方库，可以通过直接引入的方式（如 CDN 引入）来减少打包时间。提取公共代码：通过配置 webpack 的 SplitChunks 插件，提取公共代码，避免重复打包相同的代码，提高打包效率。优化构建时的搜索路径：指定需要构建的目录和不需要构建的目录，减少搜索范围，加快构建速度。模块化引入需要的部分：使用按需引入的方式，只引入需要的模块或组件，避免加载不必要的代码，提高构建效率。 通过以上优化措施，可以有效提升 webpack 的打包效率，减少开发和构建时间，提升开发效率和用户体验。根据具体项目需求和场景，选择适合的优化方法进行配置和调整。
3 编写Loader 编写一个名为 reverse-txt-loader 的 Loader，实现对文本内容进行反转处理的功能。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/1689a343a48b27b34a48f29bb64a8c9f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-30T16:48:27+08:00" />
<meta property="article:modified_time" content="2024-01-30T16:48:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">再学webpack</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1__webpack__1"></a>1 优化 webpack 打包体积的思路</h2> 
<p><strong>优化 webpack 打包体积的思路包括：</strong></p> 
<ol><li><strong>提取第三方库或通过引用外部文件的方式引入第三方库</strong>：将第三方库单独打包，并通过 CDN 引入，减少打包体积。</li><li><strong>使用代码压缩插件</strong>：例如 <code>UglifyJsPlugin</code>，可以压缩 JavaScript 代码，减小文件体积。</li><li><strong>启用服务器端的 Gzip 压缩</strong>：通过服务器端配置 Gzip 压缩，减少传输体积。</li><li><strong>按需加载资源文件</strong>：使用 <code>require.ensure</code> 或动态导入（<code>import()</code>）的方式按需加载资源文件，避免一次性加载所有资源，优化加载速度和体积。</li><li><strong>优化 devtool 中的 source-map</strong>：选择合适的 devtool 配置，确保在开发阶段能够提供足够的错误追踪信息，但不会增加过多的打包体积。</li><li><strong>剥离 CSS 文件</strong>：将 CSS 文件单独打包，通过 <code>&lt;link&gt;</code> 标签引入，利用浏览器的并行加载能力。</li><li><strong>去除不必要的插件</strong>：检查 webpack 配置中的插件，移除不必要的插件或根据环境区分开发环境和生产环境的配置，避免将开发环境的调试工具打包到生产环境中。</li></ol> 
<p><strong>除了上述优化思路，还可以考虑以下几点：</strong></p> 
<ul><li><strong>使用 Tree Shaking</strong>：通过配置 webpack，将未使用的代码在打包过程中消除，减少打包体积。</li><li><strong>使用模块化引入</strong>：合理使用 ES6 模块化语法或其他模块化方案，按需引入模块，避免不必要的全局引入。</li><li><strong>按需加载第三方库</strong>：对于较大的第三方库，可以考虑按需加载，而不是一次性全部引入。</li><li><strong>优化图片资源</strong>：压缩图片，使用适当的图片格式，尽量减小图片体积。</li><li><strong>优化字体文件</strong>：如果使用了大量的字体文件，可以考虑只引入需要的字体文件，避免全部引入。</li><li><strong>使用缓存</strong>：通过配置合适的缓存策略，利用浏览器缓存机制，减少重复加载资源。</li></ul> 
<p>综合以上优化思路，可以有效减小 webpack 打包生成的文件体积，提升应用性能和加载速度。需要根据具体项目情况和需求，选择合适的优化策略和配置。</p> 
<h2><a id="2__webpack__24"></a>2 优化 webpack 打包效率的方法</h2> 
<ol><li><strong>使用增量构建和热更新</strong>：在开发环境下，使用增量构建和热更新功能，只重新构建修改过的模块，减少整体构建时间。</li><li><strong>避免无意义的工作</strong>：在开发环境中，避免执行无意义的工作，如提取 CSS、计算文件 <code>hash</code> 等，以减少构建时间。</li><li><strong>配置合适的 devtool</strong>：选择适当的 devtool 配置，提供足够的调试信息，但不会对构建性能产生太大影响。</li><li><strong>选择合适的 loader</strong>：根据需要加载的资源类型选择高效的 loader，避免不必要的解析和处理过程。</li><li><strong>启用 loader 缓存</strong>：对于耗时较长的 loader，如 <code>babel-loader</code>，可以启用缓存功能，避免重复处理同一文件。</li><li><strong>采用引入方式引入第三方库</strong>：对于第三方库，可以通过直接引入的方式（如 CDN 引入）来减少打包时间。</li><li><strong>提取公共代码</strong>：通过配置 webpack 的 SplitChunks 插件，提取公共代码，避免重复打包相同的代码，提高打包效率。</li><li><strong>优化构建时的搜索路径</strong>：指定需要构建的目录和不需要构建的目录，减少搜索范围，加快构建速度。</li><li><strong>模块化引入需要的部分</strong>：使用按需引入的方式，只引入需要的模块或组件，避免加载不必要的代码，提高构建效率。</li></ol> 
<p>通过以上优化措施，可以有效提升 webpack 的打包效率，减少开发和构建时间，提升开发效率和用户体验。根据具体项目需求和场景，选择适合的优化方法进行配置和调整。</p> 
<h2><a id="3_Loader_38"></a>3 编写Loader</h2> 
<p>编写一个名为 <code>reverse-txt-loader</code> 的 Loader，实现对文本内容进行反转处理的功能。</p> 
<pre><code class="prism language-js"><span class="token comment">// reverse-txt-loader.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 对源代码进行处理，这里是将字符串反转</span>
  <span class="token keyword">const</span> reversedSource <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 返回处理后的 JavaScript 代码作为模块输出</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module.exports = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>reversedSource<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">';</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>    
</code></pre> 
<p>上述代码定义了一个函数，该函数接收一个参数 <code>source</code>，即原始的文本内容。在函数内部，我们将源代码进行反转处理，并将处理后的结果拼接成一个字符串，再通过 <code>module.exports</code> 输出为一个 JavaScript 模块。</p> 
<p>要使用这个 Loader，需要在 webpack 配置中指定该 Loader 的路径：</p> 
<pre><code class="prism language-js"><span class="token comment">// webpack.config.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.txt$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            loader<span class="token operator">:</span> <span class="token string">'./path/reverse-txt-loader'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre> 
<p>上述配置将该 Loader 应用于所有以 <code>.txt</code> 结尾的文件。在构建过程中，当遇到需要加载的 <code>.txt</code> 文件时，会调用 <code>reverse-txt-loader</code> 对文件内容进行反转处理，并将处理后的结果作为模块的输出。</p> 
<p>请注意，在实际使用中，需要根据实际路径修改 <code>loader</code> 配置的路径，并将该 Loader 安装在项目中。</p> 
<h2><a id="4_plugin_83"></a>4 编写plugin</h2> 
<p>编写一个自定义的 Webpack 插件需要创建一个 JavaScript 类，并在类中实现指定的生命周期方法。下面是一个简单的示例，展示如何编写一个自定义的 Webpack 插件：</p> 
<pre><code class="prism language-js"><span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 在构造函数中可以接收插件的配置参数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Webpack 在安装插件时会自动调用 apply 方法，并将 compiler 对象传递进来</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 在适当的生命周期钩子中挂载插件的功能</span>

    <span class="token comment">// 示例：在 emit 生命周期钩子中添加自定义的功能</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'MyPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// compilation 对象包含了当前构建过程的各种信息</span>
      <span class="token comment">// 可以在这里执行一些自定义的操作</span>

      <span class="token comment">// 示例：向输出的文件中添加自定义的注释</span>
      <span class="token keyword">const</span> comment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>comment <span class="token operator">||</span> <span class="token string">'Custom comment'</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> asset <span class="token keyword">in</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>compilation<span class="token punctuation">.</span>assets<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>asset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>asset<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">source</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/* </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>comment<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> */\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>asset<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre> 
<p>以上是一个简单的插件示例，它在构建过程中的 <code>emit</code> 生命周期钩子中向输出的文件添加了自定义的注释。你可以根据实际需求在其他生命周期钩子中实现不同的功能。</p> 
<p>要使用该插件，在 webpack 的配置文件中进行如下配置：</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> MyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./path/to/MyPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      comment<span class="token operator">:</span> <span class="token string">'Custom comment'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样，当你运行 webpack 构建时，该插件就会被应用，并执行指定的功能。</p> 
<p>需要注意的是，Webpack 的插件机制非常灵活，可以根据实际需求编写各种各样的插件。插件可以监听多个生命周期钩子，并在每个生命周期钩子中实现自定义的功能。详细的插件开发文档可以参考 Webpack 官方文档。</p> 
<h2><a id="5_webpackpluginwebpack_138"></a>5 说一下webpack的一些plugin，怎么使用webpack对项目进行优化</h2> 
<p>Webpack 提供了许多插件（Plugins）来帮助优化项目构建和性能。下面列举一些常用的插件以及它们的作用：</p> 
<p><strong>构建优化插件：</strong></p> 
<ul><li><code>ContextReplacementPlugin</code>：用于限制某些模块的上下文，可以减少编译体积。</li><li><code>IgnorePlugin</code>：用于忽略特定的模块，减少打包体积。</li><li><code>babel-plugin-import</code>：用于按需加载和使用模块，减少打包体积。</li><li><code>babel-plugin-transform-runtime</code>：将代码中的公共部分提取到一个单独的模块中，减少打包体积。</li><li><code>happypack</code>、<code>thread-loader</code>：实现并行编译，加快构建速度。</li><li><code>uglifyjs-webpack-plugin</code>：通过并行压缩和缓存来加快代码压缩的速度。</li></ul> 
<p><strong>性能优化插件：</strong></p> 
<ul><li><code>Tree-shaking</code>：通过静态分析代码，去除未使用的代码，减少打包体积。</li><li><code>Scope Hoisting</code>：将模块之间的关系进行静态分析，减少打包后的模块数量，提升代码执行速度。</li><li><code>webpack-md5-plugin</code>：根据文件内容生成 hash，实现缓存的更新机制。</li><li><code>splitChunksPlugin</code>：根据配置将代码拆分成多个块，实现按需加载和并行加载的效果。</li><li><code>import()</code>、<code>require.ensure</code>：动态导入模块，实现按需加载，提升页面加载速度。</li></ul> 
<p>除了使用这些插件，还可以通过配置 webpack 的其他参数来进一步优化项目，例如：</p> 
<ul><li>配置 <code>devtool</code>：选择合适的 Source Map 类型，既满足调试需求又不影响构建速度。</li><li>配置 <code>output</code>：使用 <code>chunkhash</code> 或 <code>contenthash</code> 生成文件名，实现长期缓存。</li><li>使用 <code>cache-loader</code>、<code>hard-source-webpack-plugin</code>、<code>uglifyjs-webpack-plugin</code> 等插件开启缓存，加速再次构建。</li><li>使用 <code>DllWebpackPlugin</code> 和 <code>DllReferencePlugin</code> 预编译公共模块，减少重复构建时间。</li></ul> 
<p>综合使用这些插件和优化策略，可以显著提升 webpack 项目的构建效率和性能。但是需要根据具体的项目需求和场景选择合适的插件和优化方法。</p> 
<h2><a id="6_webpack_Plugin__Loader__168"></a>6 webpack Plugin 和 Loader 的区别</h2> 
<ul><li><code>Loader</code> 用于对模块源码进行转换，将非 JavaScript 模块转换为 JavaScript 模块，或对模块进行预处理。它描述了 <code>webpack</code> 如何处理不同类型的文件，比如将 Sass 文件转换为 CSS 文件，或将 <code>ES6</code> 代码转换为 <code>ES5</code> 代码。<code>Loader</code> 是针对单个文件的转换操作，通过配置 <code>rules</code> 来匹配文件并指定相应的 <code>Loader</code></li><li><code>Plugin</code> 用于扩展 webpack 的功能，解决 <code>Loader</code> 无法解决的问题。<code>Plugin</code> 可以监听 <code>webpack</code> 构建过程中的事件，并在特定的时机执行相应的操作。它可以在打包优化、资源管理、环境变量注入等方面提供额外的功能。Plugin 的功能范围更广泛，可以修改 <code>webpack</code> 的内部行为，从而实现更复杂的构建需求。</li></ul> 
<p>总的来说，<code>Loader</code> 是用于处理模块源码的转换工具，而 <code>Plugin</code> 则是用于扩展 <code>webpack</code> 的功能，通过监听 <code>webpack</code> 构建过程中的事件来执行相应的操作。它们各自的作用和功能不同，但都可以用于优化和定制 <code>webpack</code> 的构建过程。在配置 <code>webpack</code> 时，我们可以通过配置 <code>Loader</code> 和 <code>Plugin</code> 来满足不同的需求，并实现对模块的转换和构建过程的定制化</p> 
<h2><a id="7_tree_shaking__175"></a>7 tree shaking 的原理是什么</h2> 
<p>Tree shaking 的原理主要是基于静态分析的方式来实现无用代码的消除，从而减小最终打包生成的文件体积。它的工作原理可以简要概括如下：</p> 
<ol><li>采用 <code>ES6 Module</code> 语法：<code>Tree shaking</code> 只对 <code>ES6 Module</code> 语法进行静态分析和优化。<code>ES6 Module</code> 的特点是可以进行静态分析，这意味着在编译阶段就能够确定模块之间的依赖关系。</li><li>静态分析模块依赖：在编译过程中，通过静态分析可以确定每个模块的依赖关系，以及模块中导出的函数、变量等信息。</li><li>标记未被引用的代码：在静态分析的过程中，会标记出那些未被其他模块引用的函数、变量和代码块。</li><li>消除未被引用的代码：在构建过程中，根据静态分析得到的标记信息，可以对未被引用的代码进行消除。这样，在最终生成的打包文件中，未被引用的代码将不会包含在内。</li></ol> 
<blockquote> 
 <p>总结来说，Tree shaking 的核心思想是通过静态分析模块依赖关系，并标记和消除未被引用的代码。这样可以大大减小打包后的文件体积，提升应用的性能和加载速度。需要注意的是，Tree shaking 只对 ES6 Module 语法起作用，而对于 CommonJS 等其他模块系统则无法进行静态分析和优化。</p> 
</blockquote> 
<h2><a id="8_commonjs__es6__186"></a>8 common.js 和 es6 中模块引入的区别</h2> 
<blockquote> 
 <p>CommonJS 是一种模块规范，最初被应用于 Nodejs，成为 Nodejs 的模块规范。运行在浏览器端的 JavaScript 由于也缺少类似的规范，在 ES6 出来之前，前端也实现了一套相同的模块规范 (例如: <code>AMD</code>)，用来对前端模块进行管理。自 ES6 起，引入了一套新的 <code>ES6 Module</code>规范，在语言标准的层面上实现了模块功能，而且实现得相当简单，有望成为浏览器和服务器通用的模块解决方案。但目前浏览器对 <code>ES6 Module</code> 兼容还不太好，我们平时在 <code>Webpack</code> 中使用的 <code>export</code>和 <code>import</code>，会经过 <code>Babel</code> 转换为 <code>CommonJS</code> 规范</p> 
</blockquote> 
<p><strong>CommonJS 和 ES6 Module 在模块引入的方式和特性上有一些区别，主要包括以下几个方面：</strong></p> 
<ol><li><strong>输出方式</strong>：<code>CommonJS</code> 输出的是一个值的拷贝，而 <code>ES6 Module</code> 输出的是值的引用。在 <code>CommonJS</code> 中，模块导出的值是被复制的，即使导出模块后修改了模块内部的值，也不会影响导入模块的值。而在 <code>ES6 Module</code> 中，模块导出的值是引用关系，如果导出模块后修改了模块内部的值，会影响到导入模块的值</li><li><strong>加载时机</strong>：<code>CommonJS</code> 模块是运行时加载，也就是在代码执行到导入模块的位置时才会加载模块并执行。而 <code>ES6 Module</code> 是编译时输出接口，也就是在代码编译阶段就会确定模块的依赖关系，并在运行前静态地解析模块的导入和导出</li><li><strong>导出方式</strong>：<code>CommonJS</code> 采用的是 <code>module.exports</code> 导出，可以导出任意类型的值。<code>ES6 Module</code> 采用的是 <code>export</code> 导出，只能导出具名的变量、函数、类等，而不能直接导出任意值</li><li><strong>导入方式</strong>：<code>CommonJS</code> 使用 <code>require()</code> 来导入模块，可以使用动态语法，允许在条件语句中使用。<code>ES6 Module</code> 使用 <code>import</code> 来导入模块，它是静态语法，只能写在模块的顶层，不能写在条件语句中</li><li><strong>this 指向</strong>：<code>CommonJS</code> 模块中的 <code>this</code> 指向当前模块的 <code>exports</code> 对象，而不是全局对象。<code>ES6 Module</code> 中的 <code>this</code> 默认是 <code>undefined</code>，在模块中直接使用 <code>this</code> 会报错</li></ol> 
<blockquote> 
 <p>总的来说，<code>CommonJS</code> 主要用于服务器端的模块化开发，运行时加载，更适合动态加载模块，而 <code>ES6 Module</code> 是在语言层面上实现的模块化方案，静态编译，更适合在构建时进行模块依赖的静态分析和优化。在前端开发中，通常使用打包工具（如 <code>webpack</code>）将 <code>ES6 Module</code> 转换为 <code>CommonJS</code> 或其他模块规范，以实现在浏览器环境中的兼容性。</p> 
</blockquote> 
<h2><a id="9_babel_200"></a>9 babel原理</h2> 
<p>Babel 是一个 JavaScript 编译器。他把最新版的 javascript 编译成当下可以执行的版本，简言之，利用 babel 就可以让我们在当前的项目中随意的使用这些新最新的 es6，甚至 es7 的语法</p> 
<blockquote> 
 <p><code>ES6、7</code>代码输入 -&gt; <code>babylon</code>进行解析 -&gt; 得到<code>AST</code>（抽象语法树）-&gt; <code>plugin</code>用b<code>abel-traverse</code>对<code>AST</code>树进行遍历转译 -&gt;得到新的<code>AST</code>树-&gt;用<code>babel-generator</code>通过<code>AST</code>树生成<code>ES5</code>代码</p> 
</blockquote> 
<p><strong>它的工作流程包括解析（parse）、转换（transform）和生成（generate）三个主要步骤</strong></p> 
<ol><li><strong>解析（parse）</strong> ：Babel 使用解析器（如 <code>Babylon</code>）将输入的 JavaScript 代码解析成抽象语法树（AST）。解析器将代码分析成语法结构，并生成对应的 AST，表示代码的抽象语法结构。这个阶段包括词法分析和语法分析。词法分析将源代码转换为一个个标记（tokens）的流，而语法分析则将这个标记流转换为 AST 的形式。</li><li><strong>转换（transform）</strong> ：在转换阶段，Babel 使用插件（plugins）对 AST 进行遍历和转换。插件可以对 AST 进行增删改查的操作，可以根据需求对语法进行转换、代码优化等。Babel 的插件系统非常灵活，可以根据需要自定义插件或使用现有插件来进行代码转换。</li><li><strong>生成（generate）</strong> ：在生成阶段，Babel 使用生成器（如 <code>babel-generator</code>）将经过转换的 AST 转换回字符串形式的 JavaScript 代码。生成器会深度优先遍历 AST，并根据 AST 的节点类型生成对应的代码字符串，最终将代码字符串输出。</li></ol> 
<p>通过以上三个步骤，Babel 实现了将最新版本的 JavaScript 代码转换为向后兼容的代码，使得开发者可以在当前环境中使用较新的 JavaScript 特性和语法。同时，Babel 还提供了一些常用的插件和预设（presets），以便开发者快速配置和使用常见的转换规则，如转换 ES6、ES7 语法、处理模块化、转换 JSX 等。</p> 
<p>总的来说，Babel 的原理是通过解析、转换和生成的过程，将新版本的 JavaScript 代码转换为兼容旧环境的代码，使开发者能够在当前环境中使用较新的 JavaScript 特性和语法。</p> 
<h2><a id="1__webpack__216"></a>1 介绍一下 webpack 的构建流程</h2> 
<p><strong>核心概念</strong></p> 
<ul><li><code>entry</code>：入口。webpack是基于模块的，使用webpack首先需要指定模块解析入口(entry)，webpack从入口开始根据模块间依赖关系递归解析和处理所有资源文件。</li><li><code>output</code>：输出。源代码经过webpack处理之后的最终产物。</li><li><code>loader</code>：模块转换器。本质就是一个函数，在该函数中对接收到的内容进行转换，返回转换后的结果。因为 Webpack 只认识 JavaScript，所以 Loader 就成了翻译官，对其他类型的资源进行转译的预处理工作。</li><li><code>plugin</code>：扩展插件。基于事件流框架 <code>Tapable</code>，插件可以扩展 Webpack 的功能，在 Webpack 运行的生命周期中会广播出许多事件，Plugin 可以监听这些事件，在合适的时机通过 Webpack 提供的 API 改变输出结果。</li><li><code>module</code>：模块。除了js范畴内的<code>es module、commonJs、AMD</code>等，<code>css @import、url(...)</code>、图片、字体等在webpack中都被视为模块。</li></ul> 
<p><strong>解释几个 webpack 中的术语</strong></p> 
<ul><li><code>module</code>：指在模块化编程中我们把应用程序分割成的独立功能的代码模块</li><li><code>chunk</code>：指模块间按照引用关系组合成的代码块，一个 <code>chunk</code> 中可以包含多个 <code>module</code></li><li><code>chunk group</code>：指通过配置入口点（<code>entry point</code>）区分的块组，一个 <code>chunk group</code> 中可包含一到多个 chunk</li><li><code>bundling</code>：webpack 打包的过程</li><li><code>asset/bundle</code>：打包产物</li></ul> 
<p><strong>webpack 的打包思想可以简化为 3 点：</strong></p> 
<ul><li>一切源代码文件均可通过各种 <code>Loader</code> 转换为 JS 模块 （<code>module</code>），模块之间可以互相引用。</li><li>webpack 通过入口点（<code>entry point</code>）递归处理各模块引用关系，最后输出为一个或多个产物包 <code>js(bundle)</code> 文件。</li><li>每一个入口点都是一个块组（<code>chunk group</code>），在不考虑分包的情况下，一个 <code>chunk group</code> 中只有一个 <code>chunk</code>，该 chunk 包含递归分析后的所有模块。每一个 <code>chunk</code> 都有对应的一个打包后的输出文件（<code>asset/bundle</code>）</li></ul> 
<p><img src="https://images2.imgbox.com/0a/f6/aZN2cugc_o.png" alt=""></p> 
<p><strong>打包流程</strong></p> 
<ol><li>初始化参数：从配置文件和 Shell 语句中读取并合并参数，得出最终的配置参数。</li><li>开始编译：从上一步得到的参数初始化 <code>Compiler</code> 对象，加载所有配置的插件，执行对象的 <code>run</code> 方法开始执行编译。</li><li>确定入口：根据配置中的 <code>entry</code> 找出所有的入口文件。</li><li>编译模块：从入口文件出发，调用所有配置的 <code>loader</code> 对模块进行翻译，再找出该模块依赖的模块，这个步骤是递归执行的，直至所有入口依赖的模块文件都经过本步骤的处理。</li><li>完成模块编译：经过第 4 步使用 loader 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系。</li><li>输出资源：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 <code>chunk</code>，再把每个 <code>chunk</code> 转换成一个单独的文件加入到输出列表，这一步是可以修改输出内容的最后机会。</li><li>输出完成：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统。</li></ol> 
<p><img src="https://images2.imgbox.com/22/73/hf2szpfL_o.png" alt=""></p> 
<p><strong>简版</strong></p> 
<ul><li>Webpack CLI 启动打包流程；</li><li>载入 Webpack 核心模块，创建 <code>Compiler</code> 对象；</li><li>使用 <code>Compiler</code> 对象开始编译整个项目；</li><li>从入口文件开始，解析模块依赖，形成依赖关系树；</li><li>递归依赖树，将每个模块交给对应的 Loader 处理；</li><li>合并 Loader 处理完的结果，将打包结果输出到 dist 目录。</li></ul> 
<blockquote> 
 <p>在以上过程中，<code>Webpack 会在特定的时间点广播出特定的事件</code>，插件在监听到相关事件后会执行特定的逻辑，并且插件可以调用 Webpack 提供的 API 改变 Webpack 的运行结果</p> 
</blockquote> 
<p><strong>构建流程核心概念：</strong></p> 
<ul><li><code>Tapable</code>：一个基于发布订阅的事件流工具类，<code>Compiler</code> 和 <code>Compilation</code> 对象都继承于 <code>Tapable</code></li><li><code>Compiler</code>：compiler对象是一个全局单例，他负责把控整个webpack打包的构建流程。在编译初始化阶段被创建的全局单例，包含完整配置信息、<code>loaders</code>、plugins以及各种工具方法</li><li><code>Compilation</code>：代表一次 webpack 构建和生成编译资源的的过程，在<code>watch</code>模式下每一次文件变更触发的重新编译都会生成新的 <code>Compilation</code> 对象，包含了当前编译的模块 <code>module</code>, 编译生成的资源，变化的文件, 依赖的状态等</li><li>而每个模块间的依赖关系，则依赖于<code>AST</code>语法树。每个模块文件在通过Loader解析完成之后，会通过<code>acorn</code>库生成模块代码的AST语法树，通过语法树就可以分析这个模块是否还有依赖的模块，进而继续循环执行下一个模块的编译解析。</li></ul> 
<p>最终<code>Webpack</code>打包出来的<code>bundle</code>文件是一个<code>IIFE</code>的执行函数。</p> 
<pre><code class="prism language-js"><span class="token comment">// webpack 5 打包的bundle文件内容</span>

<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// webpackBootstrap</span>
    <span class="token keyword">var</span> __webpack_modules__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">'file-A-path'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// ... })</span>
        <span class="token string">'index-file-path'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">__unused_webpack_module<span class="token punctuation">,</span> __unused_webpack_exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// ... })</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// The module cache</span>
    <span class="token keyword">var</span> __webpack_module_cache__ <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// The require function</span>
    <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Check if module is in cache</span>
        <span class="token keyword">var</span> cachedModule <span class="token operator">=</span> __webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedModule <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> cachedModule<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create a new module (and put it into the cache)</span>
        <span class="token keyword">var</span> module <span class="token operator">=</span> __webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// no module.id needed</span>
                <span class="token comment">// no module.loaded needed</span>
                exports<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// Execute the module function</span>
        __webpack_modules__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Return the exports of the module</span>
        <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// startup</span>
    <span class="token comment">// Load entry module and return exports</span>
    <span class="token comment">// This entry module can't be inlined because the eval devtool is used.</span>
    <span class="token keyword">var</span> __webpack_exports__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token string">"./src/index.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

    
</code></pre> 
<p><img src="https://images2.imgbox.com/5b/de/1coe9ezZ_o.png" alt=""></p> 
<p><strong>webpack详细工作流程</strong></p> 
<p><img src="https://images2.imgbox.com/d3/33/kXQ447i4_o.png" alt=""></p> 
<h2><a id="2__Loader_322"></a>2 介绍 Loader</h2> 
<p><strong>常用 Loader:</strong></p> 
<ul><li><code>file-loader</code>: 加载文件资源，如 字体 / 图片 等，具有移动/复制/命名等功能；</li><li><code>url-loader</code>: 通常用于加载图片，可以将小图片直接转换为 Date Url，减少请求；</li><li><code>babel-loader</code>: 加载 js / jsx 文件， 将 ES6 / ES7 代码转换成 ES5，抹平兼容性问题；</li><li><code>ts-loader</code>: 加载 ts / tsx 文件，编译 TypeScript；</li><li><code>style-loader</code>: 将 css 代码以<code>&lt;style&gt;</code>标签的形式插入到 html 中；</li><li><code>css-loader</code>: 分析@import和url()，引用 css 文件与对应的资源；</li><li><code>postcss-loader</code>: 用于 css 的兼容性处理，具有众多功能，例如 添加前缀，单位转换 等；</li><li><code>less-loader / sass-loader</code>: css预处理器，在 css 中新增了许多语法，提高了开发效率；</li></ul> 
<p><strong>编写原则:</strong></p> 
<ul><li>单一原则: 每个 Loader 只做一件事；</li><li>链式调用: Webpack 会按顺序链式调用每个 Loader；</li><li>统一原则: 遵循 Webpack制定的设计规则和结构，输入与输出均为字符串，各个 Loader 完全独立，即插即用；</li></ul> 
<h2><a id="3__plugin_341"></a>3 介绍 plugin</h2> 
<blockquote> 
 <p>插件系统是 Webpack 成功的一个关键性因素。在编译的整个生命周期中，Webpack 会触发许多事件钩子，Plugin 可以监听这些事件，根据需求在相应的时间点对打包内容进行定向的修改。</p> 
</blockquote> 
<p><strong>一个最简单的 plugin 是这样的:</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">class</span> <span class="token class-name">Plugin</span><span class="token punctuation">{<!-- --></span>
  	<span class="token comment">// 注册插件时，会调用 apply 方法</span>
  	<span class="token comment">// apply 方法接收 compiler 对象</span>
  	<span class="token comment">// 通过 compiler 上提供的 Api，可以对事件进行监听，执行相应的操作</span>
  	<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  		<span class="token comment">// compilation 是监听每次编译循环</span>
  		<span class="token comment">// 每次文件变化，都会生成新的 compilation 对象并触发该事件</span>
    	compiler<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'compilation'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

    
</code></pre> 
<p><strong>注册插件:</strong></p> 
<pre><code class="prism language-js"><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	plugins<span class="token operator">:</span><span class="token punctuation">[</span>
		<span class="token keyword">new</span> <span class="token class-name">Plugin</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>事件流机制:</strong></p> 
<blockquote> 
 <p>Webpack 就像工厂中的一条产品流水线。原材料经过 Loader 与 Plugin 的一道道处理，最后输出结果。</p> 
</blockquote> 
<ul><li>通过链式调用，按顺序串起一个个 Loader；</li><li>通过事件流机制，让 Plugin 可以插入到整个生产过程中的每个步骤中；</li></ul> 
<blockquote> 
 <p>Webpack 事件流编程范式的核心是基础类 Tapable，是一种 观察者模式 的实现事件的订阅与广播：</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"tapable"</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'arg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 订阅</span>
hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 'event-hook'</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 广播</span>
<span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'event-hook'</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><code>Webpack</code> 中两个最重要的类 <code>Compiler</code> 与 <code>Compilation</code> 便是继承于 <code>Tapable</code>，也拥有这样的事件流机制。</p> 
</blockquote> 
<ul><li> <p><strong>Compiler</strong>: 可以简单的理解为 Webpack 实例，它包含了当前 Webpack 中的所有配置信息，如 options， loaders, plugins 等信息，全局唯一，只在启动时完成初始化创建，随着生命周期逐一传递；</p> </li><li> <p><code>Compilation</code>: 可以称为 编译实例。当监听到文件发生改变时，Webpack 会创建一个新的 Compilation 对象，开始一次新的编译。它包含了当前的输入资源，输出资源，变化的文件等，同时通过它提供的 api，可以监听每次编译过程中触发的事件钩子；</p> </li><li> <p><strong>区别:</strong></p> 
  <ul><li><code>Compiler</code> 全局唯一，且从启动生存到结束；</li><li><code>Compilation</code>对应每次编译，每轮编译循环均会重新创建；</li></ul> </li><li> <p><strong>常用 Plugin:</strong></p> 
  <ul><li>UglifyJsPlugin: 压缩、混淆代码；</li><li>CommonsChunkPlugin: 代码分割；</li><li>ProvidePlugin: 自动加载模块；</li><li>html-webpack-plugin: 加载 html 文件，并引入 css / js 文件；</li><li>extract-text-webpack-plugin / mini-css-extract-plugin: 抽离样式，生成 css 文件； DefinePlugin: 定义全局变量；</li><li>optimize-css-assets-webpack-plugin: CSS 代码去重；</li><li>webpack-bundle-analyzer: 代码分析；</li><li>compression-webpack-plugin: 使用 gzip 压缩 js 和 css；</li><li>happypack: 使用多进程，加速代码构建；</li><li>EnvironmentPlugin: 定义环境变量；</li></ul> </li><li> <p>调用插件 <code>apply</code> 函数传入 <code>compiler</code> 对象</p> </li><li> <p>通过 <code>compiler</code> 对象监听事件</p> </li></ul> 
<p><strong>loader和plugin有什么区别？</strong></p> 
<blockquote> 
 <p>webapck默认只能打包JS和JOSN模块，要打包其它模块，需要借助loader，loader就可以让模块中的内容转化成webpack或其它laoder可以识别的内容。</p> 
</blockquote> 
<ul><li><code>loader</code>就是模块转换化，或叫加载器。不同的文件，需要不同的<code>loader</code>来处理。</li><li><code>plugin</code>是插件，可以参与到整个webpack打包的流程中，不同的插件，在合适的时机，可以做不同的事件。</li></ul> 
<p><strong>webpack中都有哪些插件，这些插件有什么作用？</strong></p> 
<ul><li><code>html-webpack-plugin</code> 自动创建一个HTML文件，并把打包好的JS插入到HTML文件中</li><li><code>clean-webpack-plugin</code> 在每一次打包之前，删除整个输出文件夹下所有的内容</li><li><code>mini-css-extrcat-plugin</code> 抽离CSS代码，放到一个单独的文件中</li><li><code>optimize-css-assets-plugin</code> 压缩css</li></ul> 
<h2><a id="4_webpack__439"></a>4 webpack 热更新实现原理</h2> 
<p><img src="https://images2.imgbox.com/66/95/wlss9YvQ_o.png" alt=""></p> 
<p><strong>HMR 的基本流程图</strong></p> 
<p><img src="https://images2.imgbox.com/de/59/H8MLsgq6_o.png" alt=""></p> 
<ul><li>当修改了一个或多个文件；</li><li>文件系统接收更改并通知 <code>webpack</code>；</li><li><code>webpack</code> 重新编译构建一个或多个模块，并通知 HMR 服务器进行更新；</li><li><code>HMR Server</code> 使用 <code>webSocket</code> 通知 <code>HMR runtime</code> 需要更新，<code>HMR</code> 运行时通过 <code>HTTP</code> 请求更新 <code>jsonp</code></li><li><code>HMR</code> 运行时替换更新中的模块，如果确定这些模块无法更新，则触发整个页面刷新</li></ul> 
<h2><a id="5_webpack__453"></a>5 webpack 层面如何做性能优化</h2> 
<p><strong>优化前的准备工作</strong></p> 
<ul><li>准备基于时间的分析工具：我们需要一类插件，来帮助我们统计项目构建过程中在编译阶段的耗时情况。<code>speed-measure-webpack-plugin</code> 分析插件加载的时间</li><li>使用 <code>webpack-bundle-analyzer</code> 分析产物内容</li></ul> 
<p><strong>代码优化:</strong></p> 
<blockquote> 
 <p>无用代码消除，是许多编程语言都具有的优化手段，这个过程称为 DCE (dead code elimination)，即 删除不可能执行的代码；</p> 
</blockquote> 
<p>例如我们的 <code>UglifyJs</code>，它就会帮我们在生产环境中删除不可能被执行的代码，例如:</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token comment">// 下面代码便属于 不可能执行的代码；</span>
	<span class="token comment">// 通过 UglifyJs (Webpack4+ 已内置) 便会进行 DCE；</span>
	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>摇树优化 (Tree-shaking)，这是一种形象比喻。我们把打包后的代码比喻成一棵树，这里其实表示的就是，通过工具 “摇” 我们打包后的 js 代码，将没有使用到的无用代码 “摇” 下来 (删除)。即 消除那些被 引用了但未被使用 的模块代码。</p> 
</blockquote> 
<ul><li> <p>原理: 由于是在编译时优化，因此最基本的前提就是语法的静态分析，ES6的模块机制 提供了这种可能性。不需要运行时，便可进行代码字面上的静态分析，确定相应的依赖关系。</p> </li><li> <p>问题: 具有 副作用 的函数无法被 <code>tree-shaking</code></p> 
  <ul><li>在引用一些第三方库，需要去观察其引入的代码量是不是符合预期；</li><li>尽量写纯函数，减少函数的副作用；</li><li>可使用 <code>webpack-deep-scope-plugin</code>，可以进行作用域分析，减少此类情况的发生，但仍需要注意；</li></ul> </li></ul> 
<p><strong>code-spliting: 代码分割技术</strong>，将代码分割成多份进行 懒加载 或 异步加载，避免打包成一份后导致体积过大，影响页面的首屏加载；</p> 
<ul><li> <p><code>Webpack</code> 中使用 <code>SplitChunksPlugin</code> 进行拆分；</p> </li><li> <p>按 页面 拆分: 不同页面打包成不同的文件；</p> </li><li> <p>按 功能 拆分:</p> 
  <ul><li>将类似于播放器，计算库等大模块进行拆分后再懒加载引入；</li><li>提取复用的业务代码，减少冗余代码；</li></ul> </li><li> <p>按 文件修改频率 拆分: 将第三方库等不常修改的代码单独打包，而且不改变其文件 hash 值，能最大化运用浏览器的缓存；</p> </li></ul> 
<p><strong>scope hoisting</strong>: 作用域提升，将分散的模块划分到同一个作用域中，避免了代码的重复引入，有效减少打包后的代码体积和运行时的内存损耗；</p> 
<p><strong>编译性能优化:</strong></p> 
<ul><li> <p>升级至 最新 版本的 <code>webpack</code>，能有效提升编译性能；</p> </li><li> <p>使用 <code>dev-server</code> / 模块热替换 (<code>HMR</code>) 提升开发体验；</p> 
  <ul><li>监听文件变动 忽略 node_modules 目录能有效提高监听时的编译效率；</li></ul> </li><li> <p>缩小编译范围</p> 
  <ul><li><code>modules</code>: 指定模块路径，减少递归搜索；</li><li><code>mainFields</code>: 指定入口文件描述字段，减少搜索；</li><li><code>noParse</code>: 避免对非模块化文件的加载；</li><li><code>includes/exclude</code>: 指定搜索范围/排除不必要的搜索范围；</li><li><code>alias</code>: 缓存目录，避免重复寻址；</li></ul> </li><li> <p><code>babel-loader</code></p> 
  <ul><li>忽略<code>node_moudles</code>，避免编译第三方库中已经被编译过的代码</li><li>使用<code>cacheDirectory</code>，可以缓存编译结果，避免多次重复编译</li></ul> </li><li> <p>多进程并发</p> 
  <ul><li><code>webpack-parallel-uglify-plugin</code>: 可多进程并发压缩 js 文件，提高压缩速度；</li><li><code>HappyPack</code>: 多进程并发文件的 <code>Loader</code> 解析；</li></ul> </li><li> <p>第三方库模块缓存:</p> 
  <ul><li><code>DLLPlugin</code> 和 <code>DLLReferencePlugin</code> 可以提前进行打包并缓存，避免每次都重新编译；</li></ul> </li><li> <p>使用分析</p> 
  <ul><li><code>Webpack Analyse / webpack-bundle-analyzer</code> 对打包后的文件进行分析，寻找可优化的地方</li><li>配置profile：true，对各个编译阶段耗时进行监控，寻找耗时最多的地方</li></ul> </li><li> <p><code>source-map</code>:</p> 
  <ul><li>开发: <code>cheap-module-eval-source-map</code></li><li>生产: <code>hidden-source-map</code>；</li></ul> </li></ul> 
<p><strong>优化webpack打包速度</strong></p> 
<ul><li> <p>减少文件搜索范围</p> 
  <ul><li>比如通过别名</li><li><code>loader</code> 的 <code>test</code>，<code>include &amp; exclude</code></li></ul> </li><li> <p><code>Webpack4</code> 默认压缩并行</p> </li><li> <p><code>Happypack</code> 并发调用</p> </li><li> <p><code>babel</code> 也可以缓存编译</p> </li><li> <p><code>Resolve</code> 在构建时指定查找模块文件的规则</p> </li><li> <p>使用<code>DllPlugin</code>，不用每次都重新构建</p> </li><li> <p><code>externals</code> 和 <code>DllPlugin</code> 解决的是同一类问题：将依赖的框架等模块从构建过程中移除。它们的区别在于</p> 
  <ul><li>在 Webpack 的配置方面，<code>externals</code> 更简单，而 <code>DllPlugin</code> 需要独立的配置文件。</li><li><code>DllPlugin</code> 包含了依赖包的独立构建流程，而 <code>externals</code> 配置中不包含依赖框架的生成方式，通常使用已传入 CDN 的依赖包</li><li><code>externals</code> 配置的依赖包需要单独指定依赖模块的加载方式：全局对象、CommonJS、AMD 等</li><li>在引用依赖包的子模块时，<code>DllPlugin</code> 无须更改，而 <code>externals</code> 则会将子模块打入项目包中</li></ul> </li></ul> 
<p><strong>优化打包体积</strong></p> 
<ul><li> <p>提取第三方库或通过引用外部文件的方式引入第三方库</p> </li><li> <p>代码压缩插件<code>UglifyJsPlugin</code></p> </li><li> <p>服务器启用<code>gzip</code>压缩</p> </li><li> <p>按需加载资源文件 <code>require.ensure</code></p> </li><li> <p>优化<code>devtool</code>中的<code>source-map</code></p> </li><li> <p>剥离<code>css</code>文件，单独打包</p> </li><li> <p>去除不必要插件，通常就是开发环境与生产环境用同一套配置文件导致</p> </li><li> <p><code>Tree Shaking</code> 在构建打包过程中，移除那些引入但未被使用的无效代码</p> </li><li> <p>开启 <code>scope hosting</code></p> 
  <ul><li>体积更小</li><li>创建函数作用域更小</li><li>代码可读性更好</li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/45/b4/H77DQeNz_o.png" alt=""> <img src="https://images2.imgbox.com/d6/fb/Yg8r2fI4_o.png" alt=""></p> 
<h2><a id="6__Tree_Shaking_591"></a>6 介绍一下 Tree Shaking</h2> 
<p><strong>对tree-shaking的了解</strong></p> 
<p><strong>作用：</strong></p> 
<p>它表示在打包的时候会去除一些无用的代码</p> 
<p><strong>原理</strong>：</p> 
<ul><li><code>ES6</code>的模块引入是静态分析的，所以在编译时能正确判断到底加载了哪些模块</li><li>分析程序流，判断哪些变量未被使用、引用，进而删除此代码</li></ul> 
<p><strong>特点：</strong></p> 
<ul><li>在生产模式下它是默认开启的，但是由于经过<code>babel</code>编译全部模块被封装成<code>IIFE</code>，它存在副作用无法被<code>tree-shaking</code>掉</li><li>可以在<code>package.json</code>中配置<code>sideEffects</code>来指定哪些文件是有副作用的。它有两种值，一个是布尔类型，如果是<code>false</code>则表示所有文件都没有副作用；如果是一个数组的话，数组里的文件路径表示改文件有副作用</li><li><code>rollup</code>和<code>webpack</code>中对<code>tree-shaking</code>的层度不同，例如对<code>babel</code>转译后的<code>class</code>，如果<code>babel</code>的转译是宽松模式下的话(也就是<code>loose</code>为<code>true</code>)，<code>webpack</code>依旧会认为它有副作用不会<code>tree-shaking</code>掉，而<code>rollup</code>会。这是因为<code>rollup</code>有程序流分析的功能，可以更好的判断代码是否真正会产生副作用。</li></ul> 
<p><strong>原理</strong></p> 
<ul><li><code>ES6 Module</code> 引入进行静态分析，故而编译的时候正确判断到底加载了那些模块</li><li>静态分析程序流，判断那些模块和变量未被使用或者引用，进而删除对应代码</li></ul> 
<blockquote> 
 <p>依赖于<code>import/export</code></p> 
</blockquote> 
<p>通过导入所有的包后再进行条件获取。如下：</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> bar <span class="token keyword">from</span> <span class="token string">"bar"</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// foo.xxxx</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// bar.xxx</span>
<span class="token punctuation">}</span>

    
</code></pre> 
<blockquote> 
 <p>ES6的import语法完美可以使用tree shaking，因为可以在代码不运行的情况下就能分析出不需要的代码</p> 
</blockquote> 
<p><strong>CommonJS的动态特性模块意味着tree shaking不适用</strong>。因为它是不可能确定哪些模块实际运行之前是需要的或者是不需要的。在ES6中，进入了完全静态的导入语法：import。这也意味着下面的导入是不可行的：</p> 
<pre><code class="prism language-js"><span class="token comment">// 不可行，ES6 的import是完全静态的</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    myDynamicModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    myDynamicModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"bar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

    
</code></pre> 
<h2><a id="7__webpack_scope_hosting_647"></a>7 介绍一下 webpack scope hosting</h2> 
<blockquote> 
 <p>作用域提升，将分散的模块划分到同一个作用域中，避免了代码的重复引入，有效减少打包后的代码体积和运行时的内存损耗；</p> 
</blockquote> 
<h2><a id="8_Webpack_Proxy_651"></a>8 Webpack Proxy工作原理？为什么能解决跨域</h2> 
<p><strong>1. 是什么</strong></p> 
<p><code>webpack proxy</code>，即<code>webpack</code>提供的代理服务</p> 
<p>基本行为就是接收客户端发送的请求后转发给其他服务器</p> 
<p>其目的是为了便于开发者在开发模式下解决跨域问题（浏览器安全策略限制）</p> 
<p>想要实现代理首先需要一个中间服务器，<code>webpack</code>中提供服务器的工具为<code>webpack-dev-server</code></p> 
<p><strong>2. webpack-dev-server</strong></p> 
<p><code>webpack-dev-server</code>是 <code>webpack</code> 官方推出的一款开发工具，将自动编译和自动刷新浏览器等一系列对开发友好的功能全部集成在了一起</p> 
<p>目的是为了提高开发者日常的开发效率，「只适用在开发阶段」</p> 
<p>关于配置方面，在<code>webpack</code>配置对象属性中通过<code>devServer</code>属性提供，如下：</p> 
<pre><code class="prism language-js"><span class="token comment">// ./webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        contentBase<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> <span class="token number">9000</span><span class="token punctuation">,</span>
        proxy<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                target<span class="token operator">:</span> <span class="token string">'https://api.github.com'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>devServetr</code>里面<code>proxy</code>则是关于代理的配置，该属性为对象的形式，对象中每一个属性就是一个代理的规则匹配</p> 
<p>属性的名称是需要被代理的请求路径前缀，一般为了辨别都会设置前缀为<code>/api</code>，值为对应的代理匹配规则，对应如下：</p> 
<ul><li><code>target</code>：表示的是代理到的目标地址</li><li><code>pathRewrite</code>：默认情况下，我们的 <code>/api-hy</code> 也会被写入到URL中，如果希望删除，可以使用<code>pathRewrite</code></li><li><code>secure</code>：默认情况下不接收转发到<code>https</code>的服务器上，如果希望支持，可以设置为<code>false</code></li><li><code>changeOrigin</code>：它表示是否更新代理后请求的 <code>headers</code> 中<code>host</code>地址</li></ul> 
<p><strong>2. 工作原理</strong></p> 
<blockquote> 
 <p><code>proxy</code>工作原理实质上是利用<code>http-proxy-middleware</code> 这个<code>http</code>代理中间件，实现请求转发给其他服务器</p> 
</blockquote> 
<p>举个例子：</p> 
<p>在开发阶段，本地地址为<code>http://localhost:3000</code>，该浏览器发送一个前缀带有<code>/api</code>标识的请求到服务端获取数据，但响应这个请求的服务器只是将请求转发到另一台服务器中</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>target<span class="token operator">:</span> <span class="token string">'http://www.example.org'</span><span class="token punctuation">,</span> changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// http://localhost:3000/api/foo/bar -&gt; http://www.example.org/api/foo/bar</span>

    
</code></pre> 
<p><strong>3. 跨域</strong></p> 
<blockquote> 
 <p>在开发阶段， <code>webpack-dev-server</code> 会启动一个本地开发服务器，所以我们的应用在开发阶段是独立运行在 <code>localhost</code>的一个端口上，而后端服务又是运行在另外一个地址上</p> 
</blockquote> 
<p>所以在开发阶段中，由于浏览器同源策略的原因，当本地访问后端就会出现跨域请求的问题</p> 
<p>通过设置<code>webpack proxy</code>实现代理请求后，相当于浏览器与服务端中添加一个代理者</p> 
<p>当本地发送请求的时候，代理服务器响应该请求，并将请求转发到目标服务器，目标服务器响应数据后再将数据返回给代理服务器，最终再由代理服务器将数据响应给本地</p> 
<p><img src="https://images2.imgbox.com/11/c9/G8tYDH5R_o.png" alt=""></p> 
<p>在代理服务器传递数据给本地浏览器的过程中，两者同源，并不存在跨域行为，这时候浏览器就能正常接收数据</p> 
<blockquote> 
 <p>注意：<code>「服务器与服务器之间请求数据并不会存在跨域行为，跨域行为是浏览器安全策略限制」</code></p> 
</blockquote> 
<h2><a id="9__babel_738"></a>9 介绍一下 babel原理</h2> 
<blockquote> 
 <p><code>babel</code> 的编译过程分为三个阶段：<strong>parsing</strong>、<strong>transforming</strong>、<strong>generating</strong>，以 ES6 编译为 ES5 作为例子：</p> 
</blockquote> 
<ol><li><code>ES6</code> 代码输入；</li><li><code>babylon</code> 进行解析得到 AST；</li><li><code>plugin</code> 用 <code>babel-traverse</code> 对 <code>AST</code>树进行遍历编译，得到新的 <code>AST</code>树；</li><li>用 <code>babel-generator</code> 通过 <code>AST</code>树生成 <code>ES5</code> 代码。</li></ol> 
<p><a href="http://interview.poetries.top/principle-docs/webpack/05-Babel%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E4%BD%BF%E7%94%A8.html" rel="nofollow">Babel原理及其使用(opens new window)</a></p> 
<h2><a id="10_Rollup_749"></a>10 介绍一下Rollup</h2> 
<blockquote> 
 <p>Rollup 是一款 ES Modules 打包器。它也可以将项目中散落的细小模块打包为整块代码，从而使得这些划分的模块可以更好地运行在浏览器环境或者 Node.js 环境。</p> 
</blockquote> 
<p><strong>Rollup优势：</strong></p> 
<ul><li>输出结果更加扁平，执行效率更高；</li><li>自动移除未引用代码；</li><li>打包结果依然完全可读。</li></ul> 
<p><strong>缺点</strong></p> 
<ul><li>加载非 ESM 的第三方模块比较复杂；</li><li>因为模块最终都被打包到全局中，所以无法实现 <code>HMR</code>；</li><li>浏览器环境中，代码拆分功能必须使用 <code>Require.js</code> 这样的 <code>AMD</code> 库</li></ul> 
<blockquote> 
 <ul><li>我们发现如果我们开发的是一个应用程序，需要大量引用第三方模块，同时还需要 HMR 提升开发体验，而且应用过大就必须要分包。那这些需求 Rollup 都无法满足。</li><li>如果我们是开发一个 JavaScript 框架或者库，那这些优点就特别有必要，而缺点呢几乎也都可以忽略，所以在很多像 React 或者 Vue 之类的框架中都是使用的 Rollup 作为模块打包器，而并非 Webpack</li></ul> 
</blockquote> 
<p><strong>总结一下</strong>：<code>Webpack 大而全，Rollup 小而美</code>。</p> 
<p>在对它们的选择上，我的基本原则是：<code>应用开发使用 Webpack，类库或者框架开发使用 Rollup</code>。</p> 
<p>不过这并不是绝对的标准，只是经验法则。因为 Rollup 也可用于构建绝大多数应用程序，而 Webpack 同样也可以构建类库或者框架。</p> 
<p><img src="https://images2.imgbox.com/5e/bf/18rmbYh2_o.png" alt=""></p> 
<h4><a id="hashchunkhashcontenthash_775"></a>hash、chunkhash、contenthash区别</h4> 
<ul><li>如果是<code>hash</code>的话，是和整个项目有关的，有一处文件发生更改则所有文件的<code>hash</code>值都会发生改变且它们共用一个<code>hash</code>值；</li><li>如果是<code>chunkhash</code>的话，只和<code>entry</code>的每个入口文件有关，也就是同一个<code>chunk</code>下的文件有所改动该<code>chunk</code>下的文件的<code>hash</code>值就会发生改变</li><li>如果是<code>contenthash</code>的话，和每个生成的文件有关，只有当要构建的文件内容发生改变时才会给该文件生成新的<code>hash</code>值，并不会影响其它文件。</li></ul> 
<h2><a id="11_webpack_781"></a>11 webpack常用插件总结</h2> 
<p><strong>1. 功能类</strong></p> 
<p><strong>1.1 html-webpack-plugin</strong></p> 
<blockquote> 
 <p>自动生成<code>html</code>，基本用法：</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token comment">// 生成文件名</span>
  template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'./index.html'</span><span class="token punctuation">)</span> <span class="token comment">// 模班文件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>1.2 copy-webpack-plugin</strong></p> 
<blockquote> 
 <p>拷贝资源插件</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">from</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'./vendor/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    to<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'./dist/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ignore<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*.json'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>1.3 webpack-manifest-plugin &amp;&amp; assets-webpack-plugin</strong></p> 
<blockquote> 
 <p>俩个插件效果一致，都是生成编译结果的资源单，只是资源单的数据结构不一致而已</p> 
</blockquote> 
<p><strong>webpack-manifest-plugin 基本用法</strong></p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ManifestPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>assets-webpack-plugin 基本用法</strong></p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">AssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>1.4 clean-webpack-plugin</strong></p> 
<blockquote> 
 <p>在编译之前清理指定目录指定内容</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token comment">// 清理目录</span>
<span class="token keyword">const</span> pathsToClean <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'dist'</span><span class="token punctuation">,</span>
  <span class="token string">'build'</span>
<span class="token punctuation">]</span>
 
<span class="token comment">// 清理参数</span>
<span class="token keyword">const</span> cleanOptions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  exclude<span class="token operator">:</span>  <span class="token punctuation">[</span><span class="token string">'shared.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 跳过文件</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span>pathsToClean<span class="token punctuation">,</span> cleanOptions<span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>1.5 compression-webpack-plugin</strong></p> 
<blockquote> 
 <p>提供带 <code>Content-Encoding</code> 编码的压缩版的资源</p> 
</blockquote> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>1.6 progress-bar-webpack-plugin</strong></p> 
<blockquote> 
 <p>编译进度条插件</p> 
</blockquote> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">//...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ProgressBarPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>2. 代码相关类</strong></p> 
<p><strong>2.1 webpack.ProvidePlugin</strong></p> 
<blockquote> 
 <p>自动加载模块，如 <code>$</code> 出现，就会自动加载模块；<code>$</code> 默认为<code>'jquery'</code>的<code>exports</code></p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>2.2 webpack.DefinePlugin</strong></p> 
<blockquote> 
 <p>定义全局常量</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token string">'process.env'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>2.3 mini-css-extract-plugin &amp;&amp; extract-text-webpack-plugin</strong></p> 
<blockquote> 
 <p>提取css样式，对比</p> 
</blockquote> 
<ul><li><code>mini-css-extract-plugin</code> 为<code>webpack4</code>及以上提供的<code>plugin</code>，支持<code>css chunk</code></li><li><code>extract-text-webpack-plugin</code> 只能在<code>webpack3</code> 及一下的版本使用，不支持<code>css chunk</code></li></ul> 
<p><strong>基本用法 extract-text-webpack-plugin</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"extract-text-webpack-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          fallback<span class="token operator">:</span> <span class="token string">"style-loader"</span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token string">"css-loader"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">"styles.css"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>基本用法 mini-css-extract-plugin</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mini-css-extract-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            loader<span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
              publicPath<span class="token operator">:</span> <span class="token string">'/'</span>  <span class="token comment">// chunk publicPath</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">"css-loader"</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      filename<span class="token operator">:</span> <span class="token string">"[name].css"</span><span class="token punctuation">,</span> <span class="token comment">// 主文件名</span>
      chunkFilename<span class="token operator">:</span> <span class="token string">"[id].css"</span>  <span class="token comment">// chunk文件名</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>3. 编译结果优化类</strong></p> 
<p><strong>3.1 wbepack.IgnorePlugin</strong></p> 
<blockquote> 
 <p>忽略<code>regExp</code>匹配的模块</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">/</span>locale$<span class="token operator">/</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>3.2 uglifyjs-webpack-plugin</strong></p> 
<blockquote> 
 <p>代码丑化，用于js压缩</p> 
</blockquote> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">// 开启缓存</span>
      parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启多线程编译</span>
      sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 是否sourceMap</span>
      uglifyOptions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 丑化参数</span>
        comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        compress<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          unused<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          dead_code<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          collapse_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          reduce_vars<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          comments<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>3.3 optimize-css-assets-webpack-plugin</strong></p> 
<blockquote> 
 <p>css压缩，主要使用 <code>cssnano</code> 压缩器 https://github.com/cssnano/cssnano</p> 
</blockquote> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      cssProcessor<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// css 压缩优化器</span>
      cssProcessorOptions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> discardComments<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> removeAll<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token comment">// 去除所有注释</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>3.4 webpack-md5-hash</strong></p> 
<blockquote> 
 <p>使你的<code>chunk</code>根据内容生成<code>md5</code>，用这个<code>md5</code>取代 <code>webpack chunkhash</code>。</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">var</span> WebpackMd5Hash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-md5-hash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ...</span>
  output<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//...</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">"[chunkhash].[id].chunk.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">WebpackMd5Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>3.5 SplitChunksPlugin</strong></p> 
<ul><li><code>CommonChunkPlugin</code> 的后世，用于<code>chunk</code>切割。</li></ul> 
<blockquote> 
 <p><code>webpack</code> 把 <code>chunk</code> 分为两种类型，一种是初始加载<code>initial chunk</code>，另外一种是异步加载 <code>async chunk</code>，如果不配置<code>SplitChunksPlugin</code>，<code>webpack</code>会在<code>production</code>的模式下自动开启，默认情况下，<code>webpack</code>会将 <code>node_modules</code> 下的所有模块定义为异步加载模块，并分析你的 <code>entry</code>、动态加载（<code>import()</code>、<code>require.ensure</code>）模块，找出这些模块之间共用的<code>node_modules</code>下的模块，并将这些模块提取到单独的<code>chunk</code>中，在需要的时候异步加载到页面当中，其中默认配置如下</p> 
</blockquote> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 异步加载chunk</span>
      minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token comment">// 文件名中chunk分隔符</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\/]node_modules[\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">// </span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">// 最小的共享chunk数</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>4. 编译优化类</strong></p> 
<p><strong>4.1 DllPlugin &amp;&amp; DllReferencePlugin &amp;&amp; autodll-webpack-plugin</strong></p> 
<ul><li><code>dllPlugin</code>将模块预先编译，<code>DllReferencePlugin</code> 将预先编译好的模块关联到当前编译中，当 <code>webpack</code> 解析到这些模块时，会直接使用预先编译好的模块。</li><li><code>autodll-webpack-plugin</code> 相当于 <code>dllPlugin</code> 和 <code>DllReferencePlugin</code> 的简化版，其实本质也是使用 <code>dllPlugin &amp;&amp; DllReferencePlugin</code>，它会在第一次编译的时候将配置好的需要预先编译的模块编译在缓存中，第二次编译的时候，解析到这些模块就直接使用缓存，而不是去编译这些模块</li></ul> 
<p><strong>dllPlugin 基本用法：</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
  library<span class="token operator">:</span> <span class="token string">'[name]_library'</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">'./vendor/'</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  entry<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    vendor<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'react-dom'</span><span class="token punctuation">]</span>  <span class="token comment">// 我们需要事先编译的模块，用entry表示</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> output<span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">// 使用dllPlugin</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>output<span class="token punctuation">.</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> output<span class="token punctuation">.</span>library <span class="token comment">// 全局变量名， 也就是 window 下 的 [output.library]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>DllReferencePlugin 基本用法：</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> manifest <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span> <span class="token string">'vendor.js.json'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span>manifest<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 引进dllPlugin编译的json文件</span>
      name<span class="token operator">:</span> <span class="token string">'vendor_library'</span> <span class="token comment">// 全局变量名，与dllPlugin声明的一致</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>autodll-webpack-plugin 基本用法：</strong></p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">AutoDllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      inject<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 与 html-webpack-plugin 结合使用，注入html中</span>
      filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
      entry<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        vendor<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'react'</span><span class="token punctuation">,</span>
          <span class="token string">'react-dom'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>4.2 happypack &amp;&amp; thread-loader</strong></p> 
<blockquote> 
 <p>多线程编译，加快编译速度，<code>thread-loader</code>不可以和 <code>mini-css-extract-plugin</code> 结合使用</p> 
</blockquote> 
<p><strong>happypack 基本用法</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> happyThreadPool <span class="token operator">=</span> HappyPack<span class="token punctuation">.</span><span class="token function">ThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> size<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> happyLoaderId <span class="token operator">=</span> <span class="token string">'happypack-for-react-babel-loader'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.jsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      loader<span class="token operator">:</span> <span class="token string">'happypack/loader'</span><span class="token punctuation">,</span>
      query<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        id<span class="token operator">:</span> happyLoaderId
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    id<span class="token operator">:</span> happyLoaderId<span class="token punctuation">,</span>
    threadPool<span class="token operator">:</span> happyThreadPool<span class="token punctuation">,</span>
    loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>thread-loader 基本用法</strong></p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"thread-loader"</span><span class="token punctuation">,</span>
          <span class="token comment">// your expensive loader (e.g babel-loader)</span>
          <span class="token string">"babel-loader"</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>4.3 hard-source-webpack-plugin &amp;&amp; cache-loader</strong></p> 
<blockquote> 
 <p>使用模块编译缓存，加快编译速度</p> 
</blockquote> 
<p><strong>hard-source-webpack-plugin 基本用法</strong></p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>cache-loader 基本用法</strong></p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.ext$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'cache-loader'</span><span class="token punctuation">,</span>
          <span class="token operator">...</span>loaders
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>5. 编译分析类</strong></p> 
<p><strong>5.1 webpack-bundle-analyzer</strong></p> 
<blockquote> 
 <p>编译模块分析插件</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  analyzerMode<span class="token operator">:</span> <span class="token string">'server'</span><span class="token punctuation">,</span>
  analyzerHost<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
  analyzerPort<span class="token operator">:</span> <span class="token number">8889</span><span class="token punctuation">,</span>
  reportFilename<span class="token operator">:</span> <span class="token string">'report.html'</span><span class="token punctuation">,</span>
  defaultSizes<span class="token operator">:</span> <span class="token string">'parsed'</span><span class="token punctuation">,</span>
  generateStatsFile<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  statsFilename<span class="token operator">:</span> <span class="token string">'stats.json'</span><span class="token punctuation">,</span>
  statsOptions<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  logLevel<span class="token operator">:</span> <span class="token string">'info'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> 
<p><strong>5.2 stats-webpack-plugin &amp;&amp; PrefetchPlugin</strong></p> 
<blockquote> 
 <p><code>stats-webpack-plugin</code> 将构建的统计信息写入文件，该文件可在 http://webpack.github.io/analyse中上传进行编译分析，并根据分析结果，可使用 <code>PrefetchPlugin</code> 对部分模块进行预解析编译</p> 
</blockquote> 
<p><strong>stats-webpack-plugin 基本用法：</strong></p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">StatsPlugin</span><span class="token punctuation">(</span><span class="token string">'stats.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
      chunkModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules[\/]react</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>PrefetchPlugin 基本用法：</strong></p> 
<pre><code class="prism language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>PrefetchPlugin</span><span class="token punctuation">(</span><span class="token string">'/web/'</span><span class="token punctuation">,</span> <span class="token string">'app/modules/HeaderNav.jsx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>PrefetchPlugin</span><span class="token punctuation">(</span><span class="token string">'/web/'</span><span class="token punctuation">,</span> <span class="token string">'app/pages/FrontPage.jsx'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>5.3 speed-measure-webpack-plugin</strong></p> 
<blockquote> 
 <p>统计编译过程中，各<code>loader</code>和<code>plugin</code>使用的时间</p> 
</blockquote> 
<pre><code class="prism language-js"><span class="token keyword">const</span> SpeedMeasurePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"speed-measure-webpack-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MyOtherPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="12_webpack_1290"></a>12 webpack热更新原理</h2> 
<p><img src="" alt=""></p> 
<ul><li>当修改了一个或多个文件；</li><li>文件系统接收更改并通知 <code>webpack</code>；</li><li><code>webpack</code> 重新编译构建一个或多个模块，并通知 <code>HMR</code> 服务器进行更新；</li><li><code>HMR Server</code> 使用 <code>webSocket</code> 通知 <code>HMR runtime</code> 需要更新，<code>HMR</code> 运行时通过 <code>HTTP</code> 请求更新 <code>jsonp</code></li><li><code>HMR</code> 运行时替换更新中的模块，如果确定这些模块无法更新，则触发整个页面刷新</li></ul> 
<h2><a id="13_webpack_1300"></a>13 webpack原理简述</h2> 
<p><strong>1.1 核心概念</strong></p> 
<blockquote> 
 <p>JavaScript 的 模块打包工具 (module bundler)。通过分析模块之间的依赖，最终将所有模块打包成一份或者多份代码包 (bundler)，供 HTML 直接引用。实质上，Webpack 仅仅提供了 打包功能 和一套 文件处理机制，然后通过生态中的各种 Loader 和 Plugin 对代码进行预编译和打包。因此 Webpack 具有高度的可拓展性，能更好的发挥社区生态的力量。</p> 
</blockquote> 
<ul><li><strong>Entry</strong>: 入口文件，<code>Webpack</code>会从该文件开始进行分析与编译；</li><li><strong>Output</strong>: 出口路径，打包后创建 <code>bundler</code>的文件路径以及文件名；</li><li><strong>Module</strong>: 模块，在 <code>Webpack</code> 中任何文件都可以作为一个模块，会根据配置的不同的 <code>Loader</code> 进行加载和打包；</li><li><strong>Chunk</strong>: 代码块，可以根据配置，将所有模块代码合并成一个或多个代码块，以便按需加载，提高性能；</li><li><strong>Loader</strong>: 模块加载器，进行各种文件类型的加载与转换；</li><li><strong>Plugin</strong>: 拓展插件，可以通过 <code>Webpack</code> 相应的事件钩子，介入到打包过程中的任意环节，从而对代码按需修改；</li></ul> 
<p><strong>1.2 工作流程 (加载 - 编译 - 输出)</strong></p> 
<ol><li>读取配置文件，按命令 初始化 配置参数，创建 <code>Compiler</code> 对象；</li><li>调用插件的 <code>apply</code> 方法 挂载插件 监听，然后从入口文件开始执行编译；</li><li>按文件类型，调用相应的 <code>Loader</code> 对模块进行 编译，并在合适的时机点触发对应的事件，调用 <code>Plugin</code> 执行，最后再根据模块 依赖查找 到所依赖的模块，递归执行第三步；</li><li>将编译后的所有代码包装成一个个代码块 (<code>Chunk</code>)， 并按依赖和配置确定 输出内容。这个步骤，仍然可以通过 <code>Plugin</code> 进行文件的修改;</li><li>最后，根据 <code>Output</code> 把文件内容一一写入到指定的文件夹中，完成整个过程；</li></ol> 
<p><strong>1.3 模块包装</strong></p> 
<pre><code class="prism language-js"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 模拟 require 函数，从内存中加载模块；</span>
	<span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 缓存模块</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
			l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
			exports<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 执行代码；</span>
		modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// Flag: 标记是否加载完成；</span>
		module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		
		<span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// ...</span>
	
	<span class="token comment">// 开始执行加载入口文件；</span>
	<span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">"./src/index.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
 	<span class="token string">"./src/index.js"</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 使用 eval 执行编译后的代码；</span>
		<span class="token comment">// 继续递归引用模块内部依赖；</span>
		<span class="token comment">// 实际情况并不是使用模板字符串，这里是为了代码的可读性；</span>
		<span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
			__webpack_require__.r(__webpack_exports__);
			//
			var _test__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__("test", ./src/test.js");
		</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string">"./src/test.js"</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>总结:</strong></p> 
<ul><li><strong>模块机制</strong>: <code>webpack</code>自己实现了一套模拟模块的机制，将其包裹于业务代码的外部，从而提供了一套模块机制；</li><li><strong>文件编译</strong>: <code>webpack</code>规定了一套编译规则，通过 <code>Loader</code> 和 <code>Plugin</code>，以管道的形式对文件字符串进行处理；</li></ul> 
<p><strong>1.4 webpack的打包原理</strong></p> 
<ul><li><code>初始化参数</code>：从配置文件和 <code>Shell</code> 语句中读取与合并参数，得出最终的参数</li><li><code>开始编译</code>：用上一步得到的参数初始化 <code>Compiler</code> 对象，加载所有配置的插件，执行对象的 <code>run</code> 方法开始执行编译</li><li><code>确定入口</code>：根据配置中的 <code>entry</code> 找出所有的入口文件</li><li><code>编译模块</code>：从入口文件出发，调用所有配置的 <code>Loader</code> 对模块进行翻译，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理</li><li><code>完成模块编译</code>：在经过第<code>4</code>步使用 <code>Loader</code> 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系</li><li><code>输出资源</code>：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 <code>Chunk</code>，再把每个 <code>Chunk</code> 转换成一个单独的文件加入到输出列表，这步是可以修改输出内容的最后机会</li><li><code>输出完成</code>：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统</li></ul> 
<p><strong>1.5 webpack的打包原理详细</strong></p> 
<p><strong>相关问题</strong></p> 
<ul><li><code>webpack</code> 工作流程是怎样的</li><li><code>webpack</code> 在不同阶段做了什么事情</li></ul> 
<p>webpack 是一种模块打包工具，可以将各类型的资源，例如图片、CSS、JS 等，转译组合为 JS 格式的 <code>bundle</code> 文件</p> 
<p><strong>webpack 构建的核心任务是完成内容转化和资源合并。主要包含以下 3 个阶段：</strong></p> 
<ol><li>初始化阶段</li></ol> 
<ul><li><strong>初始化参数</strong>：从配置文件、配置对象和 Shell 参数中读取并与默认参数进行合并，组合成最终使用的参数</li><li><strong>创建编译对象</strong>：用上一步得到的参数创建 <code>Compiler</code> 对象。</li><li><strong>初始化编译环境</strong>：包括注入内置插件、注册各种模块工厂、初始化 <code>RuleSet</code> 集合、加载配置的插件等</li></ul> 
<ol start="2"><li>构建阶段</li></ol> 
<ul><li><strong>开始编译</strong>：执行 <code>Compiler</code> 对象的 <code>run</code> 方法，创建 <code>Compilation</code> 对象。</li><li><strong>确认编译入口</strong>：进入 <code>entryOption</code> 阶段，读取配置的 <code>Entries</code>，递归遍历所有的入口文件，调用 <code>Compilation.addEntry</code> 将入口文件转换为 Dependency 对象。</li><li><strong>编译模块（make）</strong> ： 调用 <code>normalModule</code> 中的 <code>build</code> 开启构建，从 <code>entry</code> 文件开始，调用 <code>loader</code> 对模块进行转译处理，然后调用 JS 解释器（<code>acorn</code>）将内容转化为 <code>AST</code> 对象，然后递归分析依赖，依次处理全部文件。</li><li><strong>完成模块编译</strong>：在上一步处理好所有模块后，得到模块编译产物和依赖关系图</li></ul> 
<ol start="3"><li>生成阶段</li></ol> 
<ul><li><strong>输出资源（seal）</strong> ：根据入口和模块之间的依赖关系，组装成多个包含多个模块的 <code>Chunk</code>，再把每个 <code>Chunk</code> 转换成一个 <code>Asset</code> 加入到输出列表，这步是可以修改输出内容的最后机会。</li><li><strong>写入文件系统（emitAssets）</strong> ：确定好输出内容后，根据配置的 <code>output</code> 将内容写入文件系统</li></ul> 
<p><strong>知识点深入</strong></p> 
<p><strong>1. webpack 初始化过程</strong></p> 
<p>从 webpack 项目 <code>webpack.config.js</code> 文件 webpack 方法出发，可以看到初始化过程如下：</p> 
<p><img src="" alt=""></p> 
<ul><li> <p>将命令行参数和用户的配置文件进行合并</p> </li><li> <p>调用 <code>getValidateSchema</code> 对配置进行校验</p> </li><li> <p>调用 <code>createCompiler</code> 创建 <code>Compiler</code> 对象</p> 
  <ul><li>将用户配置和默认配置进行合并处理</li><li>实例化 <code>Compiler</code></li><li>实例化 <code>NodeEnvironmentPlugin</code></li><li>处理用户配置的 <code>plugins</code>，执行 <code>plugin</code> 的 <code>apply</code> 方法。</li><li>触发 <code>environment</code> 和 <code>afterEnvironment</code> 上注册的事件。</li><li>注册 <code>webpack</code> 内部插件。</li><li>触发 <code>initialize</code> 事件</li></ul> </li></ul> 
<pre><code class="prism language-js"><span class="token comment">// lib/webpack.js 122 行 部分代码省略处理</span>
<span class="token keyword">const</span> <span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">webpackOptionsSchemaCheck</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 校验参数</span>
    <span class="token function">getValidateSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>webpackOptionsSchema<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建 compiler 对象</span>
  compiler <span class="token operator">=</span> <span class="token function">createCompiler</span><span class="token punctuation">(</span>webpackOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// lib/webpack.js 57 行</span>
<span class="token keyword">const</span> <span class="token function-variable function">createCompiler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">rawOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 统一合并处理参数</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getNormalizedWebpackOptions</span><span class="token punctuation">(</span>rawOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">applyWebpackOptionsBaseDefaults</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 实例化 compiler</span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 把 options 挂载到对象上</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token comment">// NodeEnvironmentPlugin 是对 fs 模块的封装，用来处理文件输入输出等</span>
  <span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    infrastructureLogging<span class="token operator">:</span> options<span class="token punctuation">.</span>infrastructureLogging<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册用户配置插件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">applyWebpackOptionsDefaults</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 触发 environment 和 afterEnvironment 上注册的事件</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册 webpack 内置插件</span>
  <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>2. webpack 构建阶段做了什么</strong></p> 
<p>在 webpack 函数执行完之后，就到主要的构建阶段，首先执行 <code>compiler.run()</code>，然后触发一系列钩子函数，执行 <code>compiler.compile()</code></p> 
<p><img src="" alt=""></p> 
<ul><li> <p>在实例化 <code>compiler</code> 之后，执行 <code>compiler.run()</code></p> </li><li> <p>执行 <code>newCompilation</code> 函数，调用 <code>createCompilation</code> 初始化 <code>Compilation</code> 对象</p> </li><li> <p>执行 <code>_addEntryItem</code> 将入口文件存入 <code>this.entries</code>（<code>map</code> 对象），遍历 <code>this.entries</code> 对象构建 <code>chunk</code>。</p> </li><li> <p>执行 <code>handleModuleCreation</code>，开始创建模块实例。</p> </li><li> <p>执行 <code>moduleFactory.create</code> 创建模块</p> 
  <ul><li>执行 <code>factory.hooks.factorize.call</code> 钩子，然后会调用 <code>ExternalModuleFactoryPlugin</code> 中注册的钩子，用于配置外部文件的模块加载方式</li><li>使用 <code>enhanced-resolve</code> 解析模块和 <code>loader</code> 的真实绝对路径</li><li>执行 <code>new NormalModule()</code> 创建 <code>module</code> 实例</li></ul> </li><li> <p>执行 <code>addModule</code>，存储 <code>module</code></p> </li><li> <p>执行 <code>buildModule</code>，添加模块到模块队列 <code>buildQueue</code>，开始构建模块, 这里会调用 <code>normalModule</code> 中的 <code>build</code> 开启构建</p> 
  <ul><li>创建 <code>loader</code> 上下文。</li><li>执行 <code>runLoaders</code>，通过 <code>enhanced-resolve</code> 解析得到的模块和 <code>loader</code> 的路径获取函数，执行 <code>loader</code>。</li><li>生成模块的 <code>hash</code></li></ul> </li><li> <p>所有依赖都解析完毕后，构建阶段结束</p> </li></ul> 
<pre><code class="prism language-js">  <span class="token comment">// 构建过程涉及流程比较复杂，代码会做省略</span>

  <span class="token comment">// lib/webpack.js 1284行</span>
  <span class="token comment">// 开启编译流程</span>
  compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token parameter">err2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">callback</span><span class="token punctuation">(</span>err <span class="token operator">||</span> err2<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// lib/compiler.js 1081行</span>
  <span class="token comment">// 开启编译流程</span>
  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilationParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建 Compilation 对象</span>
    <span class="token keyword">const</span> Compilation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilation</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// lib/Compilation.js 1865行</span>
  <span class="token comment">// 确认入口文件</span>
  <span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_addEntryItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// lib/Compilation.js 1834行</span>
  <span class="token comment">// 开始创建模块流程，创建模块实例</span>
  <span class="token function">addModuleTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleModuleCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// lib/Compilation.js 1548行</span>
  <span class="token comment">// 开始创建模块流程，创建模块实例</span>
  <span class="token function">handleModuleCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">factorizeModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// lib/Compilation.js 1712行</span>
  <span class="token comment">// 添加到创建模块队列，执行创建模块</span>
  <span class="token function">factorizeModule</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>factorizeQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// lib/Compilation.js 1834行</span>
  <span class="token comment">// 保存需要构建模块</span>
  <span class="token function">_addModule</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// lib/Compilation.js 1284行</span>
  <span class="token comment">// 添加模块进模块编译队列，开始编译</span>
  <span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>buildQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p><strong>3. webpack 生成阶段做了什么</strong></p> 
<blockquote> 
 <p>构建阶段围绕 <code>module</code> 展开，生成阶段则围绕 <code>chunks</code> 展开。经过构建阶段之后，webpack 得到足够的模块内容与模块关系信息，之后通过 <code>Compilation.seal</code> 函数生成最终资源</p> 
</blockquote> 
<p><strong>3.1 生成产物</strong></p> 
<p>执行 <code>Compilation.seal</code> 进行产物的封装</p> 
<ul><li> <p>构建本次编译的 <code>ChunkGraph</code> 对象，执行 <code>buildChunkGraph</code>，这里会将 <code>import()</code>、<code>require.ensure</code> 等方法生成的动态模块添加到 <code>chunks</code> 中</p> </li><li> <p>遍历 <code>Compilation.modules</code> 集合，将 <code>module</code> 按 <strong><code>entry</code>/动态引入</strong> 的规则分配给不同的 <code>Chunk</code> 对象。</p> </li><li> <p>调用 <code>Compilation.emitAssets</code> 方法将 <code>assets</code> 信息记录到 <code>Compilation.assets</code> 对象中。</p> </li><li> <p>执行 <code>hooks.optimizeChunkModules</code> 的钩子，这里开始进行代码生成和封装。</p> 
  <ul><li>执行一系列钩子函数（<code>reviveModules</code>, <code>moduleId</code>, <code>optimizeChunkIds</code> 等）</li><li>执行 <code>createModuleHashes</code> 更新模块 <code>hash</code></li><li>执行 <code>JavascriptGenerator</code> 生成模块代码，这里会遍历 <code>modules</code>，创建构建任务，循环使用 <code>JavascriptGenerator</code> 构建代码，这时会将 <code>import</code> 等模块引入方式替换为 <code>webpack_require</code> 等，并将生成结果存入缓存</li><li>执行 <code>processRuntimeRequirements</code>，根据生成的内容所使用到的 <code>webpack_require</code> 的函数，添加对应的代码</li><li>执行 <code>createHash</code> 创建 <code>chunk</code> 的 <code>hash</code></li><li>执行 <code>clearAssets</code> 清除 <code>chunk</code> 的 <code>files</code> 和 <code>auxiliary</code>，这里缓存的是生成的 <code>chunk</code> 的文件名，主要是清除上次构建产生的废弃内容</li></ul> </li></ul> 
<p><strong>3.2 文件输出</strong></p> 
<p>回到 <code>Compiler</code> 的流程中，执行 <code>onCompiled</code> 回调。</p> 
<ul><li>触发 <code>shouldEmit</code> 钩子函数，这里是最后能优化产物的钩子。</li><li>遍历 <code>module</code> 集合，根据 <code>entry</code> 配置及引入资源的方式，将 <code>module</code> 分配到不同的 <code>chunk</code>。</li><li>遍历 <code>chunk</code> 集合，调用 <code>Compilation.emitAsset</code> 方法标记 <code>chunk</code> 的输出规则，即转化为 <code>assets</code> 集合。</li><li>写入本地文件，用的是 webpack 函数执行时初始化的文件流工具。</li><li>执行 <code>done</code> 钩子函数，这里会执行 <code>compiler.run()</code> 的回调，再执行 <code>compiler.close()</code>，然后执行持久化存储（前提是使用的 <code>filesystem</code> 缓存模式）</li></ul> 
<p><strong>1.6 总结</strong></p> 
<ol><li><strong>初始化参数</strong>：从配置文件和 <code>Shell</code> 语句中读取并合并参数，得出最终的配置参数。</li><li><strong>开始编译</strong>：从上一步得到的参数初始化 <code>Compiler</code> 对象，加载所有配置的插件，执行对象的 <code>run</code> 方法开始执行编译。</li><li><strong>确定入口</strong>：根scope据配置中的 <code>entry</code> 找出所有的入口文件。</li><li><strong>编译模块</strong>：从入口文件出发，调用所有配置的 <code>loader</code> 对模块进行翻译，再找出该模块依赖的模块，这个步骤是递归执行的，直至所有入口依赖的模块文件都经过本步骤的处理。</li><li><strong>完成模块编译</strong>：经过第 <code>4</code> 步使用 <code>loader</code> 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系。</li><li><strong>输出资源</strong>：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 <code>chunk</code>，再把每个 <code>chunk</code> 转换成一个单独的文件加入到输出列表，这一步是可以修改输出内容的最后机会。</li><li><strong>输出完成</strong>：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统。</li></ol> 
<h2><a id="14_webpack_1608"></a>14 webpack性能优化-构建速度</h2> 
<blockquote> 
 <p>先分析遇到哪些问题，在配合下面的方法优化，不要上来就回答，让人觉得背面试题</p> 
</blockquote> 
<ul><li> <p>优化<code>babel-loader</code>缓存 <img src="" alt=""></p> </li><li> <p><code>IgnorePlugin</code> 忽略某些包，避免引入无用模块（直接不引入，需要在代码中引入）</p> 
  <ul><li><code>import moment from 'moment'</code></li><li>默认会引入所有语言JS代码，代码过大</li></ul> <pre><code class="prism language-js"><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span>
moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'zh-cn'</span><span class="token punctuation">)</span> <span class="token comment">// 设置语言为中文</span>

<span class="token comment">// 手动引入中文语言包</span>
<span class="token keyword">import</span> <span class="token string">'moment/locale/zh-cn'</span>
</code></pre> <pre><code class="prism language-js"><span class="token comment">// webpack.prod.js</span>
pluins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 忽略 moment 下的 /locale 目录</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">/</span>locale<span class="token operator">/</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> </li><li> <p><code>noParse</code> 避免重复打包（引入但不打包） <img src="" alt=""></p> </li><li> <p><code>happyPack</code>多线程打包</p> 
  <ul><li>JS单线程的，开启多进程打包</li><li>提高构建速度(特别是多核<code>CPU</code>)</li></ul> <pre><code class="prism language-js">  <span class="token comment">// webpack.prod.js</span>
  <span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span>

  <span class="token punctuation">{<!-- --></span>
      module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          rules<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token comment">// js</span>
              <span class="token punctuation">{<!-- --></span>
                  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token comment">// 把对 .js 文件的处理转交给 id 为 babel 的 HappyPack 实例</span>
                  use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'happypack/loader?id=babel'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  include<span class="token operator">:</span> srcPath<span class="token punctuation">,</span>
                  <span class="token comment">// exclude: /node_modules/</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// happyPack 开启多进程打包</span>
          <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              <span class="token comment">// 用唯一的标识符 id 来代表当前的 HappyPack 是用来处理一类特定的文件</span>
              id<span class="token operator">:</span> <span class="token string">'babel'</span><span class="token punctuation">,</span>
              <span class="token comment">// 如何处理 .js 文件，用法和 Loader 配置中一样</span>
              loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory'</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre> </li><li> <p><code>parallelUglifyPlugin</code>多进程压缩<code>JS</code></p> 
  <ul><li> <p><strong>关于多进程</strong></p> 
    <ul><li>项目较大，打包较慢，开启多进程能提高速度</li><li>项目较小，打包很快，开启多进程反而会降低速度（进程开销）</li><li>按需使用</li></ul> <pre><code class="prism language-js"><span class="token comment">// webpack.prod.js</span>
<span class="token keyword">const</span> ParallelUglifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-parallel-uglify-plugin'</span><span class="token punctuation">)</span>

<span class="token punctuation">{<!-- --></span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 使用 ParallelUglifyPlugin 并行压缩输出的 JS 代码</span>
        <span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 传递给 UglifyJS 的参数</span>
            <span class="token comment">// （还是使用 UglifyJS 压缩，只不过帮助开启了多进程）</span>
            uglifyJS<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                output<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    beautify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 最紧凑的输出</span>
                    comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 删除所有的注释</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                compress<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 删除所有的 `console` 语句，可以兼容ie浏览器</span>
                    drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token comment">// 内嵌定义了但是只用到一次的变量</span>
                    collapse_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token comment">// 提取出出现多次但是没有定义成变量去引用的静态值</span>
                    reduce_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

    
</code></pre> </li></ul> </li><li> <p>自动刷新（开发环境）使用<code>dev-server</code>即可 <img src="" alt=""></p> </li><li> <p>热更新（开发环境）</p> 
  <ul><li> <p>自动刷新：整个网页全部刷新，速度较慢，状态会丢失</p> </li><li> <p>热更新：新代码生效，网页不刷新，状态不丢失</p> <pre><code class="prism language-js"><span class="token comment">// webpack.dev.js</span>
<span class="token keyword">const</span> HotModuleReplacementPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/HotModuleReplacementPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entry<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// index: path.join(srcPath, 'index.js'),</span>
    index<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'webpack-dev-server/client?http://localhost:8080/'</span><span class="token punctuation">,</span>
        <span class="token string">'webpack/hot/dev-server'</span><span class="token punctuation">,</span>
        path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'index.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    other<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'other.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
devServer<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>

 
        
    
</code></pre> <pre><code class="prism language-js"><span class="token comment">// 代码中index.js</span>

<span class="token comment">// 增加，开启热更新之后的代码逻辑</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 注册哪些模块需要热更新</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> sumRes <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sumRes in hot'</span><span class="token punctuation">,</span> sumRes<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

 
        
    
</code></pre> </li></ul> </li><li> <p><code>DllPlugin</code> 动态链接库（<code>dllPlugin</code>只适用于开发环境,因为生产环境下打包一次就完了,没有必要用于生产环境）</p> 
  <ul><li> <p>前端框架如<code>react</code>、<code>vue</code>体积大，构建慢</p> </li><li> <p>较稳定，不常升级版本，同一个版本只构建一次，不用每次都重新构建</p> </li><li> <p><code>webpack</code>已内置<code>DllPlugin</code>，不需要安装</p> </li><li> <p><code>DllPlugin</code>打包出<code>dll</code>文件</p> </li><li> <p><code>DllReferencePlugin</code>引用<code>dll</code>文件</p> <pre><code class="prism language-js"><span class="token comment">// webpack.common.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> srcPath<span class="token punctuation">,</span> distPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./paths'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    entry<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                include<span class="token operator">:</span> srcPath<span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

    
</code></pre> <pre><code class="prism language-js"><span class="token comment">// webpack.dev.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpackCommonConf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> srcPath<span class="token punctuation">,</span> distPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./paths'</span><span class="token punctuation">)</span>

<span class="token comment">// 第一，引入 DllReferencePlugin</span>
<span class="token keyword">const</span> DllReferencePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DllReferencePlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>webpackCommonConf<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                include<span class="token operator">:</span> srcPath<span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span> <span class="token comment">// 第二，不要再转换 node_modules 的代码</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// window.ENV = 'production'</span>
            <span class="token constant">ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 第三，告诉 Webpack 使用了哪些动态链接库</span>
        <span class="token keyword">new</span> <span class="token class-name">DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 描述 react 动态链接库的文件内容</span>
            manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>distPath<span class="token punctuation">,</span> <span class="token string">'react.manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
        progress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 显示打包的进度条</span>
        contentBase<span class="token operator">:</span> distPath<span class="token punctuation">,</span>  <span class="token comment">// 根目录</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 自动打开浏览器</span>
        compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 启动 gzip 压缩</span>

        <span class="token comment">// 设置代理</span>
        proxy<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 将本地 /api/xxx 代理到 localhost:3000/api/xxx</span>
            <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span>

            <span class="token comment">// 将本地 /api2/xxx 代理到 localhost:3000/xxx</span>
            <span class="token string">'/api2'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                target<span class="token operator">:</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span>
                pathRewrite<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">'/api2'</span><span class="token operator">:</span> <span class="token string">''</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

    
</code></pre> <pre><code class="prism language-js"><span class="token comment">// webpack.prod.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpackCommonConf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> srcPath<span class="token punctuation">,</span> distPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./paths'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>webpackCommonConf<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        filename<span class="token operator">:</span> <span class="token string">'bundle.[contenthash:8].js'</span><span class="token punctuation">,</span>  <span class="token comment">// 打包代码时，加上 hash 戳</span>
        path<span class="token operator">:</span> distPath<span class="token punctuation">,</span>
        <span class="token comment">// publicPath: 'http://cdn.abc.com'  // 修改所有静态文件 url 的前缀（如 cdn 域名），这里暂时用不到</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// window.ENV = 'production'</span>
            <span class="token constant">ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'production'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

 
        
    
</code></pre> <pre><code class="prism language-js"><span class="token comment">// webpack.dll.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> DllPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DllPlugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> srcPath<span class="token punctuation">,</span> distPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./paths'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
<span class="token comment">// JS 执行入口文件</span>
entry<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 把 React 相关模块的放到一个单独的动态链接库</span>
    react<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'react-dom'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
output<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 输出的动态链接库的文件名称，[name] 代表当前动态链接库的名称，</span>
    <span class="token comment">// 也就是 entry 中配置的 react 和 polyfill</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
    <span class="token comment">// 输出的文件都放到 dist 目录下</span>
    path<span class="token operator">:</span> distPath<span class="token punctuation">,</span>
    <span class="token comment">// 存放动态链接库的全局变量名称，例如对应 react 来说就是 _dll_react</span>
    <span class="token comment">// 之所以在前面加上 _dll_ 是为了防止全局变量冲突</span>
    library<span class="token operator">:</span> <span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 接入 DllPlugin</span>
    <span class="token keyword">new</span> <span class="token class-name">DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 动态链接库的全局变量名称，需要和 output.library 中保持一致</span>
    <span class="token comment">// 该字段的值也就是输出的 manifest.json 文件 中 name 字段的值</span>
    <span class="token comment">// 例如 react.manifest.json 中就有 "name": "_dll_react"</span>
    name<span class="token operator">:</span> <span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>
    <span class="token comment">// 描述动态链接库的 manifest.json 文件输出时的文件名称</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>distPath<span class="token punctuation">,</span> <span class="token string">'[name].manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

 
        
    
</code></pre> <pre><code class="prism language-js"><span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack serve --config build/webpack.dev.js"</span><span class="token punctuation">,</span>
    <span class="token string">"dll"</span><span class="token operator">:</span> <span class="token string">"webpack --config build/webpack.dll.js"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

 
        
    
</code></pre> </li></ul> </li></ul> 
<p><strong>优化打包速度完整代码</strong></p> 
<pre><code class="prism language-js"><span class="token comment">// webpack.common.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> srcPath<span class="token punctuation">,</span> distPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./paths'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    entry<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        index<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        other<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'other.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// babel-loader</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// new HtmlWebpackPlugin({<!-- --></span>
        <span class="token comment">//     template: path.join(srcPath, 'index.html'),</span>
        <span class="token comment">//     filename: 'index.html'</span>
        <span class="token comment">// })</span>

        <span class="token comment">// 多入口 - 生成 index.html</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
            <span class="token comment">// chunks 表示该页面要引用哪些 chunk （即上面的 index 和 other），默认全部引用</span>
            chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span> <span class="token string">'common'</span><span class="token punctuation">]</span>  <span class="token comment">// 要考虑代码分割</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 多入口 - 生成 other.html</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'other.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'other.html'</span><span class="token punctuation">,</span>
            chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'other'</span><span class="token punctuation">,</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span> <span class="token string">'common'</span><span class="token punctuation">]</span>  <span class="token comment">// 考虑代码分割</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-js"><span class="token comment">// webpack.dev.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpackCommonConf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> smart <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> srcPath<span class="token punctuation">,</span> distPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./paths'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HotModuleReplacementPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/HotModuleReplacementPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">smart</span><span class="token punctuation">(</span>webpackCommonConf<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// index: path.join(srcPath, 'index.js'),</span>
        index<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'webpack-dev-server/client?http://localhost:8080/'</span><span class="token punctuation">,</span>
            <span class="token string">'webpack/hot/dev-server'</span><span class="token punctuation">,</span>
            path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'index.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        other<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>srcPath<span class="token punctuation">,</span> <span class="token string">'other.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                include<span class="token operator">:</span> srcPath<span class="token punctuation">,</span>
                <span class="token comment">// exclude: /node_modules/</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 直接引入图片 url</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.(png|jpg|jpeg|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token string">'file-loader'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// {<!-- --></span>
            <span class="token comment">//     test: /.css$/,</span>
            <span class="token comment">//     // loader 的执行顺序是：从后往前</span>
            <span class="token comment">//     loader: ['style-loader', 'css-loader']</span>
            <span class="token comment">// },</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token comment">// loader 的执行顺序是：从后往前</span>
                loader<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span> <span class="token comment">// 加了 postcss</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token comment">// 增加 'less-loader' ，注意顺序</span>
                loader<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// window.ENV = 'production'</span>
            <span class="token constant">ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
        progress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 显示打包的进度条</span>
        contentBase<span class="token operator">:</span> distPath<span class="token punctuation">,</span>  <span class="token comment">// 根目录</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 自动打开浏览器</span>
        compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 启动 gzip 压缩</span>

        hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

        <span class="token comment">// 设置代理</span>
        proxy<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 将本地 /api/xxx 代理到 localhost:3000/api/xxx</span>
            <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span>

            <span class="token comment">// 将本地 /api2/xxx 代理到 localhost:3000/xxx</span>
            <span class="token string">'/api2'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                target<span class="token operator">:</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span>
                pathRewrite<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">'/api2'</span><span class="token operator">:</span> <span class="token string">''</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// watch: true, // 开启监听，默认为 false</span>
    <span class="token comment">// watchOptions: {<!-- --></span>
    <span class="token comment">//     ignored: /node_modules/, // 忽略哪些</span>
    <span class="token comment">//     // 监听到变化发生后会等300ms再去执行动作，防止文件更新太快导致重新编译频率太高</span>
    <span class="token comment">//     // 默认为 300ms</span>
    <span class="token comment">//     aggregateTimeout: 300,</span>
    <span class="token comment">//     // 判断文件是否发生变化是通过不停的去询问系统指定文件有没有变化实现的</span>
    <span class="token comment">//     // 默认每隔1000毫秒询问一次</span>
    <span class="token comment">//     poll: 1000</span>
    <span class="token comment">// }</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-js"><span class="token comment">// webpack.prod.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> smart <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> TerserJSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ParallelUglifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-parallel-uglify-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpackCommonConf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> srcPath<span class="token punctuation">,</span> distPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./paths'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">smart</span><span class="token punctuation">(</span>webpackCommonConf<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// filename: 'bundle.[contentHash:8].js',  // 打包代码时，加上 hash 戳</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].[contentHash:8].js'</span><span class="token punctuation">,</span> <span class="token comment">// name 即多入口时 entry 的 key</span>
        path<span class="token operator">:</span> distPath<span class="token punctuation">,</span>
        <span class="token comment">// publicPath: 'http://cdn.abc.com'  // 修改所有静态文件 url 的前缀（如 cdn 域名），这里暂时用不到</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// js</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token comment">// 把对 .js 文件的处理转交给 id 为 babel 的 HappyPack 实例</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'happypack/loader?id=babel'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                include<span class="token operator">:</span> srcPath<span class="token punctuation">,</span>
                <span class="token comment">// exclude: /node_modules/</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 图片 - 考虑 base64 编码的情况</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.(png|jpg|jpeg|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 小于 5kb 的图片用 base64 格式产出</span>
                        <span class="token comment">// 否则，依然延用 file-loader 的形式，产出 url 格式</span>
                        limit<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>

                        <span class="token comment">// 打包到 img 目录下</span>
                        outputPath<span class="token operator">:</span> <span class="token string">'/img1/'</span><span class="token punctuation">,</span>

                        <span class="token comment">// 设置图片的 cdn 地址（也可以统一在外面的 output 中设置，那将作用于所有静态资源）</span>
                        <span class="token comment">// publicPath: 'http://cdn.abc.com'</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 抽离 css</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token punctuation">[</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  <span class="token comment">// 注意，这里不再用 style-loader</span>
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 抽离 less</span>
            <span class="token punctuation">{<!-- --></span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token punctuation">[</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  <span class="token comment">// 注意，这里不再用 style-loader</span>
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 会默认清空 output.path 文件夹</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// window.ENV = 'production'</span>
            <span class="token constant">ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'production'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">// 抽离 css 文件</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            filename<span class="token operator">:</span> <span class="token string">'css/main.[contentHash:8].css'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">// 忽略 moment 下的 /locale 目录</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">/</span>locale<span class="token operator">/</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">// happyPack 开启多进程打包</span>
        <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 用唯一的标识符 id 来代表当前的 HappyPack 是用来处理一类特定的文件</span>
            id<span class="token operator">:</span> <span class="token string">'babel'</span><span class="token punctuation">,</span>
            <span class="token comment">// 如何处理 .js 文件，用法和 Loader 配置中一样</span>
            loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">// 使用 ParallelUglifyPlugin 并行压缩输出的 JS 代码</span>
        <span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 传递给 UglifyJS 的参数</span>
            <span class="token comment">// （还是使用 UglifyJS 压缩，只不过帮助开启了多进程）</span>
            uglifyJS<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                output<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    beautify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 最紧凑的输出</span>
                    comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 删除所有的注释</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                compress<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 删除所有的 `console` 语句，可以兼容ie浏览器</span>
                    drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token comment">// 内嵌定义了但是只用到一次的变量</span>
                    collapse_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token comment">// 提取出出现多次但是没有定义成变量去引用的静态值</span>
                    reduce_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    optimization<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 压缩 css</span>
        minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TerserJSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

        <span class="token comment">// 分割代码块</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
            <span class="token comment">/**
             * initial 入口chunk，对于异步导入的文件不处理
                async 异步chunk，只对异步导入的文件处理
                all 全部chunk
             */</span>

            <span class="token comment">// 缓存分组</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 第三方模块</span>
                vendor<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    name<span class="token operator">:</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span> <span class="token comment">// chunk 名称</span>
                    priority<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 权限更高，优先抽离，重要！！！</span>
                    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                    minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 大小限制</span>
                    minChunks<span class="token operator">:</span> <span class="token number">1</span>  <span class="token comment">// 最少复用过几次</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>

                <span class="token comment">// 公共的模块</span>
                common<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    name<span class="token operator">:</span> <span class="token string">'common'</span><span class="token punctuation">,</span> <span class="token comment">// chunk 名称</span>
                    priority<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 优先级</span>
                    minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 公共模块的大小限制</span>
                    minChunks<span class="token operator">:</span> <span class="token number">2</span>  <span class="token comment">// 公共模块最少复用过几次</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="webpack_2229"></a>webpack性能优化-产出代码（线上运行）</h2> 
<p><strong>前言</strong></p> 
<ul><li>体积更小</li><li>合理分包，不重复加载</li><li>速度更快、内存使用更少</li></ul> 
<p><strong>产出代码优化</strong></p> 
<ul><li>小图片<code>base64</code>编码，减少<code>http</code>请求</li></ul> 
<pre><code class="prism language-js"><span class="token comment">// 图片 - 考虑 base64 编码的情况</span>
module<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.(png|jpg|jpeg|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 小于 5kb 的图片用 base64 格式产出</span>
                    <span class="token comment">// 否则，依然延用 file-loader 的形式，产出 url 格式</span>
                    limit<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>

                    <span class="token comment">// 打包到 img 目录下</span>
                    outputPath<span class="token operator">:</span> <span class="token string">'/img1/'</span><span class="token punctuation">,</span>

                    <span class="token comment">// 设置图片的 cdn 地址（也可以统一在外面的 output 中设置，那将作用于所有静态资源）</span>
                    <span class="token comment">// publicPath: 'http://cdn.abc.com'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li> <p><code>bundle</code>加<code>contenthash</code>，有利于浏览器缓存</p> </li><li> <p>懒加载<code>import()</code>语法，减少首屏加载时间</p> </li><li> <p>提取公共代码（第三方代码<code>Vue</code>、<code>React</code>、<code>loadash</code>等）没有必要多次打包，可以提取到<code>vendor</code>中</p> </li><li> <p><code>IgnorePlugin</code>忽略不需要的包（如<code>moment</code>多语言），减少打包的代码</p> </li><li> <p>使用<code>CDN</code>加速，减少资源加载时间</p> <pre><code class="prism language-js">output<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  filename<span class="token operator">:</span> <span class="token string">'[name].[contentHash:8].js'</span><span class="token punctuation">,</span> <span class="token comment">// name 即多入口时 entry 的 key</span>
  path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 修改所有静态文件 url 的前缀（如 cdn 域名）</span>
  <span class="token comment">// 这样index.html中引入的js、css、图片等资源都会加上这个前缀</span>
  publicPath<span class="token operator">:</span> <span class="token string">'http://cdn.abc.com'</span>  
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> </li><li> <p><code>webpack</code>使用<code>production</code>模式，<code>mode: 'production'</code></p> 
  <ul><li> <p>自动压缩代码</p> </li><li> <p>启动<code>Tree Shaking</code></p> 
    <ul><li> <p><code>ES6</code>模块化，<code>import</code>和<code>export</code>，<code>webpack</code>会自动识别，才会生效</p> </li><li> <p><code>Commonjs</code>模块化，<code>require</code>和<code>module.exports</code>，<code>webpack</code>无法识别，不会生效</p> </li><li> <p><strong>ES6模块和Commonjs模块区别</strong></p> 
      <ul><li><code>ES6</code>模块是静态引入，编译时引入</li><li><code>Commonjs</code>是动态引入，执行时引入</li><li>只有<code>ES6 Module</code>才能静态分析，实现<code>Tree Shaking</code> <img src="" alt=""></li></ul> </li></ul> </li></ul> </li><li> <p><code>Scope Hoisting</code>：是<code>webpack3</code>引入的一个新特性，它会分析出模块之间的依赖关系，尽可能地把打散的模块合并到一个函数中去，减少代码间的引用，从而减少代码体积</p> 
  <ul><li>减少代码体积</li><li>创建函数作用域更少</li><li>代码可读性更好 <img src="" alt=""></li></ul> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/24352da0f8291c88d9c2d95762aa6de7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Unity-XCode 一些编译错误记录及解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f910a7c27cf4fa524f70d8d311d3a44b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">通过低代码开发实现数据可视化应用的简易指南</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>