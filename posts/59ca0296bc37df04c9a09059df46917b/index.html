<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>腾讯云轻量云服务器体验 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="腾讯云轻量云服务器体验" />
<meta property="og:description" content="建议直接在我的博客中阅读，有更好的排版，点击进入：https://www.xuxusheng.com 最近云服务器要到期了，但是续费就不能再用新用户优惠了。
考虑到我已经将所有的服务都迁移到了家里的小机器上，云服务器只是起到一个流量入口的作用，所以并不需要太好的配置。
这时候就需要选择一款配置一般、带宽足够、价钱便宜的云服务器了，正好腾讯云轻量云服务器有新用户优惠，完美。
过程记录一下，下次再过期的时候就可以不用动脑啦。
传送门，点击这里直接查看：
【腾讯云】轻量应用服务器Lighthouse，新朋友「轻」松上云，老朋友免费加「量」，1核2G5M限时低至99元/年起
一、购买 1核2G5M 的配置完美符合了我只需要一个便宜点的流量入口的需求，这里需要注意第一次购买的时候是优惠价 99 一年，后期续费就恢复成原价了，建议一次购买 3 年。
等待一会儿就能在控制台看到机器啦。
二、系统配置 1. 密码重置 服务器初始化好之后，会自动创建 ubuntu 和 lighthouse 两个用户，后者用于在网页中远程登录时使用。
首先在网页控制台中将 ubuntu 和 root 密码进行重置，由于系统默认禁止了 root 用户通过密码远程 ssh 登录，所以我们先使用 ubuntu 用户登录，然后通过 su 命令切换到 root 用户。
2. 修改默认编辑器 将系统默认编辑器修改为 vim。
使用 update-alternatives --config* editor 命令，并输入相应的编号即可。
3. vim 配置 默认的 vim 配置并没有开启一些高亮缩进之类的功能，不怎么方便使用。
参考：https://github.com/amix/vimrc
既然是作为服务器使用，那么选择其中的 basic 方案就行了。
将此文件 https://github.com/amix/vimrc/blob/master/vimrcs/basic.vim 内容复制到 ~/.vimrc 中即可。
4. 用户创建 不建议使用 root 用户进行操作，这里我们创建一个新的 work 用户。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/59ca0296bc37df04c9a09059df46917b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-29T21:03:48+08:00" />
<meta property="article:modified_time" content="2021-04-29T21:03:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">腾讯云轻量云服务器体验</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="httpswwwxuxushengcomhttpswwwxuxushengcompostE885BEE8AEAFE4BA91E8BDBBE9878FE4BA91E69C8DE58AA1E599A8E4BD93E9AA8C_0"></a><a href="https://www.xuxusheng.com/post/%E8%85%BE%E8%AE%AF%E4%BA%91%E8%BD%BB%E9%87%8F%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%93%E9%AA%8C" rel="nofollow">建议直接在我的博客中阅读，有更好的排版，点击进入：https://www.xuxusheng.com</a></h2> 
<p>最近云服务器要到期了，但是续费就不能再用新用户优惠了。</p> 
<p>考虑到我已经将所有的服务都迁移到了家里的小机器上，云服务器只是起到一个流量入口的作用，所以并不需要太好的配置。</p> 
<p>这时候就需要选择一款配置一般、带宽足够、价钱便宜的云服务器了，正好腾讯云轻量云服务器有新用户优惠，完美。</p> 
<p>过程记录一下，下次再过期的时候就可以不用动脑啦。</p> 
<blockquote> 
 <p><strong>传送门，点击这里直接查看：</strong><br> <a href="https://curl.qcloud.com/p72cDsD9" rel="nofollow">【腾讯云】轻量应用服务器Lighthouse，新朋友「轻」松上云，老朋友免费加「量」，1核2G5M限时低至99元/年起</a></p> 
</blockquote> 
<h2><a id="_14"></a>一、购买</h2> 
<p><a href="https://curl.qcloud.com/p72cDsD9" rel="nofollow"><img src="https://images2.imgbox.com/33/a7/JAYSyEV8_o.png" alt="【腾讯云】轻量应用服务器Lighthouse，新朋友「轻」松上云，老朋友免费加「量」，1核2G5M限时低至99元/年起"></a></p> 
<p><code>1核2G5M</code> 的配置完美符合了我只需要一个便宜点的流量入口的需求，这里需要注意第一次购买的时候是优惠价 99 一年，后期续费就恢复成原价了，建议一次购买 3 年。</p> 
<p><a href="https://curl.qcloud.com/p72cDsD9" rel="nofollow"><img src="https://images2.imgbox.com/94/b0/cg9cZIGu_o.png" alt="【腾讯云】轻量应用服务器Lighthouse，新朋友「轻」松上云，老朋友免费加「量」，1核2G5M限时低至99元/年起"></a></p> 
<p>等待一会儿就能在控制台看到机器啦。</p> 
<p><a href="https://curl.qcloud.com/p72cDsD9" rel="nofollow"><img src="https://images2.imgbox.com/f9/ae/iy4oRdxZ_o.png" alt="【腾讯云】轻量应用服务器Lighthouse，新朋友「轻」松上云，老朋友免费加「量」，1核2G5M限时低至99元/年起"></a></p> 
<h2><a id="_26"></a>二、系统配置</h2> 
<h3><a id="1__27"></a>1. 密码重置</h3> 
<p>服务器初始化好之后，会自动创建 <code>ubuntu</code> 和 <code>lighthouse</code> 两个用户，后者用于在网页中远程登录时使用。</p> 
<p>首先在网页控制台中将 <code>ubuntu</code> 和 <code>root</code> 密码进行重置，由于系统默认禁止了 root 用户通过密码远程 ssh 登录，所以我们先使用 <code>ubuntu</code> 用户登录，然后通过 <code>su</code> 命令切换到 <code>root</code> 用户。</p> 
<p><a href="https://curl.qcloud.com/p72cDsD9" rel="nofollow"><img src="https://images2.imgbox.com/47/e4/jaFOvPOF_o.png" alt="【腾讯云】轻量应用服务器Lighthouse，新朋友「轻」松上云，老朋友免费加「量」，1核2G5M限时低至99元/年起"></a></p> 
<h3><a id="2__35"></a>2. 修改默认编辑器</h3> 
<p>将系统默认编辑器修改为 <code>vim</code>。</p> 
<p>使用 <code>update-alternatives --config* editor</code> 命令，并输入相应的编号即可。</p> 
<p><a href="https://curl.qcloud.com/p72cDsD9" rel="nofollow"><img src="https://images2.imgbox.com/85/86/fzEIhFLk_o.png" alt="【腾讯云】轻量应用服务器Lighthouse，新朋友「轻」松上云，老朋友免费加「量」，1核2G5M限时低至99元/年起"></a></p> 
<h3><a id="3_vim__43"></a>3. vim 配置</h3> 
<p>默认的 <code>vim</code> 配置并没有开启一些高亮缩进之类的功能，不怎么方便使用。</p> 
<blockquote> 
 <p>参考：https://github.com/amix/vimrc</p> 
</blockquote> 
<p>既然是作为服务器使用，那么选择其中的 <code>basic</code> 方案就行了。</p> 
<p>将此文件 <a href="https://github.com/amix/vimrc/blob/master/vimrcs/basic.vim">https://github.com/amix/vimrc/blob/master/vimrcs/basic.vim</a> 内容复制到 <code>~/.vimrc</code> 中即可。</p> 
<h3><a id="4__53"></a>4. 用户创建</h3> 
<p>不建议使用 <code>root</code> 用户进行操作，这里我们创建一个新的 <code>work</code> 用户。</p> 
<pre><code class="prism language-bash">$ adduser work <span class="token comment"># 添加用户并设置密码</span>
</code></pre> 
<p>注意不要使用 <code>useradd</code> 命令，两者区别参见：https://blog.csdn.net/beitiandijun/article/details/41678251</p> 
<p><a href="https://imgtu.com/i/gkUPzt" rel="nofollow"><img src="https://images2.imgbox.com/39/65/ivCifEaO_o.png" alt="gkUPzt.png"></a></p> 
<p>同时给 <code>work</code> 用户加入管理员权限。</p> 
<ul><li>执行 <code>visudo</code> 命令，用于编辑 、etc/sudoers 文件</li><li>在 <code>root ALL=(ALL:ALL) ALL</code> 后面加入一行 <code>work ALL=(ALL:ALL) ALL</code></li></ul> 
<h3><a id="5__70"></a>5. 镜像源</h3> 
<p>和使用 <code>Ubuntu</code> 官方系统镜像安装不同，云服务商的系统镜像，一般默认就将系统镜像源设置成了自己内网环境中的私有镜像源，所以无需我们再次更改。</p> 
<p>执行下 <code>sudo apt update &amp;&amp; sudo apt upgrade</code> 即可。</p> 
<h3><a id="6__76"></a>6. 机器名称修改</h3> 
<p>默认的机器名称是一串编号（使用 <code>hostnamectl</code> 命令查看完整信息），不好看，修改下。</p> 
<p><a href="https://imgtu.com/i/gkUaWR" rel="nofollow"><img src="https://images2.imgbox.com/1b/e2/0UcfhOfR_o.png" alt="gkUaWR.png"></a></p> 
<p>执行 <code>sudo hostnamectl set-hostname &lt;你期望的hostname&gt;</code> 即可。</p> 
<p>重新登录之后就会发现 <code>hostname</code> 已经改变了。</p> 
<h3><a id="7__ssh_86"></a>7. 配置 ssh</h3> 
<p>执行 <code>ssh-keygen -t rsa -C "yourkey"</code>，然后一路回车。</p> 
<p>创建 <code>~/.ssh/authorized_keys</code> 文件，并将其权限改为 <code>600</code> , 并在其中加入公钥。</p> 
<pre><code class="prism language-bash">$ <span class="token function">touch</span> ~/.ssh/authorized_keys
$ <span class="token function">chmod</span> 600 ~/.ssh/authorized_keys
</code></pre> 
<p>ssh 对目录和文件的权限都有要求，不符合要求会导致登录出错，需要注意下。</p> 
<ul><li>~ 目录 750</li><li>~/.ssh 目录 700</li><li>~/.ssh/* 文件 600</li><li>~/.ssh/config 文件 700</li></ul> 
<h3><a id="8_speedtest__104"></a>8. speedtest 测速</h3> 
<blockquote> 
 <p>官网：https://www.speedtest.net/zh-Hans/apps/cli</p> 
</blockquote> 
<p>执行如下命令即可：</p> 
<pre><code class="prism language-bash">$ <span class="token function">curl</span> -s https://install.speedtest.net/app/cli/install.deb.sh <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span>
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> speedtest

$ speedtest
</code></pre> 
<h3><a id="9_unixBench__117"></a>9. unixBench 跑分</h3> 
<blockquote> 
 <p>参考：https://github.com/haydenjames/bench-scripts/blob/master/README.md#unixbenchsh</p> 
</blockquote> 
<p>执行如下命令即可：</p> 
<pre><code class="prism language-bash">$ <span class="token function">wget</span> --no-check-certificate https://github.com/teddysun/across/raw/master/unixbench.sh
$ <span class="token function">chmod</span> +x unixbench.sh
$ <span class="token function">sudo</span> ./unixbench.sh
</code></pre> 
<p>跑分结果：</p> 
<p><a href="https://imgtu.com/i/gkrMAf" rel="nofollow"><img src="https://images2.imgbox.com/35/5e/mRprTgiu_o.png" alt="gkrMAf.png"></a></p> 
<p>只有两百多分，有点垃圾，不过考虑到只是做个反代服务器，价钱也便宜，就能接受了，之前买的阿里云的非轻量云服务器，单核也就三四百分。</p> 
<h2><a id="_135"></a>三、应用安装及配置</h2> 
<h3><a id="1_ohmyzsh_137"></a>1. oh-my-zsh</h3> 
<blockquote> 
 <p>参考：https://github.com/ohmyzsh/ohmyzsh/wiki/Installing-ZSH</p> 
</blockquote> 
<p>理论上讲生产服务器上不应该装这个，不过既然是我自己个人用的小服务器，那就怎么方便怎么来好了。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 安装 zsh</span>
$ apt <span class="token function">install</span> zsh

<span class="token comment"># 设置 zsh 为默认</span>
$ chsh -s <span class="token variable"><span class="token variable">$(</span><span class="token function">which</span> zsh<span class="token variable">)</span></span>

<span class="token comment"># 安装 on-my-zsh</span>
$ sh -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span class="token variable">)</span></span>"</span>
</code></pre> 
<p><strong>on-my-zsh 插件安装</strong></p> 
<p>安装 <code>zsh-autosuggestions</code> 和 <code>zsh-syntax-highlighting</code> 两个插件。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 1. 克隆仓库到插件目录下</span>
<span class="token function">git</span> clone https://github.com/zsh-users/zsh-autosuggestions <span class="token variable">${ZSH_CUSTOM:-~/.oh-my-zsh/custom}</span>/plugins/zsh-autosuggestions

<span class="token function">git</span> clone https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="token variable">${ZSH_CUSTOM:-~/.oh-my-zsh/custom}</span>/plugins/zsh-syntax-highlighting

<span class="token comment"># 2.  在 ~/.zshrc 文件的 plugins 部分，加入 zsh-autosuggestions 和 zsh-autosuggestions</span>
plugins<span class="token operator">=</span><span class="token punctuation">(</span>
	<span class="token punctuation">..</span>.
	zsh-autosuggestions
	zsh-syntax-highlighting
<span class="token punctuation">)</span>

<span class="token comment"># 3. 默认的补全快捷键和提示文本的颜色不一定合适，可以自行更改</span>
<span class="token comment">#    在 ~/.zshrc 文件中加入以下代码进行修改</span>
bindkey <span class="token string">','</span> autosuggest-accept <span class="token comment"># 修改补全快捷键，我个人喜欢用逗号</span>
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE<span class="token operator">=</span><span class="token string">'fg=6'</span> <span class="token comment"># 修改提示文本的颜色</span>

<span class="token comment"># 4. 重新加载 ~/.zshrc</span>
<span class="token function">source</span> ~/.zshrc
</code></pre> 
<h3><a id="2_Docker_180"></a>2. Docker</h3> 
<p>使用脚本一键安装，简单快速：</p> 
<pre><code class="prism language-bash">$ <span class="token function">curl</span> -fsSL get.docker.com -o get-docker.sh
$ <span class="token function">sudo</span> sh get-docker.sh --mirror Aliyun
</code></pre> 
<p>启动：</p> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> systemctl <span class="token function">enable</span> docker
$ <span class="token function">sudo</span> systemctl start docker
</code></pre> 
<p>建立用户组：</p> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> <span class="token function">groupadd</span> docker <span class="token comment"># 建立 docker 组</span>
$ <span class="token function">sudo</span> <span class="token function">usermod</span> -aG docker <span class="token variable">$USER</span> <span class="token comment"># 将当前用户加入 docker 组</span>
</code></pre> 
<p>安装 <code>docker-compose</code>：</p> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> <span class="token function">curl</span> -L <span class="token string">"https://github.com/docker/compose/releases/download/1.29.1/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>"</span> -o /usr/local/bin/docker-compose

$ <span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre> 
<h2><a id="_215"></a>四、业务迁移</h2> 
<h3><a id="1_SSL__217"></a>1. SSL 证书签发</h3> 
<blockquote> 
 <p>参考：https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E</p> 
</blockquote> 
<p>安装 <code>acme.sh</code>：</p> 
<pre><code class="prism language-bash"><span class="token function">curl</span>  https://get.acme.sh <span class="token operator">|</span> sh
</code></pre> 
<p>采用手动 DNS 的方式，先准备环境变量：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 值一定要加引号</span>
<span class="token function">export</span> DP_Id<span class="token operator">=</span><span class="token string">"xxx"</span>
<span class="token function">export</span> DB_Key<span class="token operator">=</span><span class="token string">"xxx"</span>
</code></pre> 
<p>生成证书：</p> 
<pre><code class="prism language-bash"> <span class="token comment"># 域名一定要加引号</span>
 $ acme.sh --issue --dns dns_dp -d <span class="token string">'xuxusheng.com'</span>
</code></pre> 
<p>官方不建议直接使用生成的证书文件，而是移动到其他地方，使用以下命令：</p> 
<pre><code class="prism language-bash">$ acme.sh --install-cert -d <span class="token string">'xuxusheng.com'</span> --key-file /<span class="token operator">&lt;</span>PATH<span class="token operator">&gt;</span>/key.pem --fullchain-file /<span class="token operator">&lt;</span>PATH<span class="token operator">&gt;</span>/cert.pem
</code></pre> 
<h3><a id="2_Nginx__248"></a>2. Nginx 流量转发</h3> 
<p><code>docker-compose.yaml</code> 文件：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">app</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>
      <span class="token punctuation">-</span> 443<span class="token punctuation">:</span><span class="token number">443</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./conf.d<span class="token punctuation">:</span>/etc/nginx/conf.d
      <span class="token punctuation">-</span> /home/work/ssl<span class="token punctuation">:</span>/ssl
    <span class="token key atrule">logging</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">'json-file'</span>
      <span class="token key atrule">options</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-size</span><span class="token punctuation">:</span> <span class="token string">'2g'</span>
</code></pre> 
<p>压测一下：</p> 
<p><img src="https://images2.imgbox.com/0d/71/aOnrfxql_o.png" alt=""></p> 
<p>还行，不算太差，转发一下博客的流量绰绰有余了。</p> 
<p>点击访问 <strong><a href="https://www.xuxusheng.com" rel="nofollow">https://www.xuxusheng.com</a></strong> 就可以看到我的博客啦。</p> 
<p>如果对你有帮助，欢迎留言鼓励下我~</p> 
<hr> 
<blockquote> 
 <p><strong>传送门，点击这里直接查看：</strong><br> <a href="https://curl.qcloud.com/p72cDsD9" rel="nofollow">【腾讯云】轻量应用服务器Lighthouse，新朋友「轻」松上云，老朋友免费加「量」，1核2G5M限时低至99元/年起</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/60b34cb2ed32da4b592a205add2bf385/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RealSR真实场景超分</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e61336bf26652a967333504e5744ab73/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux rm命令 安装,Linux rm 命令 command not found rm 命令详解 rm 命令未找到 rm 命令安装 - CommandNotFound ⚡️ 坑否...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>