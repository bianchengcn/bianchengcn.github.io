<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>cocos2d-x格斗游戏教程（四）攻击敌人 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="cocos2d-x格斗游戏教程（四）攻击敌人" />
<meta property="og:description" content="5.创建机器人。我们已经创建了精灵的基本模型：ActionSprite。我们可以重用它来创建游戏中电脑控制的角色。新建Robot类，派生自ActionSprite类，增加如下方法：
1 2 CREATE_FUNC(Robot); bool init(); 打开 Robot.cpp 文件， init 函数代码如下： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 bool Robot::init() { bool bRet = false; do { CC_BREAK_IF(!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/99aa774c15639a93caff36b84648cf51/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-08-14T19:34:44+08:00" />
<meta property="article:modified_time" content="2013-08-14T19:34:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">cocos2d-x格斗游戏教程（四）攻击敌人</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"></span></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 5.创建机器人。我们已经创建了精灵的基本模型：<strong><span style="color:rgb(0,153,0)">ActionSprite</span></strong>。我们可以重用它来创建游戏中电脑控制的角色。新建<strong><span style="color:rgb(0,153,0)">Robot</span></strong>类，派生自<strong><span style="color:rgb(0,153,0)">ActionSprite</span></strong>类，增加如下方法：<br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px">
       CREATE_FUNC(Robot); 
      <br> 
      <span style="color:rgb(128,0,255)">bool</span> init(); 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">打开</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(229,102,0)">Robot.cpp</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">文件，</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(0,153,0)">init</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">函数代码如下：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> <br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 4 
       <br> 5 
       <br> 6 
       <br> 7 
       <br> 8 
       <br> 9 
       <br> 10 
       <br> 11 
       <br> 12 
       <br> 13 
       <br> 14 
       <br> 15 
       <br> 16 
       <br> 17 
       <br> 18 
       <br> 19 
       <br> 20 
       <br> 21 
       <br> 22 
       <br> 23 
       <br> 24 
       <br> 25 
       <br> 26 
       <br> 27 
       <br> 28 
       <br> 29 
       <br> 30 
       <br> 31 
       <br> 32 
       <br> 33 
       <br> 34 
       <br> 35 
       <br> 36 
       <br> 37 
       <br> 38 
       <br> 39 
       <br> 40 
       <br> 41 
       <br> 42 
       <br> 43 
       <br> 44 
       <br> 45 
       <br> 46 
       <br> 47 
       <br> 48 
       <br> 49 
       <br> 50 
       <br> 51 
       <br> 52 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="902" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(128,0,255)">bool</span> Robot::init() 
      <br> { 
      <br> 
      <span style="color:rgb(128,0,255)">bool</span> bRet =  
      <span style="color:rgb(0,0,255)">false</span>; 
      <br> 
      <span style="color:rgb(0,0,255)">do</span> 
      <br>    { 
      <br>        CC_BREAK_IF(!ActionSprite::initWithSpriteFrameName( 
      <span style="color:rgb(128,0,0)">"robot_idle_00.png"</span>)); 
      <br> 
      <br> 
      <span style="color:rgb(128,0,255)">int</span> i; 
      <br> 
      <span style="color:rgb(0,128,0)">//idle animation<br> </span>       CCArray *idleFrames = CCArray::createWithCapacity( 
      <span style="color:rgb(255,0,0)">5</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">for</span> (i =  
      <span style="color:rgb(255,0,0)">0</span>; i &lt;  
      <span style="color:rgb(255,0,0)">5</span>; i++) 
      <br>        { 
      <br>            CCSpriteFrame *frame = CCSpriteFrameCache::sharedSpriteFrameCache()-&gt;spriteFrameByName( 
      <br>                CCString::createWithFormat( 
      <span style="color:rgb(128,0,0)">"robot_idle_%02d.png"</span>, i)-&gt;getCString()); 
      <br>            idleFrames-&gt;addObject(frame); 
      <br>        } 
      <br>        CCAnimation *idleAnimation = CCAnimation::createWithSpriteFrames(idleFrames,  
      <span style="color:rgb(128,0,255)">float</span>( 
      <span style="color:rgb(255,0,0)">1</span>. 
      <span style="color:rgb(255,0,0)">0</span> /  
      <span style="color:rgb(255,0,0)">12</span>. 
      <span style="color:rgb(255,0,0)">0</span>)); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setIdleAction(CCRepeatForever::create(CCAnimate::create(idleAnimation))); 
      <br> 
      <br> 
      <span style="color:rgb(0,128,0)">//attack animation<br> </span>       CCArray *attackFrames = CCArray::createWithCapacity( 
      <span style="color:rgb(255,0,0)">5</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">for</span> (i =  
      <span style="color:rgb(255,0,0)">0</span>; i &lt;  
      <span style="color:rgb(255,0,0)">5</span>; i++) 
      <br>        { 
      <br>            CCSpriteFrame *frame = CCSpriteFrameCache::sharedSpriteFrameCache()-&gt;spriteFrameByName( 
      <br>                CCString::createWithFormat( 
      <span style="color:rgb(128,0,0)">"robot_attack_%02d.png"</span>, i)-&gt;getCString()); 
      <br>            attackFrames-&gt;addObject(frame); 
      <br>        } 
      <br>        CCAnimation *attackAnimation = CCAnimation::createWithSpriteFrames(attackFrames,  
      <span style="color:rgb(128,0,255)">float</span>( 
      <span style="color:rgb(255,0,0)">1</span>. 
      <span style="color:rgb(255,0,0)">0</span> / 
      <span style="color:rgb(255,0,0)">24</span>. 
      <span style="color:rgb(255,0,0)">0</span>)); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setAttackAction(CCSequence::create(CCAnimate::create(attackAnimation), CCCallFunc::create( 
      <span style="color:rgb(0,0,255)">this</span>, callfunc_selector(Robot::idle)),  
      <span style="color:rgb(0,0,255)">NULL</span>)); 
      <br> 
      <br> 
      <span style="color:rgb(0,128,0)">//walk animation<br> </span>       CCArray *walkFrames = CCArray::createWithCapacity( 
      <span style="color:rgb(255,0,0)">6</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">for</span> (i =  
      <span style="color:rgb(255,0,0)">0</span>; i &lt;  
      <span style="color:rgb(255,0,0)">6</span>; i++) 
      <br>        { 
      <br>            CCSpriteFrame *frame = CCSpriteFrameCache::sharedSpriteFrameCache()-&gt;spriteFrameByName( 
      <br>                CCString::createWithFormat( 
      <span style="color:rgb(128,0,0)">"robot_walk_%02d.png"</span>, i)-&gt;getCString()); 
      <br>            walkFrames-&gt;addObject(frame); 
      <br>        } 
      <br>        CCAnimation *walkAnimation = CCAnimation::createWithSpriteFrames(walkFrames,  
      <span style="color:rgb(128,0,255)">float</span>( 
      <span style="color:rgb(255,0,0)">1</span>. 
      <span style="color:rgb(255,0,0)">0</span> /  
      <span style="color:rgb(255,0,0)">12</span>. 
      <span style="color:rgb(255,0,0)">0</span>)); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setWalkAction(CCRepeatForever::create(CCAnimate::create(walkAnimation))); 
      <br> 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setWalkSpeed( 
      <span style="color:rgb(255,0,0)">80</span>. 
      <span style="color:rgb(255,0,0)">0</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setCenterToBottom( 
      <span style="color:rgb(255,0,0)">39</span>. 
      <span style="color:rgb(255,0,0)">0</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setCenterToSides( 
      <span style="color:rgb(255,0,0)">29</span>. 
      <span style="color:rgb(255,0,0)">0</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setHitPoints( 
      <span style="color:rgb(255,0,0)">100</span>. 
      <span style="color:rgb(255,0,0)">0</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setDamage( 
      <span style="color:rgb(255,0,0)">10</span>. 
      <span style="color:rgb(255,0,0)">0</span>); 
      <br> 
      <br>        bRet =  
      <span style="color:rgb(0,0,255)">true</span>; 
      <br>    }  
      <span style="color:rgb(0,0,255)">while</span> ( 
      <span style="color:rgb(255,0,0)">0</span>); 
      <br> 
      <br> 
      <span style="color:rgb(0,0,255)">return</span> bRet; 
      <br> } 
     </div> </td></tr></tbody></table> 
</div> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 跟英雄一样，以上代码创建一个带有3个动作的机器人：空闲、出拳、行走。它也有两个测量值：<span style="color:rgb(0,51,153)">centerToBottom</span>和<span style="color:rgb(0,51,153)">centerToSides</span>。注意到机器人的属性比英雄低一点，这是合乎逻辑的，不然英雄永远打不赢机器人。让我们开始添加一些机器人到游戏中去。打开<strong><span style="color:rgb(229,102,0)">GameLayer.h</span></strong>文件，添加如下代码：<br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px">
       CC_SYNTHESIZE_RETAIN(cocos2d::CCArray*, _robots, Robots); 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">打开</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(229,102,0)">GameLayer.cpp</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">文件，添加头文件如下：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(0,0,255)">#include</span> 
      <span style="color:rgb(128,0,0)">"Robot.h"</span> 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">在构造函数里，添加如下代码：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px">
       _robots =  
      <span style="color:rgb(0,0,255)">NULL</span>; 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">在</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(0,153,0)">init</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">函数</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; background-color:rgb(204,204,204)">this-&gt;initTileMap();</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">的后面添加如下代码：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;initRobots(); 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">添加如下方法：</span> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 4 
       <br> 5 
       <br> 6 
       <br> 7 
       <br> 8 
       <br> 9 
       <br> 10 
       <br> 11 
       <br> 12 
       <br> 13 
       <br> 14 
       <br> 15 
       <br> 16 
       <br> 17 
       <br> 18 
       <br> 19 
       <br> 20 
       <br> 21 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="902" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(128,0,255)">void</span> GameLayer::initRobots() 
      <br> { 
      <br> 
      <span style="color:rgb(128,0,255)">int</span> robotCount =  
      <span style="color:rgb(255,0,0)">50</span>; 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setRobots(CCArray::createWithCapacity(robotCount)); 
      <br> 
      <br> 
      <span style="color:rgb(0,0,255)">for</span> ( 
      <span style="color:rgb(128,0,255)">int</span> i =  
      <span style="color:rgb(255,0,0)">0</span>; i &lt; robotCount; i++) 
      <br>    { 
      <br>        Robot *robot = Robot::create(); 
      <br>        _actors-&gt;addChild(robot); 
      <br>        _robots-&gt;addObject(robot); 
      <br> 
      <br> 
      <span style="color:rgb(128,0,255)">int</span> minX = SCREEN.width + robot-&gt;getCenterToSides(); 
      <br> 
      <span style="color:rgb(128,0,255)">int</span> maxX = _tileMap-&gt;getMapSize().width * _tileMap-&gt;getTileSize().width - robot-&gt;getCenterToSides(); 
      <br> 
      <span style="color:rgb(128,0,255)">int</span> minY = robot-&gt;getCenterToBottom(); 
      <br> 
      <span style="color:rgb(128,0,255)">int</span> maxY =  
      <span style="color:rgb(255,0,0)">3</span> * _tileMap-&gt;getTileSize().height + robot-&gt;getCenterToBottom(); 
      <br>        robot-&gt;setScaleX(- 
      <span style="color:rgb(255,0,0)">1</span>); 
      <br>        robot-&gt;setPosition(ccp(random_range(minX, maxX), random_range(minY, maxY))); 
      <br>        robot-&gt;setDesiredPosition(robot-&gt;getPosition()); 
      <br>        robot-&gt;idle(); 
      <br>    } 
      <br> } 
     </div> </td></tr></tbody></table> 
</div> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 这些代码做了以下事情：<br> </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> <br> </p> 
<ul class=" list-paddingleft-2" style="color:rgb(51,51,51); font-family:Arial; font-size:14.399999618530273px; line-height:26px"><li> <p>创建一个包含50个机器人的数组，并把它们添加到精灵表单中。</p> </li><li> <p>使用<strong><span style="color:rgb(229,102,0)">Defines.h</span></strong>里面的随机函数随机放置50个机器人到地图地板上。同时，让最小随机值大于屏幕宽度，以确保不会有任何机器人出现在起点处。</p> </li><li> <p>让每个机器人都处于空闲状态。</p> </li></ul> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> <br> </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 编译运行，让英雄向前走，直到看到地图上的机器人，如下图所示：<br> <img src="https://images2.imgbox.com/f3/3d/QL6i4VJU_o.png" alt="" style="max-width:100%; border:none"><br> 试着走到机器人区域中，你会发现机器人的绘制有些不对。如果英雄是在机器人的下面，那么他应该被绘制在机器人的前面，而不是在后面。我们需要明确的告诉游戏，哪个对象先绘制，这就是Z轴来进行控制的。添加英雄和机器人时，并没有明确指定其Z轴，默认下，后面添加的对象会比前面的对象Z轴值高，这就是为什么机器人挡住了英雄。为了解决这个问题，我们需要动态的处理Z轴顺序。每当精灵在屏幕上垂直移动时，它的Z轴值应该有所改变。屏幕上越高的精灵，其Z轴值应越低。打开<strong><span style="color:rgb(229,102,0)">GameLayer.cpp</span></strong>文件，添加如下方法：<br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 4 
       <br> 5 
       <br> 6 
       <br> 7 
       <br> 8 
       <br> 9 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(128,0,255)">void</span> GameLayer::reorderActors() 
      <br> { 
      <br>    CCObject *pObject =  
      <span style="color:rgb(0,0,255)">NULL</span>; 
      <br>    CCARRAY_FOREACH(_actors-&gt;getChildren(), pObject) 
      <br>    { 
      <br>        ActionSprite *sprite = (ActionSprite*)pObject; 
      <br>        _actors-&gt;reorderChild(sprite, (_tileMap-&gt;getMapSize().height * _tileMap-&gt;getTileSize().height) - sprite-&gt;getPosition().y); 
      <br>    } 
      <br> } 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">然后在</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(0,153,0)">update</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">函数</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; background-color:rgb(192,192,192)">this-&gt;updatePositions();</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">的后面，添加如下代码：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="    " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;reorderActors(); 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">每当精灵的位置更新，这个方法会让</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(0,153,0)">CCSpriteBatchNode</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">重新设置它的每个子节点Z轴值，其根据子节点离地图底部的距离，当子节点离底部更高时，其Z轴值就会下降。编译运行，可以看到正确的绘制顺序，如下图所示：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<img src="https://images2.imgbox.com/01/2e/37PyvKu6_o.png" alt="" style="max-width:100%; border:none; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<br> 
<p><span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">6.出拳猛击机器人，碰撞检测。为了让英雄能够出拳，并且能够实际上打在了机器人身上，需要实现一种方式的碰撞检测。在这篇文章中，我们使用矩形创建一个非常简单的碰撞检测系统。在这个系统中，我们为每个角色定义两种矩形/盒子：</span></p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> <br> </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> <br> </p> 
<ul class=" list-paddingleft-2" style="color:rgb(51,51,51); font-family:Arial; font-size:14.399999618530273px; line-height:26px"><li> <p>Hit box：代表精灵的身体</p> </li><li> <p>Attack box：代表精灵的手</p> </li></ul> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> <br> </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 假如某个<strong><span style="color:rgb(0,153,0)">ActionSprite</span></strong>的Attack box碰撞到另一个<strong><span style="color:rgb(0,153,0)">ActionSprite</span></strong>的Hit box，那么这就是一次碰撞发生。这两个矩形之间的区别，将帮助我们知道谁打了谁。<strong><span style="color:rgb(229,102,0)">Defines.h</span></strong>文件中的<span style="color:rgb(0,51,153)">BoundingBox</span>定义，包含两种矩形：实际的，和原始的：<br> ①原始矩形，每个精灵的基本矩形，一旦设置后就不会改变。<br> ②实际矩形，这是位于世界空间中的矩形，当精灵移动时，实际的矩形也跟着变动。<br> 打开<strong><span style="color:rgb(229,102,0)">ActionSprite.h</span></strong>文件，添加如下代码：<br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="     " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 4 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px">
       CC_SYNTHESIZE(BoundingBox, _hitBox, Hitbox); 
      <br> CC_SYNTHESIZE(BoundingBox, _attackBox, AttackBox); 
      <br> 
      <br> BoundingBox createBoundingBoxWithOrigin(cocos2d::CCPoint origin, cocos2d::CCSize size); 
     </div> </td></tr></tbody></table> 
</div> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 以上创建了<strong><span style="color:rgb(0,153,0)">ActionSprite</span></strong>的两个包围盒：Hit box和Attack box。还定义了一个方法，用于根据给定的原点和大小来创建一个BoundingBox结构体。打开<strong><span style="color:rgb(229,102,0)">ActionSprite.cpp</span></strong>文件，添加如下方法：<br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="     " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 4 
       <br> 5 
       <br> 6 
       <br> 7 
       <br> 8 
       <br> 9 
       <br> 10 
       <br> 11 
       <br> 12 
       <br> 13 
       <br> 14 
       <br> 15 
       <br> 16 
       <br> 17 
       <br> 18 
       <br> 19 
       <br> 20 
       <br> 21 
       <br> 22 
       <br> 23 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="902" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px">
       BoundingBox ActionSprite::createBoundingBoxWithOrigin(CCPoint origin, CCSize size) 
      <br> { 
      <br>    BoundingBox boundingBox; 
      <br>    boundingBox.original.origin = origin; 
      <br>    boundingBox.original.size = size; 
      <br>    boundingBox.actual.origin = ccpAdd( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getPosition(), ccp(boundingBox.original.origin.x, boundingBox.original.origin.y)); 
      <br>    boundingBox.actual.size = size; 
      <br> 
      <span style="color:rgb(0,0,255)">return</span> boundingBox; 
      <br> } 
      <br> 
      <br> 
      <span style="color:rgb(128,0,255)">void</span> ActionSprite::transformBoxes() 
      <br> { 
      <br>    _hitBox.actual.origin = ccpAdd( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getPosition(), ccp(_hitBox.original.origin.x, _hitBox.original.origin.y)); 
      <br>    _attackBox.actual.origin = ccpAdd( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getPosition(), ccp(_attackBox.original.origin.x +  
      <br>        ( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getScaleX() == - 
      <span style="color:rgb(255,0,0)">1</span> ? (- _attackBox.original.size.width - _hitBox.original.size.width) :  
      <span style="color:rgb(255,0,0)">0</span>), 
      <br>        _attackBox.original.origin.y)); 
      <br> } 
      <br> 
      <br> 
      <span style="color:rgb(128,0,255)">void</span> ActionSprite::setPosition(CCPoint position) 
      <br> { 
      <br>    CCSprite::setPosition(position); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;transformBoxes(); 
      <br> } 
     </div> </td></tr></tbody></table> 
</div> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 第一个方法创建一个新的包围盒，这有助于<strong><span style="color:rgb(229,102,0)">ActionSprite</span></strong>的子类创建属于它们自己的包围盒。第二个方法，基于精灵的位置、比例因子，和包围盒原本的原点和大小来更新每个包围盒实际测量的原点和大小。之所以要用到比例因子，是因为它决定着精灵的方向。位于精灵右侧的盒子，当比例因子设置为-1时，将会翻转到左侧。打开<strong><span style="color:rgb(229,102,0)">Hero.cpp</span></strong>文件，在<strong><span style="color:rgb(0,153,0)">init</span></strong>函数后面添加如下代码：<br> </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> </p> 
<p class="p1"><br> </p> 
<br> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="     " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(0,0,255)"></span> 
      <p class="p1" style="color:rgb(51,51,51); font-family:arial; font-size:14px; line-height:25.984375px"> <span class="s1">  </span>//createBoundingBoxWithOrigin<span class="s2">第一个参数的意义为什么是负的中心到边界的距离和到底边的距离</span></p> 
      <p class="p1" style="color:rgb(51,51,51); font-family:arial; font-size:14px; line-height:25.984375px"> <span class="s1">        </span>//<span class="s2">因为在</span>createBoundingBoxWithOrigin<span class="s2">计算的中心点的方法是当前精灵的坐标加上第一个参数</span></p> 
      <p class="p2" style="color:rgb(51,51,51); font-family:arial; font-size:14px; line-height:25.984375px"> <span class="s3">        </span><span class="s4">//</span>只有减去中心到边界的距离和到底边的距离才能将精灵框住</p> 
      <br> 
     </div> 
     <div style="margin:7px"> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setHitbox( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;createBoundingBoxWithOrigin(ccp(- 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToSides(), - 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToBottom()), 
      <br>    CCSizeMake( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToSides() *  
      <span style="color:rgb(255,0,0)">2</span>,  
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToBottom() *  
      <span style="color:rgb(255,0,0)">2</span>))); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setAttackBox( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;createBoundingBoxWithOrigin(ccp( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToSides(), - 
      <span style="color:rgb(255,0,0)">10</span>), CCSizeMake( 
      <span style="color:rgb(255,0,0)">20</span>, 
      <span style="color:rgb(255,0,0)">20</span>))); 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">打开</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(229,102,0)">Robot.cpp</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">文件，在</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(0,153,0)">init</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">函数后面添加如下代码：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="     " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="909" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setHitbox( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;createBoundingBoxWithOrigin(ccp(- 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToSides(), - 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToBottom()), 
      <br>    CCSizeMake( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToSides() *  
      <span style="color:rgb(255,0,0)">2</span>,  
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToBottom() *  
      <span style="color:rgb(255,0,0)">2</span>))); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setAttackBox( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;createBoundingBoxWithOrigin(ccp( 
      <span style="color:rgb(0,0,255)">this</span>-&gt;getCenterToSides(), - 
      <span style="color:rgb(255,0,0)">5</span>), CCSizeMake( 
      <span style="color:rgb(255,0,0)">25</span>, 
      <span style="color:rgb(255,0,0)">20</span>))); 
     </div> </td></tr></tbody></table> 
</div> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">现在我们已经有了英雄和机器人各自的Hit box和Attack box。如果是可视化的箱子，它们会像下面这样：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<img src="https://images2.imgbox.com/ec/79/gM2XV1rL_o.png" alt="" style="max-width:100%; border:none; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">无论何时，当一个attack box（红色）跟一个hit box（蓝色）交叉，即一次碰撞发生。在开始编写代码，检测包围盒交叉前，需要确保</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(0,153,0)">ActionSprite</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">能够对被击中有所反应。我们已经添加了空闲、出拳、行走动作，但还未创建受伤和死亡动作。打开</span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"><span style="color:rgb(229,102,0)">ActionSprite.cpp</span></span> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">文件，实现如下方法：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> <br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="     " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 4 
       <br> 5 
       <br> 6 
       <br> 7 
       <br> 8 
       <br> 9 
       <br> 10 
       <br> 11 
       <br> 12 
       <br> 13 
       <br> 14 
       <br> 15 
       <br> 16 
       <br> 17 
       <br> 18 
       <br> 19 
       <br> 20 
       <br> 21 
       <br> 22 
       <br> 23 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="902" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(128,0,255)">void</span> ActionSprite::hurtWithDamage( 
      <span style="color:rgb(128,0,255)">float</span> damage) 
      <br> { 
      <br> 
      <span style="color:rgb(0,0,255)">if</span> (_actionState != kActionStateKnockedOut) 
      <br>    { 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;stopAllActions(); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;runAction(_hurtAction); 
      <br>        _actionState = kActionStateHurt; 
      <br>        _hitPoints -= damage; 
      <br> 
      <br> 
      <span style="color:rgb(0,0,255)">if</span> (_hitPoints &lt;=  
      <span style="color:rgb(255,0,0)">0</span>) 
      <br>        { 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;knockout(); 
      <br>        } 
      <br>    } 
      <br> } 
      <br> 
      <br> 
      <span style="color:rgb(128,0,255)">void</span> ActionSprite::knockout() 
      <br> { 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;stopAllActions(); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;runAction(_knockedOutAction); 
      <br>    _hitPoints =  
      <span style="color:rgb(255,0,0)">0</span>; 
      <br>    _actionState = kActionStateKnockedOut; 
      <br> } 
     </div> </td></tr></tbody></table> 
</div> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 只要精灵还未死亡，被击中时状态将会切换到受伤状态，执行受伤动画，并且精灵的生命值将会减去相应的伤害值。如果生命值少于0，那么死亡的动作将会触发。为了完成这两个动作，我们还需更改<strong><span style="color:rgb(0,153,0)">Hero</span></strong>类和<strong><span style="color:rgb(0,153,0)">Robot</span></strong>类。打开<strong><span style="color:rgb(229,102,0)">Hero.cpp</span></strong>文件，在<strong><span style="color:rgb(0,153,0)">init</span></strong>函数<span style="color:rgb(0,153,0)">walk animation</span>后面添加如下代码：<br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="     " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 4 
       <br> 5 
       <br> 6 
       <br> 7 
       <br> 8 
       <br> 9 
       <br> 10 
       <br> 11 
       <br> 12 
       <br> 13 
       <br> 14 
       <br> 15 
       <br> 16 
       <br> 17 
       <br> 18 
       <br> 19 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="902" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(0,128,0)">//hurt animation<br> </span>CCArray *hurtFrames = CCArray::createWithCapacity( 
      <span style="color:rgb(255,0,0)">3</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">for</span> (i =  
      <span style="color:rgb(255,0,0)">0</span>; i &lt;  
      <span style="color:rgb(255,0,0)">3</span>; i++) 
      <br> { 
      <br>    CCSpriteFrame *frame = CCSpriteFrameCache::sharedSpriteFrameCache()-&gt;spriteFrameByName(CCString::createWithFormat( 
      <span style="color:rgb(128,0,0)">"hero_hurt_%02d.png"</span>, i)-&gt;getCString()); 
      <br>    hurtFrames-&gt;addObject(frame); 
      <br> } 
      <br> CCAnimation *hurtAnimation = CCAnimation::createWithSpriteFrames(hurtFrames,  
      <span style="color:rgb(128,0,255)">float</span>( 
      <span style="color:rgb(255,0,0)">1</span>. 
      <span style="color:rgb(255,0,0)">0</span> /  
      <span style="color:rgb(255,0,0)">12</span>. 
      <span style="color:rgb(255,0,0)">0</span>)); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setHurtAction(CCSequence::create(CCAnimate::create(hurtAnimation), CCCallFunc::create( 
      <span style="color:rgb(0,0,255)">this</span>, callfunc_selector(Hero::idle)),  
      <span style="color:rgb(0,0,255)">NULL</span>)); 
      <br> 
      <br> 
      <span style="color:rgb(0,128,0)">//knocked out animation<br> </span>CCArray *knockedOutFrames = CCArray::createWithCapacity( 
      <span style="color:rgb(255,0,0)">5</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">for</span> (i =  
      <span style="color:rgb(255,0,0)">0</span>; i &lt;  
      <span style="color:rgb(255,0,0)">5</span>; i++) 
      <br> { 
      <br>    CCSpriteFrame *frame = CCSpriteFrameCache::sharedSpriteFrameCache()-&gt;spriteFrameByName(CCString::createWithFormat( 
      <span style="color:rgb(128,0,0)">"hero_knockout_%02d.png"</span>, i)-&gt;getCString()); 
      <br>    knockedOutFrames-&gt;addObject(frame); 
      <br> } 
      <br> CCAnimation *knockedOutAnimation = CCAnimation::createWithSpriteFrames(knockedOutFrames,  
      <span style="color:rgb(128,0,255)">float</span>( 
      <span style="color:rgb(255,0,0)">1</span>. 
      <span style="color:rgb(255,0,0)">0</span>/  
      <span style="color:rgb(255,0,0)">12</span>. 
      <span style="color:rgb(255,0,0)">0</span>)); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setKnockedOutAction(CCSequence::create(CCAnimate::create(knockedOutAnimation), CCBlink::create( 
      <span style="color:rgb(255,0,0)">2</span>. 
      <span style="color:rgb(255,0,0)">0</span>,  
      <span style="color:rgb(255,0,0)">10</span>. 
      <span style="color:rgb(255,0,0)">0</span>),  
      <span style="color:rgb(0,0,255)">NULL</span>)); 
     </div> </td></tr></tbody></table> 
</div> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 打开<strong><span style="color:rgb(229,102,0)">Robot.cpp</span></strong>文件，在<span style="color:rgb(0,153,0)"><strong>init</strong></span>函数<span style="color:rgb(0,153,0)">walk animation</span>后面添加如下代码：<br> </p> 
<div style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px; width:934.375px; border:1px solid rgb(227,227,227)"> 
 <table cellspacing="0" cellpadding="0" width="933" class="     " style="width:703px"><tbody><tr><td style="color:rgb(0,130,132); background-color:rgb(227,227,227); vertical-align:text-top"> 
     <div style="margin:7px; text-align:right"> 
      
        1 
       <br> 2 
       <br> 3 
       <br> 4 
       <br> 5 
       <br> 6 
       <br> 7 
       <br> 8 
       <br> 9 
       <br> 10 
       <br> 11 
       <br> 12 
       <br> 13 
       <br> 14 
       <br> 15 
       <br> 16 
       <br> 17 
       <br> 18 
       <br> 19 
       <br> 
       
     </div> </td><td style="background-color:rgb(0,130,132); padding:1px"> </td><td width="902" style="background-color:rgb(239,239,239); vertical-align:text-top"> 
     <div style="margin:7px"> 
      <span style="color:rgb(0,128,0)">//hurt animation<br> </span>CCArray *hurtFrames = CCArray::createWithCapacity( 
      <span style="color:rgb(255,0,0)">3</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">for</span> (i =  
      <span style="color:rgb(255,0,0)">0</span>; i &lt;  
      <span style="color:rgb(255,0,0)">3</span>; i++) 
      <br> { 
      <br>    CCSpriteFrame *frame = CCSpriteFrameCache::sharedSpriteFrameCache()-&gt;spriteFrameByName(CCString::createWithFormat( 
      <span style="color:rgb(128,0,0)">"robot_hurt_%02d.png"</span>, i)-&gt;getCString()); 
      <br>    hurtFrames-&gt;addObject(frame); 
      <br> } 
      <br> CCAnimation *hurtAnimation = CCAnimation::createWithSpriteFrames(hurtFrames,  
      <span style="color:rgb(128,0,255)">float</span>( 
      <span style="color:rgb(255,0,0)">1</span>. 
      <span style="color:rgb(255,0,0)">0</span> /  
      <span style="color:rgb(255,0,0)">12</span>. 
      <span style="color:rgb(255,0,0)">0</span>)); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setHurtAction(CCSequence::create(CCAnimate::create(hurtAnimation), CCCallFunc::create( 
      <span style="color:rgb(0,0,255)">this</span>, callfunc_selector(Robot::idle)),  
      <span style="color:rgb(0,0,255)">NULL</span>)); 
      <br> 
      <br> 
      <span style="color:rgb(0,128,0)">//knocked out animation<br> </span>CCArray *knockedOutFrames = CCArray::createWithCapacity( 
      <span style="color:rgb(255,0,0)">5</span>); 
      <br> 
      <span style="color:rgb(0,0,255)">for</span> (i =  
      <span style="color:rgb(255,0,0)">0</span>; i &lt;  
      <span style="color:rgb(255,0,0)">5</span>; i++) 
      <br> { 
      <br>    CCSpriteFrame *frame = CCSpriteFrameCache::sharedSpriteFrameCache()-&gt;spriteFrameByName(CCString::createWithFormat( 
      <span style="color:rgb(128,0,0)">"robot_knockout_%02d.png"</span>, i)-&gt;getCString()); 
      <br>    knockedOutFrames-&gt;addObject(frame); 
      <br> } 
      <br> CCAnimation *knockedOutAnimation = CCAnimation::createWithSpriteFrames(knockedOutFrames,  
      <span style="color:rgb(128,0,255)">float</span>( 
      <span style="color:rgb(255,0,0)">1</span>. 
      <span style="color:rgb(255,0,0)">0</span>/  
      <span style="color:rgb(255,0,0)">12</span>. 
      <span style="color:rgb(255,0,0)">0</span>)); 
      <br> 
      <span style="color:rgb(0,0,255)">this</span>-&gt;setKnockedOutAction(CCSequence::create(CCAnimate::create(knockedOutAnimation), CCBlink::create( 
      <span style="color:rgb(255,0,0)">2</span>. 
      <span style="color:rgb(255,0,0)">0</span>,  
      <span style="color:rgb(255,0,0)">10</span>. 
      <span style="color:rgb(255,0,0)">0</span>),  
      <span style="color:rgb(0,0,255)">NULL</span>)); 
     </div> </td></tr></tbody></table> 
</div> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 以上代码应该不陌生了。我们用创建其他动作同样的方式创建了受伤和死亡动作。受伤动作结束时，会切换到空闲状态。死亡动作结束时，精灵进行闪烁。打开<strong><span style="color:rgb(229,102,0)">GameLayer.cpp</span></strong>文件，添加碰撞处理，在<strong><span style="color:rgb(0,153,0)">ccTouchesBegan</span></strong>函数后面添加如下代码：<br> </p> 
<p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> </p> 
<pre><code class="language-cpp"> //检测英雄是否处于攻击状态，以及机器人是否处于非死亡状态。
    if (_hero-&gt;getActionState() == kActionStateAttack)
    {
        CCObject *pObject = NULL;
        //遍历所有敌人数组
        CCARRAY_FOREACH(_robots, pObject)
        {
            Robot *robot = (Robot*)pObject;
            //如果敌人没有死亡
            if (robot-&gt;getActionState() != kActionStateKnockedOut)
            {
                //检测英雄的位置和机器人的位置垂直相距在10个点以内。这表明它们在同一平面上站立。
                if (fabsf(_hero-&gt;getPosition().y - robot-&gt;getPosition().y) &lt; 10)
                {
                    //检测英雄的attack box是否与机器人的hit box进行交叉。
                    if (_hero-&gt;getAttackBox().actual.intersectsRect(robot-&gt;getHitbox().actual))
                    {
                        robot-&gt;hurtWithDamage(_hero-&gt;getDamage());
                    }
                }
            }
        }       
    }</code></pre> 
<p></p> 
<p><span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">以上代码通过三个简单步骤来检测碰撞：</span></p> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">①.检测英雄是否处于攻击状态，以及机器人是否处于非死亡状态。</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">②.检测英雄的位置和机器人的位置垂直相距在10个点以内。这表明它们在同一平面上站立。</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">③.检测英雄的attack box是否与机器人的hit box进行交叉。</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">如果这些条件都成立，那么则一次碰撞发生，机器人执行受伤动作。英雄的伤害值作为参数进行传递，这样该方法就会知道需要减去多少生命值。</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<span style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px">7.编译运行，出拳攻击机器人吧，效果如下图所示：</span> 
<br style="color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"> 
<p><img src="https://images2.imgbox.com/64/09/ne8B7ijw_o.gif" alt="" style="max-width:100%; border:none; color:rgb(51,51,51); font-family:arial; font-size:13.63636302947998px; line-height:25.99431800842285px"></p> 
<p><br> </p> 
<p><span style="font-size:18px">代码例子 <a target="_blank" href="http://vdisk.weibo.com/s/BDn59yfnBVkqw" rel="nofollow noopener noreferrer">http://vdisk.weibo.com/s/BDn59yfnBVkqw</a>  </span><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e1cbbb27315e8cc407bc59e33b18c37d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">小记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f76b35ba77ab1d99dcf336405eef3cb4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">挨踢江湖之二十</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>