<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【前端】图片上传 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【前端】图片上传" />
<meta property="og:description" content="文章目录 图片1. 图形验证码【返回一连串码】2. 图形验证码【返回图片乱码】 上传图片1. 直接使用接口2. 需要携带参数3. 更换图片 图片 1. 图形验证码【返回一连串码】 图形验证码/base64/报错博客 后台代码
前台代码
&lt;img :src=&#34;&#39;data:image/jpeg;base64,&#39; &#43; codeUrl&#34; @click=&#34;getCode&#34; class=&#34;login-code-img&#34; /&gt; // 获取验证码图片 getCode() { getCode().then((res) =&gt; { // console.log(res); this.loginForm.uuid = res.uuid; // 获取后台数据的图片编码 对其进行数据处理 // 返回的图片编码可以看下面的图片 let str = res.base64Img.replace(/\. &#43;/g, &#34;&#34;); this.codeUrl = str.replace(/[\r\n]/g, &#34;&#34;); }); }, 后台返回的数据格式
2. 图形验证码【返回图片乱码】 后端接口返回图形验证码数据流，前端应如何渲染展示
初始显示 &lt;img ref=&#34;vcImg&#34; src=&#34;/api/user/captcha&#34; alt=&#34;验证码&#34; @click=&#34;getVerifyCode()&#34; /&gt; 每次点击验证码框触发的事件 getVerifyCode() { // 直接通过src去请求验证码图片 通过Math.random()防止缓存问题 this.$refs.vcImg.src = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/dd7366f950e1e74d06680f48fa8f9e9a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-14T13:23:17+08:00" />
<meta property="article:modified_time" content="2023-11-14T13:23:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【前端】图片上传</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">图片</a></li><li><ul><li><a href="#1__2" rel="nofollow">1. 图形验证码【返回一连串码】</a></li><li><a href="#2__36" rel="nofollow">2. 图形验证码【返回图片乱码】</a></li></ul> 
   </li><li><a href="#_55" rel="nofollow">上传图片</a></li><li><ul><li><a href="#1__58" rel="nofollow">1. 直接使用接口</a></li><li><a href="#2__163" rel="nofollow">2. 需要携带参数</a></li><li><a href="#3__209" rel="nofollow">3. 更换图片</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>图片</h3> 
<h4><a id="1__2"></a>1. 图形验证码【返回一连串码】</h4> 
<ul><li><a href="https://blog.csdn.net/weixin_51747462/article/details/126547470">图形验证码/base64/报错博客</a></li></ul> 
<blockquote> 
 <p>后台代码</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/0a/4e/RLteYBcn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/87/37/beXRW7vW_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>前台代码</p> 
</blockquote> 
<pre><code class="prism language-java">		<span class="token operator">&lt;</span>img
            <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"'data:image/jpeg;base64,' + codeUrl"</span>
            <span class="token annotation punctuation">@click</span><span class="token operator">=</span><span class="token string">"getCode"</span>
            <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"login-code-img"</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-java">    <span class="token comment">// 获取验证码图片</span>
    <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// console.log(res);</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>uuid <span class="token operator">=</span> res<span class="token punctuation">.</span>uuid<span class="token punctuation">;</span>
        <span class="token comment">// 获取后台数据的图片编码 对其进行数据处理</span>
        <span class="token comment">// 返回的图片编码可以看下面的图片</span>
        let str <span class="token operator">=</span> res<span class="token punctuation">.</span>base64Img<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token punctuation">.</span> <span class="token operator">+</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>codeUrl <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">[</span>\r\n<span class="token punctuation">]</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<blockquote> 
 <p>后台返回的数据格式</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/95/f7/fvrjYoqx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2__36"></a>2. 图形验证码【返回图片乱码】</h4> 
<ul><li><a href="https://blog.csdn.net/weixin_45092437/article/details/126842549">后端接口返回图形验证码数据流，前端应如何渲染展示</a><br> <img src="https://images2.imgbox.com/af/21/627HUbo8_o.png" alt="在这里插入图片描述"></li><li>初始显示</li></ul> 
<pre><code class="prism language-java">                <span class="token operator">&lt;</span>img
                  ref<span class="token operator">=</span><span class="token string">"vcImg"</span>
                  src<span class="token operator">=</span><span class="token string">"/api/user/captcha"</span>
                  alt<span class="token operator">=</span><span class="token string">"验证码"</span>
                  <span class="token annotation punctuation">@click</span><span class="token operator">=</span><span class="token string">"getVerifyCode()"</span>
                <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<ul><li>每次点击验证码框触发的事件</li></ul> 
<pre><code class="prism language-java">    <span class="token function">getVerifyCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 直接通过src去请求验证码图片 通过Math.random()防止缓存问题</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>vcImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"/api/user/captcha?"</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h3><a id="_55"></a>上传图片</h3> 
<ul><li><a href="https://blog.csdn.net/Shuai_YeYe/article/details/124251221">vue使用element 上传图片，修改图片</a><br> <img src="https://images2.imgbox.com/2c/c0/eRAMrV1J_o.png" alt="在这里插入图片描述"></li></ul> 
<h4><a id="1__58"></a>1. 直接使用接口</h4> 
<blockquote> 
 <p>后台数据</p> 
</blockquote> 
<ul><li>直接上传图片之后直接返回一个值便可以显示使用</li><li>这个img参数就是使用el-upload上传的文件<br> <img src="https://images2.imgbox.com/7e/ec/xwWz1x4Z_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/2f/b4/Drw6PQXu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/58/7d/mTn84D8f_o.png" alt="在这里插入图片描述"></li></ul> 
<blockquote> 
 <p>第一个重点 action 写 <strong>上传的接口</strong><br> 第二个重点 headers 写 <strong>token</strong>（有token才能访问）<br> 第三个重点 on-success 得到一个 <strong>访问接口后的响应值</strong></p> 
</blockquote> 
<pre><code class="prism language-html">			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>
                  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>avatar-uploader<span class="token punctuation">"</span></span>
                  <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span>
                  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>img<span class="token punctuation">"</span></span>
                  <span class="token attr-name">:action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>moc + uploadURL<span class="token punctuation">"</span></span>
                  <span class="token attr-name">:headers</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myHeaders<span class="token punctuation">"</span></span>
                  <span class="token attr-name">:on-success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleAvatarSuccess<span class="token punctuation">"</span></span>
                  <span class="token attr-name">:on-preview</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handlePictureCardPreview<span class="token punctuation">"</span></span>
                  <span class="token attr-name">:before-upload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beforeAvatarUpload<span class="token punctuation">"</span></span>
                  <span class="token attr-name">:before-remove</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgRemove<span class="token punctuation">"</span></span>
                  <span class="token attr-name">:on-remove</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleRemove<span class="token punctuation">"</span></span>
                  <span class="token attr-name">:limit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
                <span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- 因为是放在增加或者修改中 --&gt;</span>
                <span class="token comment">&lt;!-- 所以如果是修改 可能原来存在图片 --&gt;</span>
                <span class="token comment">&lt;!--  所以我们需要判断 --&gt;</span>
				<span class="token comment">&lt;!-- 当有图片的时候就显示出来 没有的时候显示图标 --&gt;</span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
                    <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>news.img != ''<span class="token punctuation">"</span></span>
                    <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>news.img ? news.img : ''<span class="token punctuation">"</span></span>
                    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">"</span></span></span>
                  <span class="token punctuation">/&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">v-else</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-icon-plus avatar-uploader-icon<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tip<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-upload__tip<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    点击上传/更改1张图片，只能上传jpg/png文件，且不超过1mb
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--  提交表格按钮 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span>
                <span class="token attr-name">plain</span>
                <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span>
                <span class="token attr-name">:loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>buttonLoading<span class="token punctuation">"</span></span>
                <span class="token punctuation">&gt;</span></span>{<!-- -->{
                  news.id === ""
                    ? this.$t("common.add")
                    : this.$t("common.edit")
                }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span>
              <span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>data数据</li></ul> 
<pre><code class="prism language-java">	  <span class="token comment">// action中的值</span>
	  moc<span class="token operator">:</span> <span class="token string">"/moc"</span><span class="token punctuation">,</span>
	  <span class="token comment">// action中的值</span>
      uploadURL<span class="token operator">:</span> <span class="token string">"/user/upload"</span><span class="token punctuation">,</span>
      <span class="token comment">// headers中的值</span>
      myHeaders<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> token<span class="token operator">:</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<ul><li>methods</li></ul> 
<pre><code class="prism language-java"><span class="token comment">// 上传成功</span>
<span class="token comment">// 将上传的图片变成显示的图片</span>
    <span class="token function">handleAvatarSuccess</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//上传头像</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>news<span class="token punctuation">.</span>img <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 在上传成功之前判断图片的类型和大小</span>
    <span class="token function">beforeAvatarUpload</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//判断大小和类型</span>
      <span class="token keyword">const</span> isJPG <span class="token operator">=</span>
        file<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"image/png"</span> <span class="token operator">||</span>
        file<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"image/jpg"</span> <span class="token operator">||</span>
        file<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> isLt2M <span class="token operator">=</span> file<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token comment">// console.log(file);</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isJPG<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"上传头像图片只能是 JPG/JPEG/PNG 格式!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLt2M<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"上传头像图片大小不能超过 1MB!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> isJPG <span class="token operator">&amp;&amp;</span> isLt2M<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 点击图片 预览图片</span>
    <span class="token function">handlePictureCardPreview</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 对话框中图片</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogImageUrl <span class="token operator">=</span> file<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token comment">// 对话框进行显示</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 图片移除前判断</span>
    <span class="token function">imgRemove</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token function">confirm</span><span class="token punctuation">(</span>`确定移除 $<span class="token punctuation">{<!-- --></span>file<span class="token punctuation">.</span>name<span class="token punctuation">}</span>？`<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 图片移除时 将显示图片清空</span>
    <span class="token function">handleRemove</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> fileList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>news<span class="token punctuation">.</span>img <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h4><a id="2__163"></a>2. 需要携带参数</h4> 
<ul><li>需要额外携带参数</li><li>folderName和user是放到param中携带的参数</li><li>file参数就是使用el-upload上传的文件<br> <img src="https://images2.imgbox.com/c3/23/O1LrNSiG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/39/6f/8CBg59b4_o.png" alt="在这里插入图片描述"></li><li>因为是自己的项目，这里action直接使用后台给的上传接口即可</li></ul> 
<pre><code class="prism language-java">      <span class="token operator">&lt;</span>el<span class="token operator">-</span>upload
        <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"upload-demo"</span>
        drag
        action<span class="token operator">=</span><span class="token string">"/api/file/upload"</span>
        <span class="token operator">:</span>data<span class="token operator">=</span><span class="token string">"uploadData"</span>
        <span class="token operator">:</span>headers<span class="token operator">=</span><span class="token string">"myHeaders"</span>
        <span class="token operator">:</span>on<span class="token operator">-</span>success<span class="token operator">=</span><span class="token string">"uploadSuccess"</span>
      <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-icon-plus"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"dialog"</span><span class="token operator">&gt;</span>
          <span class="token generics"><span class="token punctuation">&lt;</span>p<span class="token punctuation">&gt;</span></span>上传附件<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>upload<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>上传接口头部需要携带token</li></ul> 
<pre><code class="prism language-java">myHeaders<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> token<span class="token operator">:</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<ul><li>计算属性中写额外携带的参数</li></ul> 
<pre><code class="prism language-java">  computed<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 上传文件需要的参数</span>
    <span class="token function">uploadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        folderName<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>displayPath<span class="token punctuation">,</span>
        user<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span><span class="token constant">GET_USERINFO</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token comment">// 当前登录用户</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<ul><li>文件上传成功之后初始化数据</li><li><mark>这里写的版本不需要显示图片 所以不用对结果做处理 直接加载数据即可</mark></li><li>如果是需要显示图片 按照第一种双向绑定数据并作出判断即可</li></ul> 
<pre><code class="prism language-java">    <span class="token function">uploadSuccess</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重新加载数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h4><a id="3__209"></a>3. 更换图片</h4> 
<ul><li>更新接口</li><li>上传的是用户信息达到更新的作用<br> <img src="https://images2.imgbox.com/c3/c6/JVBiRKgV_o.png" alt="在这里插入图片描述"></li><li>el-upload的<strong>action</strong>即是下图的接口路径 /uploadImage 达到上传图片的功能<br> <img src="https://images2.imgbox.com/40/d7/7Xa81no1_o.png" alt="在这里插入图片描述"></li><li>使用src可以访问图片（记得加上前面的api）</li><li>http://localhost:98/image/userAvatar/’ + currentUser.avatar 因为使用标题存储为avatar到数据库 所以需要加上前缀<br> <img src="https://images2.imgbox.com/b8/81/vfywucIG_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>el<span class="token operator">-</span>upload
      <span class="token operator">:</span>headers<span class="token operator">=</span><span class="token string">"headers"</span>
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"avatar-uploader"</span>
      <span class="token operator">:</span>action<span class="token operator">=</span><span class="token string">"moc + uploadURL"</span>
      <span class="token operator">:</span>show<span class="token operator">-</span>file<span class="token operator">-</span>list<span class="token operator">=</span><span class="token string">"false"</span>
      <span class="token operator">:</span>on<span class="token operator">-</span>success<span class="token operator">=</span><span class="token string">"handleAvatarSuccess"</span>
      <span class="token operator">:</span>before<span class="token operator">-</span>upload<span class="token operator">=</span><span class="token string">"beforeAvatarUpload"</span>
    <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在存在头像的时候显示图片 如果存在即显示 不存在显示图标 <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>img
        v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"'http://localhost:98/image/userAvatar/' + currentUser.avatar"</span>
        <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"'http://localhost:98/image/userAvatar/' + currentUser.avatar"</span>
        style<span class="token operator">=</span><span class="token string">"width: 100%"</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>i v<span class="token operator">-</span><span class="token keyword">else</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-icon-plus iconfont"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>alert title<span class="token operator">=</span><span class="token string">"点击图片更换头像"</span> type<span class="token operator">=</span><span class="token string">"info"</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>alert<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>upload<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>button <span class="token annotation punctuation">@click</span><span class="token operator">=</span><span class="token string">"handleConfirm"</span><span class="token operator">&gt;</span>确认更换<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>data数据</li></ul> 
<pre><code class="prism language-java">      headers<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> token<span class="token operator">:</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 设置接口</span>
      moc<span class="token operator">:</span> <span class="token string">"http://localhost:98/"</span><span class="token punctuation">,</span>
      uploadURL<span class="token operator">:</span> <span class="token string">"sys/user/uploadImage"</span><span class="token punctuation">,</span>
</code></pre> 
<ul><li>methods</li></ul> 
<pre><code class="prism language-java"> <span class="token comment">// 成功上传头像</span>
    <span class="token function">handleAvatarSuccess</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 这里没有用到src。 因为图片路径直接用标题转换了。</span>
      <span class="token comment">// 如果直接用src可以少些一点代码。</span>
      <span class="token comment">// this.imageUrl = "http://localhost:98/" + res.data.src;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentUser<span class="token punctuation">.</span>avatar <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 在上传头像之前 判断图片类型和图片大小</span>
    <span class="token function">beforeAvatarUpload</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> isJPG <span class="token operator">=</span> file<span class="token punctuation">.</span>type <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> isLt2M <span class="token operator">=</span> file<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isJPG<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"图片必须是jpg格式"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLt2M<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"图片大小不能超过2M!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> isJPG <span class="token operator">&amp;&amp;</span> isLt2M<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 确认按钮 使用接口 更换数据库中的头像</span>
    <span class="token function">handleConfirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 参数是用户信息</span>
      <span class="token function">updateAvatar</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentUser<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"执行成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 因为数据是保存到session中的 改变了用户信息就需要重新上传到session中</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">"SET_USERINFO"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"getUser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"getUserUrl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a041214ae141e3ce8b9b9b1a664301fd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【前端】加密解密、数据处理、前端搜索</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bf773258425c8031121e867ea569121b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">git.exe push -v --progress “origin“ dev:devwarning: redirecting to http://xxxxx提交失败</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>