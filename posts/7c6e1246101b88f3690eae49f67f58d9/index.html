<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>libcurl简介及其编程应用 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="libcurl简介及其编程应用" />
<meta property="og:description" content="本文为学习笔记，整合课程内容以及下列文章：
其中，libcurl函数库常用字段解读部分：
参考博文：原文地址
作者：冬冬他哥哥
目录
libcurl简介
libcurl的使用
学会开源包使用的一般步骤
包的解读
重点是看INSTALL文件
库的 配置 &gt; 编译 &gt; 安装
编程实例：访问百度主页
代码
编译注意：
libcurl函数库常用字段解读
一、调用curl_global_init()：初始化libcurl
二、调用curl_easy_init()：得到 easy interface型指针,拿到句柄
三、调用curl_easy_setopt(CURL *handle, CURLoption option, parameter)：设置传输选项
四、调用curl_easy_perform()：完成传输任务
五、调用curl_easy_cleanup()：释放内存
libcurl简介 在linux下用c语言做HTTP的编程有一种方法是依赖于这个libcurlv库，以后做跨平台网络协议相关的开发，第一个要想到的就是它。
libcurl是一个跨平台的网络协议库，支持http, https, ftp等协议，libcurl同样支持：
（1）HTTPS证书授权
（2）HTTP POST, HTTP PUT, FTP 上传
（3） HTTP基本表单上传，代理，cookies,和用户认证
库下载地址：库下载
然后发送到linux开发环境中。
libcurl的使用 学会开源包使用的一般步骤 我们是希望通过学会使用libcurl库来掌握一系列类似的库的使用方法，所谓触类旁通。
windows下载完库后拖拽到ubuntu，创建一个空文件，把库拉进来。
包的解读 解压下载的库
tar xvf curl-7.71.1.tar.bz2 进入文件夹
cd curl-7.71.1 对于这种开源的包，一定要学会它的使用：
先看README：
vi README 难受，看不懂
没关系，去看这个
docs文件夹很重要，一般是对README的补充
cd docs 不需要看太多，看类似于这个：提到的相关的API手册" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/7c6e1246101b88f3690eae49f67f58d9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-17T22:33:55+08:00" />
<meta property="article:modified_time" content="2023-01-17T22:33:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">libcurl简介及其编程应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>本文为学习笔记，整合课程内容以及下列文章：</p> 
<p>其中，libcurl函数库常用字段解读部分：</p> 
<blockquote> 
 <p>参考博文：<a href="https://www.cnblogs.com/xietianjiao/p/13260021.html" rel="nofollow" title="原文地址">原文地址</a><br> 作者：<a href="https://www.cnblogs.com/xietianjiao/" rel="nofollow" title="冬冬他哥哥">冬冬他哥哥</a></p> 
</blockquote> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="libcurl%E7%AE%80%E4%BB%8B-toc" style="margin-left:0px;"><a href="#libcurl%E7%AE%80%E4%BB%8B" rel="nofollow">libcurl简介</a></p> 
<p id="libcurl%E7%9A%84%E4%BD%BF%E7%94%A8-toc" style="margin-left:0px;"><a href="#libcurl%E7%9A%84%E4%BD%BF%E7%94%A8" rel="nofollow">libcurl的使用</a></p> 
<p id="%E5%AD%A6%E4%BC%9A%E5%BC%80%E6%BA%90%E5%8C%85%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%80%E8%88%AC%E6%AD%A5%E9%AA%A4-toc" style="margin-left:40px;"><a href="#%E5%AD%A6%E4%BC%9A%E5%BC%80%E6%BA%90%E5%8C%85%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%80%E8%88%AC%E6%AD%A5%E9%AA%A4" rel="nofollow">学会开源包使用的一般步骤</a></p> 
<p id="%E5%8C%85%E7%9A%84%E8%A7%A3%E8%AF%BB-toc" style="margin-left:80px;"><a href="#%E5%8C%85%E7%9A%84%E8%A7%A3%E8%AF%BB" rel="nofollow">包的解读</a></p> 
<p id="%E9%87%8D%E7%82%B9%E6%98%AF%E7%9C%8BINSTALL%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E9%87%8D%E7%82%B9%E6%98%AF%E7%9C%8BINSTALL%E6%96%87%E4%BB%B6" rel="nofollow">重点是看INSTALL文件</a></p> 
<p id="%E5%BA%93%E7%9A%84%20%E9%85%8D%E7%BD%AE%20%3E%20%E7%BC%96%E8%AF%91%20%3E%20%E5%AE%89%E8%A3%85-toc" style="margin-left:80px;"><a href="#%E5%BA%93%E7%9A%84%20%E9%85%8D%E7%BD%AE%20%3E%20%E7%BC%96%E8%AF%91%20%3E%20%E5%AE%89%E8%A3%85" rel="nofollow">库的 配置 &gt; 编译 &gt; 安装</a></p> 
<p id="%E7%BC%96%E7%A8%8B%E5%AE%9E%E4%BE%8B%EF%BC%9A%E8%AE%BF%E9%97%AE%E7%99%BE%E5%BA%A6%E4%B8%BB%E9%A1%B5-toc" style="margin-left:40px;"><a href="#%E7%BC%96%E7%A8%8B%E5%AE%9E%E4%BE%8B%EF%BC%9A%E8%AE%BF%E9%97%AE%E7%99%BE%E5%BA%A6%E4%B8%BB%E9%A1%B5" rel="nofollow">编程实例：访问百度主页</a></p> 
<p id="%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%E4%BB%A3%E7%A0%81" rel="nofollow">代码</a></p> 
<p id="%E7%BC%96%E8%AF%91%E6%B3%A8%E6%84%8F%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E7%BC%96%E8%AF%91%E6%B3%A8%E6%84%8F%EF%BC%9A" rel="nofollow">编译注意：</a></p> 
<p id="libcurl%E5%87%BD%E6%95%B0%E5%BA%93%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E8%A7%A3%E8%AF%BB-toc" style="margin-left:40px;"><a href="#libcurl%E5%87%BD%E6%95%B0%E5%BA%93%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E8%A7%A3%E8%AF%BB" rel="nofollow">libcurl函数库常用字段解读</a></p> 
<p id="%E4%B8%80%E3%80%81%E8%B0%83%E7%94%A8curl_global_init()%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96libcurl-toc" style="margin-left:80px;"><a href="#%E4%B8%80%E3%80%81%E8%B0%83%E7%94%A8curl_global_init%28%29%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96libcurl" rel="nofollow">一、调用curl_global_init()：初始化libcurl</a></p> 
<p id="%E4%BA%8C%E3%80%81%E8%B0%83%E7%94%A8curl_easy_init()%EF%BC%9A%E5%BE%97%E5%88%B0%20easy%20interface%E5%9E%8B%E6%8C%87%E9%92%88%2C%E6%8B%BF%E5%88%B0%E5%8F%A5%E6%9F%84-toc" style="margin-left:80px;"><a href="#%E4%BA%8C%E3%80%81%E8%B0%83%E7%94%A8curl_easy_init%28%29%EF%BC%9A%E5%BE%97%E5%88%B0%20easy%20interface%E5%9E%8B%E6%8C%87%E9%92%88%2C%E6%8B%BF%E5%88%B0%E5%8F%A5%E6%9F%84" rel="nofollow">二、调用curl_easy_init()：得到 easy interface型指针,拿到句柄</a></p> 
<p id="%E4%B8%89%E3%80%81%E8%B0%83%E7%94%A8curl_easy_setopt(CURL%20*handle%2C%20CURLoption%20option%2C%20parameter)%EF%BC%9A%E8%AE%BE%E7%BD%AE%E4%BC%A0%E8%BE%93%E9%80%89%E9%A1%B9-toc" style="margin-left:80px;"><a href="#%E4%B8%89%E3%80%81%E8%B0%83%E7%94%A8curl_easy_setopt%28CURL%20*handle%2C%20CURLoption%20option%2C%20parameter%29%EF%BC%9A%E8%AE%BE%E7%BD%AE%E4%BC%A0%E8%BE%93%E9%80%89%E9%A1%B9" rel="nofollow">三、调用curl_easy_setopt(CURL *handle, CURLoption option, parameter)：设置传输选项</a></p> 
<p id="%E5%9B%9B%E3%80%81%E8%B0%83%E7%94%A8curl_easy_perform()%EF%BC%9A%E5%AE%8C%E6%88%90%E4%BC%A0%E8%BE%93%E4%BB%BB%E5%8A%A1-toc" style="margin-left:80px;"><a href="#%E5%9B%9B%E3%80%81%E8%B0%83%E7%94%A8curl_easy_perform%28%29%EF%BC%9A%E5%AE%8C%E6%88%90%E4%BC%A0%E8%BE%93%E4%BB%BB%E5%8A%A1" rel="nofollow">四、调用curl_easy_perform()：完成传输任务</a></p> 
<p id="%E4%BA%94%E3%80%81%E8%B0%83%E7%94%A8curl_easy_cleanup()%EF%BC%9A%E9%87%8A%E6%94%BE%E5%86%85%E5%AD%98-toc" style="margin-left:80px;"><a href="#%E4%BA%94%E3%80%81%E8%B0%83%E7%94%A8curl_easy_cleanup%28%29%EF%BC%9A%E9%87%8A%E6%94%BE%E5%86%85%E5%AD%98" rel="nofollow">五、调用curl_easy_cleanup()：释放内存</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="libcurl%E7%AE%80%E4%BB%8B">libcurl简介</h2> 
<p>在linux下用c语言做HTTP的编程有一种方法是依赖于这个libcurlv库，以后做跨平台<a href="https://so.csdn.net/so/search?q=%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE&amp;spm=1001.2101.3001.7020" title="网络协议">网络协议</a>相关的开发，第一个要想到的就是它。</p> 
<p>libcurl是一个<strong>跨平台的网络协议库</strong>，支持http, https, ftp等协议，libcurl同样支持：</p> 
<blockquote> 
 <p>（1）HTTPS证书授权<br> （2）HTTP POST, HTTP PUT, FTP 上传<br> （3） HTTP基本表单上传，代理，cookies,和用户认证</p> 
</blockquote> 
<p>库下载地址：<a href="https://github.com/curl/curl/releases/tag/curl-7_71_1" title="库下载">库下载</a></p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/11/a3/q2LWLi32_o.png"><br> 然后发送到linux开发环境中。</p> 
<h2 id="libcurl%E7%9A%84%E4%BD%BF%E7%94%A8">libcurl的使用</h2> 
<h3 id="%E5%AD%A6%E4%BC%9A%E5%BC%80%E6%BA%90%E5%8C%85%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%80%E8%88%AC%E6%AD%A5%E9%AA%A4"><a name="t3"></a><a id="_38"></a>学会开源包使用的一般步骤</h3> 
<p>我们是希望通过学会使用libcurl库来掌握一系列类似的库的使用方法，所谓触类旁通。</p> 
<p>windows下载完库后拖拽到ubuntu，创建一个空文件，把库拉进来。</p> 
<p><img alt="" height="133" src="https://images2.imgbox.com/00/83/teBW4WAr_o.png" width="532"> </p> 
<h4 id="%E5%8C%85%E7%9A%84%E8%A7%A3%E8%AF%BB">包的解读</h4> 
<p>解压下载的库</p> 
<pre><code>tar xvf curl-7.71.1.tar.bz2</code></pre> 
<p>进入文件夹</p> 
<pre><code>cd curl-7.71.1</code></pre> 
<p>对于这种开源的包，一定要学会它的使用：</p> 
<p>先看README：</p> 
<pre><code>vi README</code></pre> 
<p>难受，看不懂<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/d0/a5/dc6is3qd_o.png"><br> 没关系，去看这个</p> 
<p>docs文件夹很重要，一般是对README的补充</p> 
<pre><code>cd docs
</code></pre> 
<p>不需要看太多，看类似于这个：提到的相关的API手册</p> 
<pre><code>vi curl.1</code></pre> 
<p>也很难受，真提取不到什么信息。</p> 
<p>嵌入式开发变得简单了是因为嵌入式经过十几二十年的发展有很多人对其进行解读，写了很多文章。</p> 
<h3 id="%E9%87%8D%E7%82%B9%E6%98%AF%E7%9C%8BINSTALL%E6%96%87%E4%BB%B6">重点是看INSTALL文件</h3> 
<p>还是重点来看看docs下的INSTALL文件，库一定要学会安装才能使用。</p> 
<pre><code class="hljs">vi INSTALL</code></pre> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/31/ab/7Sa9mMuE_o.png"> </p> 
<p>来读一读，大概看看<code>INSTALL.md</code></p> 
<pre><code class="hljs">vi INSTALL.md</code></pre> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/23/ee/qFjcF9LX_o.png"></p> 
<blockquote> 
 <p>可以看到./configure后面<strong>没有跟任何参数就是默认安装位置</strong>了，这里我们肯定要做配置，不配置都不知道文件安装到哪里去了</p> 
</blockquote> 
<blockquote> 
 <p>make就是编译的意思<br> make install就是把编译的结果拷贝到根的文件夹底下</p> 
</blockquote> 
<p>关于帮助：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/51/23/V7AomELF_o.png">不在原本默认的路径下安装说明：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/3a/f4/RacqdVUd_o.png"><br> 配置是否支持https：<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/5e/eb/HGyEYblJ_o.png">回到<code>/http/curl-7.71.1</code>目录下，configure --help看看 </p> 
<pre><code>./configure --help
</code></pre> 
<p>可以看到上文所提及的安装路径配置：</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/d9/64/Rofyeh2R_o.png"><br> 也可以看到特别重要的交叉编译说明:<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/c7/c2/cGlH5xQF_o.png"></p> 
<h4 id="%E5%BA%93%E7%9A%84%20%E9%85%8D%E7%BD%AE%20%3E%20%E7%BC%96%E8%AF%91%20%3E%20%E5%AE%89%E8%A3%85">库的 配置 &gt; 编译 &gt; 安装</h4> 
<p><a id="1_112"></a>（1）安装位置的更改：</p> 
<p>配置为：<code>$</code>获取当前路径,编译的时候会自动生成_install文件夹，并且把编译生成的东西全部放入这个文件夹。</p> 
<pre><code>./configure --prefix=$PWD/_install</code></pre> 
<blockquote> 
 <p>另外，这是针对于交叉编译的配置：编译后在树莓派上用<br><strong><code><span style="background-color:#fbd4d0;">./configure --prefix=$PWD/_install --host=arm-linux</span></code></strong><br> 这样，在ubuntu中就会使用arm-gcc进行编译 </p> 
</blockquote> 
<p>（2）开始编译</p> 
<pre><code>make</code></pre> 
<p>（3）安装</p> 
<pre><code>make install</code></pre> 
<p>4）预览</p> 
<p>进入 <code>/_install</code></p> 
<p>我们用的是头文件</p> 
<pre><code>cd include</code></pre> 
<p>进入里面的这个</p> 
<pre><code>cd curl</code></pre> 
<p>这些都是要用到的头文件<br><img alt="在这里插入图片描述" src="https://images2.imgbox.com/c0/d4/eo3560kY_o.png">就像树莓派编译是要链接库一样</p> 
<pre><code>gcc a.c -lwiringPi -lpthread</code></pre> 
<p>用到这个库的时候，我们同样需要链接<code>_install/lib</code>里面的<code>libcurl.so</code>动态库 （<code>.a</code>是静态库） </p> 
<h3 id="%E7%BC%96%E7%A8%8B%E5%AE%9E%E4%BE%8B%EF%BC%9A%E8%AE%BF%E9%97%AE%E7%99%BE%E5%BA%A6%E4%B8%BB%E9%A1%B5">编程实例：访问百度主页</h3> 
<p>把<code>_install</code>里的内容结合一下示例代码来访问一下百度。</p> 
<h4 id="%E4%BB%A3%E7%A0%81"><a name="t7"></a><a id="_175"></a>代码</h4> 
<pre><code class="language-bash">#include &lt;stdio.h&gt;
#include &lt;curl/curl.h&gt;

typedef unsigned int bool;//数据类型别名用typedef
#define true 1            //宏定义用define
#define false 0

bool getUrl(char *filename)
{
        CURL *curl;
        CURLcode res;
        FILE *fp;
        if ((fp = fopen(filename, "w")) == NULL)  // 返回结果用文件存储
                return false;
        struct curl_slist *headers = NULL;
        headers = curl_slist_append(headers, "Accept: Agent-007");
        curl = curl_easy_init();    // 初始化
        if (curl)
        {
                //curl_easy_setopt(curl, CURLOPT_PROXY, "10.99.60.201:8080");// 代理
                curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers);// 改协议头
                curl_easy_setopt(curl, CURLOPT_URL,"http://www.baidu.com");
                curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp); //将返回的http头输出到fp&gt;指向的文件,即为filename文件，而传入的参数是 /tmp/get.html，即为真正保存在get.html文件中
                curl_easy_setopt(curl, CURLOPT_HEADERDATA, fp); //将返回的html主体数据输出到fp指向的文件
                res = curl_easy_perform(curl);   // 执行
                if (res != 0) {

                        curl_slist_free_all(headers);  //释放句柄
                        curl_easy_cleanup(curl);
                }
                fclose(fp);
                return true;
        }
}
bool postUrl(char *filename)
{
        CURL *curl;
        CURLcode res;
        FILE *fp;
        if ((fp = fopen(filename, "w")) == NULL)
                return false;
        curl = curl_easy_init();
        if (curl)
        {
                curl_easy_setopt(curl, CURLOPT_COOKIEFILE, "/tmp/cookie.txt"); // 指定cookie文件
                curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "&amp;logintype=uid&amp;u=xieyan&amp;psw=xxx86");    // 指定post内容：用户信息，尝试登陆新浪邮箱
                //curl_easy_setopt(curl, CURLOPT_PROXY, "10.99.60.201:8080");
                curl_easy_setopt(curl, CURLOPT_URL, " http://mail.sina.com.cn/cgi-bin/login.cgi ");   // 指定url
                curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);
                res = curl_easy_perform(curl);
                curl_easy_cleanup(curl);
        }
        fclose(fp);
        return true;
}
int main(void)
{
        getUrl("/tmp/get.html");
        postUrl("/tmp/post.html");
}
</code></pre> 
<blockquote> 
 <p>为什么要有最开始的那三句代码呢？<br> 类似于<code>bool，true，faluse</code>，这是C99标准才会支持，C++里有专门的bool类型,用来表示真或假。但是在C语言里没有这样的类型，为了修改方便直接这样替换。 </p> 
</blockquote> 
<h4 id="%E7%BC%96%E8%AF%91%E6%B3%A8%E6%84%8F%EF%BC%9A">编译注意：</h4> 
<p>链接库和头文件再编译，同时注意指明他们的路径</p> 
<pre><code>gcc getAndPost.c -I ./curl-7.71.1/_install/include/ -L ./curl-7.71.1/_install/lib/ -lcurl

</code></pre> 
<blockquote> 
 <p>注意了，动态库静态库的链接用<code>-L</code>，而头文件用<code>-I</code></p> 
</blockquote> 
<p>错误排查：</p> 
<blockquote> 
 <p>（1）如果只是使用<code>-L</code>是默认去<code>usr/lib</code>下去找的,会提示找不到<code>cannot find -lcurl</code></p> 
</blockquote> 
<blockquote> 
 <p>（2）如果编译报错一堆函数不认识，函数是存在库里面的，说明没有链接库</p> 
</blockquote> 
<pre><code class="language-bash">usr/bin/ld: getAndPost.c:(.text+0x1a2): undefined reference to `curl_easy_init'
/usr/bin/ld: getAndPost.c:(.text+0x1d2): undefined reference to `curl_easy_setopt'
/usr/bin/ld: getAndPost.c:(.text+0x1f6): undefined reference to `curl_easy_setopt'
/usr/bin/ld: getAndPost.c:(.text+0x217): undefined reference to `curl_easy_setopt'
/usr/bin/ld: getAndPost.c:(.text+0x238): undefined reference to `curl_easy_setopt'
/usr/bin/ld: getAndPost.c:(.text+0x244): undefined reference to `curl_easy_perform'
</code></pre> 
<blockquote> 
 <p>（3）提示找不到头文件<code>#include &lt;curl/curl.h&gt;</code>，说明没有指明头文件的路径 </p> 
</blockquote> 
<p>可以看到已经生成了可执行文件./a.out</p> 
<p>直接运行这个./a.out是会报错的</p> 
<pre><code class="language-bash">error while loading shared libraries: libcurl.so.4:cannot open shared object file:no such file or directory
</code></pre> 
<p>原因是没有添加环境变量，忘记怎么添加咋办？面向百度，export lib path</p> 
<pre><code>export LD_LIBRARY_PATH=./curl-7.71.1/_install/lib/</code></pre> 
<p>成功运行后，可以看到<span style="background-color:#fbd4d0;">vi /tmp/get.html</span>中已经有了百度官网的代码。（仅贴出部分）</p> 
<pre><code class="language-bash">vi /tmp/get.html</code></pre> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/27/5a/dortkik8_o.png"></p> 
<p>这跟我们平常去访问百度是一样的,只是用了前端css去排版的比较好看罢了，当你右键查看页面源码就知道了。</p> 
<p>而<span style="background-color:#fbd4d0;">vi /tmp/port.html</span>里面不会有东西，因为访问失败了：新浪的用户和密码不匹配。</p> 
<h3 id="libcurl%E5%87%BD%E6%95%B0%E5%BA%93%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E8%A7%A3%E8%AF%BB">libcurl函数库常用字段解读</h3> 
<h4 id="%E4%B8%80%E3%80%81%E8%B0%83%E7%94%A8curl_global_init()%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96libcurl"><a name="t10"></a><a id="curl_global_initlibcurl_298"></a>一、调用<code>curl_global_init()</code>：初始化libcurl</h4> 
<p>函数只能用一次。(其实在调用curl_global_cleanup 函数后仍然可再用)</p> 
<p>如果这个函数在<code>curl_easy_init</code>函数调用时还没调用，它将由<strong>libcurl库自动调用</strong>，所以<strong>多线程</strong>下最好主动调用该函数以防止在线程中curl_easy_init时多次调用。</p> 
<blockquote> 
 <p>注意：虽然libcurl是线程安全的，但curl_global_init是不能保证线程安全的， 所以不要在每个线程中都调用curl_global_init，应该将该函数的调用放在主线程中。 </p> 
</blockquote> 
<p>参数：flags</p> 
<pre><code class="language-bash">CURL_GLOBAL_ALL               //初始化所有的可能的调用。(最常用)
CURL_GLOBAL_SSL              //初始化支持 安全套接字层。
CURL_GLOBAL_WIN32            //初始化win32套接字库。
CURL_GLOBAL_NOTHING         //没有额外的初始化。</code></pre> 
<h4 id="%E4%BA%8C%E3%80%81%E8%B0%83%E7%94%A8curl_easy_init()%EF%BC%9A%E5%BE%97%E5%88%B0%20easy%20interface%E5%9E%8B%E6%8C%87%E9%92%88%2C%E6%8B%BF%E5%88%B0%E5%8F%A5%E6%9F%84">二、调用<code>curl_easy_init()</code>：得到 easy interface型指针,拿到句柄</h4> 
<p>用来初始化一个<a href="https://so.csdn.net/so/search?q=CURL&amp;spm=1001.2101.3001.7020" title="CURL">CURL</a>的指针(有些像返回FILE类型的指针一样)。相应的在调用结束时要用curl_easy_cleanup函数清理。</p> 
<p>一般curl_easy_init意味着一个会话的开始. 它会返回一个easy_handle(CURL*对象), 一般都用在easy系列的函数中。</p> 
<p>后续所有的操作都是对这个指针进行设置，把这种类型的指针就叫做<strong>句柄</strong>，实例：</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/ae/9c/OVrOWoL1_o.png"></p> 
<blockquote> 
 <p>其实socket服务器再socket函数后生成的fd，后续的bind，accept等操作也是基于这个fd，也可以理解为句柄 </p> 
</blockquote> 
<h4 id="%E4%B8%89%E3%80%81%E8%B0%83%E7%94%A8curl_easy_setopt(CURL%20*handle%2C%20CURLoption%20option%2C%20parameter)%EF%BC%9A%E8%AE%BE%E7%BD%AE%E4%BC%A0%E8%BE%93%E9%80%89%E9%A1%B9">三、调用<code>curl_easy_setopt(CURL *handle, CURLoption option, parameter)</code>：设置传输选项</h4> 
<p>根据设置的传输选项，实现回调函数以完成用户特定任务（设置与操作句柄）</p> 
<p>这个函数最重要了.几乎所有的curl 程序都要频繁的使用它.它告诉curl库.程序将有如何的行为. 比如要查看一个网页的html代码等.(这个函数有些像ioctl函数)</p> 
<blockquote> 
 <p><strong>参数:</strong><br> （1）CURL类型的指针<br> （2）CURLoption类型的选项.(都在curl.h库里有定义,man 也可以查看到)<br> （3）parameter 既可以是个函数的指针,也可以是某个对象的指针,也可以是 个long型的变量，取决于第二个参数。</p> 
</blockquote> 
<p><strong>CURLoption常用的选项:</strong><br> （1）CURLOPT_URL:设置访问URL,就是设置访问的网址<br> （2）CURLOPT_WRITEFUNCTION，CURLOPT_WRITEDATA<br> 回调函数：网页有数据请求回来的时候，如何去处理这些数据。（做人脸识别，肯定要获得人脸识别的结果）</p> 
<p>设置的回调函数格式要求为：<br> size_t function( void *ptr, size_t size, size_t nmemb, void *stream);</p> 
<p>函数将在libcurl接收到数据后被调用，因此函数多做数据保存的功能，如处理下载文件。</p> 
<p><strong>CURLOPT_WRITEFUNCTION使用举例</strong><br> ①陈老师的车牌识别车牌识别</p> 
<pre><code class="language-bash">int BufferWriterFunc(char* data,size_t size,size_t nmemb,char *buffer)
{
	strcpy(bufferData,data);//把返回的data数据放在本地的bufferData数组中
	return size*nmemb;
}

//配置如下：
curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION,BufferWriterFunc);
</code></pre> 
<p>②修改上面访问百度的代码</p> 
<pre><code class="language-bash">size_t readData(void *ptr, size_t size, size_t nmemb, void *stream)
{
	char buf[1024] = {'\0'};
	strncpy(buf,ptr,1024);
	printf("===========get data ===========\n");
	printf("%s\n",buf);
}

curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION,readData);
</code></pre> 
<p><strong>CURLOPT_WRITEDATA使用举例</strong></p> 
<p>也可以通过 CURLOPT_WRITEDATA属性给默认回调函数传递一个<strong>已经打开的文件指针</strong>，用于将数据输出到文件里。</p> 
<p>正如上面访问百度的例子：</p> 
<pre><code class="language-bash">FILE *fp;
if ((fp = fopen(filename, "w")) == NULL)//提前打开了一个文件流
        return false;

curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);//请求回来的所有数据都放到文件中
</code></pre> 
<p>（3）CURLOPT_POSTFIELDS</p> 
<p>在post请求中：以<code>&amp;</code>拼接字符串的形式把参数链接起来</p> 
<pre><code class="language-bash">curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "&amp;logintype=uid&amp;u=xieyan&amp;psw=xxx86");    // 指定post内容：用户信息，尝试登陆新浪邮箱
</code></pre> 
<p>下片文章提到的翔云人工智能平台OCRkey和密码就要放在这里传输。</p> 
<h4 id="%E5%9B%9B%E3%80%81%E8%B0%83%E7%94%A8curl_easy_perform()%EF%BC%9A%E5%AE%8C%E6%88%90%E4%BC%A0%E8%BE%93%E4%BB%BB%E5%8A%A1">四、调用<code>curl_easy_perform()</code>：完成传输任务</h4> 
<p>在初始化CURL类型的指针 以及curl_easy_setopt完成后调用. 就像字面的意思所说perform就像是个舞台.让我们设置的option 运作起来。</p> 
<h4 id="%E4%BA%94%E3%80%81%E8%B0%83%E7%94%A8curl_easy_cleanup()%EF%BC%9A%E9%87%8A%E6%94%BE%E5%86%85%E5%AD%98">五、调用<code>curl_easy_cleanup()</code>：释放内存</h4> 
<p>结束libcurl使用的时候，用来对curl_global_init做的工作清理。类似于close的函数。</p> 
<p>该死的a库不好用</p> 
<pre><code class="language-bash">./a.out: /usr/lib/arm-linux-gnueabihf/libssl.so.1.1: version `OPENSSL_1_1_1' not found (required by ./curl-7.71.1/_install/lib/libcurl.so.4)
</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f77f0970fe286f5ec42c0bb32808dec/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【VSC插件】解决 VSC 中 Tailwind CSS IntelliSense v0.9.6 语法无法识别的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2bd2747c1024ce99ec8ef4b2dc43c34/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[简洁版]Windows命令行配置IP地址及DNS等</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>