<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OFD转PDF ~java实现 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OFD转PDF ~java实现" />
<meta property="og:description" content="OFD转PDF ~java实现 当你在查这个问题时，说明大家都已经接触到OFD这个新的版式文档了。OFD格式对标的是PDF，目前关于PDF的转换都比较成熟，但是当OFD出现后，却发现能实现转换却似乎有所困难。尝试网上搜了一下这方面的资料，大部分是只能支持在网页在线转换，但是如果想自己通过后台代码去实现转换却基本没有。
无意中发现“超阅云”这个平台，不仅支持网页在线转换，还支持API对接转换。果断验证一波！！
————————————————
准备工作 注册开发者账号，可直接微信扫码登录注册，一键搞定
进入个人中心，获取API开放秘钥，然后就需要购买套餐包。不过我当时直接咨询了一下他们客服，问小姐姐能不能后台先赠送我一个套餐包先体验调试下。小姐姐很热情，直接让后台发了个套餐包体验券给我，立马可以调试了。如果一开始就要付费调试，那成本确实有些高了。在这里感谢“超阅”客服小姐姐
开始开发 1、接口概述
（1）采用HTTP接口模式，编码UTF-8
（2）接口地址： https://surread.esign.cn
（3）接口请求前必须先申请成为开发者，并获取accessKey和secretKey
（4）接口请求头需要带上鉴权参数Authorization ，详情见“鉴权方式&#34;
2、鉴权方式
（1）鉴权规则
第一步：参数签名signature
MD5(post &#43; url &#43; 请求时间戳 &#43; 请求随机串 &#43; MD5(ak&#43;sk))
第二步：base64加密 Authorization
base64(method=post,url=xxx,timestamp=xxx,nonce_str=xxx,ak=%s,signature=xxx)
第三步： 将生成的Authorization作为参数放到请求头中
（2）代码示例
import cn.hutool.core.codec.Base64; import cn.hutool.core.util.RandomUtil; import cn.hutool.crypto.digest.DigestAlgorithm; import cn.hutool.crypto.digest.Digester; public class AuthorizationUtil { public static void main(String[] args) { String ak = &#34;开发者标识&#34;; String sk = &#34;开发者秘钥&#34;; // 生成 String requestMethod = &#34;post&#34;.toUpperCase(); String url = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/7545f57245de1437505ad6897d4a8d22/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-21T18:04:10+08:00" />
<meta property="article:modified_time" content="2022-11-21T18:04:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OFD转PDF ~java实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="OFDPDF_java_0"></a>OFD转PDF ~java实现</h2> 
<p>当你在查这个问题时，说明大家都已经接触到OFD这个新的版式文档了。OFD格式对标的是PDF，目前关于PDF的转换都比较成熟，但是当OFD出现后，却发现能实现转换却似乎有所困难。尝试网上搜了一下这方面的资料，大部分是只能支持在网页在线转换，但是如果想自己通过后台代码去实现转换却基本没有。<br> 无意中发现“<a href="https://ofd.esign.cn/" rel="nofollow">超阅云</a>”这个平台，不仅支持网页在线转换，还支持API对接转换。果断验证一波！！</p> 
<p>————————————————</p> 
<h3><a id="_7"></a>准备工作</h3> 
<ol><li> <p>注册开发者账号，可直接微信扫码登录注册，一键搞定</p> </li><li> <p>进入个人中心，获取API开放秘钥，然后就需要购买套餐包。不过我当时直接咨询了一下他们客服，问小姐姐能不能后台先赠送我一个套餐包先体验调试下。小姐姐很热情，直接让后台发了个套餐包体验券给我，立马可以调试了。如果一开始就要付费调试，那成本确实有些高了。在这里感谢“超阅”客服小姐姐</p> </li></ol> 
<h3><a id="_12"></a>开始开发</h3> 
<p>1、接口概述<br> （1）采用HTTP接口模式，编码UTF-8<br> （2）接口地址： https://surread.esign.cn<br> （3）接口请求前必须先申请成为开发者，并获取accessKey和secretKey<br> （4）接口请求头需要带上鉴权参数Authorization ，详情见“鉴权方式"</p> 
<p>2、鉴权方式<br> （1）鉴权规则<br> 第一步：参数签名signature<br> MD5(post + url + 请求时间戳 + 请求随机串 + MD5(ak+sk))<br> 第二步：base64加密 Authorization<br> base64(method=post,url=xxx,timestamp=xxx,nonce_str=xxx,ak=%s,signature=xxx)<br> 第三步： 将生成的Authorization作为参数放到请求头中<br> （2）代码示例</p> 
<pre><code>import cn.hutool.core.codec.Base64;
import cn.hutool.core.util.RandomUtil;
import cn.hutool.crypto.digest.DigestAlgorithm;
import cn.hutool.crypto.digest.Digester;

public class AuthorizationUtil {

    public static void main(String[] args) {

        String ak = "开发者标识";
        String sk = "开发者秘钥";
        // 生成
        String requestMethod = "post".toUpperCase();
        String url = "/api/developer/convert/ofd2pdf";
        Long timestamp = System.currentTimeMillis();
        String randomStr = RandomUtil.randomString(20);
        String authorization = generateAuthorization(requestMethod,url,timestamp,randomStr,ak,sk);
        System.out.println("生成:"+authorization);
    }

    public static String generateAuthorization(String requestMethod, String url, Long timestamp, String randomStr, String ak, String sk){
        Digester md5 = new Digester(DigestAlgorithm.MD5);
        // signature = MD5(requestMethod + url + 请求时间戳 + 请求随机串 + MD5(ak+sk))
        String signature = md5.digestHex(requestMethod+url+timestamp+randomStr+md5.digestHex(ak+sk));
        //   Authorization = base64(method=xxx,url=xxx,timestamp=xxx,nonce_str=xxx,ak=xxx,signature=xxx)
        return Base64.encode(String.format("method=%s,url=%s,timestamp=%s,nonce_str=%s,ak=%s,signature=%s",requestMethod,url,timestamp,randomStr,ak,signature));
    }
}
</code></pre> 
<p>（2）一些踩坑：<br> 鉴权方式其实就是base64+Md5的结合，这里我引了一个hutool工具包，挺好用的，大家也可以试试<br> 鉴权参数主要是不同的接口url参数对应的就是接口的url</p> 
<h3><a id="APIPOST_60"></a>API测试POST</h3> 
<p>postman调用测试</p> 
<pre><code>curl --location --request POST 'https://surread.esign.cn/api/developer/convert/ofd2pdf' \
--header 'Authorization: bWV0aG9kPVBPU1QsdXJsPS9hcGkvZGV2ZWxvcGVyL2NvbnZlcnQvb2ZkMnBkZix0aW1lc3RhbXA9MTY2ODQ5Mjg1NTI3Nyxub25jZV9zdHI9cnZsaXY1emY0bjByOWdqeGx6dW4sYWs9b3NlZjA2NGtjdnA1MzJ6a2k1dnYyaTJicGwzOHJyam4sc2lnbmF0dXJlPTAwZWRlOTY4YzNhMmM0MGY1ZTcwXXXXXXXXXX' \
--form 'file=@"/C:/Users/DESKTOP-J21/Documents/ofd/OFD小文档.ofd"'
</code></pre> 
<p><img src="https://images2.imgbox.com/2e/63/hlEOJYEk_o.png" alt="在这里插入图片描述"><br> ！！！注意： 这里转换后是提供了一个文件的下载key，然后是需要再调用下载文件的API接口去获取这个文件，同时还能支持获取预览地址，cool<br> 获取文档下载地址： /api/developer/convert/getDownUrlByFileKey<br> 获取文档预览地址： /api/developer/convert/getPreviewUrlByFileKey<br> 详细接口文档其实可以参考他们的<a href="https://ofd.esign.cn/develop/doc/index" rel="nofollow">文档介绍</a></p> 
<h3><a id="_74"></a>调试完成</h3> 
<p>最后最后，感谢客服小姐姐送的套餐体验包，话说他们的小程序功能也挺强大的，不仅能PDF和OFD互转，还支持OFD在线查验，大家有需要可以体验体验。<br> <img src="https://images2.imgbox.com/78/b9/i4LKU1Fy_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ea50cb28489e20e7529f8c5031caf0e1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PDF转OFD ~java实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39834eff2b10dc78d619fb0033b1da5a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux查看磁盘、文件系统、文件夹、文件大小的命令(lsblk、df、du、ll)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>