<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>宝塔面板利用反向代理实现图片及其它资源的访问 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="宝塔面板利用反向代理实现图片及其它资源的访问" />
<meta property="og:description" content="图片服务器已经搭建好，并且已实现上传，但是图片一下访问不了，前前后后折腾了几天很是崩溃，今天利用反向代理终于实现，由于以前接触宝塔比较少，故发此贴，一为自已日后翻查、二为方便各位朋友沟通交流，直接上图:
1. 开启ngnix后启动，无需做任何配置、无需做任何配置，后续都会自动添加到配置当中，如需更改端口的除外，我用的是默认端口，因为我是一通乱配之后，又回到了起点所以在此说明，避免朋友们走弯路，在此说明，以下为我的配置，可对照参考：
user www www;
worker_processes auto;
error_log /www/wwwlogs/nginx_error.log crit;
pid /www/server/nginx/logs/nginx.pid;
worker_rlimit_nofile 51200;
events
{
use epoll;
worker_connections 51200;
multi_accept on;
}
http
{
include mime.types;
#include luawaf.conf;
include proxy.conf;
default_type application/octet-stream;
server_names_hash_bucket_size 512;
client_header_buffer_size 32k;
large_client_header_buffers 4 32k;
client_max_body_size 50m;
sendfile on;
tcp_nopush on;
keepalive_timeout 60;
tcp_nodelay on;
fastcgi_connect_timeout 300;
fastcgi_send_timeout 300;
fastcgi_read_timeout 300;
fastcgi_buffer_size 64k;
fastcgi_buffers 4 64k;
fastcgi_busy_buffers_size 128k;
fastcgi_temp_file_write_size 256k;
fastcgi_intercept_errors on;
gzip on;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/aed3d625576d25b367afc269d89c8142/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-30T14:42:01+08:00" />
<meta property="article:modified_time" content="2021-08-30T14:42:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">宝塔面板利用反向代理实现图片及其它资源的访问</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>       图片服务器已经搭建好，并且已实现上传，但是图片一下访问不了，前前后后折腾了几天很是崩溃，今天利用反向代理终于实现，由于以前接触宝塔比较少，故发此贴，一为自已日后翻查、二为方便各位朋友沟通交流，直接上图:</p> 
<p>1. 开启ngnix后启动，无需做任何配置、无需做任何配置，后续都会自动添加到配置当中，如需更改端口的除外，我用的是默认端口，因为我是一通乱配之后，又回到了起点所以在此说明，避免朋友们走弯路，在此说明，以下为我的配置，可对照参考：</p> 
<p>user  www www;<br> worker_processes auto;<br> error_log  /www/wwwlogs/nginx_error.log  crit;<br> pid        /www/server/nginx/logs/nginx.pid;<br> worker_rlimit_nofile 51200;</p> 
<p>events<br>     {<!-- --><br>         use epoll;<br>         worker_connections 51200;<br>         multi_accept on;<br>     }</p> 
<p>http<br>     {<!-- --><br>         include       mime.types;<br>         #include luawaf.conf;</p> 
<p>        include proxy.conf;</p> 
<p>        default_type  application/octet-stream;</p> 
<p>        server_names_hash_bucket_size 512;<br>         client_header_buffer_size 32k;<br>         large_client_header_buffers 4 32k;<br>         client_max_body_size 50m;</p> 
<p>        sendfile   on;<br>         tcp_nopush on;</p> 
<p>        keepalive_timeout 60;</p> 
<p>        tcp_nodelay on;</p> 
<p>        fastcgi_connect_timeout 300;<br>         fastcgi_send_timeout 300;<br>         fastcgi_read_timeout 300;<br>         fastcgi_buffer_size 64k;<br>         fastcgi_buffers 4 64k;<br>         fastcgi_busy_buffers_size 128k;<br>         fastcgi_temp_file_write_size 256k;<br>         fastcgi_intercept_errors on;</p> 
<p>        gzip on;<br>         gzip_min_length  1k;<br>         gzip_buffers     4 16k;<br>         gzip_http_version 1.1;<br>         gzip_comp_level 2;<br>         gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml;<br>         gzip_vary on;<br>         gzip_proxied   expired no-cache no-store private auth;<br>         gzip_disable   "MSIE [1-6]\.";</p> 
<p>        limit_conn_zone $binary_remote_addr zone=perip:10m;<br>         limit_conn_zone $server_name zone=perserver:10m;</p> 
<p>        server_tokens off;<br>         access_log off;</p> 
<p>server<br>     {<!-- --><br>         listen 888;<br>         server_name phpmyadmin;<br>         index index.html index.htm index.php;<br>         root  /www/server/phpmyadmin;<br>             location ~ /tmp/ {<!-- --><br>                 return 403;<br>             }</p> 
<p>        #error_page   404   /404.html;<br>         include enable-php.conf;</p> 
<p>        location ~ .*\.(js|css)?$<br>         {<!-- --><br>             expires      12h;<br>         }</p> 
<p>        location ~ /\.<br>         {<!-- --><br>             deny all;<br>         }</p> 
<p>        access_log  /www/wwwlogs/access.log;<br>     }<br> include /www/server/panel/vhost/nginx/*.conf;<br> }</p> 
<p>2.开启网站反向代理，具体如下图：</p> 
<p><img alt="" height="467" src="https://images2.imgbox.com/d2/08/70o7ISPu_o.png" width="650"></p> 
<p> 3.编辑反向代理配置文件，添加路径拦截，以下为我的配置:</p> 
<p>#PROXY-START/<br> location /<br> {<!-- --><br>     proxy_pass http://127.0.0.1:888;<br>     proxy_set_header Host $host;<br>     proxy_set_header X-Real-IP $remote_addr;<br>     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>     proxy_set_header REMOTE-HOST $remote_addr;<br>     <br>     add_header X-Cache $upstream_cache_status;<br>     <br>     #Set Nginx Cache<br>     <br>         add_header Cache-Control no-cache;<br> }<br>  location /images/<br>  {<!-- --><br>      alias /www/wwwroot/ftpuser/ftpuser/;<br>  }<br> #PROXY-END/</p> 
<p> 4.按理说此时已经可以通过路径进行访问了，如我的访问域为是<a href="https://dace.5ang.net/images//uploads/2021/08/30/fe2fa8136d634df8b7dd77f4837e00a8.png" rel="nofollow">https://dace.5ang.net/images//uploads/2021/08/30/e2fa8136d634df8b7dd77f4837e00a8.png</a></p> 
<p>此时能访问到/www/wwwroot/ftpuser/ftpuser/下uploads文件夹的内空，但是无论如何却访问不了；</p> 
<p>5.多次实现后发现只要删除图片的相关拦截即可访问，对你没看错，就这么简单，折腾了两天，大坑，具体原因还没有研究，欢迎朋友们留言说明告知：删除部分如下:</p> 
<p><img alt="" height="180" src="https://images2.imgbox.com/bf/5e/bu5cwF3D_o.png" width="506"></p> 
<p>6.到此完美。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/16165b503e996b30cb48b5a350d22d47/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Manifest merger failed with multiple errors, see logs</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ecb17b67868b166fd03362d824efe181/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基本分段存储管理方式（分段 段表 地址变换 分段、分页管理的对比）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>