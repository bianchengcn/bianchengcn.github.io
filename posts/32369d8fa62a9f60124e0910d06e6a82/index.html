<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Log4j 漏洞修复检测 附检测工具 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Log4j 漏洞修复检测 附检测工具" />
<meta property="og:description" content="作者：SRE运维博客
博客地址：https://www.cnsre.cn/
文章地址：https://www.cnsre.cn/posts/211213210004/
相关话题：https://www.cnsre.cn/tags/Log4j/
近日的Log4j2，可是非常的火啊，我也是加班加点把补丁给打上了次安心。Apache Log4j2存在远程代码执行漏洞，经验证，该漏洞允许攻击者在目标服务器上执行任意代码，可导致服务器被黑客控制。由于Apache Log4j 2应用较为广泛，建议使用该组件的用户尽快采取安全措施。
影响范围 漏洞影响版本：
2.0 &lt;= Apache Log4j 2 &lt;= log4j-2.15.0-rc1
漏洞描述 Apache Log4j 2是一个基于Java的日志记录工具，是对 Log4j 的升级。近日安恒信息应急响应中心监测到Apache Log4j 2存在远程代码执行漏洞，攻击者可通过构造恶意请求利用该漏洞实现在目标服务器上执行任意代码。
漏洞修复 由于Log4j2 作为日志记录基础第三方库，被大量Java框架及应用使用，只要用到 Log4j2 进行日志输出且日志内容能被攻击者部分可控，即可能会受到漏洞攻击影响。因此，该漏洞也同时影响全球大量通用应用及组件，例如 ：
Apache Struts2、Apache Solr、Apache Druid、Apache Flink、Apache Flume、Apache Dubbo、Apache Kafka、Spring-boot-starter-log4j2、ElasticSearch、Redis、Logstash等
建议及时检查并升级所有使用了 Log4j 组件的系统或应用。
紧急： 目前漏洞POC已被公开，官方已发布安全版本，建议使用该组件的用户尽快采取安全措施。
临时性缓解措施： 1、在 jvm 参数中添加 -Dlog4j2.formatMsgNoLookups=true
2、系统环境变量中将LOG4J_FORMAT_MSG_NO_LOOKUPS 设置为 true
3、创建 log4j2.component.properties 文件，文件中增加配置 log4j2.formatMsgNoLookups=true
4、若相关用户暂时无法进行升级操作，也可通过禁止Log4j中SocketServer类所启用的socket端对公网开放来进行防护
5、禁止安装log4j的服务器访问外网，并在边界对dnslog相关域名访问进行检测。部分公共dnslog平台如下
ceye.io dnslog.link dnslog.cn dnslog.io tu4.org awvsscan119.autoverify.cn burpcollaborator.net s0x.cn 彻底修复漏洞： 建议您在升级前做好数据备份工作，避免出现意外
研发代码修复：升级到官方提供的 log4j-2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/32369d8fa62a9f60124e0910d06e6a82/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-13T12:40:45+08:00" />
<meta property="article:modified_time" content="2021-12-13T12:40:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Log4j 漏洞修复检测 附检测工具</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<blockquote> 
 <p>作者：<a href="https://www.cnsre.cn/" rel="nofollow">SRE运维博客</a><br> 博客地址：<a href="https://www.cnsre.cn/" rel="nofollow">https://www.cnsre.cn/</a><br> 文章地址：<a href="https://www.cnsre.cn/posts/211213210004/" rel="nofollow">https://www.cnsre.cn/posts/211213210004/</a><br> 相关话题：<a href="https://www.cnsre.cn/tags/Log4j/" rel="nofollow">https://www.cnsre.cn/tags/Log4j/</a></p> 
</blockquote> 
<hr> 
<p>近日的Log4j2，可是非常的火啊，我也是加班加点把补丁给打上了次安心。Apache Log4j2存在远程代码执行漏洞，经验证，该漏洞允许攻击者在目标服务器上执行任意代码，可导致服务器被黑客控制。<strong>由于Apache Log4j 2应用较为广泛，建议使用该组件的用户尽快采取安全措施。</strong></p> 
<h3><a id="_12"></a>影响范围</h3> 
<p><strong>漏洞影响版本</strong>：</p> 
<p>2.0 &lt;= Apache Log4j 2 &lt;= log4j-2.15.0-rc1</p> 
<h3><a id="_18"></a>漏洞描述</h3> 
<p>Apache Log4j 2是一个基于Java的日志记录工具，是对 Log4j 的升级。近日安恒信息应急响应中心监测到Apache Log4j 2存在远程代码执行漏洞，攻击者可通过构造恶意请求利用该漏洞实现在目标服务器上执行任意代码。</p> 
<h3><a id="_22"></a>漏洞修复</h3> 
<p>由于Log4j2 作为日志记录基础第三方库，被大量Java框架及应用使用，只要用到 Log4j2 进行日志输出且日志内容能被攻击者部分可控，即可能会受到漏洞攻击影响。因此，该漏洞也同时影响全球大量通用应用及组件，例如 ：<br> Apache Struts2、Apache Solr、Apache Druid、Apache Flink、Apache Flume、Apache Dubbo、Apache Kafka、Spring-boot-starter-log4j2、ElasticSearch、Redis、Logstash等<br> 建议及时检查并升级所有使用了 Log4j 组件的系统或应用。</p> 
<p><strong>紧急：</strong> 目前漏洞POC已被公开，官方已发布安全版本，建议使用该组件的用户尽快采取安全措施。</p> 
<h4><a id="_31"></a>临时性缓解措施：</h4> 
<p>1、在 jvm 参数中添加 -Dlog4j2.formatMsgNoLookups=true<br> 2、系统环境变量中将LOG4J_FORMAT_MSG_NO_LOOKUPS 设置为 true<br> 3、创建 log4j2.component.properties 文件，文件中增加配置 log4j2.formatMsgNoLookups=true<br> 4、若相关用户暂时无法进行升级操作，也可通过禁止Log4j中SocketServer类所启用的socket端对公网开放来进行防护<br> 5、禁止安装log4j的服务器访问外网，并在边界对dnslog相关域名访问进行检测。部分公共dnslog平台如下</p> 
<pre><code>ceye.io
dnslog.link
dnslog.cn
dnslog.io
tu4.org
awvsscan119.autoverify.cn
burpcollaborator.net
s0x.cn
</code></pre> 
<h4><a id="_49"></a>彻底修复漏洞：</h4> 
<p>建议您在升级前做好数据备份工作，避免出现意外<br> 研发代码修复：升级到官方提供的 log4j-2.15.0-rc2 版本<br> https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.1-rc1</p> 
<h3><a id="_55"></a>漏洞检测工具</h3> 
<p>检测工具下载地址 <a href="https://pan.cnsre.cn/d/Package/Linux/360log4j2.zip" rel="nofollow">https://pan.cnsre.cn/d/Package/Linux/360log4j2.zip</a></p> 
<h3><a id="_58"></a>漏洞检测</h3> 
<h4><a id="_62"></a><strong>浏览器被动式扫描检测方案</strong></h4> 
<ul><li>原理<br> 工程师可设置该代理通过浏览器被动扫描目标，查看 DNS Log 检测是否存在 log4j 漏洞。</li><li>使用方法<br> 1.浏览器或操作系统配置 HTTP/HTTPS 代理：219.141.219.69:18080</li></ul> 
<p><img src="https://images2.imgbox.com/b7/8b/7TALveqo_o.png" alt=""></p> 
<p>2.浏览器或操作系统将下列证书添加到信任名单：附件sqli-hunter.pem</p> 
<p>3.使用浏览器正常进行目标浏览，当结束扫描后，在http://219.141.219.69:18000/ 下检查是否存在以目标域名为名的 txt 文件，如 http://219.141.219.69/360.cn.txt</p> 
<p><img src="https://images2.imgbox.com/d3/55/f9jdX5Ps_o.png" alt=""></p> 
<p>4.若存在，则说明目标网站存在漏洞，细节如下：</p> 
<p><img src="https://images2.imgbox.com/ca/43/tTVk1Avx_o.png" alt=""></p> 
<p>可看到完整 HTTP 请求细节，params参数为存在 log4j 注入漏洞的参数</p> 
<ul><li><strong>使用限制</strong></li></ul> 
<ol><li>主机外网 IP 无法访问 360 IP，请不要使用该代理扫描 360</li><li>目前只能检测 POST body 中的参数</li><li>不允许任何恶意攻击</li></ol> 
<h4><a id="_102"></a><strong>本地扫描常规检测方案</strong></h4> 
<ol><li> <p>下载本地检测工具</p> </li><li> <p>扫描源码：./log4j-discoverer --src"源码目录"</p> </li><li> <p>扫描jar包：./log4j-discoverer–jar “jar包文件”</p> </li><li> <p>扫描系统进程：./log4j-discoverer –scan</p> </li></ol> 
<h4><a id="Log4j_114"></a><strong>Log4j漏洞补丁方案</strong></h4> 
<p>如果检测到相关漏洞的应用或组件，建议立即对该应用或组件进行打补丁修复， Log4j补丁方案如下：</p> 
<ul><li><strong>工具原理</strong></li></ul> 
<p><img src="https://images2.imgbox.com/ac/ee/97JaYL3C_o.png" alt=""></p> 
<p>Hook前受到log4j jndi注入攻击</p> 
<p><img src="https://images2.imgbox.com/1d/71/zAAJwcsW_o.png" alt=""></p> 
<p>执行 java -jar PatchLog4j.jar</p> 
<p><img src="https://images2.imgbox.com/8a/85/IjNxcj7l_o.png" alt=""></p> 
<p>打入补丁后 log4j不再处理JNDI逻辑直接将JNDI字符串输出</p> 
<p><img src="https://images2.imgbox.com/98/0b/CLW8rpei_o.png" alt=""></p> 
<blockquote> 
 <p>工具来源【360政企安服高攻实验室】</p> 
</blockquote> 
<hr> 
<blockquote> 
 <p>作者：<a href="https://www.cnsre.cn/" rel="nofollow">SRE运维博客</a><br> 博客地址：<a href="https://www.cnsre.cn/" rel="nofollow">https://www.cnsre.cn/</a><br> 文章地址：<a href="https://www.cnsre.cn/posts/211213210004/" rel="nofollow">https://www.cnsre.cn/posts/211213210004/</a><br> 相关话题：<a href="https://www.cnsre.cn/tags/Log4j/" rel="nofollow">https://www.cnsre.cn/tags/Log4j/</a></p> 
</blockquote> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5c7b899af14e79aa22b0dcfbc25e926e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[Vue warn]: Error in render: &#34;TypeError: Cannot read properties of undefined (reading &#39;state&#39;)&#34;</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d87b300fb7dfe0367aa9402af715bd83/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue实现底部导航栏切换页面及图片</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>