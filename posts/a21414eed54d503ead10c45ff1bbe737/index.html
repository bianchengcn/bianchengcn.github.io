<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>模数转换电路 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="模数转换电路" />
<meta property="og:description" content="一、Exynos4412 A/D转换器概述
1. 概述
ADC(Analog-to-Digital Converter)，就是模数转换器。从字面上看，A我们称为模拟信号(Analog signal)，D我们称为数字信号(digital signal)。
模数转换器，在电子技术中即是将模拟信号转换成数字信号，也称为数字量化。当然还有一种叫DAC，就是数模转换，意思相反，即是将数字信号转换成模拟信号。
在我们的日常生活中，会遇到很多的物理量，遇到很多的物理参数，其中，我们经常遇到的物理参数，如电流、电压、温度、压力、速度等电量或非电量都是模拟量。
模拟量的大小是连续分布的，且经常也是时间上的连续函数。要使计算机或数字仪表能识别、处理这些信号，必须首先将这些模拟信号转换成数字信号；而经计算机分析、处理后输出的数字量也往往需要将其转换为相应模拟信号才能为执行机构所接受。这样，就需要一种能在模拟信号与数字信号之间起桥梁作用的电路—模数和数模转换器。
2. 分类
目前常见的A/D转换器中，有：权电阻网络D/A转换器、倒T型电阻网络D/A转换器、权电流型D/A转换器、权电容网络D/A转换器、开关树形D/A转换器。
3. A/D转换主要技术指标
1）分辨率
A/D转换器的分辨率用输出二进制数的位数表示，位数越多，误差越小，转换精度越高。
2）量化误差
在A/D转换中由于整量化产生的固有误差。量化误差在±1/2LSB（最低有效位）之间。
3）转换时间
转换时间是指A/D转换器完成一次转换所需的时间。转换时间是指从接到转换控制信号开始，到输出端得到稳定的数字输出信号所经过的这段时间。
4）偏移误差
输入信号为零时输出信号不为零的值，可外接电位器调至最小。
5）满刻度误差
满刻度输出时对应的输入信号与理想输入信号值之差。
6）线性度
实际转换器的转移函数与理想直线的最大偏移，不包括以上3种误差。
其他指标还有：绝对精度（Absolute Accuracy）、相对精度（Relative Accuracy）、微分非线性、单调性和无错码、总谐波失真（Total Harmonic Distortion，THD）和积分非线性。
二、Exynos 4412 A/D转换器简介
1.简述
10位或12位CMOS再循环式模拟数字转换器，它具有10通道输入，并可将模拟量转换至10位或12位二进制数。5Mhz A/D 转换时钟时，最大1Msps的转换速度。A/D转换具备片上采样保持功能，同时也支持待机工作模式。
2.特性
ADC接口包括如下特性。
1）10bit/12bit输出位可选。
2）微分误差 1.0LSB。
3）积分误差 2.0LSB。
4）最大转换速率5Msps.
5) 功耗少，电压输入1.8V。
6）电压输入范围 0~1.8V。
7）支持偏上样本保持功能。
8）通用转换模式。
3. A/D功能模块图
图1 ADC Functional Block Diagram
2. Exynos4412 A/D 控制器寄存器
1）A/D控制寄存器ADCCON
2）A/D数据寄存器
3）A/D通道Mux寄存器
三、A/D转换器实例" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/a21414eed54d503ead10c45ff1bbe737/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-16T10:55:37+08:00" />
<meta property="article:modified_time" content="2022-11-16T10:55:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">模数转换电路</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div></div> 
<div> 
 <div> 
  <div> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">一、Exynos4412 A/D转换器概述</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">1. 概述</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ADC(Analog-to-Digital Converter)，就是</span></span><span style="background-color:#ffffff;"><strong><span style="color:#000000;">模数转换器</span></strong></span><span style="background-color:#ffffff;"><span style="color:#000000;">。从字面上看，A我们称为模拟信号(Analog signal)，D我们称为数字信号(digital signal)。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">模数转换器，在电子技术中即是将模拟信号转换成数字信号，也称为数字量化。当然还有一种叫DAC，就是数模转换，意思相反，即是将数字信号转换成模拟信号。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">在我们的日常生活中，会遇到很多的物理量，遇到很多的物理参数，其中，我们经常遇到的物理参数，如电流、电压、温度、压力、速度等电量或非电量都是模拟量。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">模拟量的大小是连续分布的，且经常也是时间上的连续函数。要使计算机或数字仪表能识别、处理这些信号，必须首先将这些模拟信号转换成数字信号；而经计算机分析、处理后输出的数字量也往往需要将其转换为相应模拟信号才能为执行机构所接受。这样，就需要一种能在模拟信号与数字信号之间起桥梁作用的电路—</span></span><span style="background-color:#ffffff;"><strong><span style="color:#000000;">模数和数模转换器。</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">2. </span></strong></span><span style="background-color:#ffffff;"><span style="color:#000000;">分类</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">目前常见的A/D转换器中，有：</span></span><span style="background-color:#ffffff;"><strong><span style="color:#000000;">权电阻网络D/A转换器、倒T型电阻网络D/A转换器、权电流型D/A转换器、权电容网络D/A转换器、开关树形D/A转换器。</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">3. </span></span><span style="background-color:#ffffff;"><strong><span style="color:#000000;">A/D转换主要技术指标</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">1）分辨率</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">A/D转换器的分辨率用输出二进制数的位数表示，位数越多，误差越小，转换精度越高。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">2）量化误差</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">在A/D转换中由于整量化产生的固有误差。量化误差在±1/2LSB（最低有效位）之间。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">3）转换时间</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">转换时间是指A/D转换器完成一次转换所需的时间。转换时间是指从接到转换控制信号开始，到输出端得到稳定的数字输出信号所经过的这段时间。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">4）偏移误差</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">输入信号为零时输出信号不为零的值，可外接电位器调至最小。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">5）满刻度误差</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">满刻度输出时对应的输入信号与理想输入信号值之差。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">6）线性度</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">实际转换器的转移函数与理想直线的最大偏移，不包括以上3种误差。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">其他指标还有：绝对精度（Absolute Accuracy）、相对精度（Relative Accuracy）、微分非线性、单调性和无错码、总谐波失真（Total Harmonic Distortion，THD）和积分非线性。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">二、Exynos 4412 A/D转换器简介</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">1.简述</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">10位或12位CMOS再循环式模拟数字转换器，它具有10通道输入，并可将模拟量转换至10位或12位二进制数。5Mhz A/D 转换时钟时，最大1Msps的转换速度。A/D转换具备片上采样保持功能，同时也支持待机工作模式。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">2.特性</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ADC接口包括如下特性。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">1）10bit/12bit输出位可选。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">2）微分误差 1.0LSB。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">3）积分误差 2.0LSB。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">4）最大转换速率5Msps.</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">5) 功耗少，电压输入1.8V。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">6）电压输入范围 0~1.8V。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">7）支持偏上样本保持功能。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">8）通用转换模式。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">3. A/D功能模块图</span></strong></span></p> 
   <p class="img-center"><img alt="" src="https://images2.imgbox.com/9d/4e/wkPlgO9e_o.png"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">图1 ADC Functional Block Diagram</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">2. </span></span><span style="background-color:#ffffff;"><strong><span style="color:#000000;">Exynos4412 A/D 控制器寄存器</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">1）A/D控制寄存器ADCCON</span></strong></span></p> 
   <p class="img-center"><img alt="" src="https://images2.imgbox.com/6d/86/yWljnwgx_o.png"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">2）A/D数据寄存器</span></span></p> 
   <p class="img-center"><img alt="" src="https://images2.imgbox.com/51/de/yLD4IHOz_o.png"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">3）A/D通道Mux寄存器</span></span></p> 
   <p class="img-center"><img alt="" src="https://images2.imgbox.com/4f/81/OA5iXdVN_o.png"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">三、A/D转换器实例</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">1. 电路连接如下：</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">利用一个电位计输出电压到4412的AIN3管脚。输入的电压范围为0~1.8V。</span></span></p> 
   <p class="img-center"><img alt="" src="https://images2.imgbox.com/12/9d/3AqJ7DPm_o.png"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">1. 代码如下：</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#include &lt;asm/ioctl.h&gt;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#include &lt;linux/module.h&gt;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#include &lt;linux/kernel.h&gt;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#include &lt;linux/fs.h&gt;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#include &lt;linux/cdev.h&gt;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#include &lt;linux/device.h&gt;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#include &lt;linux/uaccess.h&gt;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#include &lt;asm/io.h&gt;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#define ADC_MAGIC 'A'</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#define CMD_ONE 1</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#define ADC_CMD_GET _IOR(ADC_MAGIC, CMD_ONE, int)</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//寄存器定义</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#define ADC_CFG (0x10010118)</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#define ADCCON (0x126C0000)</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#define ADCDAT (0x126C000C)</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">#define ADCMUX (0x126C001C)</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">dev_t dev;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">int minor_base = 0;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">int adc_count = 1;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">char adc_name[] = "adc";</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">struct cdev *pcdev = NULL;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">struct class *pcls = NULL;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">static unsigned int *adccfg;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">static unsigned int *adcmux;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">static unsigned int *adccon;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">static unsigned int *adcdat;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">int AdcInit(void)</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">{<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">int ret = 0;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">adccfg = ioremap(ADC_CFG, 4);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (adccfg == NULL) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("ioremap adccfg\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = -ENOMEM;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return ret;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">adcmux = ioremap(ADCMUX, 4);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (adcmux == NULL) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("ioremap adcmux\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = -ENOMEM;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">goto ERR1;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">adccon = ioremap(ADCCON, 4);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (adccon == NULL) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("ioremap adccon\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = -ENOMEM;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">goto ERR2;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">adcdat = ioremap(ADCDAT, 4);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (adcdat == NULL) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("ioremap adcdat\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = -ENOMEM;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">goto ERR3;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//ADC_CFG &amp;= ~(0x1 &lt;&lt; 16);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">writel(readl(adccfg) &amp; ~(0x1&lt;&lt;16), adccfg); //Bit_16:Select ADC Mux 0:General ADC, 1:MTCADC</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//ADCMUX = 0x3;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">writel(3, adcmux); //0x3: 0011 = AIN3 //原理图管脚查到XadcAIN3</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//12bit A/D conversion; enable A/D converter prescaler; prescaler value:20; A/D conversion start by read</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//ADCCON = (0x1&lt;&lt;16) | (0x1&lt;&lt;14) | (19&lt;&lt;6) | 0x1&lt;&lt;1;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//ADCDAT &amp; 0xfff;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">writel((0x1&lt;&lt;16) | (0x1&lt;&lt;14) | (19&lt;&lt;6) | 0x1&lt;&lt;1, adccon);</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return 0;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ERR3:</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">iounmap(adccon);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ERR2:</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">iounmap(adcmux);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ERR1:</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">iounmap(adccfg);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return ret;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">unsigned int adc_get(void)</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">{<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">unsigned int adc_value;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">unsigned int temp_value;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">readl(adcdat);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">while(!(readl(adccon) &amp; (0x1&lt;&lt;15)));</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">adc_value = readl(adcdat) &amp; 0xfff;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">temp_value = 9999 * adc_value / 4095;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return temp_value;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">long adc_ioctl (struct file *filp, unsigned int cmd, unsigned long arg)</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">{<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//printk("%s:%s:%d\n", __FILE__, __func__, __LINE__);</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">switch (cmd) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">case ADC_CMD_GET:</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">*(unsigned int *)arg = adc_get();</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">break;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">default:</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return -EINVAL;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return 0;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">struct file_operations fops = {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">.owner = THIS_MODULE,</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">.unlocked_ioctl = adc_ioctl,</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">};</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">int adc_init(void)</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">{<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">int ret;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">int major;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">struct device *pdevice = NULL;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//printk("%s:%s:%d\n", __FILE__, __func__, __LINE__);</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = alloc_chrdev_region(&amp;dev, minor_base, adc_count, adc_name);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (0 &gt; ret) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("Can't get device number\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return ret;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">pcdev = cdev_alloc();</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (NULL == pcdev) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("cdev alloc failed.\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = -ENOMEM;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">goto UNREG_DEV_NUM;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">cdev_init(pcdev, &amp;fops);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">pcdev-&gt;owner = THIS_MODULE;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = cdev_add(pcdev, dev, adc_count);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (0 &gt; ret) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("add cdev failed.\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">goto DEL_CDEV;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">pcls = class_create(pcdev-&gt;owner, adc_name);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (IS_ERR(pcls)) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("class create failed.\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = PTR_ERR(pcls);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">goto DEL_CDEV;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">major = MAJOR(dev);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">pdevice = device_create(pcls, NULL, MKDEV(major, minor_base), NULL, "%s%d", adc_name, minor_base);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (IS_ERR(pdevice)) {<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("device %s%d create failed.\n", adc_name, minor_base);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">ret = PTR_ERR(pdevice);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">goto DESTROY_CLASS;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//printk("Body temperature module init done!\n");</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">if (0 != AdcInit())</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">{<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">goto DESTROY_CLASS;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("adc init\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return 0;</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">DESTROY_CLASS:</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">class_destroy(pcls);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">DEL_CDEV:</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">cdev_del(pcdev);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">UNREG_DEV_NUM:</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">unregister_chrdev_region(dev, adc_count); </span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">return ret;</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">void adc_exit(void)</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">{<!-- --></span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">device_destroy (pcls, MKDEV(MAJOR(dev), minor_base)); </span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">class_destroy(pcls);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">cdev_del(pcdev);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">unregister_chrdev_region(dev, adc_count); </span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">printk("Good bye, adc module\n");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">//printk("%s:%s:%d\n", __FILE__, __func__, __LINE__);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">}</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">module_init(adc_init);</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">module_exit(adc_exit);</span></span></p> 
   <p style="text-align:center;"></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">MODULE_LICENSE("GPL");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">MODULE_AUTHOR("Ruth Wei");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">MODULE_DESCRIPTION("adc for demo");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">MODULE_VERSION("1.0.1");</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">2. 编译测试</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">经过交叉编译后，加载驱动，写一个应用程序可以读取ADC转换后的值。</span></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><strong><span style="color:#000000;">四、总结</span></strong></span></p> 
   <p style="text-align:center;"><span style="background-color:#ffffff;"><span style="color:#000000;">本文从模数转换器的技术指标和电路连接等方面进行分析，最终写出驱动程序，可以在4412板子上进行测试。</span></span></p> 
   <p style="text-align:left;"><span style="color:#333333;">嵌入式物联网需要学的东西真的非常多，千万不要学错了路线和内容，导致工资要不上去！</span></p> 
   <p style="text-align:left;"><span style="color:#333333;">无偿分享大家一个资料包，差不多150多G。里面学习内容、面经、项目都比较新也比较全！某鱼上买估计至少要好几十。<a class="link-info" href="http://makerschool.mikecrm.com/olf7geW" rel="nofollow" title="（点击找小助理领取）">（点击找小助理领取）</a></span></p> 
   <p class="img-center"><img alt="" src="https://images2.imgbox.com/a9/bb/ca4ttXcB_o.png"></p> 
  </div> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/09f372e3da6941a483e281110dddfda8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">golang调用外部程序，创建进程，fork，守护进程，shell命令，fd查看，lsof</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f24f472a8186f9d06a5ae5c76184f5f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VS五子棋大战</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>