<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【flink番外篇】13、Broadcast State 模式示例-简单模式匹配（1） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【flink番外篇】13、Broadcast State 模式示例-简单模式匹配（1）" />
<meta property="og:description" content="Flink 系列文章 一、Flink 专栏
Flink 专栏系统介绍某一知识点，并辅以具体的示例进行说明。
1、Flink 部署系列
本部分介绍Flink的部署、配置相关基础内容。
2、Flink基础系列
本部分介绍Flink 的基础部分，比如术语、架构、编程模型、编程指南、基本的datastream api用法、四大基石等内容。
3、Flik Table API和SQL基础系列
本部分介绍Flink Table Api和SQL的基本用法，比如Table API和SQL创建库、表用法、查询、窗口函数、catalog等等内容。
4、Flik Table API和SQL提高与应用系列
本部分是table api 和sql的应用部分，和实际的生产应用联系更为密切，以及有一定开发难度的内容。
5、Flink 监控系列
本部分和实际的运维、监控工作相关。
二、Flink 示例专栏
Flink 示例专栏是 Flink 专栏的辅助说明，一般不会介绍知识点的信息，更多的是提供一个一个可以具体使用的示例。本专栏不再分目录，通过链接即可看出介绍的内容。
两专栏的所有文章入口点击：Flink 系列文章汇总索引
文章目录 Flink 系列文章一、示例：按照分组规则进行图形匹配-KeyedBroadcastProcessFunction1、maven依赖2、实现3、验证1）、规则输入2）、item输入3）、控制台输出 本文详细的介绍了通过broadcast state的实现简单的模式匹配，其中需要用到KeyedBroadcastProcessFunction。
如果需要了解更多内容，可以在本人Flink 专栏中了解更新系统的内容。
本文除了maven依赖外，没有其他依赖。
一、示例：按照分组规则进行图形匹配-KeyedBroadcastProcessFunction 本示例是简单的应用broadcast state实现简单模式匹配，即实现：
1、按照相同颜色进行分组，在相同颜色组中按照规则进行匹配。
2、相同颜色的规则1：长方形后是三角形
3、相同颜色的规则2：正方形后是长方形
如匹配上述规则1或规则2则输出匹配成功。
1、maven依赖 &lt;properties&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;scala.version&gt;2.12&lt;/scala.version&gt; &lt;flink.version&gt;1.17.0&lt;/flink.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-clients&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/fe033a8cb25b763fedb74644346753be/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T09:45:00+08:00" />
<meta property="article:modified_time" content="2024-01-12T09:45:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【flink番外篇】13、Broadcast State 模式示例-简单模式匹配（1）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Flink__0"></a>Flink 系列文章</h2> 
<p><strong>一、Flink 专栏</strong></p> 
<p><a href="https://blog.csdn.net/chenwewi520feng/category_12301202.html">Flink 专栏</a>系统介绍某一知识点，并辅以具体的示例进行说明。</p> 
<ul><li> <p>1、Flink 部署系列<br> 本部分介绍Flink的部署、配置相关基础内容。</p> </li><li> <p>2、Flink基础系列<br> 本部分介绍Flink 的基础部分，比如术语、架构、编程模型、编程指南、基本的datastream api用法、四大基石等内容。</p> </li><li> <p>3、Flik Table API和SQL基础系列<br> 本部分介绍Flink Table Api和SQL的基本用法，比如Table API和SQL创建库、表用法、查询、窗口函数、catalog等等内容。</p> </li><li> <p>4、Flik Table API和SQL提高与应用系列<br> 本部分是table api 和sql的应用部分，和实际的生产应用联系更为密切，以及有一定开发难度的内容。</p> </li><li> <p>5、Flink 监控系列<br> 本部分和实际的运维、监控工作相关。</p> </li></ul> 
<p><strong>二、Flink 示例专栏</strong></p> 
<p><a href="https://blog.csdn.net/chenwewi520feng/category_12514812.html">Flink 示例专栏</a>是 Flink 专栏的辅助说明，一般不会介绍知识点的信息，更多的是提供一个一个可以具体使用的示例。本专栏不再分目录，通过链接即可看出介绍的内容。</p> 
<p>两专栏的所有文章入口点击：<a href="https://blog.csdn.net/chenwewi520feng/article/details/134875714">Flink 系列文章汇总索引</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Flink__0" rel="nofollow">Flink 系列文章</a></li><li><a href="#KeyedBroadcastProcessFunction_39" rel="nofollow">一、示例：按照分组规则进行图形匹配-KeyedBroadcastProcessFunction</a></li><li><ul><li><a href="#1maven_46" rel="nofollow">1、maven依赖</a></li><li><a href="#2_108" rel="nofollow">2、实现</a></li><li><a href="#3_333" rel="nofollow">3、验证</a></li><li><ul><li><a href="#1_335" rel="nofollow">1）、规则输入</a></li><li><a href="#2item_342" rel="nofollow">2）、item输入</a></li><li><a href="#3_366" rel="nofollow">3）、控制台输出</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<p>本文详细的介绍了通过broadcast state的实现简单的模式匹配，其中需要用到KeyedBroadcastProcessFunction。</p> 
<p>如果需要了解更多内容，可以在本人<a href="https://blog.csdn.net/chenwewi520feng/article/details/131530503">Flink 专栏</a>中了解更新系统的内容。</p> 
<p>本文除了maven依赖外，没有其他依赖。</p> 
<h2><a id="KeyedBroadcastProcessFunction_39"></a>一、示例：按照分组规则进行图形匹配-KeyedBroadcastProcessFunction</h2> 
<p>本示例是简单的应用broadcast state实现简单模式匹配，即实现：<br> 1、按照相同颜色进行分组，在相同颜色组中按照规则进行匹配。<br> 2、相同颜色的规则1：长方形后是三角形<br> 3、相同颜色的规则2：正方形后是长方形</p> 
<p>如匹配上述规则1或规则2则输出匹配成功。</p> 
<h3><a id="1maven_46"></a>1、maven依赖</h3> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.version</span><span class="token punctuation">&gt;</span></span>2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flink.version</span><span class="token punctuation">&gt;</span></span>1.17.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flink.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- &lt;scope&gt;provided&lt;/scope&gt; --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-csv<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

		<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-compress --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-compress<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.24.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- &lt;scope&gt;provided&lt;/scope&gt; --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="2_108"></a>2、实现</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>tablesql<span class="token punctuation">.</span>join</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>state<span class="token punctuation">.</span></span><span class="token class-name">MapState</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>state<span class="token punctuation">.</span></span><span class="token class-name">MapStateDescriptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>state<span class="token punctuation">.</span></span><span class="token class-name">ReadOnlyBroadcastState</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span></span><span class="token class-name">BasicTypeInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span></span><span class="token class-name">TypeHint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span></span><span class="token class-name">TypeInformation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">KeySelector</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>typeutils<span class="token punctuation">.</span></span><span class="token class-name">ListTypeInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">BroadcastStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">KeyedStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>co<span class="token punctuation">.</span></span><span class="token class-name">KeyedBroadcastProcessFunction</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collector</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token comment">/*
 * @Author: alanchan
 * 
 * @LastEditors: alanchan
 * 
 * @Description: 按照相同颜色进行分组，在相同颜色组中按照规则进行匹配。相同颜色的规则1：长方形后是三角形；规则2：正方形后是长方形
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJoinDimKeyedBroadcastProcessFunctionDemo</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token annotation punctuation">@AllArgsConstructor</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token annotation punctuation">@AllArgsConstructor</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Colour</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> blue<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> red<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> green<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token annotation punctuation">@AllArgsConstructor</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token class-name">Shape</span> shape<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Colour</span> color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token annotation punctuation">@AllArgsConstructor</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Rule</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Shape</span> first<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Shape</span> second<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// item 实时流</span>
        <span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> itemStream <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">socketTextStream</span><span class="token punctuation">(</span><span class="token string">"192.168.10.42"</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 解析item流</span>
                    <span class="token comment">// 数据结构：Item[shape(name,desc);color(name,blue,red,green)]</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lines <span class="token operator">=</span> o<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> shapeString <span class="token operator">=</span> lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> colorString <span class="token operator">=</span> lines<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Shape</span> shape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shape</span><span class="token punctuation">(</span>shapeString<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>shapeString<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Colour</span> color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Colour</span><span class="token punctuation">(</span>colorString<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>colorString<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>colorString<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>colorString<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Item</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// rule 实时流</span>
        <span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> ruleStream <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">socketTextStream</span><span class="token punctuation">(</span><span class="token string">"192.168.10.42"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 解析rule流</span>
                    <span class="token comment">// 数据结构：Rule[name;shape(name,desc);shape(name,desc)]</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lines <span class="token operator">=</span> o<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> name <span class="token operator">=</span> lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> firstShapeString <span class="token operator">=</span> lines<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> secondShapeString <span class="token operator">=</span> lines<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Shape</span> firstShape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shape</span><span class="token punctuation">(</span>firstShapeString<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>firstShapeString<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Shape</span> secondShape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shape</span><span class="token punctuation">(</span>secondShapeString<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>secondShapeString<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Rule</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>firstShape<span class="token punctuation">,</span>secondShape<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParallelism</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将图形使用颜色进行划分</span>
        <span class="token class-name">KeyedStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">,</span> <span class="token class-name">Colour</span><span class="token punctuation">&gt;</span></span> colorPartitionedStream <span class="token operator">=</span> itemStream
                <span class="token punctuation">.</span><span class="token function">keyBy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">KeySelector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">,</span> <span class="token class-name">Colour</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token class-name">Colour</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token class-name">Item</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 实现分组</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        colorPartitionedStream<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"colorPartitionedStream:----&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 一个 map descriptor，它描述了用于存储规则名称与规则本身的 map 存储结构</span>
        <span class="token class-name">MapStateDescriptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> ruleStateDescriptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapStateDescriptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                <span class="token string">"RulesBroadcastState"</span><span class="token punctuation">,</span>
                <span class="token class-name">BasicTypeInfo</span><span class="token punctuation">.</span><span class="token constant">STRING_TYPE_INFO</span><span class="token punctuation">,</span>
                <span class="token class-name">TypeInformation</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeHint</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将rule定义为广播流，广播规则并且创建 broadcast state</span>
        <span class="token class-name">BroadcastStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> ruleBroadcastStream <span class="token operator">=</span> ruleStream<span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>ruleStateDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 连接，输出流,connect() 方法需要由非广播流来进行调用，BroadcastStream 作为参数传入。</span>
        <span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> output <span class="token operator">=</span> colorPartitionedStream
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>ruleBroadcastStream<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>
                        <span class="token comment">// KeyedBroadcastProcessFunction 中的类型参数表示：</span>
                        <span class="token comment">// 1. key stream 中的 key 类型</span>
                        <span class="token comment">// 2. 非广播流中的元素类型</span>
                        <span class="token comment">// 3. 广播流中的元素类型</span>
                        <span class="token comment">// 4. 结果的类型，在这里是 string</span>
                        <span class="token keyword">new</span> <span class="token class-name">KeyedBroadcastProcessFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Colour</span><span class="token punctuation">,</span> <span class="token class-name">Item</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">// 存储部分匹配的结果，即匹配了一个元素，正在等待第二个元素</span>
                            <span class="token comment">// 用一个数组来存储，因为同时可能有很多第一个元素正在等待</span>
                            <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MapStateDescriptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> itemMapStateDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapStateDescriptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                                    <span class="token string">"items"</span><span class="token punctuation">,</span>
                                    <span class="token class-name">BasicTypeInfo</span><span class="token punctuation">.</span><span class="token constant">STRING_TYPE_INFO</span><span class="token punctuation">,</span>
                                    <span class="token keyword">new</span> <span class="token class-name">ListTypeInfo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">// 与之前的 ruleStateDescriptor 相同,用于存储规则名称与规则本身的 map 存储结构</span>
                            <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MapStateDescriptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> ruleStateDescriptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapStateDescriptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                                    <span class="token string">"RulesBroadcastState"</span><span class="token punctuation">,</span>
                                    <span class="token class-name">BasicTypeInfo</span><span class="token punctuation">.</span><span class="token constant">STRING_TYPE_INFO</span><span class="token punctuation">,</span>
                                    <span class="token class-name">TypeInformation</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeHint</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">// 负责处理广播流的元素        </span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processBroadcastElement</span><span class="token punctuation">(</span><span class="token class-name">Rule</span> ruleValue<span class="token punctuation">,</span>
                                    <span class="token class-name">KeyedBroadcastProcessFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Colour</span><span class="token punctuation">,</span> <span class="token class-name">Item</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context ctx<span class="token punctuation">,</span>
                                    <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token comment">// 得到广播流的存储状态：ctx.getBroadcastState(MapStateDescriptor&lt;K, V&gt; stateDescriptor)</span>
                                <span class="token comment">// 查询元素的时间戳：ctx.timestamp()</span>
                                <span class="token comment">// 查询目前的Watermark：ctx.currentWatermark()</span>
                                <span class="token comment">// 目前的处理时间(processing time)：ctx.currentProcessingTime()</span>
                                <span class="token comment">// 产生旁路输出：ctx.output(OutputTag&lt;X&gt; outputTag, X value)    </span>

                                <span class="token comment">// 在 getBroadcastState() 方法中传入的 stateDescriptor 应该与调用 .broadcast(ruleStateDescriptor) 的参数相同</span>
                                ctx<span class="token punctuation">.</span><span class="token function">getBroadcastState</span><span class="token punctuation">(</span>ruleStateDescriptor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ruleValue<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ruleValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>

                            <span class="token comment">// 负责处理另一个流的元素</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processElement</span><span class="token punctuation">(</span><span class="token class-name">Item</span> itemValue<span class="token punctuation">,</span>
                                    <span class="token class-name">KeyedBroadcastProcessFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Colour</span><span class="token punctuation">,</span> <span class="token class-name">Item</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>ReadOnlyContext ctx<span class="token punctuation">,</span>
                                    <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

                                <span class="token keyword">final</span> <span class="token class-name">MapState</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> itemMapState <span class="token operator">=</span> <span class="token function">getRuntimeContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMapState</span><span class="token punctuation">(</span>itemMapStateDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">final</span> <span class="token class-name">Shape</span> shape <span class="token operator">=</span> itemValue<span class="token punctuation">.</span><span class="token function">getShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"shape:"</span><span class="token operator">+</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span>

                                <span class="token comment">// 在 getBroadcastState() 方法中传入的 stateDescriptor 应该与调用 .broadcast(ruleStateDescriptor) 的参数相同</span>
                                <span class="token class-name">ReadOnlyBroadcastState</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> readOnlyBroadcastState <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBroadcastState</span><span class="token punctuation">(</span>ruleStateDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> iterableRule <span class="token operator">=</span> readOnlyBroadcastState<span class="token punctuation">.</span><span class="token function">immutableEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Rule</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> iterableRule<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token keyword">final</span> <span class="token class-name">String</span> ruleName <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">final</span> <span class="token class-name">Rule</span> rule <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                                    <span class="token comment">// 初始化</span>
                                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> itemStoredList <span class="token operator">=</span> itemMapState<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ruleName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>itemStoredList <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                        itemStoredList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>

                                    <span class="token comment">// 比较 shape </span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>shape<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>second<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>itemStoredList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Item</span> item <span class="token operator">:</span> itemStoredList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                            <span class="token comment">// 符合规则，收集匹配结果</span>
                                            out<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token string">"匹配成功: "</span> <span class="token operator">+</span> item <span class="token operator">+</span> <span class="token string">" - "</span> <span class="token operator">+</span> itemValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                        itemStoredList<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>

                                    <span class="token comment">// 规则连续性设置</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>shape<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>first<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                        itemStoredList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>itemValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>

                                    <span class="token comment">// </span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>itemStoredList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                        itemMapState<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>ruleName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                                        itemMapState<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ruleName<span class="token punctuation">,</span> itemStoredList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        output<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"output:-------&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="3_333"></a>3、验证</h3> 
<p>在netcat中启动两个端口，分别是8888和9999，8888输入规则，9999输入item，然后关键控制台输出。</p> 
<h4><a id="1_335"></a>1）、规则输入</h4> 
<pre><code class="prism language-bash">red<span class="token punctuation">;</span>rectangle,is a rectangle<span class="token punctuation">;</span>tripe,is a tripe
green<span class="token punctuation">;</span>square,is a square<span class="token punctuation">;</span>rectangle,is a rectangle
</code></pre> 
<h4><a id="2item_342"></a>2）、item输入</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 匹配成功</span>
rectangle,is a rectangle<span class="token punctuation">;</span>red,100,100,100
tripe,is a tripe<span class="token punctuation">;</span>red,100,100,100

<span class="token comment"># 匹配成功</span>
square,is square<span class="token punctuation">;</span>green,150,150,150
rectangle,is a rectangle<span class="token punctuation">;</span>green,150,150,150

<span class="token comment"># 匹配不成功</span>
tripe,is tripe<span class="token punctuation">;</span>blue,200,200,200

<span class="token comment"># 匹配成功</span>
rectangle,is a rectangle<span class="token punctuation">;</span>blue,100,100,100
tripe,is a tripe<span class="token punctuation">;</span>blue,100,100,100

<span class="token comment"># 匹配不成功</span>
tripe,is a tripe<span class="token punctuation">;</span>blue,100,100,100
rectangle,is a rectangle<span class="token punctuation">;</span>blue,100,100,100

</code></pre> 
<h4><a id="3_366"></a>3）、控制台输出</h4> 
<pre><code class="prism language-bash">colorPartitionedStream:----<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>rectangle, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a rectangle<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>red, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span>shape:TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>rectangle, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a rectangle<span class="token punctuation">)</span>
colorPartitionedStream:----<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>tripe, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a tripe<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>red, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span>shape:TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>tripe, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a tripe<span class="token punctuation">)</span>
output:-------<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 匹配成功: TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>rectangle, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a rectangle<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>red, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span> - TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>tripe, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a tripe<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>red, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span>
colorPartitionedStream:----<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>rectangle, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a rectangle<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>green, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">150</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">150</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">))</span>
output:-------<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 匹配成功: TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>square, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is square<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>green, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">150</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">150</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">))</span> - TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>rectangle, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a rectangle<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>green, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">150</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">150</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">))</span>
colorPartitionedStream:----<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span> TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>tripe, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is tripe<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>blue, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">200</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">200</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">))</span>
colorPartitionedStream:----<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>rectangle, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a rectangle<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>blue, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span>
colorPartitionedStream:----<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>tripe, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a tripe<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>blue, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span>
output:-------<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> 匹配成功: TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>rectangle, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a rectangle<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>blue, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span> - TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>tripe, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a tripe<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>blue, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span>
colorPartitionedStream:----<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>tripe, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a tripe<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>blue, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span>
colorPartitionedStream:----<span class="token operator">&gt;</span>:<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> TestJoinDimKeyedBroadcastProcessFunctionDemo.Item<span class="token punctuation">(</span>shape<span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Shape<span class="token punctuation">(</span>name<span class="token operator">=</span>rectangle, <span class="token assign-left variable">desc</span><span class="token operator">=</span>is a rectangle<span class="token punctuation">)</span>, <span class="token assign-left variable">color</span><span class="token operator">=</span>TestJoinDimKeyedBroadcastProcessFunctionDemo.Colour<span class="token punctuation">(</span>name<span class="token operator">=</span>blue, <span class="token assign-left variable">blue</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">red</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">green</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">))</span>

</code></pre> 
<p>以上，本文详细的介绍了通过broadcast state的实现简单的模式匹配，其中需要用到KeyedBroadcastProcessFunction。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/05bb7f18cf8475eaab165372d78652d0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【PyQt小知识 - 7】：QLineEdit设置输入的文本以圆点或星号等方式显示</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/660bfc3d9a2e2898d19e423101b7c09a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决vs2019下进行跨平台开发，出现引用的头文件显示无法打开，但是可以通过编译的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>