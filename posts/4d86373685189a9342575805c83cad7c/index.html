<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Tomcat在服务器上配置HTTPS协议访问 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Tomcat在服务器上配置HTTPS协议访问" />
<meta property="og:description" content="RT，修改tomcat访问时http协议为https 怎么下载tomcat和证书的申请我就不多阐述了，网上一搜也比较多的方法，就去阿里云申请一个免费的证书就可以了，记得下载证书的时候要下载对应tomcat 的证书哟。 我在网上也搜索了很多方法，很多不是很清楚，有的说要把下载的证书用jdk转一下格式，转格式的这个方法应该是对应tomcat7之前版本的方法，我查资料有显示说tomcat7以及以上的版本不用把证书的PFX格式转换就可以直接使用。
（PS:如果觉得我写的太多的，可以查看https://www.cnblogs.com/GoslingWu/p/13690481.html，这个比较简单易懂）
ssl证书上传到 服务器。 在服务器上的应用服务器（ tomcat8 ）中, 创建一个 cert 文件夹，并进将 证书上传到 cert 目录
3、配置应用服务器（tomcat）：修改 server.xml文件开启 https 并添加相关内容。 说明：修改前先备份 server.xml （ D:\server\apache-tomcat-8.0.53\conf\server.xml ）,
找到 server.xml ,打开并找到 https 配置相关部分。（ 文件中第 77 行开始注释部分，默认https配置是被关闭的 ，升级https需要开启）
这里我们拷贝相关的内容，把证书信息也配置上去。截图如下：
重要说明
1、keystoreFile 为ssl证书( pfx 格式)文件路径
2、keystorePass 为证书密钥，在pfx-password.txt 文件中可以找到。
3、port 为 https 访问端口。即使用 https 访问方网站时，后面跟上的端口号是 8443 .
配置代码（ tomcat 8 与 8.5 适用）：
&lt;!-- http ~ https acces HTTP/1.1 org.apache.coyote.http11.Http11NioProtocol --&gt;
&lt;Connector port=&#34;8443&#34; protocol=&#34;org.apache.coyote.http11.Http11NioProtocol&#34;
maxThreads=&#34;1000&#34; acceptCount=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/4d86373685189a9342575805c83cad7c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-09T14:27:16+08:00" />
<meta property="article:modified_time" content="2020-12-09T14:27:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Tomcat在服务器上配置HTTPS协议访问</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><strong>RT，修改tomcat访问时http协议为https</strong></h2> 
<h4>     <span style="color:#f33b45;"> 怎么下载tomcat和证书的申请我就不多阐述了，网上一搜也比较多的方法，就去阿里云申请一个免费的证书就可以了，记得下载证书的时候要下载对应tomcat 的证书哟。</span></h4> 
<p>      我在网上也搜索了很多方法，很多不是很清楚，有的说要把下载的证书用jdk转一下格式，转格式的这个方法应该是对应tomcat7之前版本的方法，我查资料有显示说tomcat7以及以上的版本不用把证书的PFX格式转换就可以直接使用。</p> 
<p>（PS:如果觉得我写的太多的，可以查看<a href="https://www.cnblogs.com/GoslingWu/p/13690481.html" rel="nofollow">https://www.cnblogs.com/GoslingWu/p/13690481.html</a>，这个比较简单易懂）</p> 
<h2>ssl证书上传到 服务器。</h2> 
<p>在服务器上的应用服务器（ tomcat8 ）中, 创建一个 cert 文件夹，并进将 证书上传到 cert 目录</p> 
<p><img alt="" height="352" src="https://images2.imgbox.com/b4/3c/JpHywn1D_o.png" width="568"></p> 
<p><img alt="" height="373" src="https://images2.imgbox.com/96/30/pWNpwfS3_o.png" width="556"></p> 
<p><img alt="" height="175" src="https://images2.imgbox.com/ec/19/2WP3hKKi_o.png" width="722"></p> 
<p> </p> 
<h2><a name="t3"></a>3、配置应用服务器（tomcat）：修改 server.xml文件开启 https 并添加相关内容。</h2> 
<p>说明：修改前先备份 server.xml （ D:\server\apache-tomcat-8.0.53\conf\server.xml ）,</p> 
<p>找到 server.xml ,打开并找到 https 配置相关部分。（ 文件中第 77 行开始注释部分，默认https配置是被关闭的 ，升级https需要开启）</p> 
<p><img alt="" height="251" src="https://images2.imgbox.com/b9/b4/VMK4WSD0_o.png" width="675"></p> 
<p><img alt="" height="711" src="https://images2.imgbox.com/0a/af/GqGI6i12_o.png" width="1053"></p> 
<p>这里我们拷贝相关的内容，把证书信息也配置上去。截图如下：</p> 
<p><img alt="" height="456" src="https://images2.imgbox.com/e4/ca/KDmyxKyO_o.png" width="1200"></p> 
<p><strong>重要说明<br> 1、keystoreFile 为ssl证书( pfx 格式)文件路径<br> 2、keystorePass 为证书密钥，在pfx-password.txt 文件中可以找到。<br> 3、port 为 https 访问端口。即使用 https 访问方网站时，后面跟上的端口号是 8443 .</strong></p> 
<p><strong>配置代码（ tomcat 8 与 8.5 适用）：</strong></p> 
<pre><code class="language-html"> </code></pre> 
<ol><li> <p><code>&lt;!-- http ~ https acces HTTP/1.1 org.apache.coyote.http11.Http11NioProtocol --&gt;</code></p> </li><li> <p><code>&lt;Connector port="8443" protocol="org.apache.coyote.http11.Http11NioProtocol"</code></p> </li><li> <p><code>maxThreads="1000" acceptCount="1000" SSLEnabled="true" scheme="https" secure="true"</code></p> </li><li> <p><code>clientAuth="false" sslProtocol="TLS" </code></p> </li><li> <p><code>keystoreFile="D:\server\apache-tomcat-8.0.53\conf\cert\3317168_java.cn.pfx"</code></p> </li><li> <p><code>keystoreType="PKCS12"</code></p> </li><li> <p><code>keystorePass="123456"</code></p> </li><li> <p><code>ciphers="TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256" /&gt;</code></p> </li></ol> 
<p>好了，到此已经网站已经升级了 https 访问。</p> 
<p><strong>现在可以使用 https 访问网站（必须加上https端口才能访问）：</strong></p> 
<p>https://www.java.cn:8443/Web</p> 
<p><strong>原来的访问方式（http两种方式访问，公网ip 或 域名），假设外网端口为 8080:</strong></p> 
<p>http://120.0.0.1:8080/Web</p> 
<p>http://www.java.cn:8080/Web</p> 
<p> </p> 
<h2><a name="t4"></a>4、配置应用服务器（tomcat）：使用默认端口80、443访问应用系统</h2> 
<p>大家都知道，一般我们输入一个网址，就能打开一个网站并不需要输入端口号就可以正常访问，那是因为使用了默认端口配置。</p> 
<p><strong>一般的，http 访问默认端口（即不输入端口号）是 80 ， https 默认端口 是 443 .</strong></p> 
<p>例如：输入 www.baidu.com ,就能访问到百度搜索的主页，看看浏览器和服务器都做了啥。</p> 
<p><strong>第一步：在浏览器中输入 www.baidu.com , 打开浏览器控制台（这里使用的是 google chrome浏览器）</strong></p> 
<p><strong>发现浏览器第一次方式使用 http （80端口）访问，然后请求被转发到 https 访问地址上</strong></p> 
<p><img alt="" height="513" src="https://images2.imgbox.com/a3/65/DgxSvHsc_o.png" width="969"></p> 
<p><strong>因为服务器做了转发，自然而是 使用 https ( 443 ) 端口访问并返回到主页：</strong></p> 
<p><img alt="" height="585" src="https://images2.imgbox.com/bd/28/sS7vMROA_o.png" width="1028"></p> 
<h4><a name="t5"></a>总结：显然 http 和 https 访问都是使用默认端口访问网站的，因为我们没有在任何地方输入端口访问。</h4> 
<hr> 
<h4><a name="t6"></a>一般项目升级基本都会要求使用 https 及默认端口访问网站（即像刚刚输入百度域名那样，就可以直接访问百度搜索主页）：为了达到同样的目录，现在我们也修改相关配置文件</h4> 
<p>找到 tomcat 服务器的server.xml （ D:\server\apache-tomcat-8.0.53\conf\server.xml ）：</p> 
<p><strong>修改 http 访问端口为默认端口： 80 ；redirectPort 为 443 .</strong></p> 
<p><img alt="" height="454" src="https://images2.imgbox.com/e2/9d/WlkbgxRX_o.png" width="944"></p> 
<p>修改后：</p> 
<p><img alt="" height="128" src="https://images2.imgbox.com/22/c7/HHkNdYdt_o.png" width="925"></p> 
<p><strong>修改 https 访问端口为默认端口： 443</strong></p> 
<p><img alt="" height="185" src="https://images2.imgbox.com/5e/4d/xL0Iqc3X_o.png" width="1067"></p> 
<p>修改后：</p> 
<p><img alt="" height="168" src="https://images2.imgbox.com/85/48/RP0P9BF4_o.png" width="1001"></p> 
<p><strong>注意改了 任意一处 redirectPort （https端口），其他地方也要改，端口保持一致。</strong></p> 
<p><img alt="" height="609" src="https://images2.imgbox.com/62/01/V1sEzDFB_o.png" width="1147"></p> 
<p>好了，到此已经网站已经升级了 http及https 默认端口访问系统。</p> 
<p><strong>现在可以使用 https 访问网站（默认端口）：</strong></p> 
<p>https://www.java.cn/Web</p> 
<p><strong>原来的访问方式（默认端口，http两种方式访问，公网ip 或 域名）:</strong></p> 
<p>http://120.0.0.1/Web</p> 
<p>http://www.java.cn/Web</p> 
<p> </p> 
<h4><a name="t7"></a>注意，配置到这个时候，使用http + 域名访问，不会跳转到 https访问。请看第 5 步：</h4> 
<p> </p> 
<h2><a name="t8"></a>5、配置应用服务器：<strong>http 自动转为 https 访问配置</strong></h2> 
<p>此操作步骤之前，网站虽然配置了https , 并可以访问。但是还是可以使用 http 直接访问的，如果原来的http也能访问（保留），就不需要此步骤了。<strong>原来的访问方式（http两种方式访问，公网ip 或 域名）。</strong></p> 
<p><strong>如果网站为了安全，需要强制将 http 转为 https , 则需要做如下配置：</strong></p> 
<p>找到 tomcat 配置文件 web.xml ( ‪D:\server\apache-tomcat-8.0.53\conf\web.xml )</p> 
<p><img alt="" height="323" src="https://images2.imgbox.com/72/3f/fE7B1p9y_o.png" width="602"></p> 
<p>打开文件到底部，在  &lt;/webcome-file-list&gt; 结束标签后面，加入如下代码：</p> 
<p><img alt="" height="543" src="https://images2.imgbox.com/c9/69/Ooz2ghFl_o.png" width="864"></p> 
<pre><code class="language-html"> </code></pre> 
<ol><li> <p><code>&lt;!-- http redirectTo https : Authorization setting for SSL --&gt; </code></p> </li><li> <p><code>&lt;login-config&gt; </code></p> </li><li> <p><code>&lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt; </code></p> </li><li> <p><code>&lt;realm-name&gt;Client Cert Users-only Area&lt;/realm-name&gt; </code></p> </li><li> <p><code>&lt;/login-config&gt; </code></p> </li><li> <p><code>&lt;security-constraint&gt; </code></p> </li><li> <p><code>&lt;web-resource-collection &gt; </code></p> </li><li> <p><code>&lt;web-resource-name &gt;SSL&lt;/web-resource-name&gt; </code></p> </li><li> <p><code>&lt;url-pattern&gt;/*&lt;/url-pattern&gt; </code></p> </li><li> <p><code>&lt;/web-resource-collection&gt; </code></p> </li><li> <p><code>&lt;user-data-constraint&gt; </code></p> </li><li> <p><code>&lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt; </code></p> </li><li> <p><code>&lt;/user-data-constraint&gt; </code></p> </li><li> <p><code>&lt;/security-constraint&gt;</code></p> </li></ol> 
<h4><a name="t9"></a>到此，在浏览器中输入http访问系统，将强制跳转到 https 进行访问。</h4> 
<p> </p> 
<p><strong>现在可以使用 https 访问网站（默认端口）：</strong></p> 
<p>https://www.java.cn/Web</p> 
<p><strong>原来的访问方式（默认端口，http两种方式访问，公网ip 或 域名）:</strong></p> 
<p>http://120.0.0.1/Web    将跳转到   https://120.0.0.1/Web</p> 
<p>http://www.java.cn/Web  将跳转到  https://www.java.cn/Web</p> 
<p>效果图（仅供参考）：</p> 
<p><img alt="" height="337" src="https://images2.imgbox.com/41/0f/wguTMeat_o.png" width="563"></p> 
<p> </p> 
<h2><a name="t10"></a>6、网站升级https中常见的问题</h2> 
<h4><a name="t11"></a>温馨提示：本文章只 针对 Tomcat 8 进行配置。</h4> 
<p> </p> 
<p><strong>1）应用服务器配置好 https 端口及证书后，浏览器访问不了（不管是默认端口访问，还是其他端口）</strong></p> 
<p>一般情况下，主要原因是 windows 防火墙需要开启端口（内网端口），此外可能还需要做端口映射管理（外网与内网端口配置，如不清楚则要找网络管理员）</p> 
<p>windows防火墙配置可访问端口：</p> 
<p>请依次打开：控制面板   &gt;  系统和安全 &gt; Windows 防火墙</p> 
<p><img alt="" height="640" src="https://images2.imgbox.com/21/3f/6S0Q6EPJ_o.png" width="867"></p> 
<p>点击 window 防火墙，点击左侧菜单： 高级设置</p> 
<p><img alt="" height="463" src="https://images2.imgbox.com/eb/71/QGjCiHNd_o.png" width="861"></p> 
<p><img alt="" height="477" src="https://images2.imgbox.com/f4/26/fcCEi1Qc_o.png" width="1096"></p> 
<p>在左侧：入站规则中，可以看到系统已经防火墙已经添加的端口及程序，</p> 
<p><img alt="" height="773" src="https://images2.imgbox.com/5d/9f/YPzdD0Dg_o.png" width="1097"></p> 
<p>这里我们 添加 8443 端口为例：</p> 
<p>单击右边新建规则，选择 端口 并下一步，输入端口并下一步</p> 
<p><img alt="" height="650" src="https://images2.imgbox.com/ed/03/Orz3nsCs_o.png" width="884"></p> 
<p><img alt="" height="598" src="https://images2.imgbox.com/af/97/fQ7ky6Pu_o.png" width="716"></p> 
<p><img alt="" height="586" src="https://images2.imgbox.com/81/8d/DpDk1SbZ_o.png" width="715"></p> 
<p><img alt="" height="609" src="https://images2.imgbox.com/ad/12/pO1kjXZP_o.png" width="713"></p> 
<p><img alt="" height="620" src="https://images2.imgbox.com/fc/36/WvV7C6p5_o.png" width="724"></p> 
<p><img alt="" height="240" src="https://images2.imgbox.com/75/16/dulAWk7s_o.png" width="749"></p> 
<p>到此，windows防火墙配置完毕。</p> 
<p>2）如果第一步仔细检查后没有问题，<strong>浏览器访问不了（不管是默认端口访问，还是其他端口）</strong></p> 
<p><strong>此时很有可能是 应用服务器 ( tomcat ) 配置出现问题，需要打开应用服务器 的 logs 目录，查看日志检查问题。本人出现过配置https后访问不了的问题，由于网上的资料参差不齐或不完整导致配置错误。PS ： tomcat 不同的版本，配置文件中的属性名或属性值都可能不太一样（这是问题的关键）。</strong></p> 
<p><img alt="" height="395" src="https://images2.imgbox.com/9b/60/8oRbbcEH_o.png" width="567"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/97df5d88c12c90cd387b418ff00df99e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基类指针调用派生类函数_C&#43;&#43; 多态性：虚函数--基类与派生类类型转换（第7章 05）例子问题解析（学习笔记：第8章 05）...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e371617ee208265c4fc8aad9d030050f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Shiro 实现免密码登录策略 微信扫码登录 第三方登录问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>