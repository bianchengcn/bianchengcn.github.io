<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>台达dvp16es2plc-qt串口通信协议 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="台达dvp16es2plc-qt串口通信协议" />
<meta property="og:description" content="#ifndef DELTA_DVP_PROTOCOL_H #define DELTA_DVP_PROTOCOL_H #include &lt;QByteArray&gt; class Delta_dvp_protocol { public: Delta_dvp_protocol() = default; static QByteArray set_Y_CMD_5_Bit(int slaveAddress,int address,bool isOn); static QByteArray set_M_CMD_5_Bit(int slaveAddress,int address,bool isOn); static QByteArray set_S_CMD_5_Bit(int slaveAddress,int address,bool isOn); static QByteArray set_T_CMD_5_Bit(int slaveAddress,int address,bool isOn); static QByteArray set_C_CMD_5_Bit(int slaveAddress,int address,bool isOn); static QByteArray read_one_address_X_Bit(int slaveAddress, int address); static QByteArray read_one_address_Y_Bit(int slaveAddress, int address); static QByteArray read_one_address_M_Bit(int slaveAddress, int address); static QByteArray read_one_address_S_Bit(int slaveAddress, int address); static QByteArray read_one_address_T_Bit(int slaveAddress, int address); static QByteArray read_one_address_C_Bit(int slaveAddress, int address); static QByteArray set_D_CMD_6_Word(int slaveAddress,int address,int value); static QByteArray set_T_CMD_6_Word(int slaveAddress,int address,int value); static QByteArray set_C_CMD_6_Word(int slaveAddress,int address,int value); static QByteArray set_C_CMD_6_Word_GreaterThan199(int slaveAddress,int address,int value); static QByteArray read_one_address_D_Word(int slaveAddress, int address); static QByteArray read_one_address_T_Word(int slaveAddress, int address); static QByteArray read_one_address_C_Word(int slaveAddress, int address); static QByteArray set_M_Y_S_T_C_CMD_5_Bit(int slaveAddress,int address,bool isOn,const QString &amp; innerDeviceName); static QByteArray set_M_Y_S_T_C_CMD_F_Bit(int slaveAddress, int address, bool isOn, const QString &amp; innerDeviceName); static QByteArray set_D_T_CMD_6_Word(int slaveAddress,int address,int value, const QString &amp; innerDeviceName); static QByteArray read_one_address_D_T_Word(int slaveAddress,int address,const QString &amp; innerDeviceName); static QByteArray read_one_address_Y_M_S_T_C_X_Bit(int slaveAddress, int address,const QString &amp; innerDeviceName); static void parsingReceiveData(const QByteArray &amp; data); }; #endif // DELTA_DVP_PROTOCOL_H #include &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/787c50d8901e1f4e640331e39d692bf1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-30T15:15:45+08:00" />
<meta property="article:modified_time" content="2024-01-30T15:15:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">台达dvp16es2plc-qt串口通信协议</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code>#ifndef DELTA_DVP_PROTOCOL_H
#define DELTA_DVP_PROTOCOL_H

#include &lt;QByteArray&gt;

class Delta_dvp_protocol
{
public:
    Delta_dvp_protocol() = default;


    static QByteArray set_Y_CMD_5_Bit(int slaveAddress,int address,bool isOn);
    static QByteArray set_M_CMD_5_Bit(int slaveAddress,int address,bool isOn);
    static QByteArray set_S_CMD_5_Bit(int slaveAddress,int address,bool isOn);
    static QByteArray set_T_CMD_5_Bit(int slaveAddress,int address,bool isOn);
    static QByteArray set_C_CMD_5_Bit(int slaveAddress,int address,bool isOn);

    static QByteArray read_one_address_X_Bit(int slaveAddress, int address);
    static QByteArray read_one_address_Y_Bit(int slaveAddress, int address);
    static QByteArray read_one_address_M_Bit(int slaveAddress, int address);
    static QByteArray read_one_address_S_Bit(int slaveAddress, int address);
    static QByteArray read_one_address_T_Bit(int slaveAddress, int address);
    static QByteArray read_one_address_C_Bit(int slaveAddress, int address);

    static QByteArray set_D_CMD_6_Word(int slaveAddress,int address,int value);
    static QByteArray set_T_CMD_6_Word(int slaveAddress,int address,int value);
    static QByteArray set_C_CMD_6_Word(int slaveAddress,int address,int value);
    static QByteArray set_C_CMD_6_Word_GreaterThan199(int slaveAddress,int address,int value);

    static QByteArray read_one_address_D_Word(int slaveAddress, int address);
    static QByteArray read_one_address_T_Word(int slaveAddress, int address);
    static QByteArray read_one_address_C_Word(int slaveAddress, int address);

    static QByteArray set_M_Y_S_T_C_CMD_5_Bit(int slaveAddress,int address,bool isOn,const QString &amp; innerDeviceName);
    static QByteArray set_M_Y_S_T_C_CMD_F_Bit(int slaveAddress, int address, bool isOn, const QString &amp; innerDeviceName);

    static QByteArray set_D_T_CMD_6_Word(int slaveAddress,int address,int value, const QString &amp; innerDeviceName);

    static QByteArray read_one_address_D_T_Word(int slaveAddress,int address,const QString &amp; innerDeviceName);
    static QByteArray read_one_address_Y_M_S_T_C_X_Bit(int slaveAddress, int address,const QString &amp; innerDeviceName);

    static void parsingReceiveData(const QByteArray &amp; data);

};

#endif // DELTA_DVP_PROTOCOL_H</code></pre> 
<pre><code class="language-cpp">#include "delta_dvp_protocol.h"
#include &lt;QDebug&gt;

QList&lt;uchar&gt; getAsciiCodes(int num)
{
    QList&lt;uchar&gt; asciiCodes;
    QString hexStr = QString("%1").arg(num, 2, 16, QLatin1Char('0')).toUpper(); // 转换为两位十六进制字符串

    for (const auto &amp; digit : hexStr)
    {
        asciiCodes.append(digit.toUpper().toLatin1());
    }
    return asciiCodes;
}

quint8 getLRC(const QByteArray &amp;buf)
{
    quint8 check = 0; // 校验字节 初始化
    for (const auto &amp; byte : buf)
    {
        check += byte; // 累加求和
    }
    return static_cast&lt;quint8&gt;((check ^ 0xFF) + 1);
}

QString parseHexString(const QString&amp; hexString)
{
    return QString(QByteArray::fromHex(hexString.toUtf8()));
}

QString charToBinaryString(char num)
{
    QString binaryString;
    for (int i = 3; i &gt;= 0; --i)
    {
        binaryString.append(((num &gt;&gt; i) &amp; 1) ? '1' : '0');
    }
    return binaryString;
}

int get_M_Address(int address)
{
    int _address_ = 0;
    if(address &gt;= 0 &amp;&amp; address &lt;= 255)
    {
        _address_ = address + 0x0800;
    }
    else if(address &gt;= 256 &amp;&amp; address &lt;= 511)
    {
        _address_ = (address - 256) + 0x0900;
    }
    else if(address &gt;= 512 &amp;&amp; address &lt;= 767)
    {
        _address_ = (address - 512) + 0x0A00;
    }
    else if(address &gt;= 768 &amp;&amp; address &lt;= 1023)
    {
        _address_ = (address - 768) + 0x0B00;
    }
    else if(address &gt;= 1024 &amp;&amp; address &lt;= 1279)
    {
        _address_ = (address - 1024) + 0x0C00;
    }
    else if(address &gt;= 1280 &amp;&amp; address &lt;= 1535)
    {
        _address_ = (address - 1280) + 0x0D00;
    }
    else if(address &gt;= 1536 &amp;&amp; address &lt;= 1791)
    {
        _address_ = (address - 1536) + 0xB000;
    }
    else if(address &gt;= 1792 &amp;&amp; address &lt;= 2047)
    {
        _address_ = (address - 1792) + 0xB100;
    }
    else if(address &gt;= 2048 &amp;&amp; address &lt;= 2303)
    {
        _address_ = (address - 2048) + 0xB200;
    }
    else if(address &gt;= 2304 &amp;&amp; address &lt;= 2559)
    {
        _address_ = (address - 2304) + 0xB300;
    }
    else if(address &gt;= 2560 &amp;&amp; address &lt;= 2815)
    {
        _address_ = (address - 2560) + 0xB400;
    }
    else if(address &gt;= 2816 &amp;&amp; address &lt;= 3071)
    {
        _address_ = (address - 2816) + 0xB500;
    }
    else if(address &gt;= 3072 &amp;&amp; address &lt;= 3327)
    {
        _address_ = (address - 3072) + 0xB600;
    }
    else if(address &gt;= 3328 &amp;&amp; address &lt;= 3583)
    {
        _address_ = (address - 3328) + 0xB700;
    }
    else if(address &gt;= 3584 &amp;&amp; address &lt;= 3839)
    {
        _address_ = (address - 3584) + 0xB800;
    }
    else if(address &gt;= 3840 &amp;&amp; address &lt;= 4095)
    {
        _address_ = (address - 3840) + 0xB900;
    }

    return _address_;
}

int getRealAddress(int address,const QString &amp; innerDeviceName)
{
    int _address_{0};
    if(innerDeviceName == QStringLiteral("M"))
    {
        _address_ = get_M_Address(address);
    }
    else if(innerDeviceName == QStringLiteral("Y"))
    {
        _address_ = address + 0x0500;
    }
    else if(innerDeviceName == QStringLiteral("S"))
    {
        _address_ = address;
    }
    else if(innerDeviceName == QStringLiteral("T"))
    {
        _address_ = address + 0x0600;
    }
    else if(innerDeviceName == QStringLiteral("C"))
    {
        _address_ = address + 0x0E00;
    }
    else if(innerDeviceName == QStringLiteral("X"))
    {
        _address_ = address + 0x0400;
    }
    else if(innerDeviceName == QStringLiteral("D"))
    {
        if(address &gt;= 0 &amp;&amp; address &lt;= 4095)
        {
            _address_ = address + 0x1000;
        }
        else
        {
            _address_ = (address - 4096) + 0x9000;
        }
    }

    return _address_;
}

QByteArray Delta_dvp_protocol::set_M_Y_S_T_C_CMD_F_Bit(int slaveAddress,int address,bool isOn,const QString &amp; innerDeviceName)
{
    QByteArray data;
    data.append(static_cast&lt;char&gt;(0x3a));//ASCII码：:

    //从站号 1-255 即0x01-0xff
    auto addressList = getAsciiCodes(slaveAddress);
    data.append(static_cast&lt;char&gt;(addressList.at(0)));
    data.append(static_cast&lt;char&gt;(addressList.at(1)));
    //0F
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x46));

    int _address_ = getRealAddress(address,innerDeviceName);

    auto list = getAsciiCodes(_address_/256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(_address_%256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x30));

    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x31));

    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x31));

    data.append(static_cast&lt;char&gt;(0x30));

    if(isOn)
    {
        data.append(static_cast&lt;char&gt;(0x31));
    }
    else
    {
        data.append(static_cast&lt;char&gt;(0x30));
    }

    {
        QString src = QString("%1").arg(slaveAddress, 2, 10, QLatin1Char('0')) +
                      "0F" +
                      QString("%1").arg(_address_, 4, 16, QLatin1Char('0')).toUpper() +
                      "000101";

        if(isOn)
        {
            src.append("01");
        }
        else
        {
            src.append("00");
        }

        uchar lrc = getLRC(QByteArray::fromHex(qPrintable(src)));

        list = getAsciiCodes(lrc);
        data.append(static_cast&lt;char&gt;(list.at(0)));
        data.append(static_cast&lt;char&gt;(list.at(1)));
    }

    data.append(static_cast&lt;char&gt;(0x0D));
    data.append(static_cast&lt;char&gt;(0x0A));

    return data;
}

QByteArray Delta_dvp_protocol::set_D_T_CMD_6_Word(int slaveAddress, int address, int value, const QString &amp;innerDeviceName)
{
    QByteArray data;
    data.append(static_cast&lt;char&gt;(0x3a));//ASCII码：:

    //从站号 1-255 即0x01-0xff
    auto addressList = getAsciiCodes(slaveAddress);
    data.append(static_cast&lt;char&gt;(addressList.at(0)));
    data.append(static_cast&lt;char&gt;(addressList.at(1)));
    //06
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x36));

    int _address_ = getRealAddress(address,innerDeviceName);

    auto list = getAsciiCodes(_address_/256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(_address_%256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(value/256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(value%256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    {
        QString src = QString("%1").arg(slaveAddress, 2, 10, QLatin1Char('0')) +
                      "06" +
                      QString("%1").arg(_address_, 4, 16, QLatin1Char('0')).toUpper() +
                      QString("%1").arg(value, 4, 16, QLatin1Char('0')).toUpper();

        qDebug()&lt;&lt;"src = "&lt;&lt;src;
        uchar lrc = getLRC(QByteArray::fromHex(qPrintable(src)));

        list = getAsciiCodes(lrc);
        data.append(static_cast&lt;char&gt;(list.at(0)));
        data.append(static_cast&lt;char&gt;(list.at(1)));
    }

    data.append(static_cast&lt;char&gt;(0x0D));
    data.append(static_cast&lt;char&gt;(0x0A));

    qDebug()&lt;&lt;QString(data.toHex());
    return data;
}

QByteArray Delta_dvp_protocol::read_one_address_D_T_Word(int slaveAddress, int address, const QString &amp;innerDeviceName)
{
    QByteArray data;
    data.append(static_cast&lt;char&gt;(0x3a));//ASCII码：:

    //从站号 1-255 即0x01-0xff
    auto addressList = getAsciiCodes(slaveAddress);
    data.append(static_cast&lt;char&gt;(addressList.at(0)));
    data.append(static_cast&lt;char&gt;(addressList.at(1)));
    //03
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x33));

    int _address_ = getRealAddress(address,innerDeviceName);

    auto list = getAsciiCodes(_address_/256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(_address_%256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    //读取个数：1
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x31));

    {
        QString src = QString("%1").arg(slaveAddress, 2, 10, QLatin1Char('0')) +
                      "03" +
                      QString("%1").arg(_address_, 4, 16, QLatin1Char('0')).toUpper();
        src.append("0001");
        qDebug()&lt;&lt;"src = "&lt;&lt;src;
        uchar lrc = getLRC(QByteArray::fromHex(qPrintable(src)));

        list = getAsciiCodes(lrc);
        data.append(static_cast&lt;char&gt;(list.at(0)));
        data.append(static_cast&lt;char&gt;(list.at(1)));
    }

    data.append(static_cast&lt;char&gt;(0x0D));
    data.append(static_cast&lt;char&gt;(0x0A));
    qDebug()&lt;&lt;QString(data.toHex());

    return data;
}

QByteArray Delta_dvp_protocol::set_Y_CMD_5_Bit(int slaveAddress, int address, bool isOn)
{
    return set_M_Y_S_T_C_CMD_5_Bit(slaveAddress,address,isOn,QStringLiteral("Y"));
}

QByteArray Delta_dvp_protocol::set_M_CMD_5_Bit(int slaveAddress,int address,bool isOn)
{
    return set_M_Y_S_T_C_CMD_5_Bit(slaveAddress,address,isOn,QStringLiteral("M"));
}

QByteArray Delta_dvp_protocol::set_S_CMD_5_Bit(int slaveAddress, int address, bool isOn)
{
    return set_M_Y_S_T_C_CMD_5_Bit(slaveAddress,address,isOn,QStringLiteral("S"));
}

QByteArray Delta_dvp_protocol::set_T_CMD_5_Bit(int slaveAddress, int address, bool isOn)
{
    return set_M_Y_S_T_C_CMD_5_Bit(slaveAddress,address,isOn,QStringLiteral("T"));
}

QByteArray Delta_dvp_protocol::set_C_CMD_5_Bit(int slaveAddress, int address, bool isOn)
{
    return set_M_Y_S_T_C_CMD_5_Bit(slaveAddress,address,isOn,QStringLiteral("C"));
}

QByteArray Delta_dvp_protocol::read_one_address_X_Bit(int slaveAddress, int address)
{
    return read_one_address_Y_M_S_T_C_X_Bit(slaveAddress,address,QStringLiteral("X"));
}

QByteArray Delta_dvp_protocol::read_one_address_Y_Bit(int slaveAddress, int address)
{
    return read_one_address_Y_M_S_T_C_X_Bit(slaveAddress,address,QStringLiteral("Y"));
}

QByteArray Delta_dvp_protocol::read_one_address_M_Bit(int slaveAddress, int address)
{
    return read_one_address_Y_M_S_T_C_X_Bit(slaveAddress,address,QStringLiteral("M"));
}

QByteArray Delta_dvp_protocol::read_one_address_S_Bit(int slaveAddress, int address)
{
    return read_one_address_Y_M_S_T_C_X_Bit(slaveAddress,address,QStringLiteral("S"));
}

QByteArray Delta_dvp_protocol::read_one_address_T_Bit(int slaveAddress, int address)
{
    return read_one_address_Y_M_S_T_C_X_Bit(slaveAddress,address,QStringLiteral("T"));
}

QByteArray Delta_dvp_protocol::read_one_address_C_Bit(int slaveAddress, int address)
{
    return read_one_address_Y_M_S_T_C_X_Bit(slaveAddress,address,QStringLiteral("C"));
}

QByteArray Delta_dvp_protocol::set_D_CMD_6_Word(int slaveAddress, int address, int value)
{
    return set_D_T_CMD_6_Word(slaveAddress,address,value,QStringLiteral("D"));
}

QByteArray Delta_dvp_protocol::set_T_CMD_6_Word(int slaveAddress, int address, int value)
{
    return set_D_T_CMD_6_Word(slaveAddress,address,value,QStringLiteral("T"));
}

//C寄存器word0-199是16位int，之后是32位int
QByteArray Delta_dvp_protocol::set_C_CMD_6_Word(int slaveAddress, int address, int value)
{
    if(address &gt; 199)
        return set_C_CMD_6_Word_GreaterThan199(slaveAddress,address,value);
    else
        return set_D_T_CMD_6_Word(slaveAddress,address,value,QStringLiteral("C"));
}

QByteArray Delta_dvp_protocol::set_C_CMD_6_Word_GreaterThan199(int slaveAddress, int address, int value)
{
    QByteArray data;
    data.append(static_cast&lt;char&gt;(0x3a));//ASCII码：:

    //从站号 1-255 即0x01-0xff
    auto addressList = getAsciiCodes(slaveAddress);
    data.append(static_cast&lt;char&gt;(addressList.at(0)));
    data.append(static_cast&lt;char&gt;(addressList.at(1)));
    //06
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x36));

    int _address_ = getRealAddress(address,QStringLiteral("C"));

    auto list = getAsciiCodes(_address_/256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(_address_%256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes((value &gt;&gt; 24) &amp; 0xFF);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes((value &gt;&gt; 16) &amp; 0xFF);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes((value &gt;&gt; 8) &amp; 0xFF);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(value &amp; 0xFF);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    {
        QString src = QString("%1").arg(slaveAddress, 2, 10, QLatin1Char('0')) +
                      "06" +
                      QString("%1").arg(_address_, 4, 16, QLatin1Char('0')).toUpper() +
                      QString("%1").arg(value, 8, 16, QLatin1Char('0')).toUpper();
        ;

        qDebug()&lt;&lt;"src = "&lt;&lt;src;
        uchar lrc = getLRC(QByteArray::fromHex(qPrintable(src)));

        list = getAsciiCodes(lrc);
        data.append(static_cast&lt;char&gt;(list.at(0)));
        data.append(static_cast&lt;char&gt;(list.at(1)));
    }

    data.append(static_cast&lt;char&gt;(0x0D));
    data.append(static_cast&lt;char&gt;(0x0A));

    qDebug()&lt;&lt;QString(data.toHex());
    return data;
}

QByteArray Delta_dvp_protocol::read_one_address_D_Word(int slaveAddress, int address)
{
    return read_one_address_D_T_Word(slaveAddress,address,QStringLiteral("D"));
}

QByteArray Delta_dvp_protocol::read_one_address_T_Word(int slaveAddress, int address)
{
    return read_one_address_D_T_Word(slaveAddress,address,QStringLiteral("T"));
}

QByteArray Delta_dvp_protocol::read_one_address_C_Word(int slaveAddress, int address)
{
    return read_one_address_D_T_Word(slaveAddress,address,QStringLiteral("C"));
}

QByteArray Delta_dvp_protocol::set_M_Y_S_T_C_CMD_5_Bit(int slaveAddress, int address, bool isOn, const QString &amp;innerDeviceName)
{
    QByteArray data;
    data.append(static_cast&lt;char&gt;(0x3a));//ASCII码：:

    //从站号 1-255 即0x01-0xff
    auto addressList = getAsciiCodes(slaveAddress);
    data.append(static_cast&lt;char&gt;(addressList.at(0)));
    data.append(static_cast&lt;char&gt;(addressList.at(1)));
    //05
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x35));

    int _address_ = getRealAddress(address,innerDeviceName);

    auto list = getAsciiCodes(_address_/256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(_address_%256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    if(isOn)
    {
        data.append(static_cast&lt;char&gt;(0x46));
        data.append(static_cast&lt;char&gt;(0x46));
    }
    else
    {
        data.append(static_cast&lt;char&gt;(0x30));
        data.append(static_cast&lt;char&gt;(0x30));
    }
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x30));

    {
        QString src = QString("%1").arg(slaveAddress, 2, 10, QLatin1Char('0')) +
                      "05" +
                      QString("%1").arg(_address_, 4, 16, QLatin1Char('0')).toUpper();
        if(isOn)
        {
            src.append("FF");
        }
        else
        {
            src.append("00");
        }
        src.append("00");
        qDebug()&lt;&lt;"src = "&lt;&lt;src;
        uchar lrc = getLRC(QByteArray::fromHex(qPrintable(src)));

        list = getAsciiCodes(lrc);
        data.append(static_cast&lt;char&gt;(list.at(0)));
        data.append(static_cast&lt;char&gt;(list.at(1)));
    }

    data.append(static_cast&lt;char&gt;(0x0D));
    data.append(static_cast&lt;char&gt;(0x0A));
    qDebug()&lt;&lt;QString(data.toHex());
    return data;
}

QByteArray Delta_dvp_protocol::read_one_address_Y_M_S_T_C_X_Bit(int slaveAddress, int address, const QString &amp;innerDeviceName)
{
    QByteArray data;
    data.append(static_cast&lt;char&gt;(0x3a));//ASCII码：:

    //从站号 1-255 即0x01-0xff
    auto addressList = getAsciiCodes(slaveAddress);
    data.append(static_cast&lt;char&gt;(addressList.at(0)));
    data.append(static_cast&lt;char&gt;(addressList.at(1)));
    //02
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x32));

    int _address_ = getRealAddress(address,innerDeviceName);

    auto list = getAsciiCodes(_address_/256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    list = getAsciiCodes(_address_%256);
    data.append(static_cast&lt;char&gt;(list.at(0)));
    data.append(static_cast&lt;char&gt;(list.at(1)));

    //读取个数：1
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x30));
    data.append(static_cast&lt;char&gt;(0x31));

    {
        QString src = QString("%1").arg(slaveAddress, 2, 10, QLatin1Char('0')) +
                      "02" +
                      QString("%1").arg(_address_, 4, 16, QLatin1Char('0')).toUpper();
        src.append("0001");
        qDebug()&lt;&lt;"src = "&lt;&lt;src;
        uchar lrc = getLRC(QByteArray::fromHex(qPrintable(src)));

        list = getAsciiCodes(lrc);
        data.append(static_cast&lt;char&gt;(list.at(0)));
        data.append(static_cast&lt;char&gt;(list.at(1)));
    }

    data.append(static_cast&lt;char&gt;(0x0D));
    data.append(static_cast&lt;char&gt;(0x0A));
    qDebug()&lt;&lt;QString(data.toHex());

    return data;
}

void Delta_dvp_protocol::parsingReceiveData(const QByteArray &amp;data)
{
    qDebug() &lt;&lt;"读取到："&lt;&lt; parseHexString(data.toHex());
    qDebug() &lt;&lt;"data size = "&lt;&lt;data.size();

    // for(int i = 0;i &lt; data.size();++i)
    // {
    //     qDebug()&lt;&lt;"i = "&lt;&lt;i&lt;&lt;" "&lt;&lt;QString(QChar(data[i]));
    // }

    auto cmd = data.mid(3,2);
    if(cmd == QByteArrayLiteral("02"))
    {
        qDebug()&lt;&lt;"读取bit";
        char value = data[8];
        qDebug()&lt;&lt;"value = "&lt;&lt;QString(QChar(value))&lt;&lt;QString(value).toInt(nullptr,16);
        QString binaryString = charToBinaryString(QString(value).toInt(nullptr,16)); // 将数值转换为二进制字符串，确保长度为4位
        qDebug()&lt;&lt;"binaryString = "&lt;&lt;binaryString;

        if (binaryString[3] == QLatin1Char('1'))
        {
            qDebug() &lt;&lt; "解析为 on";
        }
        else
        {
            qDebug() &lt;&lt; "解析为off";
        }
    }
    else if(cmd == QByteArrayLiteral("03"))
    {
        qDebug()&lt;&lt;"读取wold";
        if(data.size() == 19)//是读取C寄存器的200-255地址
        {
            auto value = data.mid(7,8);
            int decimalValue = QString(value).toInt(nullptr, 16);
            qDebug() &lt;&lt;"读取到值："&lt;&lt; decimalValue;
        }
        else
        {
            auto value = data.mid(7,4);
            int decimalValue = QString(value).toInt(nullptr, 16);
            qDebug() &lt;&lt;"读取到值："&lt;&lt; decimalValue;
        }
    }
}

/*
测试使用设备地址范围：
T：0-367（16F）
D：0-9999
C：0-255
*/</code></pre> 
<p>测试程序：<a href="https://download.csdn.net/download/kenfan1647/88791785" title="https://download.csdn.net/download/kenfan1647/88791785">https://download.csdn.net/download/kenfan1647/88791785</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d8d9ae1de817bf42485e0211650c3761/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">NC248:左叶子之和(C&#43;&#43;)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a65ecf080b110a5297bda8c8e45b1533/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">雾锁王国多人联机专用服务器推荐！最高支持16人联机</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>