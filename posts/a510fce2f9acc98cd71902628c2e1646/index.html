<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【ES】之集群详解 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【ES】之集群详解" />
<meta property="og:description" content=" 文章目录 ES的集群（3台服务器）概念实现 测试集群脑裂（老版本可能出现）什么是脑裂如何解决? 文档读写原理文档写原理文档读原理 ES的集群（3台服务器） 概念 实现 配置集群名称，保证每个节点的名称相同，如此就能都处于一个集群之内了 cluster.name: imooc-es-cluster
每一个节点的名称，必须不一样 node.name: es-node1
http端口（使用默认即可） http.port: 9200
主节点，作用主要是用于来管理整个集群，负责创建或删除索引，管理其他非master节点（相当于企业老总） node.master: true
数据节点，用于对文档数据的增删改查 node.data: true
集群列表 discovery.seed_hosts: [“192.168.1.184”, “192.168.1.185”, “192.168.1.186”]
启动的时候使用一个master节点 cluster.initial_master_nodes: [“es-node1”]
首先清空data中的数据
然后配置cluster.name(每个服务器上的都是一样的)
配置node.name（每个节点的服务器都是不一样的）
跨域的设置
node.master和node.data
node.master = true // 代表有可能被选举成master节点
node.data = true // 代表可以对数据的增删改查
配置discovery(每个节点配置的都是一样的)
快速查看配置信息
启动
测试 集群脑裂（老版本可能出现） 什么是脑裂 如果发生网络中断或者服务器宕机，那么集群会有可能被划分为两个部分，各自有自己的master来管理，那么这就是脑裂
如何解决? master主节点要经过多个master节点共同选举后才能成为新的主节点。就跟班级里选班长一样，并不是你1个人能决定的，需要班里半数以上的人决定。
解决实现原理：半数以上的节点同意选举，节点方可成为新的master。
discovery.zen.minimum_master_nodes=(N/2)&#43;1
N为集群的中master节点的数量，也就是那些 node.master=true 设置的那些服务器节点总数。
在最新版7.x中， minimum_master_node 这个参数已经被移除了，这一块内容完全由es自身去管理，这样就避免了脑裂的问题，选举也会非常快。
这里的n等于配置了node.mster=true的节点数量
文档读写原理 文档写原理 协调节点可以当成是一个controller
文档读原理 " />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/a510fce2f9acc98cd71902628c2e1646/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-12T08:14:29+08:00" />
<meta property="article:modified_time" content="2021-04-12T08:14:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【ES】之集群详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><ul><li><a href="#ES3_1" rel="nofollow">ES的集群（3台服务器）</a></li><li><ul><li><a href="#_2" rel="nofollow">概念</a></li><li><a href="#_4" rel="nofollow">实现</a></li></ul> 
     </li><li><a href="#_44" rel="nofollow">测试</a></li><li><a href="#_49" rel="nofollow">集群脑裂（老版本可能出现）</a></li><li><ul><li><a href="#_50" rel="nofollow">什么是脑裂</a></li><li><a href="#_54" rel="nofollow">如何解决?</a></li></ul> 
     </li><li><a href="#_66" rel="nofollow">文档读写原理</a></li><li><ul><li><a href="#_67" rel="nofollow">文档写原理</a></li><li><a href="#_71" rel="nofollow">文档读原理</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h5><a id="ES3_1"></a>ES的集群（3台服务器）</h5> 
<h6><a id="_2"></a>概念</h6> 
<p><img src="https://images2.imgbox.com/79/6a/g8sUR5M0_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_4"></a>实现</h6> 
<blockquote> 
 <p>配置集群名称，保证每个节点的名称相同，如此就能都处于一个集群之内了 cluster.name: imooc-es-cluster</p> 
</blockquote> 
<blockquote> 
 <p>每一个节点的名称，必须不一样 node.name: es-node1</p> 
</blockquote> 
<blockquote> 
 <p>http端口（使用默认即可） http.port: 9200</p> 
</blockquote> 
<blockquote> 
 <p>主节点，作用主要是用于来管理整个集群，负责创建或删除索引，管理其他非master节点（相当于企业老总） node.master: true</p> 
</blockquote> 
<blockquote> 
 <p>数据节点，用于对文档数据的增删改查 node.data: true</p> 
</blockquote> 
<blockquote> 
 <p>集群列表 discovery.seed_hosts: [“192.168.1.184”, “192.168.1.185”, “192.168.1.186”]</p> 
</blockquote> 
<blockquote> 
 <p>启动的时候使用一个master节点 cluster.initial_master_nodes: [“es-node1”]</p> 
</blockquote> 
<hr> 
<ol><li> <p>首先清空data中的数据</p> </li><li> <p>然后配置cluster.name(每个服务器上的都是一样的)<br> <img src="https://images2.imgbox.com/63/ef/6TuDe64x_o.png" alt="在这里插入图片描述"></p> </li><li> <p>配置node.name（每个节点的服务器都是不一样的）<br> <img src="https://images2.imgbox.com/98/e8/1F6hT2nc_o.png" alt="在这里插入图片描述"></p> </li><li> <p>跨域的设置<br> <img src="https://images2.imgbox.com/44/b0/KSr2lgdo_o.png" alt="在这里插入图片描述"></p> </li><li> <p>node.master和node.data</p> </li></ol> 
<blockquote> 
 <p>node.master = true // 代表有可能被选举成master节点</p> 
</blockquote> 
<blockquote> 
 <p>node.data = true // 代表可以对数据的增删改查</p> 
</blockquote> 
<ol start="6"><li>配置discovery(每个节点配置的都是一样的)<br> <img src="https://images2.imgbox.com/92/9c/pVirSnhq_o.png" alt="在这里插入图片描述"></li><li>快速查看配置信息<br> <img src="https://images2.imgbox.com/0a/bd/t9QSVQBx_o.png" alt="在这里插入图片描述"></li><li>启动<br> <img src="https://images2.imgbox.com/e9/11/68UMLXLS_o.png" alt="在这里插入图片描述"></li></ol> 
<h5><a id="_44"></a>测试</h5> 
<p><img src="https://images2.imgbox.com/b0/04/5F2VhOG8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f5/b5/g7fTv7oy_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_49"></a>集群脑裂（老版本可能出现）</h5> 
<h6><a id="_50"></a>什么是脑裂</h6> 
<p>如果发生网络中断或者服务器宕机，那么集群会有可能被划分为两个部分，各自有自己的master来管理，那么这就是脑裂<br> <img src="https://images2.imgbox.com/58/bb/lnHiYE0N_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_54"></a>如何解决?</h6> 
<p>master主节点要经过多个master节点共同选举后才能成为新的主节点。就跟班级里选班长一样，并不是你1个人能决定的，需要班里半数以上的人决定。<br> 解决实现原理：半数以上的节点同意选举，节点方可成为新的master。<br> discovery.zen.minimum_master_nodes=(N/2)+1<br> N为集群的中master节点的数量，也就是那些 node.master=true 设置的那些服务器节点总数。</p> 
<p><strong>在最新版7.x中， minimum_master_node 这个参数已经被移除了，这一块内容完全由es自身去管理，这样就避免了脑裂的问题，选举也会非常快。</strong></p> 
<p><img src="https://images2.imgbox.com/b3/34/HSPBuG4w_o.png" alt="在这里插入图片描述"><br> 这里的n等于配置了<strong>node.mster=true</strong>的节点数量</p> 
<h5><a id="_66"></a>文档读写原理</h5> 
<h6><a id="_67"></a>文档写原理</h6> 
<p>协调节点可以当成是一个controller<br> <img src="https://images2.imgbox.com/40/bc/wCkOQfpS_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_71"></a>文档读原理</h6> 
<p><img src="https://images2.imgbox.com/54/1d/MBfo6CZq_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c34a44953d07656316f651048268b66b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">k8s-大型分布式集群环境捷径部署</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ae2b62c99461509caf8cae907fe900f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Building wheel for opencv-python (PEP 517) ... /</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>