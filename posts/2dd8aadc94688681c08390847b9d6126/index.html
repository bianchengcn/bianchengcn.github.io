<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>COLMAP输出的文件类型(bin, txt) - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="COLMAP输出的文件类型(bin, txt)" />
<meta property="og:description" content="默认情况下，COLMAP使用二进制文件格式(bin，机器可读，速度速)来存储稀疏模型。此外，COLMAP也可以将稀疏模型存储为文本文件(txt，人类可读，速度慢)。在这两种情况下，模型导出的信息被分为关于相机、图像和点云的三个文件。任何包含这三个文件的目录都构成了一个稀疏模型。二进制文件的扩展名是.bin，文本文件的扩展名是.txt。注意，当从包含二进制文件和文本文件的目录加载模型时，COLMAP更倾向于二进制格式。
参考网页：https://colmap.github.io/format.html
导出bin文件 要在GUI（可视化界面）中导出当前的模型，选择File &gt; Export model，要导出当前数据集中的所有重建模型，选择File &gt; Export all models，为bin文件。要想导入已经导出的模型，例如，为了可视化或恢复重建，选择File &gt; Import model，并选择包含相机、图像和点云文件的文件夹。
此外，还可以将稀疏模型导出为其他格式，例如VisualSfM的NVM、Bundler文件、PLY、VRML等，使用File &gt; Export model as....
导出txt文件 要在GUI导出文本格式，使用File &gt; Export model as text导出模型。三个文本文件:camera .txt、images.txt和points3D.txt。注释以前导“#”字符开始。第一行注释简要描述了文本文件的格式。
cameras.txt 这个文件包含了数据集中所有重建相机的内参，每个相机占一行，例如:
# Camera list with one line of data per camera: # 一行一个相机参数列表 # CAMERA_ID, MODEL, WIDTH, HEIGHT, PARAMS[] # 相机ID, 相机, 宽, 高, 参数[] # Number of cameras: 3 1 SIMPLE_PINHOLE 3072 2304 2559.81 1536 1152 2 PINHOLE 3072 2304 2560." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2dd8aadc94688681c08390847b9d6126/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-25T09:41:42+08:00" />
<meta property="article:modified_time" content="2022-11-25T09:41:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">COLMAP输出的文件类型(bin, txt)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:justify;">默认情况下，COLMAP使用<strong>二进制文件格式(bin，机器可读，速度速)</strong>来存储稀疏模型。此外，COLMAP也可以将稀疏模型存储为<strong>文本文件(txt，人类可读，速度慢)</strong>。在这两种情况下，模型导出的信息被分为关于相机、图像和点云的三个文件。任何包含这三个文件的目录都构成了一个稀疏模型。<strong>二进制文件的扩展名是.bin，文本文件的扩展名是.txt</strong>。注意，当从包含二进制文件和文本文件的目录加载模型时，COLMAP更倾向于二进制格式。</p> 
<p style="text-align:justify;">参考网页：<a class="link-info" href="https://colmap.github.io/format.html" rel="nofollow" title="https://colmap.github.io/format.html">https://colmap.github.io/format.html</a></p> 
<h3 style="text-align:justify;"><strong>导出bin文件</strong></h3> 
<p style="text-align:justify;">要在GUI（可视化界面）中导出当前的模型，选择File &gt; Export model，要导出当前数据集中的所有重建模型，选择File &gt; Export all models，为bin文件。要想导入已经导出的模型，例如，为了可视化或恢复重建，选择File &gt; Import model，并选择包含相机、图像和点云文件的文件夹。</p> 
<p class="img-center"><img alt="" height="101" src="https://images2.imgbox.com/97/91/RwbsFjwZ_o.png" width="351"></p> 
<p>此外，还可以将稀疏模型导出为其他格式，例如VisualSfM的NVM、Bundler文件、PLY、VRML等，使用File &gt; Export model as....</p> 
<p class="img-center"><img alt="" height="148" src="https://images2.imgbox.com/e0/1c/ca7g8l9t_o.png" width="543"></p> 
<h3 style="text-align:justify;"><strong>导出txt文件</strong></h3> 
<p style="text-align:justify;">要在GUI导出文本格式，使用File &gt; Export model as text导出模型。三个文本文件:camera .txt、images.txt和points3D.txt。注释以前导“#”字符开始。第一行注释简要描述了文本文件的格式。</p> 
<h4 style="text-align:justify;"><img alt="" height="116" src="https://images2.imgbox.com/e7/e5/CbgCZ0iW_o.png" width="738"><strong>cameras.txt</strong></h4> 
<p>这个文件包含了数据集中所有重建相机的内参，每个相机占一行，例如:</p> 
<pre><code class="language-python"># Camera list with one line of data per camera:
# 一行一个相机参数列表
#   CAMERA_ID, MODEL, WIDTH, HEIGHT, PARAMS[]
#   相机ID, 相机, 宽, 高, 参数[]
# Number of cameras: 3
1 SIMPLE_PINHOLE 3072 2304 2559.81 1536 1152
2 PINHOLE 3072 2304 2560.56 2560.56 1536 1152
3 SIMPLE_RADIAL 3072 2304 2559.69 1536 1152 -0.0218531</code></pre> 
<p style="text-align:justify;"><a name="t1"></a><a id="imagestxt_11"></a>上述数据中，数据集包含 3 个相机，这些相机使用具有相同传感器尺寸（宽度：3072，高度：2304）的不同失真模型。 参数的长度是可变的，取决于相机型号。 对于第一个相机，有 3 个参数，单个焦距为2559.81像素，主点(即 cx,cy)位于像素位置（1536、1152）。相机的内参可以被多个图像共享，这些图像使用唯一标识符 CAMERA_ID 来指代相机。</p> 
<p style="text-align:justify;"><strong>如下：</strong></p> 
<p class="img-center"><img alt="" height="173" src="https://images2.imgbox.com/84/83/XTt6A9ai_o.png" width="1200"></p> 
<h4><strong>images.txt</strong></h4> 
<p>该文件包含数据集中所有重建图像的位姿和关键点，每个图像占两行，例如:</p> 
<pre><code class="language-python"># Image list with two lines of data per image:
# 每张图像数据占两行
#   IMAGE_ID, QW, QX, QY, QZ, TX, TY, TZ, CAMERA_ID, NAME
#   图像ID, QW, QX, QY, QZ, TX, TY, TZ, 相机ID, NAME
#   POINTS2D[] as (X, Y, POINT3D_ID)
#   2D点坐标和对应3D点ID, 若没有对应的3D点则ID标记为-1
# Number of images: 2, mean observations per image: 2
1 0.851773 0.0165051 0.503764 -0.142941 -0.737434 1.02973 3.74354 1 P1180141.JPG
2362.39 248.498 58396 1784.7 268.254 59027 1784.7 268.254 -1
2 0.851773 0.0165051 0.503764 -0.142941 -0.737434 1.02973 3.74354 1 P1180142.JPG
1190.83 663.957 23056 1258.77 640.354 59070
</code></pre> 
<p style="text-align:justify;"><a name="t2"></a><a id="points3Dtxt_24"></a>这里，前两行定义了第一张图片的信息，以此类推。使用四元数 (QW, QX, QY, QZ) 和平移向量 (TX, TY, TZ) 将图像的重建位姿指定为从世界到图像的相机坐标系的投影。四元数是使用 Hamilton 约定定义的，例如，Eigen 库也使用该约定。投影/相机中心的坐标由 -R^t * T 给出，其中 R^t 是由四元数组成的 3x3 旋转矩阵的逆/转置，T 是平移向量。从图像上看，图像的局部相机坐标系定义为 X 轴指向右侧，Y 轴指向底部，Z 轴指向前方。</p> 
<p style="text-align:justify;">上面示例中的两个图像都使用相同的相机模型并共享内参 (CAMERA_ID = 1)。映像名称与项目的选定基础映像文件夹相关。第一个图像有 3 个关键点，第二个图像有 2 个关键点，而关键点的位置由像素坐标指定。两幅图像都观察到 2 个 3D 点，并注意第一张图像的最后一个关键点在重建中没有观察到 3D 点，因此 3D 点标识符为 -1。</p> 
<p style="text-align:justify;"><strong>如下：</strong></p> 
<p class="img-center"><img alt="" height="232" src="https://images2.imgbox.com/7a/de/WNxSteyO_o.png" width="1200"></p> 
<p style="text-align:justify;">发现导出的 txt 和示例不一样，找不到第二张图片的信息，苦恼很久，才醒悟是关键点信息太多了，解决办法如下：</p> 
<p style="text-align:justify;"><a class="link-info" href="https://blog.csdn.net/qq_43307074/article/details/128029245?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22128029245%22%2C%22source%22%3A%22qq_43307074%22%7D" title="COLMAP导出相机外参（bin文件转txt文件）">COLMAP导出相机外参（bin文件转txt文件）</a></p> 
<h4><strong>points3D.txt</strong></h4> 
<p>该文件包含数据集中所有重建的3D点的信息，每个点占一行，例如:</p> 
<pre><code class="language-python">#   3D point list with one line of data per point:
#   每个点占一行
#   POINT3D_ID, X, Y, Z, R, G, B, ERROR, TRACK[] as (IMAGE_ID, POINT2D_IDX)
#   POINT3D_ID:三维点的id (二维点可以根据此id找到图片对应的三维点) 
#   X, Y, Z:三维点坐标
#   R, G, B：三维点颜色信息
#   ERROR：投影误差（基于像素）
# Number of points: 3, mean track length: 3.3334
63390 1.67241 0.292931 0.609726 115 121 122 1.33927 16 6542 15 7345 6 6714 14 7227
63376 2.01848 0.108877 -0.0260841 102 209 250 1.73449 16 6519 15 7322 14 7212 8 3991
63371 1.71102 0.28566 0.53475 245 251 249 0.612829 118 4140 117 4473</code></pre> 
<p style="text-align:justify;">这里有三个重建的 3D 点，其中TRACK[] as (IMAGE_ID, POINT2D_IDX)：对应images.txt里的图像id，POINT2D_IDX 定义了 images.txt 文件中关键点的从零开始的索引。比如说上面：16 6542，意思是images.txt中图片ID为16的里面的第6542个点，这个点是该图的特征点，也映射到这个三维点。误差以重投影误差的像素为单位，仅在全局BA后更新。</p> 
<p style="text-align:justify;"><strong>如下：</strong></p> 
<p style="text-align:justify;"><img alt="" height="211" src="https://images2.imgbox.com/b8/58/IP0QjWCN_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/94b6437bc925d3b4d6266ef42413e729/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">华为“仓颉”不是中文编程，中文编程早有所属，势如破竹</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91aa2402691c89bd7c0520bfed1d6206/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">COLMAP导出相机外参（bin文件转txt文件）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>