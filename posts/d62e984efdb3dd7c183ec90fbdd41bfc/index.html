<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Source Insight宏 -  头文件与源文件切换（不限目录） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Source Insight宏 -  头文件与源文件切换（不限目录）" />
<meta property="og:description" content="前面发布的帖子：Source Insight 宏 - 头文件与源文件切换用到的切换宏有一定的限制（要求在同一目录下），如源码结构为src、include、test时，include下头文件与src下源文件之间就不能实现切换，在使用过程中不免会产生一点影响，今天将其进行了修改，经测试可以达到不同目录下的文件切换，对目录再没有要求，但是同时如果源码中存在多个相同文件名（不同目录下）时，需要用户自己选择相应的文件。
宏代码如下，也可以从我的资源中直接下载em文件。
/** cpp和hpp文件互换(不限目录) 作者: 王丰亮 时间: 2012.2.18 */ macro SwitchCppAndHpp() { hwnd = GetCurrentWnd() hCurOpenBuf = GetCurrentBuf() if (hCurOpenBuf == 0)// empty buffer stop // 文件类型临时缓冲区 strFileExt = NewBuf(&#34;strFileExtBuf&#34;) ClearBuf(strFileExt) // 头文件 index_hpp_begin = 0 // 头文件开始索引 AppendBufLine(strFileExt, &#34;.h&#34;) AppendBufLine(strFileExt, &#34;.hpp&#34;) AppendBufLine(strFileExt, &#34;.hxx&#34;) index_hpp_end = GetBufLineCount(strFileExt) // 头文件结束索引 // 源文件 index_cpp_begin = index_hpp_end // 源文件开始索引 AppendBufLine(strFileExt, &#34;.c&#34;) AppendBufLine(strFileExt, &#34;.cpp&#34;) AppendBufLine(strFileExt, &#34;.cc&#34;) AppendBufLine(strFileExt, &#34;.cx&#34;) AppendBufLine(strFileExt, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/d62e984efdb3dd7c183ec90fbdd41bfc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-02-18T11:40:23+08:00" />
<meta property="article:modified_time" content="2012-02-18T11:40:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Source Insight宏 -  头文件与源文件切换（不限目录）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-size:16px">        前面发布的帖子：<span class="link_title"><a href="http://blog.csdn.net/tankles/article/details/6949474">Source Insight 宏 - 头文件与源文件切换</a></span>用到的切换宏有一定的限制（</span><span style="font-size:16px">要求在同一目录下），如源码结构为src、include、test时，include下头文件与src下源文件之间就不能实现切换，在使用过程中不免会产生一点影响，今天将其进行了修改，经测试可以达到不同目录下的文件切换，对目录再没有要求，但是同时如果源码中存在多个相同文件名（不同目录下）时，需要用户自己选择相应的文件。</span></p> 
<p><span style="font-size:16px">        宏代码如下，也可以从<a target="_blank" href="http://download.csdn.net/detail/tankles/4071785" rel="noopener noreferrer">我的资源</a>中直接下载em文件。</span></p> 
<p><span style="font-size:16px"></span></p> 
<pre><code class="language-cpp"><span style="font-size:16px;">/**
	cpp和hpp文件互换(不限目录)

	作者: 王丰亮
	时间: 2012.2.18
*/

macro SwitchCppAndHpp()
{
	hwnd = GetCurrentWnd()
	hCurOpenBuf = GetCurrentBuf()
	if (hCurOpenBuf == 0)// empty buffer
		stop 

	// 文件类型临时缓冲区
	strFileExt = NewBuf("strFileExtBuf")
	ClearBuf(strFileExt)
	
	// 头文件
	index_hpp_begin = 0 								// 头文件开始索引
	AppendBufLine(strFileExt, ".h")
	AppendBufLine(strFileExt, ".hpp")
	AppendBufLine(strFileExt, ".hxx")

	index_hpp_end = GetBufLineCount(strFileExt) 		// 头文件结束索引
	
	// 源文件
	index_cpp_begin = index_hpp_end 					// 源文件开始索引
	AppendBufLine(strFileExt, ".c")
	AppendBufLine(strFileExt, ".cpp")
	AppendBufLine(strFileExt, ".cc")
	AppendBufLine(strFileExt, ".cx")
	AppendBufLine(strFileExt, ".cxx")
	index_cpp_end = GetBufLineCount(strFileExt)			// 源文件结束索引


	curOpenFileName = GetBufName(hCurOpenBuf)
	curOpenFileName = ParseFilenameWithExt(curOpenFileName) 	// 获得不包括路径的文件名
	curOpenFileNameWithoutExt = ParseFilenameWithoutExt(curOpenFileName)
	curOpenFileNameLen = strlen(curOpenFileName)
	//Msg(cat("current opened no ext filename:", curOpenFileNameWithoutExt))

	isCppFile = 0 										// 0：未知 1：头文件 2：源文件，默认未知扩展名
	curOpenFileExt = "" 								// 当前打开文件的扩展名
	index = index_hpp_begin 
	// 遍历文件，判断文件类型
	while(index &lt; index_cpp_end)	
	{
		curExt = GetBufLine(strFileExt, index) 

		if(isFileType(curOpenFileName, curExt) == True)// 匹配成功
		{
			if (index &lt; index_hpp_end)
				isCppFile = 1 							// 当前打开文件是头文件
			else
				isCppFile = 2 							// 源文件
			break 
		}
		index = index + 1 
	}// while(index &lt; index_cpp_end)
	
	// 调试
	// AppendBufLine(debugBuf, isCppFile)

	index_replace_begin = index_hpp_begin 
	index_replace_end = index_hpp_end 
	
	if (isCppFile == 1)									// 当前打开文件是头文件			
	{
		index_replace_begin = index_cpp_begin 
		index_replace_end = index_cpp_end 
	}
	else if(isCppFile == 2)								// 当前打开文件是源文件
	{
		index_replace_begin = index_hpp_begin 
		index_replace_end = index_hpp_end 
	}
	else												// 未知类型
	{
		index_replace_begin = 9999 					
		index_replace_end = index_replace_begin 		// 下面循环不会执行
	}
	
	index = index_replace_begin 
	while(index &lt; index_replace_end)
	{
		destExt = GetBufLine(strFileExt, index) 
		// 尝试当前目标扩展名是否能够打开
		destFilename = AddFilenameExt(curOpenFileNameWithoutExt, destExt)

		//Msg(destFilename)

		hCurOpenBuf = OpenBuf(destFilename)
		if(hCurOpenBuf != hNil)
		{
			SetCurrentBuf(hCurOpenBuf)
			break 
		}
		else
		{
			//Msg("打开失败")
		}
	
		index = index + 1 
	}
	CloseBuf(strFileExt)							// 关闭缓冲区
}


macro switch_cpp_hpp()
{
	hwnd = GetCurrentWnd()
	hCurOpenBuf = GetCurrentBuf()
	if (hCurOpenBuf == hNil)// empty buffer
		stop 

	curOpenFileName = GetBufName(hCurOpenBuf)
	curOpenFileNameLen = strlen(curOpenFileName)
//	Msg(cat("current opened filename:", curOpenFileName))
		
	// 文件类型临时缓冲区
	strFileExt = NewBuf("strFileExtBuf")
	ClearBuf(strFileExt)
	
	// 头文件
	index_hpp_begin = 0 							// 头文件开始索引
	AppendBufLine(strFileExt, ".h")
	AppendBufLine(strFileExt, ".hpp")
	index_hpp_end = GetBufLineCount(strFileExt) 		// 头文件结束索引
	
	// 源文件
	index_cpp_begin = index_hpp_end 					// 源文件开始索引
	AppendBufLine(strFileExt, ".c")
	AppendBufLine(strFileExt, ".cpp")
	AppendBufLine(strFileExt, ".cc")
	AppendBufLine(strFileExt, ".cx")
	AppendBufLine(strFileExt, ".cxx")
	index_cpp_end = GetBufLineCount(strFileExt)		// 源文件结束索引

	isCppFile = 0 										// 0：未知 1：头文件 2：源文件，默认未知扩展名
	curOpenFileExt = "" 								// 当前打开文件的扩展名
	index = index_hpp_begin 
	// 遍历头文件，判断是否当前打开文件是头文件类型
	while(index &lt; index_cpp_end)	
	{
		curExt = GetBufLine(strFileExt, index) 
		curExtLen = strlen(curExt) 
		curOpenFileExt = strmid(curOpenFileName, curOpenFileNameLen-curExtLen, curOpenFileNameLen) 		// 当前打开文件的扩展名
		
		// 调试
		// AppendBufLine(debugBuf, curExt)
		// AppendBufLine(debugBuf, curOpenFileExt)

		
		if(curOpenFileExt == curExt)					// 匹配成功
		{
			if (index &lt; index_hpp_end)
				isCppFile = 1 							// 当前打开文件是头文件
			else
				isCppFile = 2 							// 源文件
			break 
		}
		index = index + 1 
	}// while(index &lt; index_cpp_end)
	
	// 调试
	// AppendBufLine(debugBuf, isCppFile)

	index_replace_begin = index_hpp_begin 
	index_replace_end = index_hpp_end 
	
	if (isCppFile == 1)									// 当前打开文件是头文件			
	{
		index_replace_begin = index_cpp_begin 
		index_replace_end = index_cpp_end 
	}
	else if(isCppFile == 2)								// 当前打开文件是源文件
	{
		index_replace_begin = index_hpp_begin 
		index_replace_end = index_hpp_end 
	
		// 调试
		// AppendBufLine(debugBuf, "cpp")
	}
	else												// 未知类型
	{
		//CloseBuf(strFileExt)							// 关闭缓冲区

		//stop 
	
		index_replace_begin = 9999 					
		index_replace_end = index_replace_begin 		// 下面循环不会执行
	}
	
	index = index_replace_begin 
	while(index &lt; index_replace_end)
	{
		destExt = GetBufLine(strFileExt, index) 
		destFileName = strmid(curOpenFileName, 0, curOpenFileNameLen-strlen(curOpenFileExt)) 	// 不包括扩展名，绝对路径
		
		// 尝试当前目标扩展名是否能够打开
		destFilePath = cat(destFileName, destExt)												// 文件名（包括扩展名）
		
		// 调试
		// AppendBufLine(debugBuf, destFilePath)

		hCurOpenBuf = OpenBuf(destFilePath)
		if(hCurOpenBuf != 0)
		{
			SetCurrentBuf(hCurOpenBuf)
			break 
		}
		
		// 尝试进行目录替换，看能否打开文件（如何设计：支持多个目录）
		// ...

		
		index = index + 1 
	}
	CloseBuf(strFileExt)							// 关闭缓冲区
	// 调试
	// AppendBufLine(debugBuf, "finished")
	
}

macro ParseFilenameWithExt(longFilename)
{
	shortFilename = longFilename
	len = strlen(longFilename)-1
	if(len &gt; 0)
	{
		while(True)
		{
			if(strmid(longFilename, len, len+1) == "\\")
				break

			len = len - 1
			if(len &lt;= 0)
				break 
		}
	}
	shortFilename = strmid(longFilename, len+1, strlen(longFilename))
	
	return shortFilename
}
macro ParseFilenameWithoutExt(longFilename)
{
	shortFilename = longFilename
	len = strlen(longFilename)
	dotPos = len
	if(len &gt; 0)
	{
		while(True)
		{
			len = len - 1
			if(strmid(longFilename, len, len+1) == ".")
			{
				dotPos = len
				break
			}
			if(len &lt;= 0)
				break 
		}
	}
	shortFilename = strmid(longFilename, 0, dotPos)
	
	return shortFilename
}
macro AddFilenameExt(filename, ext)
{
	return cat(filename, ext)
}

macro isFileType(shortFilename, ext)
{
	extLen = strlen(ext)
	lastExtFilename = strmid(shortFilename, strlen(shortFilename)-extLen, strlen(shortFilename))
	if(toupper(lastExtFilename) == toupper(ext))
		return True

	return False
}

</span></code></pre> 
<br> 
<span style="font-size:16px">        两个版本使用哪个，各位各取所需</span>~_~ 
<br> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f32d492a1f6d6a7ad525763a405fd682/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Asp 结合JQuery EasyUI 框架完成的一个增删改查</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8ec7282d2799fd29acd40f176517059d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用fileupload组件上传文件出现乱码解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>