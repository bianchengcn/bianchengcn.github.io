<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python - 定时任务，每天定时备份数据库 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python - 定时任务，每天定时备份数据库" />
<meta property="og:description" content="一、代码说话 # coding=utf-8 ... os.system(&#39;comand&#39;) 执行括号中的命令 os.path.exists 查看path是否存在 mysql命令 mysqldump -uusername -ppassword dbname &gt; dbname.sql 导出整个数据库 (导出过程会锁表) mysql命令 mysqldump --single-transaction -uusername -ppassword dbname &gt; dbname.sql 导出整个数据库 (innodb 导出过程不锁表) mysql命令 mysqldump --lock-tables=false -uusername -ppassword dbname &gt; dbname.sql 导出整个数据库 (myisam 导出过程不锁表) ... import os import time # from apscheduler.schedulers.blocking import BlockingScheduler DB_USER = &#39;root&#39; DB_PASSWORD = &#39;123456&#39; DB_NAME = &#39;yourdbname&#39; BACK_DIR = &#39;/data/mysql/&#39; TODAY = time.strftime(&#39;%Y-%m-%d&#39;) # -%H-%M-%S TODAY_DIR = BACK_DIR &#43; TODAY def backupsql(): # 如果目录不存在，新建目录 if not os." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/cafbfae80df5aa181183a7a328a0373c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-12-05T15:30:04+08:00" />
<meta property="article:modified_time" content="2018-12-05T15:30:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python - 定时任务，每天定时备份数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_1"></a>一、代码说话</h5> 
<pre><code># coding=utf-8
...
os.system('comand') 执行括号中的命令
os.path.exists 查看path是否存在

mysql命令  mysqldump -uusername -ppassword dbname &gt; dbname.sql  导出整个数据库 (导出过程会锁表)


mysql命令  mysqldump --single-transaction -uusername -ppassword dbname &gt; dbname.sql  导出整个数据库 (innodb 导出过程不锁表)


mysql命令  mysqldump --lock-tables=false -uusername -ppassword dbname &gt; dbname.sql  导出整个数据库 (myisam 导出过程不锁表)

...
import os
import time
# from apscheduler.schedulers.blocking import BlockingScheduler

DB_USER = 'root'
DB_PASSWORD = '123456'
DB_NAME = 'yourdbname'
BACK_DIR = '/data/mysql/'
TODAY = time.strftime('%Y-%m-%d') # -%H-%M-%S
TODAY_DIR = BACK_DIR + TODAY

def backupsql():
	# 如果目录不存在，新建目录
	if not os.path.exists(TODAY_DIR):
		os.makedirs(TODAY_DIR)
	# 执行mysql命令，导出数据库到新建的文件
	sqlcmd = "mysqldump  --single-transaction -u" + DB_USER + " -p" + DB_PASSWORD + " " + DB_NAME + " &gt; " + TODAY_DIR + "/" + DB_NAME + ".sql"
	os.system(sqlcmd)

# 主函数
def main():
    # 方式一
    # ----------------- 使用 schedule 定时 -------------- 
    # 经测试，schedule的定时任务没有生效 ...... 换一种思路。
    # python代码只执行备份操作，定时任务由linux系统自带的定时任务实现
	# schedule = BlockingScheduler()
	# 每天凌晨1点执行定时任务
	# schedule.add_job(func=backupsql, trigger='cron', month='*', day='*', hour='1', minute='0')
	# 启动定时器
	# schedule.start
	# 方式二
	# ----------------- 只 执行备份函数 -------------- 
	backupsql()

# 执行主函数
if __name__ == '__main__':
	main()

</code></pre> 
<h5><a id="_56"></a>二、支持（方式二）</h5> 
<p><strong>1、添加系统级别的定时任务</strong></p> 
<pre><code>vim /etc/crontab
</code></pre> 
<p>打开后的文件：</p> 
<pre><code>SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
</code></pre> 
<p>最后一行添加</p> 
<pre><code># 每天凌晨1点，定时执行testmysql.py
0 1 * * * root python /data/testmysql.py
</code></pre> 
<p>查看日志</p> 
<pre><code>cat /var/log/cron
</code></pre> 
<h5><a id="_88"></a>三、支持（方式一）</h5> 
<p>定时任务没启动，知道怎么写的望留言告知</p> 
<p><strong>1、安装apscheduler</strong></p>   apscheduler不是python内置的模块，所以需要安装 
<p> </p> 
<p>(1) 下载源码</p> 
<p><a href="https://pypi.python.org/pypi/APScheduler/#downloads" rel="nofollow">https://pypi.python.org/pypi/APScheduler/#downloads</a></p> 
<p>(2) 解压</p> 
<pre><code>tar -zxvf APScheduler-3.5.3.tar.gz
</code></pre> 
<p>(3) 安装</p> 
<pre><code># 进入目录
cd APScheduler-3.5.3
# 安装
python setup.py install
</code></pre> 
<p><strong>2、使用(脚本怎么用)</strong></p> 
<pre><code>cd /data
vim test.py
# 将上面的代码内容粘贴到vim编辑器里面,保存并退出
# 执行python脚本
python test.py
</code></pre> 
<p><strong>3、开机启动</strong></p> 
<pre><code>vim /etc/rc.local
# 在最后一行添加
python /data/test.py
# 保存并退出

# 修改test.py的执行权限
cd /data
chmod 777 test.py
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6d1158023ee0ebdb31b94b2ccf414abd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">用WeUI 中的weui-tab 配合js实现weui-tab tabbar   页面切换切换功能</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f89be9539a6500e6d8679d59224eaa0c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">最大流之Ford-Fulkerson算法（C&#43;&#43;实现）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>