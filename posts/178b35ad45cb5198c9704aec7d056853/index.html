<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>hive的特殊函数named_struct、inline及特殊类型map＜string, array＜string＞＞ - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="hive的特殊函数named_struct、inline及特殊类型map＜string, array＜string＞＞" />
<meta property="og:description" content="spark-sql&gt; desc test2; userid int NULL date string NULL list_01 array&lt;string&gt; NULL target string NULL group_num int NULL Time taken: 0.526 seconds, Fetched 5 row(s) spark-sql&gt; select * from test2; 1 20220303 [&#34;1:20220202&#34;,&#34;1:20220202&#34;,&#34;2:20220202&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;1:20220303&#34;] 1:20220303 1 1 20220202 [&#34;1:20220202&#34;,&#34;1:20220202&#34;,&#34;2:20220202&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;1:20220303&#34;] 1:20220202 1 1 20220202 [&#34;1:20220202&#34;,&#34;1:20220202&#34;,&#34;2:20220202&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;1:20220303&#34;] 1:20220202 1 2 20220202 [&#34;1:20220202&#34;,&#34;1:20220202&#34;,&#34;2:20220202&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;1:20220303&#34;] 2:20220202 2 3 20220303 [&#34;1:20220202&#34;,&#34;1:20220202&#34;,&#34;2:20220202&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;1:20220303&#34;] 3:20220303 2 3 20220303 [&#34;1:20220202&#34;,&#34;1:20220202&#34;,&#34;2:20220202&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;1:20220303&#34;] 3:20220303 2 3 20220303 [&#34;1:20220202&#34;,&#34;1:20220202&#34;,&#34;2:20220202&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;1:20220303&#34;] 3:20220303 3 3 20220303 [&#34;1:20220202&#34;,&#34;1:20220202&#34;,&#34;2:20220202&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;3:20220303&#34;,&#34;1:20220303&#34;] 3:20220303 3 spark-sql&gt; select named_struct(&#39;a&#39;,target, &#39;b&#39;,list_01) from test2 limit 1; {&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/178b35ad45cb5198c9704aec7d056853/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-13T16:10:36+08:00" />
<meta property="article:modified_time" content="2023-02-13T16:10:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">hive的特殊函数named_struct、inline及特殊类型map＜string, array＜string＞＞</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; desc test2;</code></pre> 
 <blockquote class="kdocs-blockquote" style="">
   userid int NULL 
  <br> date string NULL 
  <br> list_01 
  <span class="kdocs-color" style="color:#C21C13;">array&lt;string&gt; </span> NULL 
  <br> target string NULL 
  <br> group_num int NULL 
  <br>Time taken: 0.526 seconds, Fetched 5 row(s) 
 </blockquote> 
 <hr> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; select * from test2;</code></pre> 
 <blockquote class="kdocs-blockquote" style="text-align:left;">
   1 20220303 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 1:20220303 1 
  <br>1 20220202 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 1:20220202 1 
  <br>1 20220202 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 1:20220202 1 
  <br>2 20220202 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 2:20220202 2 
  <br>3 20220303 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 3:20220303 2 
  <br>3 20220303 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 3:20220303 2 
  <br>3 20220303 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 3:20220303 3 
  <br>3 20220303 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 3:20220303 3 
 </blockquote> 
 <hr> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; select named_struct('a',target, 'b',list_01) from test2 limit 1;</code></pre> 
 <blockquote class="kdocs-blockquote" style="">
   {"a":"1:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
 </blockquote> 
 <hr> 
 <h6 style="">1、构建 类型 struct&lt;key:string,value:array&lt;string&gt;</h6> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; 
    drop table if exists test3;
    create table test3 as 
    select 
        named_struct('a',target, 'b',list_01) as content_shi_group,
        group_num
    from 
        test2;</code></pre> 
 <blockquote class="kdocs-blockquote" style="">
   {"a":"1:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 1 
  <br>{"a":"1:20220202","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 1 
  <br>{"a":"1:20220202","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 1 
  <br>{"a":"2:20220202","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 2 
  <br>{"a":"3:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 2 
  <br>{"a":"3:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 2 
  <br>{"a":"3:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 3 
  <br>{"a":"3:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 3 
 </blockquote> 
 <hr> 
 <h6 style="">2、按group_num聚合，生成 类型array&lt;struct&lt;key:string,value:array&lt;string&gt;&gt;</h6> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; 
    drop table if exists test4;
    create table test4 as 
    select 
        group_num, collect_list(content_shi_group) as list_struct
    from test3 
    group by group_num;</code></pre> 
 <blockquote class="kdocs-blockquote" style="">
   1 [{"a":"1:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]},{"a":"1:20220202","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]},{"a":"1:20220202","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]}] 
  <br>3 [{"a":"3:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]},{"a":"3:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]}] 
  <br>2 [{"a":"2:20220202","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]},{"a":"3:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]},{"a":"3:20220303","b":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]}] 
 </blockquote> 
 <hr> 
 <h6 style="">3、类型 array&lt;struct&lt;key:string,value:array&lt;string&gt;&gt; 转 map&lt;string,array&lt;string&gt;&gt;</h6> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; 
    drop table if exists test5;
    create table test5 as 
    select 
        group_num, map(k1,v1) as map_list
    from test4 
    lateral view inline(list_struct) t1 as k1,v1;</code></pre> 
 <blockquote class="kdocs-blockquote" style="">
   1 {"1:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
  <br>1 {"1:20220202":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
  <br>1 {"1:20220202":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
  <br>3 {"3:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
  <br>3 {"3:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
  <br>2 {"2:20220202":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
  <br>2 {"3:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
  <br>2 {"3:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 
 </blockquote> 
 <hr> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; select inline(list_struct) from test4 where group_num=1;</code></pre> 
 <blockquote class="kdocs-blockquote" style="">
   1:20220303 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 
  <br>1:20220202 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 
  <br>1:20220202 ["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"] 
 </blockquote> 
 <hr> 
 <h6 style="">4、直接生成hive map&lt;string, array&lt;String&gt;&gt;类型</h6> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; 
    drop table if exists test3_02;
    create table test3_02 as 
    select 
        map(target, list_01) as content_group,
        group_num
    from 
    test2 ;</code></pre> 
 <blockquote class="kdocs-blockquote" style="">
   {"1:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 1 
  <br>{"1:20220202":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 1 
  <br>{"1:20220202":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 1 
  <br>{"2:20220202":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 2 
  <br>{"3:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 2 
  <br>{"3:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 2 
  <br>{"3:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 3 
  <br>{"3:20220303":["1:20220202","1:20220202","2:20220202","3:20220303","3:20220303","3:20220303","3:20220303","1:20220303"]} 3 
 </blockquote> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">spark-sql&gt; desc test3_02;</code></pre> 
 <blockquote class="kdocs-blockquote" style="">
   content_group map&lt;string,array&lt;string&gt;&gt; NULL 
  <br>group_num int NULL 
 </blockquote> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b7cb7bab7ea92caa43ba93cc5e843f87/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">若依微服务版集成滑动验证码AJ-Captcha</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/16326f7c420f8533114096fed6aa0d49/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">win11和win10哪个好?</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>