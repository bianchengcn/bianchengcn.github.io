<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>项目记录:使用SpringBoot &#43; MyBatisPlus 在MySQL字段设置外键后ID自增失效导致添加失败问题(ID生成策略) - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="项目记录:使用SpringBoot &#43; MyBatisPlus 在MySQL字段设置外键后ID自增失效导致添加失败问题(ID生成策略)" />
<meta property="og:description" content="目录
说明
外键列设置后自增失效特性演示
ID不设置自增策略，报错问题和解决
设置自增策略冲突问题和解决。
说明 记录在使用SpringBoot &#43; MyBatisPlus操作数据库以及和前端页面交互时遇到的问题和解决方式。
1.表主键字段设置外键之后，自增功能失效问题。
2.PostMan测试传入json数据后台接收时报错argument type mismatch解决。
3.yml文件配置ID自增策略为auto后导致表外键自增列添加失败问题解决。
外键列设置后自增失效特性演示 现有表 tab_student_info 和表 tab_login_info，两个表的字段：
tab_student_info-学生信息表
tab_login_info-登录信息表
登录信息表的ID设置外键映射学生信息表的ID。
给登录信息表添加记录，ID字段设置为null，查看ID是否会自增。
INSERT INTO tab_login_info VALUES(NULL,&#39;123456&#39;) 执行该SQL语句，会报如下错误：
1452 - Cannot add or update a child row: a foreign key constraint fails (`xingshang`.`tab_login_info`, CONSTRAINT `fk_logininfo_stuinfo_id` FOREIGN KEY (`id`) REFERENCES `tab_student_info` (`id`)) 大概意思就是：该条记录无法添加或更新，因为存在外键约束。
因此就只能在添加记录时，显示的声明ID了，如下：
INSERT INTO tab_login_info VALUES(7,&#39;123456&#39;) 添加成功： Affected rows: 1
ID不设置自增策略，报错问题和解决 用SpringBoot&#43;MyBatisPlus 在写好表现层接口后，使用PostMan测试接口的新增记录方法:save()
获取PostMan传入的对应实体类的json数据，报错:argument type mismatch解决。
表现层接口代码：
@RestController //加入Bean 使用REST风格 响应数据 @RequestMapping(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/9a18e0fa7dcaab94e63879f092bf4048/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-01T21:14:21+08:00" />
<meta property="article:modified_time" content="2023-02-01T21:14:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">项目记录:使用SpringBoot &#43; MyBatisPlus 在MySQL字段设置外键后ID自增失效导致添加失败问题(ID生成策略)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"><a href="#" rel="nofollow">说明</a></p> 
<p id="%E5%A4%96%E9%94%AE%E5%88%97%E8%AE%BE%E7%BD%AE%E5%90%8E%E8%87%AA%E5%A2%9E%E5%A4%B1%E6%95%88%E7%89%B9%E6%80%A7%E6%BC%94%E7%A4%BA-toc" style="margin-left:0px;"><a href="#%E5%A4%96%E9%94%AE%E5%88%97%E8%AE%BE%E7%BD%AE%E5%90%8E%E8%87%AA%E5%A2%9E%E5%A4%B1%E6%95%88%E7%89%B9%E6%80%A7%E6%BC%94%E7%A4%BA" rel="nofollow">外键列设置后自增失效特性演示</a></p> 
<p id="ID%E4%B8%8D%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%A2%9E%E7%AD%96%E7%95%A5%EF%BC%8C%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3-toc" style="margin-left:0px;"><a href="#ID%E4%B8%8D%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%A2%9E%E7%AD%96%E7%95%A5%EF%BC%8C%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3" rel="nofollow">ID不设置自增策略，报错问题和解决</a></p> 
<p id="%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%A2%9E%E7%AD%96%E7%95%A5%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E3%80%82-toc" style="margin-left:0px;"><a href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%A2%9E%E7%AD%96%E7%95%A5%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E3%80%82" rel="nofollow">设置自增策略冲突问题和解决。</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2>说明</h2> 
<p>记录在使用SpringBoot + MyBatisPlus操作数据库以及和前端页面交互时遇到的问题和解决方式。</p> 
<p>1.表主键字段设置外键之后，自增功能失效问题。</p> 
<p>2.PostMan测试传入json数据后台接收时报错argument type mismatch解决。</p> 
<p>3.yml文件配置ID自增策略为auto后导致表外键自增列添加失败问题解决。</p> 
<h2></h2> 
<h2 id="%E5%A4%96%E9%94%AE%E5%88%97%E8%AE%BE%E7%BD%AE%E5%90%8E%E8%87%AA%E5%A2%9E%E5%A4%B1%E6%95%88%E7%89%B9%E6%80%A7%E6%BC%94%E7%A4%BA">外键列设置后自增失效特性演示</h2> 
<p>现有表 <strong>tab_student_info</strong> 和表 <strong>tab_login_info</strong>，两个表的字段<strong>：</strong></p> 
<p><strong><span style="background-color:#d4e9d5;">tab_student_info-学生信息表</span></strong></p> 
<p><img alt="" height="291" src="https://images2.imgbox.com/68/5e/VMi1ohiU_o.png" width="981"></p> 
<p><span style="background-color:#d4e9d5;">  </span><strong><span style="background-color:#d4e9d5;">tab_login_info-登录信息表</span></strong></p> 
<p><img alt="" height="120" src="https://images2.imgbox.com/0e/2d/NO3mkHB5_o.png" width="1055"></p> 
<blockquote> 
 <p>登录信息表的ID设置外键映射学生信息表的ID。</p> 
</blockquote> 
<p>给登录信息表添加记录，ID字段设置为null，查看ID是否会自增。</p> 
<pre><code class="language-sql">INSERT INTO tab_login_info VALUES(NULL,'123456')</code></pre> 
<p>执行该SQL语句，会报如下错误：</p> 
<pre><code class="language-sql">1452 - Cannot add or update a child row: a foreign key constraint fails (`xingshang`.`tab_login_info`, CONSTRAINT `fk_logininfo_stuinfo_id` FOREIGN KEY (`id`) REFERENCES `tab_student_info` (`id`))</code></pre> 
<p>大概意思就是：该条记录无法添加或更新，因为存在外键约束。</p> 
<p>因此就只能在添加记录时，显示的声明ID了，如下：</p> 
<pre><code class="language-sql">INSERT INTO tab_login_info VALUES(7,'123456')</code></pre> 
<blockquote> 
 <p> 添加成功： Affected rows: 1</p> 
</blockquote> 
<h2 id="ID%E4%B8%8D%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%A2%9E%E7%AD%96%E7%95%A5%EF%BC%8C%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3">ID不设置自增策略，报错问题和解决</h2> 
<p>用SpringBoot+MyBatisPlus 在写好表现层接口后，使用PostMan测试接口的新增记录方法:<strong>save()</strong></p> 
<p>获取PostMan传入的对应实体类的json数据，报错:argument type mismatch解决。</p> 
<p><strong><span style="background-color:#fbd4d0;">表现层接口代码：</span></strong></p> 
<pre><code class="language-java">@RestController   //加入Bean 使用REST风格 响应数据
@RequestMapping("/students")
public class StudentInfoController {

    @Autowired
    private StudentInfoService stuService;

    @PostMapping(produces = "application/json;charset=UTF-8")
    public Result AddStudentInfo(@RequestBody StudentInfo studentInfo){ //自动将前端json数据转为我们自定的实体类对象
        boolean save = stuService.save(studentInfo);
        Result r = new Result(true,"添加成功"); //前后端数据联调(自定义Result类)
        return r;
    }
}</code></pre> 
<p><strong><span style="background-color:#fbd4d0;">PostMan测试</span></strong></p> 
<p><img alt="" height="449" src="https://images2.imgbox.com/ee/57/2gIEaAuM_o.png" width="1130"></p> 
<p> PostMan发送请求之后，报错：argument type mismatch （ERROR 23828）</p> 
<p>翻译来说是：参数类型不匹配，指向是(StudentInfoController.java:25)，一看是save()报错，</p> 
<p>开始以为是save()参数有问题，检查save()的参数要求为StudentInfo对象，打印来看(@RequestBody StudentInfo studentInfo)中接收的参数也是会自己转为StudentInfo对象。</p> 
<p>并不是这个问题，思考是否是StudentInfo类中字段类型问题。</p> 
<p><strong>解决</strong>：yml配置文件设置ID自增策略后解决报错。</p> 
<p><img alt="" height="225" src="https://images2.imgbox.com/8c/d4/KYvdnJyV_o.png" width="775"></p> 
<p>设置自增策略后添加成功。 </p> 
<p> <img alt="" height="144" src="https://images2.imgbox.com/4a/54/LatjgzlW_o.png" width="478"></p> 
<blockquote> 
 <p><strong>说明：</strong></p> 
 <p>虽然这个表现层添加了，但是我们测试一下login表对应的表现层，结果是会报错的。</p> 
 <p>因为login表的ID存在外键约束，此博客的最上方已经说明了外键约束后ID自增会失效的问题，设置了外键约束的ID主键列只能显示的输入ID进行记录的添加。</p> 
</blockquote> 
<p><span style="background-color:#d4e9d5;">PostMan页面：</span></p> 
<p><img alt="" height="748" src="https://images2.imgbox.com/a8/dd/CAYpq3oQ_o.png" width="1113"></p> 
<p><span style="background-color:#d4e9d5;"> 发送请求报错：</span></p> 
<p> 不管ID是null还是指定ID，都会报错：</p> 
<pre><code class="language-java">java.sql.SQLIntegrityConstraintViolationException: Cannot add or update a child row: a foreign key constraint fails......</code></pre> 
<p><strong>报错解决方案如下</strong>  </p> 
<h2 id="%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%A2%9E%E7%AD%96%E7%95%A5%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E3%80%82">设置自增策略冲突问题和解决。</h2> 
<p>上方报错，报错信息是外键约束导致报错，因为我们想设置ID自增，在yml文件中设置了</p> 
<p>id-type: auto，配置文件范围是全局的。导致我们设置了外键的login表ID字段添加记录时报错，所以思路就是全局ID还是使用自增策略，设置了外键的字段设置为用户自定义输入策略即可。</p> 
<p><strong>实际解决方式</strong>：</p> 
<p>在外键属性添加注解：@TableId(type = IdType.INPUT)，单独设置字段的输入策略。</p> 
<pre><code class="language-java">@Data
@AllArgsConstructor
@NoArgsConstructor
public class LoginInfo {

    /**
     * 学生学号
     */
    @TableId(type = IdType.INPUT)
    private Integer id;

    /**
     * 登录密码
     */
    @TableField(select = false)
    private String password;

}</code></pre> 
<p>设置后，未设置外键的字段ID可以使用表自增的策略，而设置有外键的ID字段，也可以实现ID的显示赋值，报错解决。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a4b068d59d653f4c32e156c3c48edec1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[iHooya]2023年1月31日作业解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e8f0285d0d3ee7364b3ee4bf4d5d4adb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【iHooya】2023年2月1日作业解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>