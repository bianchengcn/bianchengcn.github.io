<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【STM32】贪吃蛇小游戏 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【STM32】贪吃蛇小游戏" />
<meta property="og:description" content="这是一个几个星期之前的小项目，参考修改了一下网上和正点原子的例程。
点击下载源码
功能：贪吃蛇小游戏
单片机：stm32f103c8t6
用到的硬件资源：
1.LED指示灯
2.矩阵键盘
3.OLED模块
4.通用定时器
软件设计：
1.矩阵键盘（中断方式）前面文章有介绍
2.定时器中断：用于更新游戏界面
3.贪吃蛇设计：
OLED的像素点是128*64的，为了可以显示清晰，在这里把游戏的点坐标映射为32x12（map【32】【12】），每个坐标占用16个像素点，前16行像素点用于显示分数。
#define MAXLENGTH 100 //蛇的最大长度 int map[32][12]={0};//地图大小 x,y（一个坐标为4*4个像素点） 实际按4倍尺寸放大后地图大小为128*48个像素点 int score; //分数 bool eated=false; //蛇吃到食物的标记 extern u8 KeyValue; //获取按键值 struct { int snake_Grid[MAXLENGTH][2]; //二维数组，行坐标表示蛇节点，列表示当前节点的x，y坐标 int length; //蛇的长度 int direction;//蛇的方向 }snake; //定义结构体变量snake 清除界面函数
void GUI_Clear(int map[32][12])//界面清除 { int i,j; for(i=0;i&lt;32;i&#43;&#43;) { for(j=0;j&lt;12;j&#43;&#43;) { map[i][j]=0; } } } 创建地图函数：填充游戏界面的边界坐标，并将边界坐标的值存入map数组
void Creat_map(int map[32][12])//创建地图 { int i,j; for(i=0;i&lt;12;i&#43;&#43;) { for(j=0;j&lt;32;j&#43;&#43;) { if(i==0||i==11) { map[j][i]=-2; } if(j==0||j==31) { map[j][i]=-2; } } } } 绘制地图函数：用画点函数将坐标绘出来，y坐标&#43;16是因为前16行用来显示分数，16行以后为游戏界面" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/e75c7d5154f14354ff21800aae65f3cb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-02T13:01:17+08:00" />
<meta property="article:modified_time" content="2020-09-02T13:01:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【STM32】贪吃蛇小游戏</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>这是一个几个星期之前的小项目，参考修改了一下网上和正点原子的例程。<br> <a href="https://download.csdn.net/download/yechongbinbin/12795629">点击下载源码</a></p> 
<p><strong>功能：贪吃蛇小游戏<br> 单片机：stm32f103c8t6</strong></p> 
<img src="https://images2.imgbox.com/3a/bf/U8OsXDTq_o.png" width="70%"> 
<img src="https://images2.imgbox.com/5a/0d/mIx5iSQt_o.png" width="70%"> 
<img src="https://images2.imgbox.com/13/7f/xvm0wyuD_o.png" width="70%"> 
<img src="https://images2.imgbox.com/0b/94/3vAEWW2Z_o.png" width="70%"> 
<p><strong>用到的硬件资源：<br> 1.LED指示灯<br> 2.矩阵键盘<br> 3.OLED模块<br> 4.通用定时器</strong></p> 
<img src="https://images2.imgbox.com/9c/4b/NDPfvw4L_o.png" width="70%"> 
<hr> 
<p><strong>软件设计：<br> 1.矩阵键盘（中断方式）前面文章有介绍<br> 2.定时器中断：用于更新游戏界面<br> 3.贪吃蛇设计：</strong></p> 
<p>OLED的像素点是128*64的，为了可以显示清晰，在这里把游戏的点坐标映射为32x12（map【32】【12】），每个坐标占用16个像素点，前16行像素点用于显示分数。<br> <img src="https://images2.imgbox.com/87/d3/UjQ3RNFW_o.png"></p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">define</span> MAXLENGTH  100    </span><span class="token comment">//蛇的最大长度</span>
<span class="token keyword">int</span> map<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//地图大小  x,y（一个坐标为4*4个像素点）     实际按4倍尺寸放大后地图大小为128*48个像素点</span>
<span class="token keyword">int</span> score<span class="token punctuation">;</span>            <span class="token comment">//分数</span>
bool eated<span class="token operator">=</span>false<span class="token punctuation">;</span>      <span class="token comment">//蛇吃到食物的标记</span>
<span class="token keyword">extern</span> u8 KeyValue<span class="token punctuation">;</span>        <span class="token comment">//获取按键值</span>
<span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>       
<span class="token keyword">int</span> snake_Grid<span class="token punctuation">[</span>MAXLENGTH<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">//二维数组，行坐标表示蛇节点，列表示当前节点的x，y坐标</span>
<span class="token keyword">int</span> length<span class="token punctuation">;</span>    <span class="token comment">//蛇的长度</span>
<span class="token keyword">int</span> direction<span class="token punctuation">;</span><span class="token comment">//蛇的方向</span>
<span class="token punctuation">}</span>snake<span class="token punctuation">;</span>                          <span class="token comment">//定义结构体变量snake</span>
</code></pre> 
<p>清除界面函数</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">GUI_Clear</span><span class="token punctuation">(</span><span class="token keyword">int</span> map<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//界面清除</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">32</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">12</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
          map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>创建地图函数：填充游戏界面的边界坐标，并将边界坐标的值存入map数组<br> <img src="https://images2.imgbox.com/e6/8c/3REudfgU_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Creat_map</span><span class="token punctuation">(</span><span class="token keyword">int</span> map<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//创建地图</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">12</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">32</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
  		 <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>i<span class="token operator">==</span><span class="token number">11</span><span class="token punctuation">)</span>
		 <span class="token punctuation">{<!-- --></span>
		   map<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
		 <span class="token punctuation">}</span>
		 <span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>j<span class="token operator">==</span><span class="token number">31</span><span class="token punctuation">)</span>
		 <span class="token punctuation">{<!-- --></span>
		   map<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
		 <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>绘制地图函数：用画点函数将坐标绘出来，y坐标+16是因为前16行用来显示分数，16行以后为游戏界面<br> <img src="https://images2.imgbox.com/c2/7f/ZqQrZfEe_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Paint_Map</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token comment">//绘制地图点坐标</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>     
	<span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
	  <span class="token punctuation">{<!-- --></span>
		    <span class="token function">OLED_DrawPoint</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	  <span class="token punctuation">}</span>
	
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>绘制蛇头坐标函数：<br> <img src="https://images2.imgbox.com/68/dd/jBEssO7Z_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Paint_Head</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y <span class="token punctuation">)</span><span class="token comment">//绘制蛇头点坐标</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>     
	<span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
	  <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token operator">||</span>i<span class="token operator">==</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			
			 <span class="token function">OLED_DrawPoint</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
			
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">==</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token operator">||</span>j<span class="token operator">==</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			
			 <span class="token function">OLED_DrawPoint</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
		
		<span class="token punctuation">}</span>
	  <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>绘制食物坐标函数：<br> <img src="https://images2.imgbox.com/ab/c3/Rphc07D7_o.png" alt=""></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Paint_Food</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y <span class="token punctuation">)</span><span class="token comment">//绘制食物点坐标</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>     
	<span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
	  <span class="token punctuation">{<!-- --></span>
		
	   <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token operator">||</span>i<span class="token operator">==</span><span class="token number">4</span><span class="token operator">*</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			
			 <span class="token function">OLED_DrawPoint</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
			
		<span class="token punctuation">}</span>
	   <span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">==</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token operator">||</span>j<span class="token operator">==</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			
			 <span class="token function">OLED_DrawPoint</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
		
		<span class="token punctuation">}</span> 
	  <span class="token punctuation">}</span>
	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>刷新界面函数：根据map数组里面的值一次性刷新游戏界面内的点坐标</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">GUI_Refresh</span><span class="token punctuation">(</span><span class="token keyword">int</span> map<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//界面刷新</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>temp<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">32</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>                 
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">12</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
		   temp<span class="token operator">=</span>map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">switch</span> <span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
		 <span class="token punctuation">{<!-- --></span>
			 <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>		          
			   <span class="token function">Paint_Body</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>  
		          <span class="token keyword">break</span><span class="token punctuation">;</span>
			 <span class="token keyword">case</span>  <span class="token number">1</span><span class="token punctuation">:</span>		   
		       <span class="token function">Paint_Head</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>  
		          <span class="token keyword">break</span><span class="token punctuation">;</span>
			 <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>		   
		       <span class="token function">Paint_Map</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>  
		          <span class="token keyword">break</span><span class="token punctuation">;</span>
			 <span class="token keyword">case</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>		   
		       <span class="token function">Paint_Food</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>  
		          <span class="token keyword">break</span><span class="token punctuation">;</span>
			 <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>		   
		       <span class="token function">Paint_Clean</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>  
		    	  <span class="token keyword">break</span><span class="token punctuation">;</span>
	   <span class="token punctuation">}</span>		   
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">OLED_Refresh_Gram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>初始化蛇和地图函数：初定蛇长度为5、方向向右、蛇头坐标位于（7，5）</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Snake_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//蛇及地图初始化</span>
<span class="token punctuation">{<!-- --></span>  
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
   snake<span class="token punctuation">.</span>length<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
   snake<span class="token punctuation">.</span>direction<span class="token operator">=</span>RIGHT<span class="token punctuation">;</span>
   score<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//x坐标,蛇头坐标</span>
   snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">//y坐标,蛇头坐标</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>snake<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>i<span class="token punctuation">;</span>
        snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//给刚开始的蛇身几个初始坐标</span>
    <span class="token punctuation">}</span>
    <span class="token function">Creat_map</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>画蛇函数：将二维数组snake.snake_Grid里面的各个蛇坐标的值存入map数组</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">drawSnake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">//画蛇</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">;</span>
	<span class="token comment">//蛇头</span>
		x<span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		y<span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        map<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token comment">//蛇身</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>snake<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
		x<span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		y<span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        map<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>       
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>按键处理函数：自定义矩形键盘值控制蛇的方向</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Get_Command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//获取键盘值</span>
<span class="token punctuation">{<!-- --></span>
	u8 key<span class="token punctuation">;</span>
	key<span class="token operator">=</span>KeyValue<span class="token punctuation">;</span>	
		<span class="token keyword">switch</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">case</span> <span class="token number">5</span><span class="token punctuation">:</span><span class="token keyword">if</span><span class="token punctuation">(</span>snake<span class="token punctuation">.</span>direction<span class="token operator">!=</span>RIGHT<span class="token punctuation">)</span>         <span class="token comment">//左</span>
                   snake<span class="token punctuation">.</span>direction<span class="token operator">=</span>LEFT<span class="token punctuation">;</span>			
                   <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token keyword">if</span><span class="token punctuation">(</span>snake<span class="token punctuation">.</span>direction<span class="token operator">!=</span>LEFT<span class="token punctuation">)</span>           <span class="token comment">//右</span>
                   snake<span class="token punctuation">.</span>direction<span class="token operator">=</span>RIGHT<span class="token punctuation">;</span>			
                   <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token keyword">if</span><span class="token punctuation">(</span>snake<span class="token punctuation">.</span>direction<span class="token operator">!=</span>DOWN<span class="token punctuation">)</span>        <span class="token comment">//上</span>
                   snake<span class="token punctuation">.</span>direction<span class="token operator">=</span>UP<span class="token punctuation">;</span>
                   <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">6</span><span class="token punctuation">:</span><span class="token keyword">if</span><span class="token punctuation">(</span>snake<span class="token punctuation">.</span>direction<span class="token operator">!=</span>UP<span class="token punctuation">)</span>         <span class="token comment">//下</span>
                   snake<span class="token punctuation">.</span>direction<span class="token operator">=</span>DOWN<span class="token punctuation">;</span>
                   <span class="token keyword">break</span><span class="token punctuation">;</span>		
		<span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>蛇的移动函数：蛇身移动就让其坐标等于前一个坐标的值，蛇头则根据蛇的方向就行移动</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//移动</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
	map<span class="token punctuation">[</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>snake<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>snake<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//清除尾巴</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>eated<span class="token punctuation">)</span>               <span class="token comment">//如果吃到了食物</span>
    <span class="token punctuation">{<!-- --></span>
        snake<span class="token punctuation">.</span>length<span class="token operator">++</span><span class="token punctuation">;</span>
        eated<span class="token operator">=</span>false<span class="token punctuation">;</span>        <span class="token comment">//设置为false，不然无限变长</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>snake<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>    <span class="token comment">//从尾巴开始，蛇身每一个点的位置等于它前面一个点的位置</span>
    <span class="token punctuation">{<!-- --></span>
        snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>snake<span class="token punctuation">.</span>direction<span class="token punctuation">)</span>       <span class="token comment">//根据蛇的方向处理蛇头坐标</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> UP<span class="token punctuation">:</span>
        snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> DOWN<span class="token punctuation">:</span>
        snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> LEFT<span class="token punctuation">:</span>
        snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> RIGHT<span class="token punctuation">:</span>
        snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>生成食物函数：在游戏界面内空位生成食物点坐标，并将食物坐标存入map数组</p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">Chek</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span><span class="token keyword">int</span> j<span class="token punctuation">)</span><span class="token comment">//检查地图空位</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">//是空位就返回1</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Food</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//生成食物</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{<!-- --></span>
		i<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                 <span class="token comment">//生成1~30之间的一个数</span>
        j<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                 <span class="token comment">//生成1~10之间的一个数</span>
	
	<span class="token punctuation">}</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">Chek</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//检查该点是否为空位</span>
	map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//画出食物</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>判断蛇吃食物：蛇吃到食物后通过eated标记状态（传递给move函数使蛇身+1）、分数+1、重新生成食物</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Eat_Food</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//吃食物</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//如果蛇头碰到食物，就重新投放食物，并且把食物点重置为0</span>
        <span class="token punctuation">{<!-- --></span>
            eated<span class="token operator">=</span>true<span class="token punctuation">;</span>            <span class="token comment">//标记已经吃到食物</span>
			score<span class="token operator">+</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">Food</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">[</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//去掉食物</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>判断游戏是否结束：</p> 
<pre><code class="prism language-c">bool <span class="token function">GameOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//游戏结束</span>
<span class="token punctuation">{<!-- --></span>
	bool isGameOver<span class="token operator">=</span>false<span class="token punctuation">;</span>
	<span class="token keyword">int</span> sx<span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>sy<span class="token operator">=</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>i<span class="token punctuation">;</span><span class="token comment">//蛇头坐标</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>snake<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token comment">//判断有没有吃到自己</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>sx<span class="token operator">&amp;&amp;</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>sy<span class="token punctuation">)</span>
            isGameOver<span class="token operator">=</span>true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">31</span><span class="token operator">||</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span> \
		snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">11</span><span class="token operator">||</span>snake<span class="token punctuation">.</span>snake_Grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment">//判断有没有撞墙</span>
		isGameOver<span class="token operator">=</span>true<span class="token punctuation">;</span>
    <span class="token keyword">return</span> isGameOver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>显示分数：</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Show_Score</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//显示分数</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Score:"</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">OLED_ShowNum</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>定时器中断：TIM4_Int_Init(4999,7199);//500ms，使用通用定时器进行游戏刷新，如果想增加控制蛇前进速度的功能可以通过修改定时器初始化函数实现。</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">TIM4_Int_Init</span><span class="token punctuation">(</span>u16 arr<span class="token punctuation">,</span>u16 psc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure<span class="token punctuation">;</span>
	NVIC_InitTypeDef NVIC_InitStructure<span class="token punctuation">;</span>

	<span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_TIM4<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//时钟使能</span>
	
	<span class="token comment">//定时器TIM4初始化</span>
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_Period <span class="token operator">=</span> arr<span class="token punctuation">;</span> <span class="token comment">//设置在下一个更新事件装入活动的自动重装载寄存器周期的值	</span>
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_Prescaler <span class="token operator">=</span>psc<span class="token punctuation">;</span> <span class="token comment">//设置用来作为TIMx时钟频率除数的预分频值</span>
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_ClockDivision <span class="token operator">=</span> TIM_CKD_DIV1<span class="token punctuation">;</span> <span class="token comment">//设置时钟分割:TDTS = Tck_tim</span>
	TIM_TimeBaseStructure<span class="token punctuation">.</span>TIM_CounterMode <span class="token operator">=</span> TIM_CounterMode_Up<span class="token punctuation">;</span>  <span class="token comment">//TIM向上计数模式</span>
	<span class="token function">TIM_TimeBaseInit</span><span class="token punctuation">(</span>TIM4<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TIM_TimeBaseStructure<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//根据指定的参数初始化TIMx的时间基数单位</span>
 
	<span class="token function">TIM_ITConfig</span><span class="token punctuation">(</span>TIM4<span class="token punctuation">,</span>TIM_IT_Update<span class="token punctuation">,</span>ENABLE <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使能指定的TIM3中断,允许更新中断</span>

	<span class="token comment">//中断优先级NVIC设置</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span> TIM4_IRQn<span class="token punctuation">;</span>  <span class="token comment">//TIM4中断</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelPreemptionPriority <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//先占优先级0级</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelSubPriority <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">//从优先级3级</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span> <span class="token comment">//IRQ通道被使能</span>
	<span class="token function">NVIC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NVIC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//初始化NVIC寄存器</span>


	<span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>TIM4<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//使能TIMx					 </span>
<span class="token punctuation">}</span>
<span class="token comment">//定时器4中断服务程序</span>
<span class="token keyword">void</span> <span class="token function">TIM4_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>   <span class="token comment">//TIM4中断</span>
<span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">TIM_GetITStatus</span><span class="token punctuation">(</span>TIM4<span class="token punctuation">,</span> TIM_IT_Update<span class="token punctuation">)</span> <span class="token operator">!=</span> RESET<span class="token punctuation">)</span>  <span class="token comment">//检查TIM3更新中断发生与否</span>
		<span class="token punctuation">{<!-- --></span>
		 <span class="token function">TIM_ClearITPendingBit</span><span class="token punctuation">(</span>TIM4<span class="token punctuation">,</span> TIM_IT_Update  <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//清除TIMx更新中断标志</span>
		 <span class="token function">Move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 <span class="token function">Eat_Food</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 <span class="token function">drawSnake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>若大家要下载源码可以留言邮箱（因为资源那里设置了0C币发现过几天会自动升价）。还有其他建议，欢迎交流沟通呀！！！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/07e07092fe992995013826db5f928a64/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于esp32默认事件循环  默认WiFi事件注册和获取事件信息</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6191e9c9db2e84d44f0a40249f819035/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">五分钟做一个简单的响应式Godot GUI</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>