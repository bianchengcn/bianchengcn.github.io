<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>element-ui el-table中根据按钮的多少来计算操作栏的宽度以及根据显示按钮的数量动态计算是否需要展示更多 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="element-ui el-table中根据按钮的多少来计算操作栏的宽度以及根据显示按钮的数量动态计算是否需要展示更多" />
<meta property="og:description" content="因为当前行的某些状态或者操作权限，每一行的操作按钮可能展示的数量不同。
所以我们需要找出当前table页,按钮最多的那一行row，并计算出这个row中操作栏的所需宽度，用这个宽度来设置最后一列操作栏的宽度
columnWidth.js
export default { data() { return { minWidth: 100 } }, watch: { minWidth() { this.setWidth() } }, methods: { setWidth() { if (this.headerData) { this.$set(this.headerData[this.headerData.length - 1], &#39;width&#39;, this.minWidth) } }, // 获取列表数据后，调用此方法 getTextWidth(ref) { const trArr = [] const operateTd = [] const buttonNumArr = [] let isContainMore = false // 是否含有&#39;更多&#39;按钮，因为‘更多’后面有个尖括号 this.$nextTick(() =&gt; { // 获取当前table的所有tr let tr = [] if (ref &amp;&amp; this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c7bcfaa57cabc1556f080f4df561cb38/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-29T17:43:07+08:00" />
<meta property="article:modified_time" content="2024-01-29T17:43:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">element-ui el-table中根据按钮的多少来计算操作栏的宽度以及根据显示按钮的数量动态计算是否需要展示更多</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>因为当前行的某些状态或者操作权限，每一行的操作按钮可能展示的数量不同。</p> 
 <p>所以我们需要找出当前table页,按钮最多的那一行row，并计算出这个row中操作栏的所需宽度，用这个宽度来设置最后一列操作栏的宽度</p> 
</blockquote> 
<p><img alt="" height="260" src="https://images2.imgbox.com/8a/95/KpHGiUWL_o.png" width="1200"> </p> 
<p>columnWidth.js</p> 
<pre><code class="language-javascript">
export default {
  data() {
    return {
      minWidth: 100
    }
  },
  watch: {
    minWidth() {
      this.setWidth()
    }
  },
  methods: {
    setWidth() {
      if (this.headerData) {
        this.$set(this.headerData[this.headerData.length - 1], 'width', this.minWidth)
      }
    },
    // 获取列表数据后，调用此方法
    getTextWidth(ref) {
      const trArr = []
      const operateTd = []
      const buttonNumArr = []
      let isContainMore = false // 是否含有'更多'按钮，因为‘更多’后面有个尖括号
      this.$nextTick(() =&gt; {
        // 获取当前table的所有tr
        let tr = []
        if (ref &amp;&amp; this.$refs[ref]) {
          tr = this.$refs[ref].$el.querySelectorAll('tbody tr')
        } else {
          tr = document.querySelectorAll('tbody tr')
        }
        // console.log(tr)
        if (tr.length) {
          tr.forEach((item, index) =&gt; {
            const t = trArr.find(t =&gt; t.rowIndex === item.rowIndex)
            if (!t) trArr.push(item)
          })
        }
        // 获取每一行tr中操作栏的按钮数量（操作栏在最后一列）
        trArr.forEach(item =&gt; {
          const span = document.createElement('span')
          span.classList.add('getColumnWidth')
          const td = item.querySelector('td:last-child .cell')
          const allSpan = td.querySelectorAll('span')
          const textArr = []// 存放每一行的按钮文字
          // console.log(btns.length)
          allSpan.forEach(b =&gt; {
            if (b.innerHTML) {
              const str = b.innerHTML + ''
              const text = str.replace(/&lt;[^&gt;]+&gt;/g, '')
              if (text.indexOf('更多') !== -1) {
                isContainMore = true
              }
              if (textArr.indexOf(text) === -1) {
                textArr.push(text)
              }
            }
          })
          buttonNumArr.push(textArr.length)
          // const cloneTd = btns.cloneNode(true)
          if (td) {
            span.innerHTML = textArr.join(',')

            // span.appendChild(cloneTd)
            document.body.appendChild(span)
            operateTd.push(span.offsetWidth)

            document.querySelector('.getColumnWidth').remove()
          }
        })
        // 获取长度最大的操作栏
        const width = Math.max(...operateTd)
        // 获取按钮数量最多的操作栏
        const buttonNum = Math.max(...buttonNumArr)
        if (buttonNumArr.length &lt; 1 || width &lt; 29) {
          this.minWidth = 63
        } else {
          let base = 35
          if (isContainMore) {
            base = base + 12
          }
          this.minWidth = width + (buttonNum - 1) * 10 + base
        }
      })
    }
  }
}
</code></pre> 
<p> buttonGroup.vue 【按钮组件】</p> 
<pre><code class="language-html">&lt;template&gt;
  &lt;div&gt;
    &lt;el-button v-for="item in list" :key="item.label" type="text" @click="btnClick(item.row,item.funcMethod)"&gt;{<!-- -->{ item.label }}&lt;/el-button&gt;
    &lt;el-dropdown v-if="extraList.length&gt;0"&gt;
      &lt;el-button type="text"&gt;
        更多&lt;i class="el-icon-arrow-down el-icon--right" /&gt;
      &lt;/el-button&gt;
      &lt;el-dropdown-menu slot="dropdown"&gt;
        &lt;el-dropdown-item v-for="item in extraList" :key="item.label" @click.native="btnClick(item.row,item.funcMethod)"&gt;{<!-- -->{ item.label }}&lt;/el-dropdown-item&gt;
      &lt;/el-dropdown-menu&gt;
    &lt;/el-dropdown&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  props: {
    btnGroup: {
      type: Array,
      default: () =&gt; []
    }
  },
  data() {
    return {
      btnNumber: 3,
      list: [],
      extraList: []
    }
  },
  watch: {
    btnGroup: {
      immediate: true,
      deep: true,
      handler(val) {
        if (val &amp;&amp; val.length) {
          const result = val.filter(item =&gt; {
            return !item.hide
          })
          if (result.length === this.btnNumber) {
            this.list = result.slice(0, this.btnNumber)
            this.extraList = []
          } else if (result.length &gt;= this.btnNumber + 1) {
            this.list = result.slice(0, this.btnNumber - 1)
            this.extraList = result.slice(this.btnNumber - 1)
          } else {
            this.list = result
            this.extraList = []
          }
        }
      }
    }
  },
  methods: {
    btnClick(row, funcMethod) {
      this.$emit('clickTableBtn', { row, funcMethod })
    }
  }
}
&lt;/script&gt;
&lt;style lang="scss"&gt;
.el-button + .el-dropdown{
    margin-left: 7px;
}
&lt;/style&gt;
</code></pre> 
<p>tablePage.vue 【代码没抄全。但是主要代码都在】</p> 
<pre><code class="language-javascript">&lt;template&gt;
  &lt;el-table
    :data="tableData"
    style="width: 100%"
    max-height="250"
  &gt;
    &lt;el-table-column
      fixed
      prop="date"
      label="日期"
    /&gt;
    &lt;el-table-column
      prop="name"
      label="姓名"
    /&gt;
    &lt;el-table-column
      prop="province"
      label="省份"
    /&gt;
    &lt;el-table-column
      prop="city"
      label="市区"
      width="120"
    /&gt;
    &lt;el-table-column
      prop="address"
      label="地址"
    /&gt;
    &lt;el-table-column
      prop="zip"
      label="邮编"
    /&gt;
    &lt;el-table-column
      fixed="right"
      label="操作"
      :width="minWidth"
    &gt;
      &lt;template slot-scope="{row}"&gt;
        &lt;buttonGroup
          :btn-group="dealGroup(row)"
          @clickTableBtn="clickTableBtn"
        /&gt;
        &lt;!-- &lt;el-button
          type="text"
          size="small"
          @click.native.prevent="deleteRow(scope.$index, tableData)"
        &gt;
          移除
        &lt;/el-button&gt; --&gt;
      &lt;/template&gt;
    &lt;/el-table-column&gt;
  &lt;/el-table&gt;
&lt;/template&gt;

&lt;script&gt;
import columnWidth from '@/mixins/columnWidth'
import buttonGroup from './buttonGroup.vue'
export default {
  components: {
    buttonGroup
  },
  mixins: [columnWidth],
  data() {
    return {
      tableData: []
    }
  },
  created() {
    this.getDataList()
  },
  mounted() {

  },
  methods: {
    dealGroup(row) {
      return [
        {
          'label': '编辑',
          'type': 'primary',
          'hide': row.name !== '王小虎1',
          'row': row,
          'funcMethod': 'edit'
        },
        {
          'label': '查看',
          'row': row,
          'funcMethod': 'see'
        },
        {
          'label': '解锁',
          'type': 'danger',
          'hide': !this.$hasPermission('UNLOCK_TASK'),
          'row': row,
          'funcMethod': 'unlock'
        },
        {
          'label': '取消',
          'type': 'danger',
          'hide': !this.$hasPermission('CANCLE_TASK'),
          'row': row,
          'funcMethod': 'cancel'
        }
      ]
    },
    getDataList() {
      this.tableData = [{
        date: '2016-05-03',
        name: '王小虎1',
        province: '上海',
        city: '普陀区',
        address: '上海市普陀区金沙江路 1518 弄',
        zip: 200333
      }, {
        date: '2016-05-02',
        name: '王小虎2',
        province: '上海',
        city: '普陀区',
        address: '上海市普陀区金沙江路 1518 弄',
        zip: 200333
      }, {
        date: '2016-05-04',
        name: '王小虎3',
        province: '上海',
        city: '普陀区',
        address: '上海市普陀区金沙江路 1518 弄',
        zip: 200333
      }, {
        date: '2016-05-01',
        name: '王小虎4',
        province: '上海',
        city: '普陀区',
        address: '上海市普陀区金沙江路 1518 弄',
        zip: 200333
      }, {
        date: '2016-05-08',
        name: '王小虎5',
        province: '上海',
        city: '普陀区',
        address: '上海市普陀区金沙江路 1518 弄',
        zip: 200333
      }, {
        date: '2016-05-06',
        name: '王小虎6',
        province: '上海',
        city: '普陀区',
        address: '上海市普陀区金沙江路 1518 弄',
        zip: 200333
      }, {
        date: '2016-05-07',
        name: '王小虎7',
        province: '上海',
        city: '普陀区',
        address: '上海市普陀区金沙江路 1518 弄',
        zip: 200333
      }]
      this.getTextWidth()
    },
    edit(row) {
      console.log('bianji', row)
    },
    see(row) {
      console.log('see', row)
    },
    unlock(row) {
      console.log('unlock', row)
    },
    cancel(row) {
      console.log('cancel', row)
    },
    clickTableBtn(data) {
      this[data.funcMethod](data.row)
    },
    deleteRow(index, rows) {
      rows.splice(index, 1)
    }
  }
}
&lt;/script&gt;
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac54e3cc191a7b0f9f4f89bf9a62c196/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信小程序 全局变量键值对map对象</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/192e1e2ce47f90d2efc5e373826ad35d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【论文阅读|半监督小苹果检测方法S3AD】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>