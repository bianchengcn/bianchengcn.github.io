<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HM学习心得3 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HM学习心得3" />
<meta property="og:description" content="测试结果的保存、批处理及数据处理
一.测试结果的单一保存
这些天跑了一些程序，发现按照原始状态的话，得到的结果没法保存。刚开始只是跑着玩玩，认为只要把结果截图下来，然后进行处理。后来发现，这样的做法对测试一两个序列还是可以接受的，但当自已在测试多个序列时，工作量实在太大了，浪费了好多时间。于是，就想怎样使测试结果自已保存起来？网上搜了一下，发现了一个函数“freopen”,可以简单的实现测试结果的保存。即，将测试输出直接转化为TXT，保存在工程目录下（与生成解决方案同一路径）。语句具体使用如下：将freopen(&#34;filemane.txt&#34;,&#34;w&#34;,stdout)。将这条语句放在主函数（encmain.cpp）所有打印输出的语句之前（如图1所示），就能实现测试结果的TXT保存。
图1
二.批处理
但后来又发现了一个问题，不仅要测试多个序列而且同一个序列的不同QP（量化参数）也要进行测试，每测试完一个序列的一个QP，就要更改命令参数、QP等设置，非常麻烦。于是，在高人的指导下，了解到了——批处理，就能轻松解决这个问题。具体操作如下：
首先在工程目录下（与生成解决方案同一路径）创建一个TXT文本，在里面输入编码器的可执行文件名，两个配置文件名及保存的文件名，格式如图2所示。图2所示是在QP为37、32、27、22下，执行BasketballDrill这个测试序列，并将其分别保存为BasketballDrill_q37等。
图2
将所有要测试的序列及改变QP后的配置文件同行输入 ，然后保存。
再将该TXT文件的后缀名改为.bat。最后，要将序列的配置文件与不同QP的配置文件同时复制到工程目录下（与生成解决方案同一路径）。如图3所示。图3中encoder_intra_main_qp22.cfg\
encoder_intra_main_qp27.cfg\encoder_intra_main_qp32.cfg\encoder_intra_main_qp37.cfg,这四个文件为不同QP下的配置文件。
图3
在编码器的“属性”-&gt;“调试”-&gt;&#34;命令参数&#34;一栏中，只要输入.bat文件的第一行的配置文件即可。如图4所示：
图4
测试的时候双击该.bat文件即可。
如果要修改该.bat文件，右击选择“编辑”即可。
有一点要注意的是，当程序改动一次，编码器的可执行文件要重新生成一次。
三.数据处理
当大量的序列测试结束后，数据的处理也是一件很费时间的活。幸好在一H265交流群上下到了一个好东西，小软件的名字叫“HMResultHelper.exe”。只要把测试结果的TXT文件放到与该软件同一文件夹下（图5所示），然后双击该软件（或许称为一个可执行文件更好），就能得到一个“HMResults.txt”的文件。该文件包含所有TXT的名称，BR(码率)、PSNR-Y、PSNR-U、PSNR-V、ET(编码时间)总结输入在另一个TXT文件中（图6所示）。现在，只要把所有的同类数据对齐，导入到excel中，就能很快的对数据进行处理了。
图5
图6
图6中，每一行的数据为：第一个为文件名（如BasketballDrill_qp22.txt）,第二个为码率，第三个为PSNR-Y,第四个为PSNR-U，第五个为PSNR-V，第六个为编码时间。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/f3089bd74cc3b596a7ad0d959d91804a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-08-02T23:09:44+08:00" />
<meta property="article:modified_time" content="2014-08-02T23:09:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HM学习心得3</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p align="center"><strong><span style="font-size:18px">测试结果的保存、批处理及数据处理</span></strong></p> 
<p align="left"><strong><span style="font-size:18px">一.测试结果的单一保存</span></strong></p> 
<p align="left"><strong><span style="font-size:18px">这些天跑了一些程序，发现按照原始状态的话，得到的结果没法保存。刚开始只是跑着玩玩，认为只要把结果截图下来，然后进行处理。后来发现，这样的做法对测试一两个序列还是可以接受的，但当自已在测试多个序列时，工作量实在太大了，浪费了好多时间。于是，就想怎样使测试结果自已保存起来？网上搜了一下，发现了一个函数“freopen”,可以简单的实现测试结果的保存。即，将测试输出直接转化为TXT，保存在工程目录下（与生成解决方案同一路径）。语句<strong><span style="font-size:18px">具体</span></strong>使用如下：将freopen("filemane.txt","w",stdout)。将这条语句放在主函数（encmain.cpp）所有打印输出的语句之前（如图1所示），就能实现测试结果的TXT保存。</span></strong></p> 
<p align="center"><img src="https://images2.imgbox.com/81/bc/dM7PWBaE_o.png" alt=""></p> 
<p align="center">图1</p> 
<p align="left"><strong><span style="font-size:18px">二.批处理</span></strong></p> 
<p align="left"><strong><span style="font-size:18px">但后来又发现了一个问题，不仅要测试多个序列而且同一个序列的不同QP（量化参数）也要进行测试，每测试完一个序列的一个QP，就要更改命令参数、QP等设置，非常麻烦。于是，在高人的指导下，了解到了——批处理，就能轻松解决这个问题。具体操作如下：</span></strong></p> 
<p align="left"><strong><span style="font-size:18px">首先<strong><span style="font-size:18px">在工程目录下（与生成解决方案同一路径）创建一个TXT文本，在里面输入编码器的可执行文件名，两个配置文件名及保存的文件名，格式如图2所示。图2所示是在QP为37、32、27、22下，执行BasketballDrill这个测试序列，并将其分别保存为<strong><span style="font-size:18px">BasketballDrill_q37等。</span></strong></span></strong></span></strong></p> 
<p align="center"><img src="https://images2.imgbox.com/f3/5c/XCDQfBR5_o.png" alt=""></p> 
<p align="center">图2</p> 
<p align="left"><strong><span style="font-size:18px"><strong><span style="font-size:18px">将所有要测试的序列及改变QP后的配置文件同行输入 ，然后保存。</span></strong></span></strong></p> 
<p align="left"><strong><span style="font-size:18px"><strong><span style="font-size:18px">再将该TXT文件的后缀名改为.bat。最后，要将序列的配置文件与不同QP的配置文件同时复制到<strong><span style="font-size:18px">工程目录下（与生成解决方案同一路径）。如图3所示。图3中encoder_intra_main_qp22.cfg\</span></strong></span></strong></span></strong></p> 
<p align="left"><strong><font size="4"><strong><span style="font-size:18px"><strong><span style="font-size:18px"><strong><span style="font-size:18px">encoder_intra_main_qp27.cfg\</span></strong></span></strong></span></strong></font><font size="4"><strong><font size="4"><strong><font size="4"><strong><span style="font-size:18px"><strong><span style="font-size:18px">encoder_intra_main_qp32.cfg\<strong><span style="font-size:18px">encoder_intra_main_qp37.cfg,这四个文件为不同QP下的配置文件。</span></strong></span></strong></span></strong></font></strong></font></strong></font></strong></p> 
<p align="center"><img src="https://images2.imgbox.com/58/45/TMhGQQ1d_o.png" alt=""></p> 
<p align="center">图3</p> 
<p align="left"><span style="font-size:14px"><strong>在编码器的“属性”-&gt;“调试”-&gt;"命令参数"一栏中，只要输入.bat文件的第一行的配置文件即可。如图4所示：</strong></span></p> 
<p align="center"><img src="https://images2.imgbox.com/bb/3c/FZsTCDVB_o.png" alt=""></p> 
<p align="center">图4</p> 
<p align="left"><strong><span style="font-size:18px"><strong><span style="font-size:18px">测试的时候双击该.bat文件即可。</span></strong></span></strong></p> 
<p align="left"><strong><span style="font-size:18px"><strong><span style="font-size:18px">如果要修改该<strong><span style="font-size:18px">.bat文件，右击选择“编辑”即可。</span></strong></span></strong></span></strong></p> 
<p align="left"><strong><font size="4"><strong><span style="font-size:18px"><span style="color:#ff0000">有一点要注意的是，当程序改动一次，<strong><span style="font-size:18px">编码器的可执行文件要重新生成一次。</span></strong></span></span></strong></font></strong></p> 
<p align="left"><strong><span style="font-size:18px">三.数据处理</span></strong></p> 
<p align="left"><strong><span style="font-size:18px">当大量的序列测试结束后，数据的处理也是一件很费时间的活。幸好在一H265交流群上下到了一个好东西，小软件的名字叫“HMResultHelper.exe”。只要把测试结果的TXT文件放到与该软件同一文件夹下（图5所示），然后双击该软件（或许称为一个可执行文件更好），就能得到一个“HMResults.txt”的文件。该文件包含所有TXT的名称，BR(码率)、PSNR-Y、PSNR-U、PSNR-V、ET(编码时间)总结输入在另一个TXT文件中（图6所示）。现在，只要把所有的同类数据对齐，导入到excel中，就能很快的对数据进行处理了。</span></strong></p> 
<p align="center"><img src="https://images2.imgbox.com/26/b7/EyFZPy5V_o.png" alt=""></p> 
<p align="center">图5</p> 
<p align="left"> </p> 
<p align="left"> </p> 
<p align="center"><img src="https://images2.imgbox.com/2c/04/rzC9s6m0_o.png" width="952" height="211" alt=""></p> 
<p align="center">图6</p> 
<p align="left">图6中，每一行的数据为：第一个为文件名（如BasketballDrill_qp22.txt）,第二个为码率，第三个为PSNR-Y,第四个为PSNR-U，第五个为PSNR-V，第六个为编码时间。</p> 
<p align="left"><strong><span style="font-size:18px"></span></strong> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d6a9eeeb47bda920ac10685f071db38d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java学习笔记之使用MyEclipse写一个简单的登陆界面（二）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/00a6fc2d1afcd590f6bc0448b80ab0bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vim跳到指定行</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>