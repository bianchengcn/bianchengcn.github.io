<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>typescript在react中的使用配置详解 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="typescript在react中的使用配置详解" />
<meta property="og:description" content="1 环境 $ npx create-react-app test --typescript 2 function组件 props 一般类型 interface IProps{ param_1: string param_2: number param_3: boolean param_4: string[] param_5?: number[] ...... } function App(props:IProps) { return null } 类型为function组件 import React from &#39;react&#39;; interface ITest { name: string } function Test({ name }: ITest) { return &lt;span&gt;{name}&lt;/span&gt; } function App({ TestComponent }: { TestComponent: React.FC&lt;ITest&gt; }) { return &lt;TestComponent name={&#39;xxx&#39;} /&gt; } export default function () { return &lt;App TestComponent={Test} /&gt; } 类型为class组件 import React from &#39;react&#39;; interface IProps { age: number } interface IState { name: string } class Test extends React." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/13f6f9d9ab2fd888604671282968a60f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-24T11:02:04+08:00" />
<meta property="article:modified_time" content="2021-02-24T11:02:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">typescript在react中的使用配置详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1%09_1"></a>1 环境</h2> 
<pre><code class="prism language-powershell">$ npx create<span class="token operator">-</span>react<span class="token operator">-</span>app test <span class="token operator">--</span>typescript
</code></pre> 
<h2><a id="2%09function_7"></a>2 function组件</h2> 
<h3><a id="props_9"></a>props</h3> 
<h4><a id="_11"></a>一般类型</h4> 
<pre><code class="prism language-tsx">interface IProps{
    param_1: string
    param_2: number
    param_3: boolean
    param_4: string[]
    param_5?: number[]
    ......
}

function App(props:IProps) {
    return null
}
</code></pre> 
<h4><a id="function_28"></a>类型为function组件</h4> 
<pre><code class="prism language-tsx">import React from 'react';

interface ITest {  name: string }

function Test({ name }: ITest) {
  return &lt;span&gt;{name}&lt;/span&gt;
}

function App({ TestComponent }: { TestComponent: React.FC&lt;ITest&gt; }) {
  return  &lt;TestComponent name={'xxx'} /&gt;
}

export default function () {
  return &lt;App
    TestComponent={Test}
  /&gt;
}
</code></pre> 
<h4><a id="class_50"></a>类型为class组件</h4> 
<pre><code class="prism language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{<!-- --></span>  age<span class="token punctuation">:</span> number  <span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">IState</span> <span class="token punctuation">{<!-- --></span>  name<span class="token punctuation">:</span> string  <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token operator">&lt;</span>IProps<span class="token punctuation">,</span> IState<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>

  state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> name<span class="token punctuation">:</span> <span class="token string">'林'</span> <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>age<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> TestComponent <span class="token punctuation">}</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>  TestComponent<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ComponentType<span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>TestComponent age<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">18</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>App
    TestComponent<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>Test<span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="useReducer_78"></a>useReducer</h3> 
<pre><code class="prism language-ts"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> useReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> Action <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'setOpen'</span><span class="token punctuation">;</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>open<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'setName'</span><span class="token punctuation">;</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">IInit</span> <span class="token punctuation">{<!-- --></span>
  open<span class="token punctuation">:</span> <span class="token builtin">boolean</span>
  name<span class="token punctuation">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> init<span class="token punctuation">:</span> IInit <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'1'</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">myReducer</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> IInit<span class="token punctuation">,</span> action<span class="token punctuation">:</span> Action<span class="token punctuation">)</span><span class="token punctuation">:</span> IInit <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token string">'setOpen'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token operator">...</span>data<span class="token punctuation">,</span><span class="token operator">...</span>action<span class="token punctuation">.</span>data<span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'setName'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token operator">...</span>data<span class="token punctuation">,</span><span class="token operator">...</span>action<span class="token punctuation">.</span>data<span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>myReducer<span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>state<span class="token punctuation">.</span>open <span class="token operator">?</span> <span class="token string">'open为true'</span> <span class="token punctuation">:</span> <span class="token string">'open为false'</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>open<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'setOpen'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> open<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'setOpen'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> open<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        切换open
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'setName'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> name<span class="token punctuation">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        切换flag
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="useRef_142"></a>useRef</h3> 
<pre><code class="prism language-tsx">import React, { useRef, MutableRefObject } from 'react';
import Child from './Child';

function Father() {

  const h1Ref = useRef() as MutableRefObject&lt;HTMLHeadingElement&gt;;
  const divRef = useRef() as MutableRefObject&lt;HTMLDivElement&gt;;
  const ulRef = useRef() as MutableRefObject&lt;HTMLUListElement&gt;;

  return (
    &lt;&gt;
      &lt;h1 ref={h1Ref}&gt;&lt;/h1&gt;
      &lt;div ref={divRef}&gt;&lt;/div&gt;
      &lt;ul ref={ulRef}&gt;&lt;/ul&gt;
      &lt;canvas&gt;&lt;/canvas&gt;
    &lt;/&gt;
  )
}

export default Father;
</code></pre> 
<h3><a id="useImperativeHandle_167"></a>useImperativeHandle</h3> 
<pre><code class="prism language-tsx">import React, { useImperativeHandle } from 'react';

export interface IChildHandler {
    speak: () =&gt; void
}

interface IChildProps { name?: string }

const Child = React.forwardRef&lt;IChildHandler, IChildProps&gt;(({ name }, ref) =&gt; {

    useImperativeHandle(ref, () =&gt; ({
        speak() {
            console.log('访问到组件里的内容了')
        }
    }))

    return null;
});

export default Child;
</code></pre> 
<h3><a id="useRef__useImperativeHandle_192"></a>useRef | useImperativeHandle</h3> 
<pre><code class="prism language-tsx">import React, { useRef, MutableRefObject, useCallback } from 'react';
import Child, { IChildHandler } from './Child';

function Father() {

  const childRef = useRef() as MutableRefObject&lt;IChildHandler&gt;;

  return &lt;&gt;
    &lt;Child ref={childRef} /&gt;
    &lt;button onClick={
      useCallback(() =&gt; {
        childRef.current.speak();
      }, [])
    }&gt;
      触发child中的speak
    &lt;/button&gt;
  &lt;/&gt;
}

export default Father;
</code></pre> 
<h3><a id="useContext_217"></a>useContext</h3> 
<ul><li>context.ts</li></ul> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IContext</span> <span class="token punctuation">{<!-- --></span>
  name<span class="token punctuation">:</span> string 
  obj<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    age<span class="token punctuation">:</span> number
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> createContext<span class="token operator">&lt;</span>Partial<span class="token operator">&lt;</span>IContext<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>Father.tsx</li></ul> 
<pre><code class="prism language-tsx">import MyContext from './context';

function Father() {
  return (
    &lt;MyContext.Provider value={<!-- -->{ name: '林', obj: { age: 18 } }}&gt;
      &lt;Child /&gt;
    &lt;/MyContext.Provider &gt;
  )
}
</code></pre> 
<ul><li>Child.tsx</li></ul> 
<pre><code class="prism language-tsx">import MyContext, { IContext } from './context';

function Child() {

  const { name, obj } = useContext(MyContext) as IContext;

  return &lt;span&gt;{name}-{obj.age}&lt;/span&gt;
}
</code></pre> 
<h2><a id="3%09redux_261"></a>3 redux</h2> 
<p>官方例子 https://redux.js.org/recipes/usage-with-typescript</p> 
<pre><code class="prism language-powershell">$ yarn add react<span class="token operator">-</span>redux redux  @types<span class="token operator">/</span>react<span class="token operator">-</span>redux
</code></pre> 
<h3><a id="30%09_269"></a>3.0 基础文件</h3> 
<h4><a id="301%09storelogintypets_271"></a>3.0.1 store/login/type.ts</h4> 
<pre><code class="prism language-ts"><span class="token comment">// src/store/login/type.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> <span class="token constant">SET_LOGIN</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> LoginState <span class="token operator">=</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>   <span class="token comment">// 定义登陆状态的数据类型</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UpdateLogin</span> <span class="token punctuation">{<!-- --></span>    <span class="token comment">// 定义登陆状态的action</span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token keyword">typeof</span> <span class="token constant">SET_LOGIN</span>
  payload<span class="token punctuation">:</span> LoginState
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="302%09storeloginindexts_286"></a>3.0.2 store/login/index.ts</h4> 
<pre><code class="prism language-ts"><span class="token comment">// src/store/login/index.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> LoginState<span class="token punctuation">,</span> UpdateLogin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./type'</span><span class="token punctuation">;</span>

<span class="token comment">// Key</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SET_LOGIN</span> <span class="token operator">=</span> <span class="token string">'SET_LOGIN'</span><span class="token punctuation">;</span>

<span class="token comment">// initalValue</span>
<span class="token keyword">const</span> initialState<span class="token punctuation">:</span> LoginState <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">// 是否已经登陆</span>

<span class="token comment">// Action</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">updateLoginState</span><span class="token punctuation">(</span>newLoginState<span class="token punctuation">:</span> LoginState<span class="token punctuation">)</span><span class="token punctuation">:</span> UpdateLogin <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">SET_LOGIN</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">:</span> newLoginState
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Reducer</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token punctuation">:</span> UpdateLogin<span class="token punctuation">)</span><span class="token punctuation">:</span> LoginState <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token constant">SET_LOGIN</span><span class="token punctuation">:</span> <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="303%09storechattypets_316"></a>3.0.3 store/chat/type.ts</h4> 
<pre><code class="prism language-ts"><span class="token comment">// src/store/chat/type.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> <span class="token constant">SEND_MESSAGE</span><span class="token punctuation">,</span> <span class="token constant">DELETE_MESSAGE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Message</span> <span class="token punctuation">{<!-- --></span>
  user<span class="token punctuation">:</span> <span class="token builtin">string</span>
  message<span class="token punctuation">:</span> <span class="token builtin">string</span>
  timestamp<span class="token punctuation">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ChatState</span> <span class="token punctuation">{<!-- --></span>
  messages<span class="token punctuation">:</span> Message<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">SendMessageAction</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token keyword">typeof</span> <span class="token constant">SEND_MESSAGE</span>
  newMessage<span class="token punctuation">:</span> Message
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">DeleteMessageAction</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token keyword">typeof</span> <span class="token constant">DELETE_MESSAGE</span>
  timestamp<span class="token punctuation">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> ChatActionTypes <span class="token operator">=</span> SendMessageAction <span class="token operator">|</span> DeleteMessageAction
</code></pre> 
<h4><a id="304%09storechatindexts_345"></a>3.0.4 store/chat/index.ts</h4> 
<pre><code class="prism language-ts"><span class="token comment">// src/store/chat/index.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ChatActionTypes<span class="token punctuation">,</span> ChatState<span class="token punctuation">,</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./type'</span><span class="token punctuation">;</span>

<span class="token comment">// Key</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SEND_MESSAGE</span> <span class="token operator">=</span> <span class="token string">'SEND_MESSAGE'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">DELETE_MESSAGE</span> <span class="token operator">=</span> <span class="token string">'DELETE_MESSAGE'</span>

<span class="token comment">// initalValue</span>
<span class="token keyword">const</span> initialState<span class="token punctuation">:</span> ChatState <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> messages<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>

<span class="token comment">// Action</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span>newMessage<span class="token punctuation">:</span> Message<span class="token punctuation">)</span><span class="token punctuation">:</span> ChatActionTypes <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">SEND_MESSAGE</span><span class="token punctuation">,</span> newMessage <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">deleteMessage</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ChatActionTypes <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">DELETE_MESSAGE</span><span class="token punctuation">,</span> timestamp <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Reducer</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  state <span class="token operator">=</span> initialState<span class="token punctuation">,</span>
  action<span class="token punctuation">:</span> ChatActionTypes
<span class="token punctuation">)</span><span class="token punctuation">:</span> ChatState <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token constant">SEND_MESSAGE</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> messages<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>messages<span class="token punctuation">,</span> action<span class="token punctuation">.</span>newMessage<span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token constant">DELETE_MESSAGE</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        messages<span class="token punctuation">:</span> state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
          message <span class="token operator">=&gt;</span> message<span class="token punctuation">.</span>timestamp <span class="token operator">!==</span> action<span class="token punctuation">.</span>timestamp
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="305%09storeindexts_388"></a>3.0.5 store/index.ts</h4> 
<pre><code class="prism language-ts"><span class="token comment">// src/store/index.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> combineReducers<span class="token punctuation">,</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> loginRefucer <span class="token keyword">from</span> <span class="token string">'./login'</span>
<span class="token keyword">import</span> chatReducer <span class="token keyword">from</span> <span class="token string">'./chat'</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  login<span class="token punctuation">:</span> loginRefucer<span class="token punctuation">,</span>
  chat<span class="token punctuation">:</span> chatReducer
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> RootState <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> rootReducer<span class="token operator">&gt;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="306%09indextsx_407"></a>3.0.6 index.tsx</h4> 
<pre><code class="prism language-tsx">import React from 'react';
import ReactDOM from 'react-dom';
import { Provider } from 'react-redux';
import store from './store/index';
import Child from './child'

function Father() {
  return (
    &lt;Provider store={store}&gt;
      &lt;Child /&gt;
    &lt;/Provider&gt;
  )
}

ReactDOM.render(&lt;Father /&gt;, document.getElementById('root'));
</code></pre> 
<h3><a id="31%09hooks_427"></a>3.1 hooks</h3> 
<h4><a id="311%09useSelector_429"></a>3.1.1 useSelector</h4> 
<pre><code class="prism language-tsx">import React from 'react';
import { Provider, useSelector, useStore, useDispatch } from 'react-redux';
import store, { RootState } from './store/index'

function Child() {

  const loginState = useSelector((state: RootState) =&gt; state.login);

  return &lt;span&gt;现在的登陆状态为：{loginState ? '已登陆' : '未登陆'}&lt;/span&gt;
}
</code></pre> 
<h4><a id="312%09useDispatch_444"></a>3.1.2 useDispatch</h4> 
<ul><li>store/index.ts</li></ul> 
<pre><code class="prism language-ts"><span class="token keyword">export</span> <span class="token keyword">type</span> AppDispatch <span class="token operator">=</span> <span class="token keyword">typeof</span> store<span class="token punctuation">.</span>dispatch<span class="token punctuation">;</span>
</code></pre> 
<ul><li>index.tsx</li></ul> 
<pre><code class="prism language-tsx">....
import store, { RootState, AppDispatch } from './store/index'


function Child(){
    
    const dispatch: AppDispatch = useDispatch();
    
    useEffect(()=&gt;{
        dispatch({ type: 'SET_LOGIN', payload: true });
	},[])
    
    return null
}
</code></pre> 
<h2><a id="4%09tsjs_471"></a>4 ts中使用js</h2> 
<h3><a id="41%09js_473"></a>4.1 导入js组件</h3> 
<p>如果在ts项目中导入js写的库，因为没有类型的描述文件就会报错</p> 
<p><img src="https://images2.imgbox.com/5b/da/NyUwKCay_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a7/81/EKQGA1RF_o.png" alt="在这里插入图片描述"></p> 
<p>这是因为这个库过于老旧或者官方没有为其编写类型文件，解决这个方法之一，就是在 tsconfig.josn 中添加下面一行配置</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
	<span class="token operator">...</span><span class="token operator">...</span>
    <span class="token string">"noImplicitAny"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>现在再编译就不会报错了，虽然不会报错，但是引入的库后面会显示这几个小点点，表示ts的编译器不知道其类型，相当于any<br> <img src="https://images2.imgbox.com/22/07/KjebIFbG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="42%09_497"></a>4.2 安装别人写好的声明文件</h3> 
<p>先把 <code>noImplicitAny</code> 改为<code>true</code>, 还记得上面的提示吗，<code>webpack</code>让 我们 安装 <code>@types/react-fastclick</code>，这是因为 ts 为了让一些用js写成的库在ts环境下能正常访问，所以如果 这个库的声明文件在 源码目录下找不到，会去 <code>node_modules</code> 的 <code>@types</code> 目录下查找相关的声明文件</p> 
<p>这个目录下一般是官方不想使用 ts 重写一遍代码，所以直接的写一遍类型文件</p> 
<p>或者为这个库的爱好者为其官方书写的类型文件<br> <img src="https://images2.imgbox.com/90/bb/2R9BOijx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="42%09dts_507"></a>4.2 自定义d.ts</h3> 
<p>但是我们通过安装发现，并没有 <code>@types/react-fastclick</code> 这个库，说明没有人为其书写类型声明文件，那我们可以自己的为其书写声明文件</p> 
<ul><li>项目/tsconfig.json</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"compilerOptions"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
	<span class="token operator">...</span><span class="token operator">...</span>
    <span class="token string">"baseUrl"</span><span class="token punctuation">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>
    <span class="token string">"paths"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"*"</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token string">"./node_modules/@tpyes"</span><span class="token punctuation">,</span>   <span class="token comment">// 声明文件先去node_modules/@tpyes下找</span>
        <span class="token string">"./typings/*"</span>    <span class="token comment">// 如果node_modules下找不到，就去这个文件夹下找</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>项目/typings/react-fastclick/index.d.ts</li></ul> 
<pre><code class="prism language-ts"><span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">fastClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> fastClick<span class="token punctuation">;</span>
</code></pre> 
<p>编写完成之后，就会发现 vscode 不会有三个小点了<br> <img src="https://images2.imgbox.com/6d/34/WqgTGtlG_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b7cbf4559003a8e7638160ab1b67aa3f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">利用Echarts制作不规则刻度的仪表盘图表示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/30675ec80d38d6ea30e73f584d4e7188/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java函数式编程FunctionalInterface报错：The target method is generic</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>