<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>确定包含全角和半角字符的字符串长度（VB） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="确定包含全角和半角字符的字符串长度（VB）" />
<meta property="og:description" content="确定包含全角和半角字符的字符串长度（VB）
各个版本的VB对汉字字符的长度定义并不相同。在Windows 3.x中，VB3中认为每个汉字的长度为2字节。VB自从32位版本以後，不管中英文字，均以2 bytes来储存，这与中文Win95的汉字内核有关。但是VB4以后，VB认为每个汉字的长度为1。这在处理包含汉字的字符串时带来很多的不便。
由于Len、Left、Mid等字符串函数认为一个汉字和一个西文字符的长度都为1，因此处理汉字字符串时有一定的难度。实现上必须要能把汉字按照两个字符(字节)的形式读出。因此在截取汉字字符串的子串时需特别注意。
由于汉字处理和汉字字模存储的特殊性，在许多情况下我们希望汉字字符的长度为2，英文字符为1。由于VB5和VB6把一个汉字作为一个字符。因此处理汉字时首先必须能正确判断汉字字符串的长度。
在VB3或C&#43;&#43;里，汉字的 ASCII码均大于零，而VB5和VB6中汉字的ASCII码小于0。因此通过判断一个未知字符的ASCII码就可以判断该字符是否汉字。
这里我们提供了两种方法来判断汉字字符串的长度。
1、方法1
VB6中提供了LenB函数用于字符串中的字节数据。如同在双字节字符集(DBCS)语言中一样，LenB返回的是用于代表字符串的字节数，而不是返回字符串中字符的数量。如为用户自定义类型，LenB返回在内存中的大小。
LenB(StrConv(Str1，vbFormUnicode))
对要处理的字符串Str1，必须先使用StrConv函数把ANSI格式的Byte数组转换为字符串，否则直接使用LenB函数得到的结果比实际结果大。
2、方法2
这里自定义了一个子函数CLen来计算汉字字符串的实际长度。同时还能判断字符串中汉字的实际个数。
Function CharacterLen(s_str As String) As Integer
Dim i_num As Integer
Dim i_index As Integer
Dim i_len As Integer
i_len = Len(s_str)
For i_index = 1 To i_len
If Asc(Mid(s_str, i_index, 1)) &lt; 0 Then
i_num = i_num &#43; 1
End If
Next
CharacterLen = i_len &#43; i_num
End Function
CharacterLen函数中的静态变量HzNum返回字符串中实际汉字的数目。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/3492139d4a9583ff559717ae2284de97/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2005-09-22T13:20:00+08:00" />
<meta property="article:modified_time" content="2005-09-22T13:20:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">确定包含全角和半角字符的字符串长度（VB）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>确定包含全角和半角字符的字符串长度（VB）</p> 
<p>         各个版本的VB对汉字字符的长度定义并不相同。在Windows 3.x中，VB3中认为每个汉字的长度为2字节。VB自从32位版本以後，不管中英文字，均以2 bytes来储存，这与中文Win95的汉字内核有关。但是VB4以后，VB认为每个汉字的长度为1。这在处理包含汉字的字符串时带来很多的不便。<br><br>　　由于Len、Left、Mid等字符串函数认为一个汉字和一个西文字符的长度都为1，因此处理汉字字符串时有一定的难度。实现上必须要能把汉字按照两个字符(字节)的形式读出。因此在截取汉字字符串的子串时需特别注意。<br><br>　　由于汉字处理和汉字字模存储的特殊性，在许多情况下我们希望汉字字符的长度为2，英文字符为1。由于VB5和VB6把一个汉字作为一个字符。因此处理汉字时首先必须能正确判断汉字字符串的长度。<br><br>　　在VB3或C++里，汉字的 ASCII码均大于零，而VB5和VB6中汉字的ASCII码小于0。因此通过判断一个未知字符的ASCII码就可以判断该字符是否汉字。<br><br>　　这里我们提供了两种方法来判断汉字字符串的长度。<br><br>　　1、方法1<br><br>　　VB6中提供了LenB函数用于字符串中的字节数据。如同在双字节字符集(DBCS)语言中一样，LenB返回的是用于代表字符串的字节数，而不是返回字符串中字符的数量。如为用户自定义类型，LenB返回在内存中的大小。<br><br>　　LenB(StrConv(Str1，vbFormUnicode))<br><br>　　对要处理的字符串Str1，必须先使用StrConv函数把ANSI格式的Byte数组转换为字符串，否则直接使用LenB函数得到的结果比实际结果大。<br><br>　　2、方法2<br><br>　　这里自定义了一个子函数CLen来计算汉字字符串的实际长度。同时还能判断字符串中汉字的实际个数。<br><br>　　Function CharacterLen(s_str As String) As Integer</p> 
<p>            Dim i_num As Integer<br>            Dim i_index As Integer<br>            Dim i_len As Integer<br>    <br>            i_len = Len(s_str)</p> 
<p>            For i_index = 1 To i_len<br>    <br>                If Asc(Mid(s_str, i_index, 1)) &lt; 0 Then<br>                    i_num = i_num + 1<br>                End If</p> 
<p>            Next</p> 
<p>            CharacterLen = i_len + i_num</p> 
<p>    End Function</p> 
<p><br>　CharacterLen函数中的静态变量HzNum返回字符串中实际汉字的数目。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dbcd4d98b57ca6472b03571abc96e4ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">datepart函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>