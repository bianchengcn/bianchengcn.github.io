<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>hive内置UDTF函数 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="hive内置UDTF函数" />
<meta property="og:description" content="explode函数：hive内置的表生成函数，主要用于将一行输入拆分成多行输出。 官网解释：explode() takes in an array (or a map) as an input and outputs the elements of the array (map) as separate rows. UDTFs can be used in the SELECT expression list and as a part of LATERAL VIEW. ①创建array数据类型表 hive&gt; create table student_array( &gt; name string, &gt; course_score array&lt;string&gt; &gt; ) &gt; row format delimited fields terminated by &#39;\t&#39; &gt; collection items terminated by &#39;,&#39; &gt; stored as textfile; ②准备数据student_array." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/292aa522f581a7a2df63e857a770444b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-08-20T12:09:02+08:00" />
<meta property="article:modified_time" content="2017-08-20T12:09:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">hive内置UDTF函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <ul><li>explode函数：hive内置的表生成函数，主要用于将一行输入拆分成多行输出。</li></ul> 
<div>
  官网解释：explode() takes in an array (or a map) as an input and outputs the elements of the array (map) as separate rows. UDTFs can be used in the SELECT expression list and as a part of LATERAL VIEW. 
</div> 
<div>
  ①创建array数据类型表 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; create table student_array(
    &gt; name string,
    &gt; course_score array&lt;string&gt;
    &gt; )
    &gt; row format delimited fields terminated by '\t'
    &gt; collection items terminated by ','
    &gt; stored as textfile;
</code></pre>②准备数据student_array.txt 
</div> 
<div> 
 <pre><code class="language-sql">root@Master:/home/hadoop/dataset# cat student_array.txt
zs	语文:86,数学:87.5,英语:90
ls	语文:76,数学:93,英语:88
ww	语文:88,数学:90,英语:95
</code></pre>③将数据导入到hive表 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; load data local inpath '/home/hadoop/dataset/student_array.txt' overwrite into table student_array;
</code></pre>④查看hive表数据 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; select * from student_array;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
zs	["语文:86","数学:87.5","英语:90"]
ls	["语文:76","数学:93","英语:88"]
ww	["语文:88","数学:90","英语:95"]
</code></pre>对于array数据类型，explode函数将数组中的元素拆分，按行输出每个元素 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; select explode(course_score) from student_array;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
语文:86
数学:87.5
英语:90
语文:76
数学:93
英语:88
语文:88
数学:90
英语:95</code></pre>posexplode函数类似于explode函数，只是在返回数组中的元素同时也返回元素在数组中的索引位置 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; select posexplode(course_score)   from  student_array;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
0	语文:86
1	数学:87.5
2	英语:90
0	语文:76
1	数学:93
2	英语:88
0	语文:88
1	数学:90
2	英语:95
</code></pre>对于map数据类型，explode函数会将一个map数据类型拆分成两列输出，键一列，值一列。 
</div> 
<div>
  首先创建带map的表 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; create table student_map(
    &gt; name string,
    &gt; course_score map&lt;string ,float&gt;
    &gt; )
    &gt; row format delimited fields terminated by '\t'
    &gt; collection items terminated by ','
    &gt; map keys terminated by ':'
    &gt; stored as textfile;
hive&gt; select * from student_map;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
zs	{"语文":86.0,"数学":87.5,"英语":90.0}
ls	{"语文":76.0,"数学":93.0,"英语":88.0}
ww	{"语文":88.0,"数学":90.0,"英语":95.0}
</code></pre>explode函数将map数据类型的数据键值对拆分长两列 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; select explode(course_score) from student_map;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
语文	86.0
数学	87.5
英语	90.0
语文	76.0
数学	93.0
英语	88.0
语文	88.0
数学	90.0
英语	95.0
</code></pre>posexplode函数的参数只能是数组，不能是map数据类型 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; select posexplode(course_score) from student_map;
FAILED: UDFArgumentException posexplode() takes an array as a parameter
</code></pre>对于结构体数组，可以使用inline函数进行拆分 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; select * from student_struct_array;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
zs	[{"course":"语文","score":86.0},{"course":"数学","score":87.5},{"course":"英语","score":90.0}]
ls	[{"course":"语文","score":76.0},{"course":"数学","score":93.0}]
ww	[{"course":"语文","score":88.0},{"course":"数学","score":90.0},{"course":"英语","score":95.0}]
Time taken: 0.19 seconds, Fetched: 3 row(s)
hive&gt; select inline(course_score) from student_struct_array;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
语文	86.0
数学	87.5
英语	90.0
语文	76.0
数学	93.0
语文	88.0
数学	90.0
英语	95.0
</code></pre>在select语句中使用UDTF语法的限制： 
</div> 
<div>
  ①在select语句中只支持单个UDTF表达式 
</div> 
<div>
  ②不支持UDTF嵌套 
</div> 
<div>
  ③不支持GROUP BY / CLUSTER BY / DISTRIBUTE BY / SORT BY语句 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; select explode(name) , explode(course_score) from student_array;
FAILED: SemanticException 1:23 Only a single expression in the SELECT clause is supported with UDTF's. Error encountered near token 'course_score'
hive&gt; select explode(name) , explode(course_score) from student_array;
FAILED: SemanticException 1:23 Only a single expression in the SELECT clause is supported with UDTF's. Error encountered near token 'course_score'
hive&gt; select name ,explode(course_score) from student_array;
FAILED: SemanticException [Error 10081]: UDTF's are not supported outside the SELECT clause, nor nested in expressions
hive&gt; select explode(course_score) from student_array sort by name;
FAILED: SemanticException [Error 10078]: SORT BY is not supported with a UDTF in the SELECT clause
</code></pre>explode函数和lateral view结合使用，就不存在上上语法限制 
</div> 
<div> 
 <pre><code class="language-sql">hive&gt; select name ,course ,score from student_struct_array  lateral view inline(course_score)  course_scores as course , score ;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
zs	语文	86.0
zs	数学	87.5
zs	英语	90.0
ls	语文	76.0
ls	数学	93.0
ww	语文	88.0
ww	数学	90.0
ww	英语	95.0
</code></pre> 
 <span style="font-family:Consolas,'Bitstream Vera Sans Mono','Courier New',Courier,monospace; font-size:14px; line-height:20px; white-space:nowrap"></span> 
 <div>
   lateral view outer 使用方法 
 </div> 
 <div> 
  <pre><code class="language-sql">hive&gt; select * from student_array lateral view outer explode(array())  c as a;
-chgrp: '*' does not match expected pattern for group
Usage: hadoop fs [generic options] -chgrp [-R] GROUP PATH...
OK
zs	["语文:86","数学:87.5","英语:90"]	NULL
ls	["语文:76","数学:93","英语:88"]	NULL
ww	["语文:88","数学:90","英语:95"]	NULL
Time taken: 0.166 seconds, Fetched: 3 row(s)
</code></pre> 
  <br> 
  <br> 
 </div> 
 <br> 
 <br> 
 <br> 
</div> 
<div> 
 <br> 
 <br> 
 <br> 
</div> 
<div> 
 <br> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/92fd9d6eae01156c3c09f39f63af4bd7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">javascript调用java方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9a806b4e5fcac780f3dce79c49466f32/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">table-layout属性fixed和auto的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>