<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>权限中心设计 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="权限中心设计" />
<meta property="og:description" content="目录 前言1. 权限模型1.1 RBAC0 模型1.2 RBAC1 模型1.3 RBAC2 模型1.4 RBAC3 模型1.5 用户组1.5.1 组织1.5.2 职位 1.6 含有组织 / 职位 / 用户组的模型 2. 授权流程3. 表结构4. 权限框架5. 结语 前言 权限管理是所有后台系统的都会涉及的一个重要组成部分，主要目的是对不同的人访问资源进行权限的控制，避免因权限控制缺失或操作不当引发的风险问题，如操作错误，隐私数据泄露等问题。
目前在公司负责权限这块, 所以对权限这块的设计比较熟悉, 公司采用微服务架构, 权限系统自然就独立出来了, 其他业务系统包括商品中心, 订单中心, 用户中心, 仓库系统, 小程序, 多个 APP 等十几个系统和终端
1. 权限模型 迄今为止最为普及的权限设计模型是 RBAC 模型, 基于角色的访问控制（Role-Based Access Control)
1.1 RBAC0 模型 RBAC0 模型如下:
以上是 RBAC 的核心设计及模型分析, 此模型也叫做 RBAC0, 而基于核心概念之上, RBAC 还提供了扩展模式。包括 RBAC1,RBAC2,RBAC3 模型。
下面介绍这三种类型
1.2 RBAC1 模型 此模型引入了角色继承 (Hierarchical Role) 概念，即角色具有上下级的关系，角色间的继承关系可分为一般继承关系和受限继承关系。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/09a8ea34fbd641eeaf83e9f43c6ebe2f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-22T14:32:10+08:00" />
<meta property="article:modified_time" content="2022-04-22T14:32:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">权限中心设计</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#1__7" rel="nofollow">1. 权限模型</a></li><li><ul><li><a href="#11_RBAC0__11" rel="nofollow">1.1 RBAC0 模型</a></li><li><a href="#12_RBAC1__17" rel="nofollow">1.2 RBAC1 模型</a></li><li><a href="#13_RBAC2__24" rel="nofollow">1.3 RBAC2 模型</a></li><li><a href="#14_RBAC3__38" rel="nofollow">1.4 RBAC3 模型</a></li><li><a href="#15__40" rel="nofollow">1.5 用户组</a></li><li><ul><li><a href="#151__55" rel="nofollow">1.5.1 组织</a></li><li><a href="#152__61" rel="nofollow">1.5.2 职位</a></li></ul> 
   </li><li><a href="#16______68" rel="nofollow">1.6 含有组织 / 职位 / 用户组的模型</a></li></ul> 
  </li><li><a href="#2__84" rel="nofollow">2. 授权流程</a></li><li><a href="#3__92" rel="nofollow">3. 表结构</a></li><li><a href="#4__95" rel="nofollow">4. 权限框架</a></li><li><a href="#5__100" rel="nofollow">5. 结语</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>权限管理是所有后台系统的都会涉及的一个重要组成部分，主要目的是对不同的人访问资源进行权限的控制，避免因权限控制缺失或操作不当引发的风险问题，如操作错误，隐私数据泄露等问题。</p> 
<p>目前在公司负责权限这块, 所以对权限这块的设计比较熟悉, 公司采用微服务架构, 权限系统自然就独立出来了, 其他业务系统包括商品中心, 订单中心, 用户中心, 仓库系统, 小程序, 多个 APP 等十几个系统和终端</p> 
<h2><a id="1__7"></a>1. 权限模型</h2> 
<p>迄今为止最为普及的权限设计模型是 RBAC 模型, <strong>基于角色的访问控制（Role-Based Access Control)</strong></p> 
<h3><a id="11_RBAC0__11"></a>1.1 RBAC0 模型</h3> 
<p>RBAC0 模型如下:<br> <img src="https://images2.imgbox.com/f0/dc/WdycSnjL_o.png" alt="在这里插入图片描述"><br> 以上是 RBAC 的核心设计及模型分析, 此模型也叫做 RBAC0, 而基于核心概念之上, RBAC 还提供了扩展模式。包括 RBAC1,RBAC2,RBAC3 模型。<br> 下面介绍这三种类型</p> 
<h3><a id="12_RBAC1__17"></a>1.2 RBAC1 模型</h3> 
<p><img src="https://images2.imgbox.com/96/83/dFcXC08O_o.png" alt="在这里插入图片描述"><br> 此模型引入了<strong>角色继承 (Hierarchical Role)</strong> 概念，即角色具有上下级的关系，角色间的继承关系可分为<strong>一般继承关系</strong>和<strong>受限继承关系</strong>。</p> 
<ul><li>一般继承关系仅要求角色继承关系是一个绝对偏序关系，允许角色间的多继承。</li><li>而受限继承关系则进一步要求角色继承关系是一个树结构，实现角色间的单继承。这种设计可以给角色分组和分层，一定程度简化了权限管理工作。</li></ul> 
<h3><a id="13_RBAC2__24"></a>1.3 RBAC2 模型</h3> 
<p>基于核心模型的基础上，进行了角色的约束控制，RBAC2 模型中添加了<strong>责任分离关系</strong>。</p> 
<p>其规定了权限被赋予角色时，或角色被赋予用户时，以及当用户在某一时刻激活一个角色时所应遵循的强制性规则。</p> 
<p>责任分离包括<strong>静态责任分离</strong>和<strong>动态责任分离</strong>。主要包括以下约束:</p> 
<ul><li><strong>互斥角色:</strong><br> 同一用户只能分配到一组互斥角色集合中至多一个角色，支持责任分离的原则。<br> 互斥角色是指各自权限互相制约的两个角色。比如财务部有会计和审核员两个角色, 他们是互斥角色, 那么用户不能同时拥有这两个角色, 体现了职责分离原则</li><li><strong>基数约束:</strong><br> 一个角色被分配的用户数量受限；一个用户可拥有的角色数目受限；同样一个角色对应的访问权限数目也应受限，以控制高级权限在系统中的分配</li><li><strong>先决条件角色:</strong><br> 即用户想获得某上级角色, 必须先获得其下一级的角色</li></ul> 
<h3><a id="14_RBAC3__38"></a>1.4 RBAC3 模型</h3> 
<p>即最全面的权限管理, 它是基于 RBAC0，将 RBAC1 和 RBAC2 进行了整合。</p> 
<h3><a id="15__40"></a>1.5 用户组</h3> 
<p>当平台用户基数增大，角色类型增多时，而且有一部分人具有相同的属性，比如财务部的所有员工，如果直接给用户分配角色，管理员的工作量就会很大。</p> 
<p>如果把相同属性的用户归类到某用户组，那么管理员直接给用户组分配角色，用户组里的每个用户即可拥有该角色，以后其他用户加入用户组后，即可自动获取用户组的所有角色，退出用户组，同时也撤销了用户组下的角色，无须管理员手动管理角色。</p> 
<p>根据用户组是否有上下级关系, 可以分为有上下级的用户组和普通用户组:</p> 
<ul><li><strong>具有上下级关系的用户组:</strong><br> 最典型的例子就是部门和职位，可能多数人没有把部门职位和用户组关联起来吧。<br> 当然用户组是可以拓展的，部门和职位常用于内部的管理系统，如果是面向 C 端的系统。<br> 比如淘宝网的商家，商家自身也有一套组织架构，比如采购部，销售部，客服部，后勤部等，有些人拥有客服权限，有些人拥有上架权限等等，所以用户组是可以拓展的</li><li><strong>普通用户组:</strong><br> 即没有上下级关系，和组织架构，职位都没有关系，也就是说可以跨部门，跨职位。<br> 举个例子，某电商后台管理系统，有拼团活动管理角色，我们可以设置一个拼团用户组，该组可以包括研发部的后台开发人员，运营部的运营人员，采购部的人员等等。</li></ul> 
<p>每个公司都会涉及到到组织和职位, 下面就重点介绍这两个。</p> 
<h4><a id="151__55"></a>1.5.1 组织</h4> 
<p>常见的组织架构如下图:<br> <img src="https://images2.imgbox.com/35/b6/GTWIApd0_o.png" alt="在这里插入图片描述"><br> 我们可以把组织与角色进行关联，用户加入组织后，就会自动获得该组织的全部角色，无须管理员手动授予，大大减少工作量，同时用户在调岗时，只需调整组织，角色即可批量调整。</p> 
<p>组织的另外一个作用是控制数据权限, 把角色关联到组织, 那么该角色只能看到该组织下的数据权限。</p> 
<h4><a id="152__61"></a>1.5.2 职位</h4> 
<p>假设财务部的职位如下图:<br> <img src="https://images2.imgbox.com/e9/e7/mg1pxTt4_o.png" alt="在这里插入图片描述"><br> 每个组织部门下都会有多个职位，比如财务部有总监，会计，出纳等职位，虽然都在同一部门，但是每个职位的权限是不同的，职位高的拥有更多的权限。</p> 
<p>总监拥有所有权限，会计和出纳拥有部分权限。特殊情况下, 一个人可能身兼多职。</p> 
<h3><a id="16______68"></a>1.6 含有组织 / 职位 / 用户组的模型</h3> 
<p>根据以上场景, 新的权限模型就可以设计出来了, 如下图:<br> <img src="https://images2.imgbox.com/e8/b9/rsrfzLHg_o.png" alt="在这里插入图片描述"><br> 根据系统的复杂度不同, 其中的多对多关系和一对一关系可能会有变化</p> 
<p>1、在单系统且用户类型单一的情况下，用户和组织是一对一关系，组织和职位是一对多关系，用户和职位是一对一关系，组织和角色是一对一关系，职位和角色是一对一关系，用户和用户组是多对对关系，用户组和角色是一对一关系，当然这些关系也可以根据具体业务进行调整。</p> 
<p>模型设计并不是死的, 如果小系统不需要用户组, 这块是可以去掉的。</p> 
<p>2、分布式系统且用户类型单一的情况下，到这里权限系统就会变得很复杂，这里就要引入了一个 “系统” 概念。</p> 
<p>3、此时系统架构是个分布式系统，权限系统独立出来，负责所有的系统的权限控制，其他业务系统比如商品中心，订单中心，用户中心，每个系统都有自己的角色和权限，那么权限系统就可以配置其他系统的角色和权限。</p> 
<p>4、分布式系统且用户类型多个的情况下，比如淘宝网，它的用户类型包括内部用户，商家，普通用户，内部用户登录多个后台管理系统，商家登录商家中心，这些做权限控制，如果你作为架构师，该如何来设计呢? 大神可以在评论区留言交流哦!</p> 
<h2><a id="2__84"></a>2. 授权流程</h2> 
<p>授权即给用户授予角色, 按流程可分为手动授权和审批授权。权限中心可同时配置这两种, 可提高授权的灵活性。<br> <strong>手动授权:</strong><br> 管理员登录权限中心为用户授权，根据在哪个页面授权分为两种方式：给用户添加角色，给角色添加用户。<br> 给用户添加角色就是在用户管理页面，点击某个用户去授予角色，可以一次为用户添加多个角色；给角色添加用户就是在角色管理页面，点击某个角色，选择多个用户，实现了给批量用户授予角色的目的。<br> <strong>审批授权:</strong><br> 即用户申请某个职位角色，那么用户通过 OA 流程申请该角色，然后由上级审批，该用户即可拥有该角色，不需要系统管理员手动授予。</p> 
<h2><a id="3__92"></a>3. 表结构</h2> 
<p>有了上述的权限模型, 设计表结构就不难了, 下面是多系统下的表结构, 简单设计下, 主要提供思路:<br> <img src="https://images2.imgbox.com/ea/38/DbULDBkh_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4__95"></a>4. 权限框架</h2> 
<p>Apache Shrio<br> Spring Security<br> 在项目中可以采用其中一种框架, 它们的优缺点以及如何使用会在后面的文章中详细介绍。</p> 
<h2><a id="5__100"></a>5. 结语</h2> 
<p>权限系统可以说是整个系统中最基础，同时也可以很复杂的，在实际项目中，会遇到多个系统，多个用户类型，多个使用场景，这就需要具体问题具体分析，但最核心的 RBAC 模型是不变的, 我们可以在其基础上进行扩展来满足需求。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a70c64a3bdfd6be281a4580905204261/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《啊哈算法》学习笔记（三）——最短路径</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/532980d5e25727daf1ceb631b8a04af7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">出现报错Object reference not set to an instance of an object</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>