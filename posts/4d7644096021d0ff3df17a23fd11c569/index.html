<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ASP 单文件上传无组件代码 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ASP 单文件上传无组件代码" />
<meta property="og:description" content="&lt;%@LANGUAGE=&#34;VBSCRIPT&#34; CODEPAGE=&#34;65001&#34;%&gt; &lt;% &#39;禁止缓存&#39; Response.CacheControl=&#34;no-cache&#34; Response.Expires=-1 Response.Charset=&#34;UTF-8&#34; &#39;配合第一行设定网页编码 if Request.TotalBytes then	&#39;如果上传文件非空&#39; set read_stream=createobject(&#34;adodb.stream&#34;)	&#39;设置一个流&#39; read_stream.Type=1	&#39;这个流读二进制数据，如果Type=2则读文本数据&#39; read_stream.Open	&#39;打开流&#39; read_stream.write Request.BinaryRead(Request.TotalBytes)	&#39;将表单传过来的二进制数据写入流read_stream&#39; &#39;将流read_stream的所有数据读到binary_stream中，binary_stream相当于一个临时变量，接下来将对binary_stream进行切割，以免污染read_stream中的原数据&#39; read_stream.Position=0 binary_stream=read_stream.Read enter=chrB(13)&amp;chrB(10)	&#39;二进制流中的回车&#39; first_enter=clng(instrb(binary_stream,enter))	&#39;寻找第一个回车的位置&#39; second_enter=instrb(first_enter&#43;1,binary_stream,enter)	&#39;寻找第二个回车的位置&#39; set write_stream=createobject(&#34;adodb.stream&#34;)	&#39;定义一个流write_stream&#39; write_stream.type=1	&#39;write_stream是处理二进制数据的&#39; write_stream.open &#39;将read_stream中文件信息部分写到write_stream&#39; read_stream.Position=first_enter&#43;1 read_stream.copyto write_stream,second_enter-first_enter-3 write_stream.Position=0 write_stream.type=2	&#39;再将write_stream转为文本流&#39; write_stream.CharSet=&#34;UTF-8&#34; file_info=write_stream.readtext	&#39;写到file_info这个字符串&#39; write_stream.Close	&#39;暂且关闭write_stream这个流，接下来对file_info这个字符串进行切割&#39; file_name=mid(file_info,instrRev(file_info,&#34;\&#34;)&#43;1)	&#39;取得全文件名&#39; file_name=mid(file_name,instrRev(file_name,&#34;=&#34;)&#43;2) file_pre_suffix=left(file_name,instrRev(file_name,&#34;.&#34;)-1)	&#39;取得文件前缀&#39; suffix=mid(file_name,instrRev(file_name,&#34;.&#34;))	&#39;取得文件后缀，带.的&#39; server_file_name=file_pre_suffix&amp;&#34;_&#34;&amp;datediff(&#34;s&#34;,&#34;1970-01-01 00:00:00&#34;,now)&amp;suffix	&#39;在服务器保存的文件名就是“原文件前缀_时间戳.原文件后缀名”&#39; delimiter=leftB(binary_stream,clng(instrb(binary_stream,enter))-1)	&#39;取得文件分隔符，用于给字符串处理函数找到文件内容&#39; third_enter=instrb(second_enter&#43;1,binary_stream,enter)	&#39;找第三个回车的位置&#39; file_begin_position=clng(instrb(third_enter&#43;1,binary_stream,enter))&#43;1	&#39;获取文件内容第一个字符之前的位置&#39; file_end_position=clng(instrb(lenb(delimiter),binary_stream,delimiter))-3 &#39;获取文件内容中最后一个字符的位置，就是第二个分隔符&#34;delimiter&#34;开始的前一个二进制字符&#39; write_stream.type=1	&#39;write_stream是处理二进制数据&#39; write_stream." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/4d7644096021d0ff3df17a23fd11c569/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-25T15:43:36+08:00" />
<meta property="article:modified_time" content="2022-08-25T15:43:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ASP 单文件上传无组件代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-cpp">&lt;%@LANGUAGE="VBSCRIPT" CODEPAGE="65001"%&gt;
&lt;%
'禁止缓存'
Response.CacheControl="no-cache"  
Response.Expires=-1
Response.Charset="UTF-8"    '配合第一行设定网页编码
 
if Request.TotalBytes then	'如果上传文件非空'
	set read_stream=createobject("adodb.stream")	'设置一个流'
	read_stream.Type=1	'这个流读二进制数据，如果Type=2则读文本数据'
	read_stream.Open	'打开流'
	read_stream.write Request.BinaryRead(Request.TotalBytes)	'将表单传过来的二进制数据写入流read_stream'
	'将流read_stream的所有数据读到binary_stream中，binary_stream相当于一个临时变量，接下来将对binary_stream进行切割，以免污染read_stream中的原数据'
	read_stream.Position=0
	binary_stream=read_stream.Read
 
	enter=chrB(13)&amp;chrB(10)	'二进制流中的回车'
	first_enter=clng(instrb(binary_stream,enter))	'寻找第一个回车的位置'
	second_enter=instrb(first_enter+1,binary_stream,enter)	'寻找第二个回车的位置'
 
	set write_stream=createobject("adodb.stream")	'定义一个流write_stream'
	write_stream.type=1	'write_stream是处理二进制数据的'
	write_stream.open
	'将read_stream中文件信息部分写到write_stream'
	read_stream.Position=first_enter+1
	read_stream.copyto write_stream,second_enter-first_enter-3
	
	write_stream.Position=0
	write_stream.type=2	'再将write_stream转为文本流'
	write_stream.CharSet="UTF-8"
	file_info=write_stream.readtext	'写到file_info这个字符串'
	write_stream.Close	'暂且关闭write_stream这个流，接下来对file_info这个字符串进行切割'
 
	file_name=mid(file_info,instrRev(file_info,"\")+1)	'取得全文件名'
	file_name=mid(file_name,instrRev(file_name,"=")+2)
	file_pre_suffix=left(file_name,instrRev(file_name,".")-1)	'取得文件前缀'
	suffix=mid(file_name,instrRev(file_name,"."))	'取得文件后缀，带.的'
	
   
	server_file_name=file_pre_suffix&amp;"_"&amp;datediff("s","1970-01-01 00:00:00",now)&amp;suffix	'在服务器保存的文件名就是“原文件前缀_时间戳.原文件后缀名”'
	
	delimiter=leftB(binary_stream,clng(instrb(binary_stream,enter))-1)	'取得文件分隔符，用于给字符串处理函数找到文件内容'
	third_enter=instrb(second_enter+1,binary_stream,enter)	'找第三个回车的位置'
	file_begin_position=clng(instrb(third_enter+1,binary_stream,enter))+1	'获取文件内容第一个字符之前的位置'
	file_end_position=clng(instrb(lenb(delimiter),binary_stream,delimiter))-3  '获取文件内容中最后一个字符的位置，就是第二个分隔符"delimiter"开始的前一个二进制字符'
 
	write_stream.type=1	'write_stream是处理二进制数据'
	write_stream.open
	read_stream.Position=file_begin_position	'将流read_stream的开始位置移到文件开始的位置'
	read_stream.copyto write_stream,file_end_position-file_begin_position	'把流read_stream的开始位置之后 长为 文件长度 的内容复制到write_stream，其中文件长度就是文件结束的位置file_end_position-文件开始的位置file_begin_position'

	write_stream.SaveToFile server.mappath("upload_file/"&amp;server_file_name),2	'将write_stream转化为文件，保存在设定好的文件目录'
 
	'人走带门，关闭所有用到的流'	
	write_stream.Close
	Set write_stream=nothing
	read_stream.Close
	Set read_stream=nothing
 
	'打印文件信息到网页'
	response.write "您上传的文件是："&amp;file_name&amp;"&lt;br&gt;"
	response.write "您上传文件的后缀为："&amp;suffix&amp;"&lt;br&gt;"
	url="http://"&amp;Request.ServerVariables("HTTP_HOST")&amp;"/rf/upload_file/"&amp;server_file_name
	response.write "访问地址：&lt;a href='"&amp;url&amp;"' target='_blank'&gt;"&amp;url&amp;"&lt;/a&gt;&lt;br&gt;"
	response.write "&lt;a href='返回地址'&gt;返回&lt;/a&gt;&lt;br&gt;" 
   
end if
%&gt;</code></pre> 
<p>原网上发布的代码执行有问题，现找到问题所在，对问题所在处进行了修改，直接就可以使用。</p> 
<p>这个是FORM 提交后保存代码save.asp，下面是上传页，自由设计。</p> 
<p>&lt;form method="post" action="save.asp" enctype="multipart/form-data"&gt;<br>         &lt;input type="file" name="file"/&gt;<br>         &lt;input type="submit" value="提交" /&gt;<br>     &lt;/form&gt;</p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/16fd0944230481084c2748a4c8ca52bc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">代码迁移过程 -- Gitee to GitHub</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b72daefcda76cffe82a1da9c81bde4bb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软件定义汽车之 Android Automotive OS 发展历程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>