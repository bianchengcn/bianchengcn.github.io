<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STC15单片机-按键检测单击、双击和长按(状态机) - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STC15单片机-按键检测单击、双击和长按(状态机)" />
<meta property="og:description" content="按键检测(状态机) 传统的按键检测 在单片机的应用中，利用按键实现与用户的交互功能是相当常见的，同时按键的检测也是很讲究的，众所周知，在有键按下后，数据线上的信号出现一段时间的抖动，然后为低，当按键释放时，信号抖动一段时间后变高，然而这段抖动时间要维持10ms~50ms，这个与按键本身的材质有一定的关系，在这个范围内基本上都可以确定的。如果按键检测的不好，单片机的运行效率将会大打折扣，严重影响到系统的性能，导致系统的运行出现异常，在教科书中，我们见到的按键处理程序都是以下这样的结构:
if(KEY_IO != 0xFF)	//检测到有按键按下 { DelayNms (20);	//延时20毫秒（严重影响单片机的运行效率) if (KEY_IO !=0xFF)	//确认按键按下 { switch (KEY_IO) { case 0xFE: KeyValue=1 ; break; case 0xFD: KeyValue=2 ; break; default: KeyValue=0 ; break; } } } 弊端： 像这样的程序经常出现在大学的教科书中，在按键的扫描中，单片机的资源全部用来做按键的扫描，特别是当中的延时程序，对单片机来说，这个一个漫长的过程。例如，我们需要用动态扫描数码管来做一个电子时钟，如果在按键持续按下的过程中，由于延时程序对单片机资源的占用，单片机这个时候就不能做动态扫描，数码管的显示就会有问题；
除非当前程序搭载了实时系统，一旦当前任务要进行延时操作，系统会自动进行任务调度，执行其他任务，当之前的任务延时完毕，系统会自动执行之前的任务。遗憾的是传统8051系列单片机不推荐搭载实时系统的，毕竟其资源有限，而且又增加额外的成本，比如搭载ucos实时系统，传统的8051系列单片机完全不能满足该系统的要求，必须拓展外部存储器才能满足，这样就间接上增加了成本，同时ucos用于商业上要收费的，成本大大地增加了。因此当没有搭载实时系统做按键检测使用软件延时是不现实的，严重影响性能。
这样的教科书的按键处理程序是不实用的，在实际应用中是不可取的。所以这里介绍采用“状态机”的思想进行检测按键，不仅可以正确检测到按键，而且不会影响其他周边外设器件的运作。
有限状态机思想 ​ 有限状态机是一种概念思想，把复杂的控制逻辑分解成有限个稳定状态，组成闭环系统，通过事件触发，让状态机按设定的顺序处理事务。
​ 状态机是软件编程中的一个重要概念，比这个概念更里要的定对它的灵活应用。在一个思路清晰而且高效的程序中，必然有状态机的身影浮现。
​ 比如说一个按键命令解析程序，就可以被看做状态机：本来在A状态下，触发一个按键后切换到了B状态：再触发另一个键后切换到C状态，或者返回到A状态。这就是最简单的按键状态机例子。实际的按键解析程序会比这更复杂些，但这不影响我们对状态机的认识。
​ 进一步看，击键动作本身也可以看做一个状态机。一个细小的击键动作包含了：按下、抖动、释放等状态。其实状态机思想不单只用在按键方面，数码管显示动态扫描、LED亮灭都是存在状态机的思想如亮与灭的状态。
​ 使用状态机思想去进行单片机编程，比较通用的方法就是用swtich 的选择性分支语句来进行状态跳转，既然可以 switch 来判断，那么使用 if 同样可以，但是使用 switch 来判断状态可以使代码更加清晰。
按键动作示意图 状态图 说明：
整个状态机使用定时器来驱动，每隔10ms进入一次状态机进行判断，检测消抖的时间通常也是10ms；多任务时可以避免其他任务占用CPU 过多的时间；
状态1：按键处于弹起状态，为高电平，定时器每隔10ms扫描一次，如果检测到按键的IO口为低电平了，则切换到状态2
状态2：按键抖动检测，检测到IO口低电平从状态1切换到状态2后，下一个10ms进来如果检测到IO口变回了高电平，说明低电平是由抖动引起的，按键没有被完全按下，状态2切回到状态1；如果检测到IO口任然是低电平，说明按键被按下，状态2切换到状态3
状态3：此状态下按键已确认被按下，IO口会一直是低电平，如果长按，也一直是处于这个状态3；这个状态可以做一些按键动作的检测，如长按、双击；该状态下如果检测到IO口为高电平，则切换到状态4
状态4：进行弹起抖动检测，从状态3切到该状态时，在下一个10ms如果检测到IO口又变为低电平了，则说明上一步高电平是有抖动引起的，再将状态切回到状态3；如果检测到IO口继续为高电平，说明按键松开了，将状态切换到状态1
又开始下一个循环……
程序 实现效果 按键2单击指示灯电平翻转，长按2秒则闪一下，双击则闪三下" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c05cd7ff4cad8edf2c1814c14622463e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-02T11:49:45+08:00" />
<meta property="article:modified_time" content="2022-09-02T11:49:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STC15单片机-按键检测单击、双击和长按(状态机)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>按键检测(状态机)</h3> 
<h4><a id="_2"></a>传统的按键检测</h4> 
<p>在单片机的应用中，利用按键实现与用户的交互功能是相当常见的，同时按键的检测也是很讲究的，众所周知，在有键按下后，数据线上的信号出现一段时间的抖动，然后为低，当按键释放时，信号抖动一段时间后变高，然而这段抖动时间要维持10ms~50ms，这个与按键本身的材质有一定的关系，在这个范围内基本上都可以确定的。如果按键检测的不好，单片机的运行效率将会大打折扣，严重影响到系统的性能，导致系统的运行出现异常，在教科书中，我们见到的按键处理程序都是以下这样的结构:</p> 
<pre><code class="prism language-c"><span class="token keyword">if</span><span class="token punctuation">(</span>KEY_IO <span class="token operator">!=</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>		<span class="token comment">//检测到有按键按下</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">DelayNms</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//延时20毫秒（严重影响单片机的运行效率)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_IO <span class="token operator">!=</span><span class="token number">0xFF</span><span class="token punctuation">)</span>	<span class="token comment">//确认按键按下</span>
    <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">switch</span> <span class="token punctuation">(</span>KEY_IO<span class="token punctuation">)</span>
    	<span class="token punctuation">{<!-- --></span>
    		<span class="token keyword">case</span> <span class="token number">0xFE</span><span class="token operator">:</span> KeyValue<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    		<span class="token keyword">case</span> <span class="token number">0xFD</span><span class="token operator">:</span> KeyValue<span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    		<span class="token keyword">default</span><span class="token operator">:</span> KeyValue<span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_22"></a>弊端：</h4> 
<p>像这样的程序经常出现在大学的教科书中，在按键的扫描中，单片机的资源全部用来做按键的扫描，特别是当中的延时程序，对单片机来说，这个一个漫长的过程。例如，我们需要用动态扫描数码管来做一个电子时钟，如果在按键持续按下的过程中，由于延时程序对单片机资源的占用，单片机这个时候就不能做动态扫描，数码管的显示就会有问题；</p> 
<p>除非当前程序搭载了实时系统，一旦当前任务要进行延时操作，系统会自动进行任务调度，执行其他任务，当之前的任务延时完毕，系统会自动执行之前的任务。遗憾的是传统8051系列单片机不推荐搭载实时系统的，毕竟其资源有限，而且又增加额外的成本，比如搭载ucos实时系统，传统的8051系列单片机完全不能满足该系统的要求，必须拓展外部存储器才能满足，这样就间接上增加了成本，同时ucos用于商业上要收费的，成本大大地增加了。<strong>因此当没有搭载实时系统做按键检测使用软件延时是不现实的，严重影响性能</strong>。</p> 
<p>这样的教科书的按键处理程序是不实用的，在实际应用中是不可取的。所以这里介绍采用“<strong>状态机</strong>”的思想进行检测按键，不仅可以正确检测到按键，而且不会影响其他周边外设器件的运作。</p> 
<h4><a id="_32"></a>有限状态机思想</h4> 
<p>​ 有限状态机是一种概念思想，把复杂的控制逻辑分解成有限个稳定状态，组成闭环系统，通过事件触发，让状态机按设定的顺序处理事务。</p> 
<p>​ 状态机是软件编程中的一个重要概念，比这个概念更里要的定对它的灵活应用。在一个思路清晰而且高效的程序中，必然有状态机的身影浮现。</p> 
<p>​ 比如说一个按键命令解析程序，就可以被看做状态机：本来在A状态下，触发一个按键后切换到了B状态：再触发另一个键后切换到C状态，或者返回到A状态。这就是最简单的按键状态机例子。实际的按键解析程序会比这更复杂些，但这不影响我们对状态机的认识。</p> 
<p>​ 进一步看，击键动作本身也可以看做一个状态机。一个细小的击键动作包含了：按下、抖动、释放等状态。其实状态机思想不单只用在按键方面，数码管显示动态扫描、LED亮灭都是存在状态机的思想如亮与灭的状态。</p> 
<p>​ 使用状态机思想去进行单片机编程，比较通用的方法就是用swtich 的选择性分支语句来进行状态跳转，既然可以 switch 来判断，那么使用 if 同样可以，但是使用 switch 来判断状态可以使代码更加清晰。</p> 
<h4><a id="_46"></a>按键动作示意图</h4> 
<p><img src="https://images2.imgbox.com/e6/81/JRXI8mxE_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_51"></a>状态图</h4> 
<p><img src="https://images2.imgbox.com/00/fb/lcY6TpvC_o.png" alt="在这里插入图片描述"></p> 
<p>说明：</p> 
<p>整个状态机使用定时器来驱动，每隔10ms进入一次状态机进行判断，检测消抖的时间通常也是10ms；多任务时可以避免其他任务占用CPU 过多的时间；</p> 
<p>状态1：按键处于弹起状态，为高电平，定时器每隔10ms扫描一次，如果检测到按键的IO口为低电平了，则切换到状态2</p> 
<p>状态2：按键抖动检测，检测到IO口低电平从状态1切换到状态2后，下一个10ms进来如果检测到IO口变回了高电平，说明低电平是由抖动引起的，按键没有被完全按下，状态2切回到状态1；如果检测到IO口任然是低电平，说明按键被按下，状态2切换到状态3</p> 
<p>状态3：此状态下按键已确认被按下，IO口会一直是低电平，如果长按，也一直是处于这个状态3；这个状态可以做一些按键动作的检测，如长按、双击；该状态下如果检测到IO口为高电平，则切换到状态4</p> 
<p>状态4：进行弹起抖动检测，从状态3切到该状态时，在下一个10ms如果检测到IO口又变为低电平了，则说明上一步高电平是有抖动引起的，再将状态切回到状态3；如果检测到IO口继续为高电平，说明按键松开了，将状态切换到状态1</p> 
<p>又开始下一个循环……</p> 
<h4><a id="_70"></a>程序</h4> 
<h5><a id="_72"></a>实现效果</h5> 
<p>按键2单击指示灯电平翻转，长按2秒则闪一下，双击则闪三下</p> 
<h5><a id="_76"></a>按键检测程序思路</h5> 
<p>单击与双击：按键第一次检测到单击时，将单击状态缓存，同时启动双击定时器，超过一定时间，比如 200ms，认定按键为单击；如果没超过 200ms，又检测到了单击，认定按键为双击。</p> 
<p>长按：检测到按键按下后，启动长按定时器，过了一段时间，比如 2s，按键依然为按下状态 ，认定按键为长按。</p> 
<h5><a id="_82"></a>文件结构</h5> 
<p><img src="https://images2.imgbox.com/ec/b7/2OehwMBm_o.png" alt="在这里插入图片描述"></p> 
<p>main.c -&gt; 主函数文件，包含 main 函数等；</p> 
<p>Public.c -&gt; 公共函数文件，包含 Delay 延时函数等；</p> 
<p>Sys_init -&gt; 系统初始化函数，包含 GPIO 初始化函数等；</p> 
<p>LED.c -&gt; LED 外设函数，包含 LED 打开、关闭函数等；</p> 
<p>Timer0.c -&gt; 定时器函数，包含定时器初始化，中断函数等；</p> 
<p>KEY1.c -&gt; 按键 1 函数，包含按键检测，中断函数等；</p> 
<p><strong>KEY2.c -&gt; 按键 2 函数，包含按键状态机检测函数等；</strong></p> 
<h5><a id="KEY2h_103"></a>KEY2.h：</h5> 
<p>用枚举定义状态机的4种状态，用结构体定义扫描定时器，将结构体变量声明为外部可调用</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__KEY2_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__KEY2_H_</span></span>

<span class="token comment">//定义状体机使用的枚举类型</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{<!-- --></span>
  STA1_KEY_Up             <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span><span class="token number">0x01</span><span class="token punctuation">,</span>    <span class="token comment">//按键弹起</span>
  STA2_KEY_DownShake      <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span><span class="token number">0x02</span><span class="token punctuation">,</span>    <span class="token comment">//按下抖动</span>
  STA3_KEY_Down           <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span><span class="token number">0x03</span><span class="token punctuation">,</span>    <span class="token comment">//按键按下</span>
  STA4_KEY_UpShake        <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span><span class="token number">0x04</span>     <span class="token comment">//弹起抖动</span>
<span class="token punctuation">}</span>STA_Machine_Status_t<span class="token punctuation">;</span>

<span class="token comment">//定义结构体类型</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
  STA_Machine_Status_t  ucSTA_Machine_Status<span class="token punctuation">;</span>       <span class="token comment">//状态机状态</span>
  <span class="token class-name">uint16_t</span> <span class="token keyword">volatile</span>     ucSTA_Machine_Scan_Timer<span class="token punctuation">;</span>   <span class="token comment">//状态机扫描定时器</span>
  <span class="token class-name">uint16_t</span> <span class="token keyword">volatile</span>     usKEY2_Double_Click_Timer<span class="token punctuation">;</span>  <span class="token comment">//KEY2双击定时器</span>
  <span class="token class-name">uint16_t</span> <span class="token keyword">volatile</span>     usKEY2_Press_Timer<span class="token punctuation">;</span>         <span class="token comment">//KEY2长按定时器</span>
<span class="token punctuation">}</span>STA_Machine_t<span class="token punctuation">;</span>

<span class="token comment">/* extern variables-----------------------------------------------------------*/</span>
<span class="token keyword">extern</span> KEY_t          KEY2<span class="token punctuation">;</span>
<span class="token keyword">extern</span> STA_Machine_t  STA_Machine<span class="token punctuation">;</span>
<span class="token comment">/* extern function prototypes-------------------------------------------------*/</span> 

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token comment">/********************************************************
  End Of File
********************************************************/</span>
</code></pre> 
<h5><a id="KEY2c_140"></a>KEY2.c：</h5> 
<h6><a id="1_142"></a>1.先搭好状态机的框架：</h6> 
<pre><code class="prism language-c"><span class="token comment">/* Includes ------------------------------------------------------------------*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;main.h&gt;</span></span>

<span class="token comment">/* Private define-------------------------------------------------------------*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY2_State</span> <span class="token expression">P33</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Set_Press_TIME</span>          <span class="token expression">TIMER_2S            </span><span class="token comment">//设置长按时间</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Set_Double_Click_TIME</span>   <span class="token expression">TIMER_200MS         </span><span class="token comment">//设置双击时间</span></span>

<span class="token comment">/* Private variables----------------------------------------------------------*/</span>
<span class="token keyword">static</span> <span class="token class-name">uint8_t</span> Click_Buf <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>                 <span class="token comment">//单击状态缓存</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">KEY_Detect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Public variables-----------------------------------------------------------*/</span>
KEY_t KEY2 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>FALSE<span class="token punctuation">,</span>FALSE<span class="token punctuation">,</span>FALSE<span class="token punctuation">,</span>FALSE<span class="token punctuation">,</span>KEY_Detect<span class="token punctuation">}</span><span class="token punctuation">;</span>		<span class="token comment">//标志位初始化</span>
STA_Machine_t  STA_Machine <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>STA1_KEY_Up<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>		<span class="token comment">//状态和定时器初始化</span>

<span class="token comment">/* Private function prototypes------------------------------------------------*/</span>

<span class="token comment">/*
* @name   KEY_Detect
* @brief  按键2检测(状态机)
* @param  None
* @retval None   
*/</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">KEY_Detect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//状态机扫描定时器计时大于或等于10ms，进入一次状态机</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Scan_Timer <span class="token operator">&gt;=</span> TIMER_10MS<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status<span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//按键弹起</span>
        <span class="token keyword">case</span> STA1_KEY_Up<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2_State <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                                          
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//切换到状态2</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA2_KEY_DownShake<span class="token punctuation">;</span>  
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//按下抖动</span>
        <span class="token keyword">case</span> STA2_KEY_DownShake<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2_State <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//切换到状态3</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA3_KEY_Down<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//如果检测到高电平说明是抖动，切回到状态1</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA1_KEY_Up<span class="token punctuation">;</span>             
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//按键按下</span>
        <span class="token keyword">case</span> STA3_KEY_Down<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2_State <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//切换到状态4</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA4_KEY_UpShake<span class="token punctuation">;</span>      
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//弹起抖动</span>
        <span class="token keyword">case</span> STA4_KEY_UpShake<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2_State <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//切换到状态1，完成一次按键动作</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA1_KEY_Up<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span>
          <span class="token punctuation">{<!-- --></span>
             <span class="token comment">//否则判断为抖动，切回到状态3</span>
             STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA3_KEY_Down<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token comment">//默认情况都切换到状态1</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA1_KEY_Up<span class="token punctuation">;</span>             
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">//状态机扫描定时器清零，开始下一次扫描</span>
      STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Scan_Timer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/********************************************************
  End Of File
********************************************************/</span>
</code></pre> 
<h6><a id="2_242"></a>2.完成按键单击、双击、长按的检测</h6> 
<pre><code class="prism language-c"><span class="token comment">/* Includes ------------------------------------------------------------------*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;main.h&gt;</span></span>

<span class="token comment">/* Private define-------------------------------------------------------------*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KEY2_State</span> <span class="token expression">P33</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Set_Press_TIME</span>          <span class="token expression">TIMER_2S            </span><span class="token comment">//设置长按时间</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Set_Double_Click_TIME</span>   <span class="token expression">TIMER_200MS         </span><span class="token comment">//设置双击时间</span></span>

<span class="token comment">/* Private variables----------------------------------------------------------*/</span>
<span class="token keyword">static</span> <span class="token class-name">uint8_t</span> Click_Buf <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>                 <span class="token comment">//单击状态缓存</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">KEY_Detect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Public variables-----------------------------------------------------------*/</span>
KEY_t KEY2 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>FALSE<span class="token punctuation">,</span>FALSE<span class="token punctuation">,</span>FALSE<span class="token punctuation">,</span>FALSE<span class="token punctuation">,</span>KEY_Detect<span class="token punctuation">}</span><span class="token punctuation">;</span>		<span class="token comment">//标志位初始化</span>
STA_Machine_t  STA_Machine <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>STA1_KEY_Up<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>		<span class="token comment">//状态和定时器初始化</span>

<span class="token comment">/* Private function prototypes------------------------------------------------*/</span>

<span class="token comment">/*
* @name   KEY_Detect
* @brief  按键2检测(状态机)
* @param  None
* @retval None   
*/</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">KEY_Detect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//状态机扫描定时器计时大于或等于10ms，进入一次状态机</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Scan_Timer <span class="token operator">&gt;=</span> TIMER_10MS<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status<span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//按键弹起</span>
        <span class="token keyword">case</span> STA1_KEY_Up<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2_State <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                                          
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//切换到状态2</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA2_KEY_DownShake<span class="token punctuation">;</span>  
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//按键没被按下，则判断是否有单击缓存</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>Click_Buf <span class="token operator">==</span> TRUE<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token comment">//如果双击定时器大于200ms后，说明没在规定时间内进行双击，判断上一次按下是单击操作</span>
              <span class="token comment">/*如果双击定时器小于200ms，则下面判断不成立，说明还有时间完成双击操作，再按下按键后
              就从状体1到状态2再到状态3，状态3里判断是双击操作*/</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>STA_Machine<span class="token punctuation">.</span>usKEY2_Double_Click_Timer <span class="token operator">&gt;=</span> Set_Double_Click_TIME<span class="token punctuation">)</span>
              <span class="token punctuation">{<!-- --></span>
                KEY2<span class="token punctuation">.</span>KEY_Flag <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
                KEY2<span class="token punctuation">.</span>Click    <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>

                <span class="token comment">//清除单击缓存</span>
                Click_Buf <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//按下抖动</span>
        <span class="token keyword">case</span> STA2_KEY_DownShake<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2_State <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//切换到状态3</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA3_KEY_Down<span class="token punctuation">;</span>
            <span class="token comment">//长按定时器清0，开始计算长按时间</span>
            STA_Machine<span class="token punctuation">.</span>usKEY2_Press_Timer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//如果检测到高电平说明是抖动，切回到状态1</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA1_KEY_Up<span class="token punctuation">;</span>             
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//按键按下</span>
        <span class="token keyword">case</span> STA3_KEY_Down<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2_State <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//切换到状态4</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA4_KEY_UpShake<span class="token punctuation">;</span>
            <span class="token comment">//不是长按操作，则判断是不是双击操作</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token punctuation">.</span>Press <span class="token operator">==</span> FALSE<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token comment">//双击检测</span>
              <span class="token comment">//有单击缓存，说明前面已经单击一次，这次就判断为双击操作</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>Click_Buf <span class="token operator">==</span> TRUE<span class="token punctuation">)</span>
              <span class="token punctuation">{<!-- --></span>
                KEY2<span class="token punctuation">.</span>KEY_Flag     <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
                KEY2<span class="token punctuation">.</span>Double_Click <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
                <span class="token comment">//清除单击缓存，为下一次双击准备</span>
                Click_Buf <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">else</span>
              <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//没有单击缓存，说明这是双击的第一次点击，则进行缓存</span>
                Click_Buf <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
                <span class="token comment">/*双击定时器清零，开始计算双击时间，如果在双击时间内，再次进入到状态3，则判断是双击操作，
                如果在状态1里超时了，则状态1里检测为单击*/</span>
                STA_Machine<span class="token punctuation">.</span>usKEY2_Double_Click_Timer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>   
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//长按检测</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token punctuation">.</span>Press <span class="token operator">==</span> FALSE<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token comment">/*如果长按定时器超过两秒，认为是长按，进入判断体内将长按标志位置TRUE；如果在两秒内松开了按键
              则会判断是不是双击，去执行判断双击的情况*/</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>STA_Machine<span class="token punctuation">.</span>usKEY2_Press_Timer <span class="token operator">&gt;=</span> Set_Press_TIME<span class="token punctuation">)</span>
              <span class="token punctuation">{<!-- --></span>
                STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA4_KEY_UpShake<span class="token punctuation">;</span>
                <span class="token comment">/*为什么要切换到状态4？
                
                解释：因为这里将KEY2.Press置TRUE后，后面执行一次按键动作，指示灯闪一下，随后KEY2.Press被清零；
                      下一个10ms再进入函数时，状态位还是3，还是进入这里执行，KEY2.Press又会被置成TRUE，所以一直
                      按住不放的话，指示灯就会一直闪，而不是闪一下的情况

                      而在这里第一次进来后将状态位切换到4，KEY2.Press还是会置TRUE，后面指示灯闪一下，KEY2.Press
                      被清零，下一个10ms进来后会直接跳到状态4，所以KEY2.Press不会再次被置TRUE，后面指示灯动作不会
                      再执行，所以只闪一下*/</span>
                KEY2<span class="token punctuation">.</span>KEY_Flag <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
                KEY2<span class="token punctuation">.</span>Press    <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
                
                <span class="token comment">//因为已经判断为长按，所以不是双击操作，把单击缓存清0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>Click_Buf <span class="token operator">==</span> TRUE<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                  Click_Buf <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//弹起抖动</span>
        <span class="token keyword">case</span> STA4_KEY_UpShake<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2_State <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//切换到状态1，完成一次按键动作</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA1_KEY_Up<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">/*如果KEY2_State == 0，不跳回状态3，避免反复检测长按的情况*/</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token comment">//默认情况都切换到状态1</span>
            STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Status <span class="token operator">=</span> STA1_KEY_Up<span class="token punctuation">;</span>             
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">/****执行按键动作，用于检测按键效果****/</span>
      <span class="token comment">//单击动作 -&gt; 指示灯翻转</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token punctuation">.</span>KEY_Flag <span class="token operator">==</span> TRUE<span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token punctuation">.</span>Click <span class="token operator">==</span> TRUE<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//长按动作 -&gt; 指示灯闪一下</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token punctuation">.</span>Press <span class="token operator">==</span> TRUE<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Public<span class="token punctuation">.</span><span class="token function">Delay_ms</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//双击动作 -&gt; 指示灯闪三下</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>KEY2<span class="token punctuation">.</span>Double_Click <span class="token operator">==</span> TRUE<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Public<span class="token punctuation">.</span><span class="token function">Delay_ms</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Public<span class="token punctuation">.</span><span class="token function">Delay_ms</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Public<span class="token punctuation">.</span><span class="token function">Delay_ms</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Public<span class="token punctuation">.</span><span class="token function">Delay_ms</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Public<span class="token punctuation">.</span><span class="token function">Delay_ms</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Run_LED<span class="token punctuation">.</span><span class="token function">Run_LED_Flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">//按键状体位清零，为下一次按下准备</span>
      KEY2<span class="token punctuation">.</span>Click        <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
      KEY2<span class="token punctuation">.</span>Press        <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
      KEY2<span class="token punctuation">.</span>Double_Click <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>

      <span class="token comment">//状态机扫描定时器清零，开始下一次扫描</span>
      STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Scan_Timer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/********************************************************
  End Of File
********************************************************/</span>
</code></pre> 
<h5><a id="Timer0c_450"></a>Timer0.c：</h5> 
<p>定时器0中断处理函数中让状态机里用到的3个定时器每隔5ms加1</p> 
<pre><code class="prism language-c"><span class="token comment">/*
* @name   Timer0_isr
* @brief  定时器0中断处理函数（5ms进入一次）
* @param  None
* @retval None   
*/</span>
<span class="token keyword">void</span> <span class="token function">Timer0_isr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span>
<span class="token punctuation">{<!-- --></span>
	Timer0<span class="token punctuation">.</span>msMCU_Timer0_Value<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Timer0<span class="token punctuation">.</span>msMCU_Timer0_Value <span class="token operator">&gt;=</span> TIMER_500MS<span class="token punctuation">)</span>	<span class="token comment">//计时到500ms</span>
	<span class="token punctuation">{<!-- --></span>
		Timer0<span class="token punctuation">.</span>msMCU_Timer0_Value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token comment">//Run_LED.Run_LED_Flip();					//运行指示灯翻转</span>
	<span class="token punctuation">}</span>
	STA_Machine<span class="token punctuation">.</span>ucSTA_Machine_Scan_Timer<span class="token operator">++</span><span class="token punctuation">;</span>			<span class="token comment">//状态机扫描定时器</span>
	STA_Machine<span class="token punctuation">.</span>usKEY2_Double_Click_Timer<span class="token operator">++</span><span class="token punctuation">;</span>		<span class="token comment">//双击定时器</span>
	STA_Machine<span class="token punctuation">.</span>usKEY2_Press_Timer<span class="token operator">++</span><span class="token punctuation">;</span>				<span class="token comment">//长按定时器</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="mainc_477"></a>main.c：</h5> 
<p>main函数先进行系统初始化，主要是引脚和定时器的初始化，然后在while循环里调用按键2的按键扫描函数不断扫描即可</p> 
<pre><code class="prism language-c"><span class="token comment">/*
	* @name   main
	* @brief  主函数
	* @param  void	
	* @retval int      
*/</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>	
	<span class="token comment">//系统初始化</span>
	Hradware<span class="token punctuation">.</span><span class="token function">Sys_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//系统主循环</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//按键检测</span>
		<span class="token comment">//KEY1.KEY_Detect();</span>
		KEY2<span class="token punctuation">.</span><span class="token function">KEY_Detect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/efd989e3553eb35b4b56c9a8bbe0af9b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Bean的生命周期-getbean</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/149ef2726f63616a573e07c54b177642/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">H3C交换机如何查环路</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>