<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>排查Linux服务器是否被入侵步骤 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="排查Linux服务器是否被入侵步骤" />
<meta property="og:description" content="作为一个Linux运维工程师，能够清晰地鉴别异常机器是否已经被入侵了显得至关重要，以下是结合centos7.9操作系统进行排查Linux操作系统是否被入侵，其他Linux发行版的操作类似
1.入侵者可能会删除机器的日志信息
可以查看日志信息是否还存在或者是否被清空，相关命令
[root@master01 ~]# ls /var/log/*
/var/log/boot.log /var/log/dmesg.old /var/log/messages-20221113 /var/log/vmware-network.1.log
/var/log/btmp /var/log/maillog /var/log/secure-20221113 /var/log/vmware-vmsvc.3.log
/var/log/cron /var/log/maillog-20221106 /var/log/spooler /var/log/wtmp
/var/log/dmesg /var/log/messages-20221106 /var/log/tallylog
[root@master01 ~]# du -sh /var/log/
183M /var/log/
[root@master01 ~]# du -sh /var/log/*
2.6M /var/log/anaconda
39M /var/log/audit
0 /var/log/boot.log
20K /var/log/boot.log-20200417
12K /var/log/boot.log-20200816
24K /var/log/boot.log-20220216
12K /var/log/boot.log-20221001
8.0K /var/log/btmp
2.入侵者可能创建一个新的存放用户名及密码文件
可以查看/etc/passwd及/etc/shadow文件，相关命令：
[root@master01 ~]# ll /etc/pass*
-rw-r--r--. 1 root root 1022 Jan 25 2022 /etc/passwd
-rw-r--r--. 1 root root 986 Apr 16 2020 /etc/passwd-" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/4537972eaf271959414f94637e5da725/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-22T08:53:18+08:00" />
<meta property="article:modified_time" content="2022-11-22T08:53:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">排查Linux服务器是否被入侵步骤</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>作为一个Linux运维工程师，能够清晰地鉴别异常机器是否已经被入侵了显得至关重要，以下是结合centos7.9操作系统进行排查Linux操作系统是否被入侵，其他Linux发行版的操作类似</p> 
<p>1.入侵者可能会删除机器的日志信息</p> 
<p>可以查看日志信息是否还存在或者是否被清空，相关命令</p> 
<p>[root@master01 ~]# ls /var/log/*<br> /var/log/boot.log           /var/log/dmesg.old           /var/log/messages-20221113  /var/log/vmware-network.1.log<br> /var/log/btmp               /var/log/maillog             /var/log/secure-20221113    /var/log/vmware-vmsvc.3.log<br> /var/log/cron               /var/log/maillog-20221106    /var/log/spooler            /var/log/wtmp<br> /var/log/dmesg              /var/log/messages-20221106   /var/log/tallylog</p> 
<p>[root@master01 ~]# du -sh /var/log/<br> 183M    /var/log/<br> [root@master01 ~]# du -sh /var/log/*<br> 2.6M    /var/log/anaconda<br> 39M    /var/log/audit<br> 0    /var/log/boot.log<br> 20K    /var/log/boot.log-20200417<br> 12K    /var/log/boot.log-20200816<br> 24K    /var/log/boot.log-20220216<br> 12K    /var/log/boot.log-20221001<br> 8.0K    /var/log/btmp<br> 2.入侵者可能创建一个新的存放用户名及密码文件</p> 
<p>可以查看/etc/passwd及/etc/shadow文件，相关命令：</p> 
<p>[root@master01 ~]# ll /etc/pass*<br> -rw-r--r--. 1 root root 1022 Jan 25  2022 /etc/passwd<br> -rw-r--r--. 1 root root  986 Apr 16  2020 /etc/passwd-</p> 
<p>[root@master01 ~]# ll /etc/shado*<br> ----------. 1 root root 653 Nov 15 10:33 /etc/shadow<br> ----------. 1 root root 634 May  5  2020 /etc/shadow-</p> 
<p>3.入侵者可能修改用户名及密码文件</p> 
<p>可以查看/etc/passwd及/etc/shadow文件内容进行鉴别，看看是否有异常用户，相关命令：</p> 
<p>[root@master01 ~]# more /etc/passwd<br> root:x:0:0:root:/root:/bin/bash<br> bin:x:1:1:bin:/bin:/sbin/nologin<br> daemon:x:2:2:daemon:/sbin:/sbin/nologin<br> adm:x:3:4:adm:/var/adm:/sbin/nologin<br> lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin<br> sync:x:5:0:sync:/sbin:/bin/sync<br> shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown<br> halt:x:7:0:halt:/sbin:/sbin/halt<br> [root@master01 ~]# more /etc/shadow<br> root:$6$67Tijq/P$AcFLf9.4334pEKLAc1jFWTYzzLp92.qAl2El5MSZEjfm8YsW.3m3I1C7Oi.SMntqIUQr4eF.Fcm.EVfbdDEWf0:19311:0:99999:7:::<br> bin:*:17834:0:99999:7:::<br> daemon:*:17834:0:99999:7:::<br> adm:*:17834:0:99999:7:::<br> lp:*:17834:0:99999:7:::</p> 
<p>4.查看机器最近成功登陆的事件和最后一次不成功的登陆事</p> 
<p>对应日志“/var/log/lastlog”，相关命令：</p> 
<p>[root@master01 ~]# last<br> root     pts/0        10.3.180.178     Tue Nov 22 08:27   still logged in   <br> root     pts/0        10.0.252.47      Sat Nov 19 22:52 - 14:23  (15:31)    <br> root     pts/0        10.0.252.47      Sat Nov 19 04:49 - 22:52  (18:02)    <br> root     pts/0        10.3.180.178     Fri Nov 18 14:51 - 14:54  (00:02)    <br> root     pts/1        10.3.180.178     Fri Nov 18 14:51 - 14:51  (00:00)    <br> root     pts/1        10.3.180.178     Fri Nov 18 13:45 - 14:45  (00:59)</p> 
<p>5.查看机器当前登录的全部用户</p> 
<p>对应日志文件“/var/run/utmp”，相关命令</p> 
<p>[root@master01 ~]# who<br> root     pts/0        2022-11-22 08:27 (10.3.180.178)</p> 
<p>6.查看机器创建以来登陆过的用户</p> 
<p>对应日志文件“/var/log/wtmp”，相关命令</p> 
<p>[root@master01 ~]# last<br> root     pts/0        10.3.180.178     Tue Nov 22 08:27   still logged in   <br> root     pts/0        10.0.252.47      Sat Nov 19 22:52 - 14:23  (15:31)    <br> root     pts/0        10.0.252.47      Sat Nov 19 04:49 - 22:52  (18:02)    <br> root     pts/0        10.3.180.178     Fri Nov 18 14:51 - 14:54  (00:02)    <br> root     pts/1        10.3.180.178     Fri Nov 18 14:51 - 14:51  (00:00)    <br> root     pts/1        10.3.180.178     Fri Nov 18 13:45 - 14:45  (00:59)</p> 
<p>7.查看机器所有用户的连接时间（小时）</p> 
<p>对应日志文件“/var/log/wtmp”，相关命令</p> 
<p>[root@master01 ~]# ac -dp | more<br>     root                                28.89<br> Apr 16    total       28.89<br>     root                               151.58<br> Apr 19    total      151.58<br>     root                                52.11<br> Apr 20    total       52.11<br>     root                                62.00<br> Apr 21    total       62.00<br>     root                                60.41</p> 
<p>备注：如果操作系统提示没有ac命令，centos系统可以通过命令 yum install psacct安装</p> 
<p>8.如果发现机器产生了异常流量</p> 
<p>可以使用命令“tcpdump”抓取网络包查看流量情况或者使用工具”iperf”查看流量情况。</p> 
<p>tcpdump命令可以重点学习一下，这个单独讲解，通过流量分析异常问题虽说比较难，但是可以定位到深层次的网络问题</p> 
<p>9.可以查看/var/log/secure日志文件</p> 
<p>尝试发现入侵者的信息，相关命令</p> 
<p>[root@master01 ~]# cat /var/log/secure | grep -i "accepted"<br> Nov 22 08:27:02 master01 sshd[17081]: Accepted publickey for root from 10.3.180.178 port 62392 ssh2: RSA SHA256:KdRyYMK79OVOE5pIc5fTp9kW0YyA9eyydEPyevqYGVY</p> 
<p>10.查询异常进程所对应的执行脚本文件</p> 
<p>a.top命令查看异常进程对应的PID</p> 
<p>top</p> 
<p>b.在虚拟文件系统目录查找该进程的可执行文件</p> 
<p>ll /proc/PID/ | grep -i exe  #PID要替换成真实的PID数字</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39834eff2b10dc78d619fb0033b1da5a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux查看磁盘、文件系统、文件夹、文件大小的命令(lsblk、df、du、ll)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/34e9fb41fe5dba5618e9233b763356bf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">文件绝对路径泄露</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>