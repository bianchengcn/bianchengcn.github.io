<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用 Github Action 将 github 仓库同步到 gitee - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用 Github Action 将 github 仓库同步到 gitee" />
<meta property="og:description" content="背景 最近将 CI/CD 流程改造了一波，使用 ArgoCD 做 gitops，这样所有的集群 Yaml 文件就都存放在了 github 上的一次仓库里。
但是小服务器放在家里，从 github 上拉代码时总是时不时有网络问题，导致集群资源无法及时更新。
Gitee 提供了一个仓库镜像的功能，所以我目前采用的方式就是：
CI 构建镜像 -&gt; 推送最新配置代码到 Github 仓库 -&gt; Gitee 仓库同步 Github 仓库 -&gt; 集群 ArgoCD 拉取 Gitee 仓库配置。
但是到 3 月底这个功能就要关闭了，得寻找个替代方案了。
要么就是在 CI 过程中，既推送到 Github 仓库，又推送到 Gitee 仓库，但是这样感觉好麻烦，在搜索的过程中，看到了一个 Github Action：sync-gitee-mirror，专门用来将 Github 的仓库，推送到 Gitee 中。
这样就可以在 Github 的配置仓库中，增加一个 workflow，每当配置文件更新时，就触发此 action，主动将代码同步到 Gitee 仓库中。
使用 以我的集群配置仓库 gitops-configs 为例，在此仓库根目录下新建文件 .github/workflows/micrror-to-gitee.yaml，并填入如下内容：
name: 镜像仓库到 Gitee on: push: branches: - main env: # 仓库名称 REPO_NAME: ${{ github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/d7afe1ed715065e82a96204c7d2bf25b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-31T17:46:34+08:00" />
<meta property="article:modified_time" content="2023-03-31T17:46:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 Github Action 将 github 仓库同步到 gitee</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>背景</h3> 
<p>最近将 CI/CD 流程改造了一波，使用 ArgoCD 做 gitops，这样所有的集群 Yaml 文件就都存放在了 github 上的一次仓库里。<br> 但是小服务器放在家里，从 github 上拉代码时总是时不时有网络问题，导致集群资源无法及时更新。</p> 
<p><code>Gitee</code> 提供了一个仓库镜像的功能，所以我目前采用的方式就是：</p> 
<p>CI 构建镜像 -&gt; 推送最新配置代码到 Github 仓库 -&gt; Gitee 仓库同步 Github 仓库 -&gt; 集群 ArgoCD 拉取 Gitee 仓库配置。</p> 
<p>但是到 3 月底这个功能就要关闭了，得寻找个替代方案了。</p> 
<p>要么就是在 CI 过程中，既推送到 Github 仓库，又推送到 Gitee 仓库，但是这样感觉好麻烦，在搜索的过程中，看到了一个 Github Action：<a href="https://github.com/marketplace/actions/sync-gitee-mirror">sync-gitee-mirror</a>，专门用来将 Github 的仓库，推送到 Gitee 中。</p> 
<p>这样就可以在 Github 的配置仓库中，增加一个 workflow，每当配置文件更新时，就触发此 action，主动将代码同步到 Gitee 仓库中。</p> 
<h3><a id="_15"></a>使用</h3> 
<p>以我的集群配置仓库 <code>gitops-configs</code> 为例，在此仓库根目录下新建文件 <code>.github/workflows/micrror-to-gitee.yaml</code>，并填入如下内容：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> 镜像仓库到 Gitee
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> main
<span class="token key atrule">env</span><span class="token punctuation">:</span>
  <span class="token comment"># 仓库名称</span>
  <span class="token key atrule">REPO_NAME</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> github.event.repository.name <span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">mirror-to-gitee</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> 同步到 Gitee
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Mirror repo to Gitee.
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> abersheeran/sync<span class="token punctuation">-</span>gitee<span class="token punctuation">-</span>mirror@v1<span class="token punctuation">-</span>beta
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">repository</span><span class="token punctuation">:</span> xuxusheng/$<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> env.REPO_NAME <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">username</span><span class="token punctuation">:</span> xuxusheng
          <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> secrets.GITEE_PASSWORD <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fa34d77e5075fd33766e06f58eeaaba4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Visual Studio开发Qt5.12.3，使用QChartView widget时报错问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d1f241c48824673ea4b358767e52db60/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python pyqt5 全选 和反选 demo</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>