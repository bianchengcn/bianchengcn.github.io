<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>协同过滤算法实验 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="协同过滤算法实验" />
<meta property="og:description" content="本次呢，简单介绍一下协同过滤算法，并且给出简单的电影推荐实验作为举例说明。利用Spark MLlib中的协同过滤算法完成针对特定用户的电影推荐功能。这一部分需要实现实现输入用户id，输出为其推荐的电影。
一、协同过滤 所谓协同过滤，就是简单来说是利用某兴趣相投、拥有共同经验之群体的喜好来推荐使用者感兴趣的资讯，个人透过合作的机制给予资讯相当程度的回应并记录下来以达到过滤的目的进而帮助别人选择信息。对于实现针对用户个性的推荐功能这一需求，非常合适。
二、电影推荐 首先来看我们的结果：
需要用到的数据集下载链接在文章的最后。
大概是这个样子：
movies和ratings两个数据集
数据之间以 :: 隔开
movies的每一列分别表示
movie_id , movie_name , movie_type
ratings的每一列分别表示：
movie_id , user_id , score , timestamp(时间戳)
代码如下:
object SparkPi { case class Rating(userId: Int, movieId: Int, rating: Float, timestamp: Long) def parseRating(str: String): Rating = { val fields = str.split(&#34;::&#34;) assert(fields.size == 4) Rating(fields(0).toInt, fields(1).toInt, fields(2).toFloat, fields(3).toLong) } def main(args: Array[String]): Unit = { val sc=SparkSession.builder() .master(&#34;local&#34;) .appName(&#34;movie&#34;) .getOrCreate() val ratingRDD=sc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/75287ea8985ee20f9cefe819d9ed0d61/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-25T22:30:00+08:00" />
<meta property="article:modified_time" content="2021-12-25T22:30:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">协同过滤算法实验</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>         本次呢，简单介绍一下协同过滤算法，并且给出简单的电影推荐实验作为举例说明。利用Spark MLlib中的协同过滤算法完成针对特定用户的电影推荐功能。这一部分需要实现实现输入用户id，输出为其推荐的电影。</p> 
<h2>一、协同过滤</h2> 
<p>       所谓协同过滤，就是简单来说是利用某兴趣相投、拥有共同经验之群体的喜好来推荐使用者感兴趣的资讯，个人透过合作的机制给予资讯相当程度的回应并记录下来以达到过滤的目的进而帮助别人选择信息。对于实现针对用户个性的推荐功能这一需求，非常合适。</p> 
<h2>二、电影推荐</h2> 
<p>        首先来看我们的结果：</p> 
<p><img alt="" height="87" src="https://images2.imgbox.com/c7/0d/PB8TEwLW_o.png" width="624"></p> 
<p> <img alt="" height="311" src="https://images2.imgbox.com/77/ba/rMgcS7Iw_o.png" width="803"></p> 
<p> </p> 
<p>        需要用到的数据集下载链接在文章的最后。</p> 
<p>大概是这个样子：</p> 
<p>movies和ratings两个数据集</p> 
<p>数据之间以 :: 隔开</p> 
<p>movies的每一列分别表示</p> 
<p>movie_id , movie_name , movie_type</p> 
<p><img alt="" height="484" src="https://images2.imgbox.com/d3/13/vTx3OgeB_o.png" width="781"></p> 
<p> ratings的每一列分别表示：</p> 
<p>movie_id , user_id , score , timestamp(时间戳)</p> 
<p><img alt="" height="544" src="https://images2.imgbox.com/00/ea/pDBG1u0m_o.png" width="528"></p> 
<p> 代码如下:</p> 
<pre><code class="language-Scala">object SparkPi {
  case class Rating(userId: Int, movieId: Int, rating: Float, timestamp: Long)
  def parseRating(str: String): Rating = {
    val fields = str.split("::")
    assert(fields.size == 4)
    Rating(fields(0).toInt, fields(1).toInt, fields(2).toFloat, fields(3).toLong)
  }
  def main(args: Array[String]): Unit = {
    val sc=SparkSession.builder()
      .master("local")
      .appName("movie")
      .getOrCreate()
    val ratingRDD=sc.sparkContext.textFile("/ratings.dat")
    val ratings=sc.createDataFrame(ratingRDD.map(parseRating))
    val Array(training, test) = ratings.randomSplit(Array(0.8, 0.2))
    //训练模型
    val alsExplicit = new ALS()
      .setMaxIter(5)            
      .setRegParam(0.01)         
      .setUserCol("userId")
      .setItemCol("movieId")
      .setRatingCol("rating")    
    val alsImplicit = new ALS()
      .setMaxIter(5)           
      .setRegParam(0.01)   
      .setImplicitPrefs(true)
      .setUserCol("userId")
      .setItemCol("movieId")
      .setRatingCol("rating")    
    val modelExplicit = alsExplicit.fit(training)
    val modelImplicit = alsImplicit.fit(training)
    val predictionsExplicit = modelExplicit.transform(test).na.drop()
    val predictionsImplicit = modelImplicit.transform(test).na.drop()
    //计算模型误差
    val evaluator = new RegressionEvaluator()
      .setMetricName("rmse")
      .setLabelCol("rating")
      .setPredictionCol("prediction")
    val rmseExplicit = evaluator.evaluate(predictionsExplicit)
    val rmseImplicit = evaluator.evaluate(predictionsImplicit)
    println(s"Explicit:模型均方根误差 : $rmseExplicit")
    println(s"Implicit:模型均方根误差 : $rmseImplicit")
    println("请输入用户id:")
    val userId:Int=StdIn.readInt()
    val movieDF=ratings.where(s"userId= $userId")
    println(s"为id为 $userId 的用户推荐如下10部电影：")
    movieDF.limit(10).show()
    val df=movieDF.limit(10)
    //将数据存到数据库中
    val prop=new Properties()
    prop.put("user","root")
    prop.put("password","Wyk@123456")
    prop.put("driver","com.mysql.jdbc.Driver")
df.write.mode("Overwrite").jdbc("jdbc:mysql://localhost:3306/movie","movie.advice",prop)
  }
}</code></pre> 
<p> 下面是有关的数据集<a class="has-card" href="https://grouplens.org/datasets/movielens/" rel="nofollow" title="MovieLens | GroupLens"><span class="link-card-box"><span class="link-title">MovieLens | GroupLens</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/f6/51/eJVNx9DH_o.png" alt="icon-default.png?t=LA92">https://grouplens.org/datasets/movielens/</span></span></a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b936fa5af42c8af4e437a7e0efc8bd03/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">elementui 表格单行删除</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/71718608c7935aa179f79e0e29322b15/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2021年，一个产品经理的40条心得总结。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>