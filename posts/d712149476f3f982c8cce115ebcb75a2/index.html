<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>看书标记【R语言数据分析项目精解：理论、方法、实战 6】 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="看书标记【R语言数据分析项目精解：理论、方法、实战 6】" />
<meta property="og:description" content="看书标记——R语言 Chapter 6 变量筛选技术6.1项目背景、目标和方案6.1.1项目背景6.1.2项目目标6.1.3项目方案 6.2项目技术简介6.2.1变量相关性1.定类变量和定类变量2.定序变量与定类变量3.定距（连续型）变量与定距变量4.定类变量与定序变量 6.2.2变量筛选1．基于变量距离的层次聚类2.基于变量距离的模糊聚类 6.2.3变量降维1.主成分分析（PCA）2.因子分析 6.2.4 R语言实例代码1.基于变量距离的层次聚类2.模糊聚类3.主成分分析4.因子分析 6.3项目实践6.3.1变量筛选6.3.2变量降维1.主成分分析2.因子分析 【R语言数据分析项目精解：理论、方法、实战】 Chapter 6 变量筛选技术 6.1项目背景、目标和方案 6.1.1项目背景 对底层数据做一次清洗和olap层中间数据的搭建，方便日后分析和选取。问题的提出：哪些变量是相关的？这些变量能否归类？
在统计建模中，筛选变量是前期最重要的步骤，原因：
（1）能提高魔性的稳定性
（2）能提高模型的预测能力
（3）能提高模型的运行效率
设计一套方法、开发一套程序以应对今后的变量筛选问题是有必要的， 可以给业务带来更好的解释和指引，帮助查看重要变量。发起一个内部技术项目：智能化筛选和划分变量。
6.1.2项目目标 （1）基于原始变量，探究各变量之间的关系
（2）开发变量筛选的通用模块
（3）规范变量变换和变量筛选流程。
6.1.3项目方案 （1）用变量相关系数，探究变量的相关性。
（2）对变量进行分析（变量筛选：距离聚类、模糊聚类等，从原始数据及中选出子集；变量降维：主成分分析、因子分析等，通过属性间的关系以组合的方式得到新的属性，改变了原本的特征空间）
（3）总结各方法的特点和使用情况，制作智能化工具。
6.2项目技术简介 （1）有较高缺失值的变量。缺失率大于阈值80%
（2）变量大部分为常数。逻辑变量除外
（3）变量站位过多，邮政编码类的变量需考虑剔除。
以上三种数据考虑直接剔除，然后将变量分为连续型和离散型，为下一步分析做准备。
6.2.1变量相关性 1.定类变量和定类变量 λ相关系数：用定类变量解释或预测定类变量时，以众数作为标准，这样可以减少预测误差。
2.定序变量与定类变量 关于属性值的顺序之分
同序对：某对样本在两个变量上的相对等级是相同的异序对：某对样本在两个变量上的相对等级是不同的同分对：两个样本在某个变量上是同分。
（1）Gamma相关系数
G = ( N s − N d ) / ( N s &#43; N d ) , N s 表示同序对， N d 表示异序对 G=(N_s-N_d)/(N_s&#43;N_d),N_s表示同序对，N_d表示异序对 G=(Ns​−Nd​)/(Ns​&#43;Nd​),Ns​表示同序对，Nd​表示异序对" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/d712149476f3f982c8cce115ebcb75a2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-01T21:18:51+08:00" />
<meta property="article:modified_time" content="2024-01-01T21:18:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">看书标记【R语言数据分析项目精解：理论、方法、实战 6】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>看书标记——R语言</h4> 
 <ul><li><a href="#Chapter_6__3" rel="nofollow">Chapter 6 变量筛选技术</a></li><li><ul><li><ul><li><a href="#61_4" rel="nofollow">6.1项目背景、目标和方案</a></li><li><ul><li><a href="#611_5" rel="nofollow">6.1.1项目背景</a></li><li><a href="#612_13" rel="nofollow">6.1.2项目目标</a></li><li><a href="#613_17" rel="nofollow">6.1.3项目方案</a></li></ul> 
    </li><li><a href="#62_21" rel="nofollow">6.2项目技术简介</a></li><li><ul><li><a href="#621_26" rel="nofollow">6.2.1变量相关性</a></li><li><ul><li><a href="#1_27" rel="nofollow">1.定类变量和定类变量</a></li><li><a href="#2_31" rel="nofollow">2.定序变量与定类变量</a></li><li><a href="#3_49" rel="nofollow">3.定距（连续型）变量与定距变量</a></li><li><a href="#4_52" rel="nofollow">4.定类变量与定序变量</a></li></ul> 
     </li><li><a href="#622_54" rel="nofollow">6.2.2变量筛选</a></li><li><ul><li><a href="#1_55" rel="nofollow">1．基于变量距离的层次聚类</a></li><li><a href="#2_60" rel="nofollow">2.基于变量距离的模糊聚类</a></li></ul> 
     </li><li><a href="#623_62" rel="nofollow">6.2.3变量降维</a></li><li><ul><li><a href="#1PCA_63" rel="nofollow">1.主成分分析（PCA）</a></li><li><a href="#2_68" rel="nofollow">2.因子分析</a></li></ul> 
     </li><li><a href="#624_R_70" rel="nofollow">6.2.4 R语言实例代码</a></li><li><ul><li><a href="#1_71" rel="nofollow">1.基于变量距离的层次聚类</a></li><li><a href="#2_97" rel="nofollow">2.模糊聚类</a></li><li><a href="#3_211" rel="nofollow">3.主成分分析</a></li><li><a href="#4_303" rel="nofollow">4.因子分析</a></li></ul> 
    </li></ul> 
    </li><li><a href="#63_317" rel="nofollow">6.3项目实践</a></li><li><ul><li><a href="#631_318" rel="nofollow">6.3.1变量筛选</a></li><li><a href="#632_331" rel="nofollow">6.3.2变量降维</a></li><li><ul><li><a href="#1_332" rel="nofollow">1.主成分分析</a></li><li><a href="#2_360" rel="nofollow">2.因子分析</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br> 【R语言数据分析项目精解：理论、方法、实战】 
<p></p> 
<h2><a id="Chapter_6__3"></a>Chapter 6 变量筛选技术</h2> 
<h4><a id="61_4"></a>6.1项目背景、目标和方案</h4> 
<h5><a id="611_5"></a>6.1.1项目背景</h5> 
<p>对底层数据做一次清洗和olap层中间数据的搭建，方便日后分析和选取。问题的提出：哪些变量是相关的？这些变量能否归类？<br> 在统计建模中，筛选变量是前期最重要的步骤，原因：<br> （1）能提高魔性的稳定性<br> （2）能提高模型的预测能力<br> （3）能提高模型的运行效率<br> 设计一套方法、开发一套程序以应对今后的变量筛选问题是有必要的， 可以给业务带来更好的解释和指引，帮助查看重要变量。发起一个内部技术项目：智能化筛选和划分变量。</p> 
<h5><a id="612_13"></a>6.1.2项目目标</h5> 
<p>（1）基于原始变量，探究各变量之间的关系<br> （2）开发变量筛选的通用模块<br> （3）规范变量变换和变量筛选流程。</p> 
<h5><a id="613_17"></a>6.1.3项目方案</h5> 
<p>（1）用变量相关系数，探究变量的相关性。<br> （2）对变量进行分析（变量筛选：距离聚类、模糊聚类等，从原始数据及中选出子集；变量降维：主成分分析、因子分析等，通过属性间的关系以组合的方式得到新的属性，改变了原本的特征空间）<br> （3）总结各方法的特点和使用情况，制作智能化工具。</p> 
<h4><a id="62_21"></a>6.2项目技术简介</h4> 
<p>（1）有较高缺失值的变量。缺失率大于阈值80%<br> （2）变量大部分为常数。逻辑变量除外<br> （3）变量站位过多，邮政编码类的变量需考虑剔除。<br> 以上三种数据考虑直接剔除，然后将变量分为连续型和离散型，为下一步分析做准备。</p> 
<h5><a id="621_26"></a>6.2.1变量相关性</h5> 
<h6><a id="1_27"></a>1.定类变量和定类变量</h6> 
<p>λ相关系数：用定类变量解释或预测定类变量时，以众数作为标准，这样可以减少预测误差。<br> <img src="https://images2.imgbox.com/12/cf/RlAfuMNa_o.png" alt="λ公式"><br> <img src="https://images2.imgbox.com/d1/ac/YPpuA0yR_o.png" alt="λ计算实例"></p> 
<h6><a id="2_31"></a>2.定序变量与定类变量</h6> 
<p>关于属性值的顺序之分</p> 
<ul><li>同序对：某对样本在两个变量上的相对等级是相同的</li><li>异序对：某对样本在两个变量上的相对等级是不同的</li><li>同分对：两个样本在某个变量上是同分。<br> （1）Gamma相关系数<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          G 
         
        
          = 
         
        
          ( 
         
         
         
           N 
          
         
           s 
          
         
        
          − 
         
         
         
           N 
          
         
           d 
          
         
        
          ) 
         
        
          / 
         
        
          ( 
         
         
         
           N 
          
         
           s 
          
         
        
          + 
         
         
         
           N 
          
         
           d 
          
         
        
          ) 
         
        
          , 
         
         
         
           N 
          
         
           s 
          
         
        
          表示同序对， 
         
         
         
           N 
          
         
           d 
          
         
        
          表示异序对 
         
        
       
         G=(N_s-N_d)/(N_s+N_d),N_s表示同序对，N_d表示异序对 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">/</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">表示同序对，</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">表示异序对</span></span></span></span></span><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ( 
         
         
         
           N 
          
         
           s 
          
         
        
          + 
         
         
         
           N 
          
         
           d 
          
         
        
          ) 
         
        
       
         (N_s+N_d) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>表示在预测或解释任何一个个案的相对等级时可能的最大误差，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ( 
         
         
         
           N 
          
         
           s 
          
         
        
          − 
         
         
         
           N 
          
         
           d 
          
         
        
          ) 
         
        
       
         (N_s-N_d) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.109em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>表示以一对个案在一个变量上的相对等级来预测其在另一个变量上的相对等级所能减少的误差。<br> （2）肯德尔的tau系数<br> 有三种形式：tau-a、tau-b、tau-c。都可用于分析对称关系 （两个变量都是自变量，非对称关系是指两个变量一个是自变量一个是因变量），用于计算同序对数与异序对数之差在全部可能对数中所占的比例。<br> <img src="https://images2.imgbox.com/f8/f6/FS69d5ms_o.png" alt="三种肯德尔相关系数表达式"><br> 三种方法的适用情形：</li><li>两变量没有同分对，tau-a</li><li>有同分对，交叉分组表行列数相等（r=c），tau-b</li><li>无论同分对和行列数，tau-c<br> （3）斯皮尔曼rho系数（等级相关系数）<br> 不仅区分个案在两变量上的等级高低，还能将差异的确切数值计算出来。该算法可以消减误差比例：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           r 
          
         
           s 
          
         
        
          = 
         
        
          1 
         
        
          − 
         
         
          
          
            6 
           
          
            ∑ 
           
           
           
             D 
            
           
             2 
            
           
          
          
          
            n 
           
          
            ( 
           
           
           
             n 
            
           
             2 
            
           
          
            − 
           
          
            1 
           
          
            ) 
           
          
         
        
          ， 
         
        
          D 
         
        
       
         r_s=1- \frac {6\sum D^2}{n(n^2-1)}，D 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.6289em; vertical-align: -0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.1089em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7463em;"><span class="" style="top: -2.786em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.485em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mspace mtight" style="margin-right: 0.1952em;"></span><span class="mop op-symbol small-op mtight" style="position: relative; top: 0em;">∑</span><span class="mspace mtight" style="margin-right: 0.1952em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8913em;"><span class="" style="top: -2.931em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.52em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span>为同一个样本不同变量之间的等级差</li></ul> 
<h6><a id="3_49"></a>3.定距（连续型）变量与定距变量</h6> 
<p>两个连续型变量之间的关系可以用斯皮尔曼相关系数来描述：<br> <img src="https://images2.imgbox.com/cb/2e/4o3uAHyc_o.png" alt="斯皮尔曼相关系数"></p> 
<h6><a id="4_52"></a>4.定类变量与定序变量</h6> 
<p>lambda、tau-y系数描述。</p> 
<h5><a id="622_54"></a>6.2.2变量筛选</h5> 
<h6><a id="1_55"></a>1．基于变量距离的层次聚类</h6> 
<p>首先计算各变量之间的距离，然后根据变量之间的距离进行聚类，变量距离的计算基于变量相关性，变量相关性越高，它们之间的距离就越近;反之，它们之间的距离就越远。距离和相关性之间的关系如下:<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          D 
         
         
         
           x 
          
         
           y 
          
         
        
       
         = 
        
       
         1 
        
       
         − 
        
        
        
          ρ 
         
         
         
           x 
          
         
           y 
          
         
        
       
      
        D_{xy}=1-ρ_{xy} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0278em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.7167em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span></span></span></span></span><br> 根据聚类所用的不同方法，聚类可分为层次聚类、动态聚类、模糊聚类、基于密度聚类和最大期望聚类等。常会选择层次聚类和模糊聚类这两种。<br> 变量层次聚类的步骤是：先计算变量之间的距离，每次将距离最近的点合并到同一个类;然后计算类与类之间的距离，将距离最近的类合并为一个大类;不停地合并，直到合成一个类。其中，类与类距离的计算方法有最短距离法、最长距离法、中间距离法和类平均法等。比如，最短距离法是将类与类的距离定义为类与类之间变量的最短距离，最长距离法是将类与类的距离定义为类与类之间变量的最长距离。</p> 
<h6><a id="2_60"></a>2.基于变量距离的模糊聚类</h6> 
<p>在现实生活中，事物的分类往往是模糊不清、没有明显界线的。对于此类聚类问题，就需要我们借助模糊数学的理论并结合传统意义上的聚类分析方法，得到一个新的聚类方法——模糊聚类。</p> 
<h5><a id="623_62"></a>6.2.3变量降维</h5> 
<h6><a id="1PCA_63"></a>1.主成分分析（PCA）</h6> 
<p>将众多原始变量变为少数几个相互独立的线性组合形成的变量（主成分），线性组合后的的主成分方差变得最大，使得主成分之间显示出最大的个别差异性。<br> <img src="https://images2.imgbox.com/4a/6b/tO8y0fhC_o.png" alt="主成分表达式"><br> 其中系数a要满足<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         V 
        
       
         ( 
        
        
        
          y 
         
        
          1 
         
        
       
         ) 
        
       
         = 
        
        
        
          a 
         
        
          1 
         
        
          ′ 
         
        
       
         ∑ 
        
        
        
          a 
         
        
          1 
         
        
       
      
        V(y_1)=a_1'\sum a_1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">V</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0019em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -2.4519em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2481em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-symbol small-op" style="position: relative; top: 0em;">∑</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>最大，此时对应第一主成分，还希望达到，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         c 
        
       
         o 
        
       
         v 
        
       
         ( 
        
        
        
          y 
         
        
          1 
         
        
       
         , 
        
        
        
          y 
         
        
          2 
         
        
       
         ) 
        
       
         = 
        
       
         0 
        
       
      
        cov(y_1,y_2)=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>.<br> 在提取主成分后，新的主成分变量可能不太容易解释，为了尽可能地对新变量去噪，可采用主成分旋转来完成。常用的主成分旋转有两种：<strong>正交旋转</strong>（使选择的成分仍旧保持不相关，常用的正交旋转为方差极大旋转，它试图使载荷矩阵每列只有少数几个很大的载荷，其他都是很小的载荷）和<strong>斜交旋转</strong>（使选择的成分变得相关）。</p> 
<h6><a id="2_68"></a>2.因子分析</h6> 
<p><img src="https://images2.imgbox.com/91/98/FvFg037K_o.png" alt="因子表达式"></p> 
<h5><a id="624_R_70"></a>6.2.4 R语言实例代码</h5> 
<h6><a id="1_71"></a>1.基于变量距离的层次聚类</h6> 
<p>（1）计算变量相关性<br> cor(x,y=NULL,method=‘pearson’) ##‘pearson、kendall、spearman’<br> （2）层次聚类<br> hclust(d,method) ##d为dist类数据类型，可以用as.dist()转换。向量的内积作为距离，默认为欧氏距离。层次聚类方法有：single（最短距离法）、complete（最长距离法）、median（中间距离法）、mcquitty（相似法）、average（类平均法）、centroid（重心法）和ward.D（离差平方和法）</p> 
<pre><code class="prism language-r"><span class="token comment">#函数功能：依据变量相似性利用层次聚类法进行聚类</span>
<span class="token comment">#df：原始数据，必须为数据框</span>
<span class="token comment">#k：需要聚类的个数（可以先随便设定，然后逐步调整）</span>
varcluster_hc<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>mydf<span class="token punctuation">,</span>k<span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">'average'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cordist<span class="token operator">&lt;-</span>as.dist<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>cor<span class="token punctuation">(</span>mydf<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">#计算变量相关性，并转换成距离对象</span>
    hcl<span class="token operator">&lt;-</span>hclust<span class="token punctuation">(</span>cordist<span class="token punctuation">,</span>method<span class="token punctuation">)</span>   <span class="token comment">#对距离进行层次聚类</span>
    plclust<span class="token punctuation">(</span>hcl<span class="token punctuation">,</span>hang<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token comment">#画出树状图</span>
    rel<span class="token operator">&lt;-</span>rect.hclust<span class="token punctuation">(</span>hcl<span class="token punctuation">,</span> k<span class="token punctuation">,</span> border<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">)</span>      <span class="token comment">#用红框画出分类的效果</span>
    varnames<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">#输出变量类别</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>rel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        varnames<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>varnames<span class="token punctuation">,</span>names<span class="token punctuation">(</span>rel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    classid<span class="token operator">&lt;-</span>rep<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>k<span class="token punctuation">,</span>unlist<span class="token punctuation">(</span>lapply<span class="token punctuation">(</span>rel<span class="token punctuation">,</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    varclass<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>varname<span class="token operator">=</span>varnames<span class="token punctuation">,</span>corclass<span class="token operator">=</span>classid<span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>varclass<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
varcluster_hc<span class="token punctuation">(</span>mtcars<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token comment">#用mtcars数据为例，分成3类，可以用碎石图等方法确定需要聚成几类</span>
</code></pre> 
<p>步骤为，先计算变量相关系数》计算距离并转换为dist类型调用hclust函数》生成树状图》输出变量分类结果</p> 
<h6><a id="2_97"></a>2.模糊聚类</h6> 
<pre><code class="prism language-r"><span class="token comment">#函数功能：根据相关系数矩阵，利用模糊聚类方法实现变量聚类</span>
<span class="token comment">#mydf：原始数据，必须为数据框类型</span>
<span class="token comment">#class_level：设定lamda的值，取值范围：-1~1.随着lamda的值越大，聚类的个数也越大。</span>
library<span class="token punctuation">(</span>plyr<span class="token punctuation">)</span>
fuzzycluster<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>mydf<span class="token punctuation">,</span>class_level<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">#模糊矩阵合成</span>
    fuzzycombine<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>fmatrix<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       n<span class="token operator">&lt;-</span>nrow<span class="token punctuation">(</span>fmatrix<span class="token punctuation">)</span>
       rresmatrix<span class="token operator">&lt;-</span>matrix<span class="token punctuation">(</span><span class="token punctuation">,</span>n<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>n<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
           <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>n<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              rresmatrix<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&lt;-</span>max<span class="token punctuation">(</span>pmin<span class="token punctuation">(</span>fmatrix<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>fmatrix<span class="token punctuation">[</span><span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       return<span class="token punctuation">(</span>rresmatrix<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token comment">#计算模糊等价关系</span>
   fuzzyequal<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>fmatrix<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      n<span class="token operator">&lt;-</span>length<span class="token punctuation">(</span>fmatrix<span class="token punctuation">)</span>
      r_1<span class="token operator">&lt;-</span>fmatrix
      i<span class="token operator">&lt;-</span><span class="token number">0</span>
      num<span class="token operator">&lt;-</span><span class="token number">1</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        r_2<span class="token operator">&lt;-</span>fuzzycombine<span class="token punctuation">(</span>r_1<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>sum<span class="token punctuation">(</span>r_1<span class="token operator">==</span>r_2<span class="token punctuation">)</span><span class="token operator">/</span>n<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
           i<span class="token operator">&lt;-</span><span class="token number">1</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
           r_1<span class="token operator">&lt;-</span>r_2
           num<span class="token operator">&lt;-</span>num<span class="token operator">*</span><span class="token number">2</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     return<span class="token punctuation">(</span>list<span class="token punctuation">(</span>r_1<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token comment">#根据模糊等价关系得到的截矩阵，进行聚类</span>
   classcluster<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>r_lamda_loc<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        blist<span class="token operator">&lt;-</span>list<span class="token punctuation">(</span><span class="token punctuation">)</span>
        blist_num<span class="token operator">&lt;-</span><span class="token number">1</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span>nrow<span class="token punctuation">(</span>r_lamda_loc<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            r_first<span class="token operator">&lt;-</span>unique<span class="token punctuation">(</span>unlist<span class="token punctuation">(</span>r_lamda_loc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bl_f<span class="token operator">&lt;-</span>r_first
            bl_t<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>
            bl_2<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>
            rowmatch_l<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">while</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>bl_f<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
               <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>bl_f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                  rowmatch<span class="token operator">&lt;-</span>which<span class="token punctuation">(</span>r_lamda_loc<span class="token operator">==</span>bl_f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>arr.ind<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
                  bl<span class="token operator">&lt;-</span>unique<span class="token punctuation">(</span>unlist<span class="token punctuation">(</span>r_lamda_loc<span class="token punctuation">[</span>rowmatch<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  bl_2<span class="token operator">&lt;-</span>unique<span class="token punctuation">(</span>c<span class="token punctuation">(</span>bl_2<span class="token punctuation">,</span>bl<span class="token punctuation">)</span><span class="token punctuation">)</span>
                  bl_t<span class="token operator">&lt;-</span>unique<span class="token punctuation">(</span>c<span class="token punctuation">(</span>bl_t<span class="token punctuation">,</span>bl_f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  rowmatch_l<span class="token operator">&lt;-</span>unique<span class="token punctuation">(</span>c<span class="token punctuation">(</span>rowmatch_l<span class="token punctuation">,</span>rowmatch<span class="token punctuation">)</span><span class="token punctuation">)</span>
               <span class="token punctuation">}</span>

              <span class="token keyword">if</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>rowmatch_l<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                 r_lamda_loc<span class="token operator">&lt;-</span>r_lamda_loc<span class="token punctuation">[</span><span class="token operator">-</span>rowmatch_l<span class="token punctuation">,</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span>

              rowmatch_l<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>

             bl_f<span class="token operator">&lt;-</span>bl_2<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">(</span>bl_2<span class="token percent-operator operator">%in%</span>bl_t<span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>bl_f<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span> <span class="token operator">|</span> nrow<span class="token punctuation">(</span>r_lamda_loc<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                blist<span class="token punctuation">[</span><span class="token punctuation">[</span>blist_num<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span>bl_2
                blist_num<span class="token operator">&lt;-</span>blist_num<span class="token operator">+</span><span class="token number">1</span>
                <span class="token keyword">break</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        return<span class="token punctuation">(</span>blist<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">if</span><span class="token punctuation">(</span>class_level<span class="token operator">&gt;=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       message<span class="token punctuation">(</span><span class="token string">"pls input class_level lower than 1!"</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token comment">#计算相关矩阵</span>
   cormatrix<span class="token operator">&lt;-</span>cor<span class="token punctuation">(</span>mydf<span class="token punctuation">)</span>

   <span class="token comment">#输出变量及对应的id</span>
   varname<span class="token operator">&lt;-</span>attributes<span class="token punctuation">(</span>cormatrix<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
   id<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>varname<span class="token punctuation">)</span><span class="token punctuation">)</span>
   vardf<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>varname<span class="token operator">=</span>varname<span class="token punctuation">,</span>id<span class="token operator">=</span>id<span class="token punctuation">)</span>

   <span class="token comment">#计算模糊相似矩阵</span>
   fuzzysimilarmatrix<span class="token operator">&lt;-</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>cormatrix<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.5</span>

   <span class="token comment">#计算模糊等价关系</span>
   fuzzy_matrix<span class="token operator">&lt;-</span>fuzzyequal<span class="token punctuation">(</span>fuzzysimilarmatrix<span class="token punctuation">)</span>   
   res_lamda<span class="token operator">&lt;-</span>fuzzy_matrix<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>class_level

   <span class="token comment">#计算模糊聚类</span>
   r_lamda_loc<span class="token operator">&lt;-</span>as.data.frame<span class="token punctuation">(</span>which<span class="token punctuation">(</span>res_lamda <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;</span> lower.tri<span class="token punctuation">(</span>res_lamda<span class="token punctuation">,</span>diag<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span> arr.ind <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   blist<span class="token operator">&lt;-</span>classcluster<span class="token punctuation">(</span>r_lamda_loc<span class="token punctuation">)</span>
   <span class="token comment">#把模糊聚类结果和变量整合，最终输出变量聚类结果</span>
   varlist<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>
   classlist<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>

   <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>blist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       varnum<span class="token operator">&lt;-</span>blist<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
       class<span class="token operator">&lt;-</span>rep<span class="token punctuation">(</span>i<span class="token punctuation">,</span>length<span class="token punctuation">(</span>varnum<span class="token punctuation">)</span><span class="token punctuation">)</span>
       varlist<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>varlist<span class="token punctuation">,</span>varnum<span class="token punctuation">)</span>
       classlist<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>classlist<span class="token punctuation">,</span>class<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   class_res<span class="token operator">&lt;-</span>data.frame<span class="token punctuation">(</span>id<span class="token operator">=</span>varlist<span class="token punctuation">,</span>fuzzyclass<span class="token operator">=</span>classlist<span class="token punctuation">)</span>
   fuzzyres<span class="token operator">&lt;-</span>join<span class="token punctuation">(</span>vardf<span class="token punctuation">,</span>class_res<span class="token punctuation">)</span>
   return<span class="token punctuation">(</span>fuzzyres<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>根据模糊等价关系得到截矩阵》聚类》贪婪算法每次解决一个类别的变量聚类》循环</p> 
<h6><a id="3_211"></a>3.主成分分析</h6> 
<p>principal(x,nfactor=主成分个数，rotate=旋转方法(默认为最大方差旋转varimax),scores=F是否需要计算主成分得分)</p> 
<pre><code class="prism language-r">library<span class="token punctuation">(</span>psych<span class="token punctuation">)</span>
pca_eigen<span class="token operator">&lt;-</span><span class="token keyword">function</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span>cumproplevel<span class="token operator">=</span><span class="token number">0.85</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>   <span class="token comment">##cumproplevel:主成分累计贡献方差阈值</span>
    corrx<span class="token operator">&lt;-</span>cor<span class="token punctuation">(</span>df<span class="token punctuation">)</span>   <span class="token comment">#计算相关矩阵</span>
    colnum<span class="token operator">&lt;-</span>length<span class="token punctuation">(</span>df<span class="token punctuation">)</span>  <span class="token comment">#原始向量变量个数</span>
    eigenresult<span class="token operator">&lt;-</span>eigen<span class="token punctuation">(</span>corrx<span class="token punctuation">)</span>   <span class="token comment">#求相关矩阵特征值和特征向量</span>
    eigenvalue<span class="token operator">&lt;-</span>eigenresult<span class="token operator">$</span>values   <span class="token comment">#求相关矩阵特征值</span>
    eigenvector<span class="token operator">&lt;-</span>eigenresult<span class="token operator">$</span>vectors
    plot<span class="token punctuation">(</span>eigenvalue<span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span>main<span class="token operator">=</span><span class="token string">'Eigen for the Data'</span><span class="token punctuation">)</span>   <span class="token comment">#画碎石图</span>
    abline<span class="token punctuation">(</span>h<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>col<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>
    
    prop.eigen<span class="token operator">&lt;-</span>eigenvalue<span class="token operator">/</span>colnum  <span class="token comment">#计算每个主成份的方差贡献率</span>
    cum.prop<span class="token operator">&lt;-</span>cumsum<span class="token punctuation">(</span>prop.eigen<span class="token punctuation">)</span>   <span class="token comment">#计算累计方差贡献率</span>

    <span class="token comment">#判断达到累计贡献方差阀值的主成份个数</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sum<span class="token punctuation">(</span>cum.prop<span class="token operator">&lt;=</span>cumproplevel<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        tsprint<span class="token operator">&lt;-</span>paste<span class="token punctuation">(</span><span class="token string">"第一主成份方差贡献超过"</span><span class="token punctuation">,</span>cumproplevel<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
        principal_cnt<span class="token operator">&lt;-</span><span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        tsprint<span class="token operator">&lt;-</span>paste<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>cum.prop<span class="token operator">&lt;=</span><span class="token number">0.85</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"个主成份方差累计贡献超过"</span><span class="token punctuation">,</span>cumproplevel<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">'%'</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
        principal_cnt<span class="token operator">&lt;-</span>sum<span class="token punctuation">(</span>cum.prop<span class="token operator">&lt;=</span><span class="token number">0.85</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#创建结果矩阵</span>
    iocomponents<span class="token operator">&lt;-</span>matrix<span class="token punctuation">(</span>rep<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">*</span>colnum<span class="token punctuation">)</span><span class="token punctuation">,</span>nrow<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>ncol<span class="token operator">=</span>colnum<span class="token punctuation">)</span>
    iocomponents<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span>eigenvalue
    iocomponents<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span>prop.eigen
    iocomponents<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span>cum.prop

    rowname<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">"eigenvalue"</span><span class="token punctuation">,</span><span class="token string">"prop.eigen"</span><span class="token punctuation">,</span><span class="token string">"cum.prop"</span><span class="token punctuation">)</span>

    colname<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>colnum<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       colname<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span>colname<span class="token punctuation">,</span>paste<span class="token punctuation">(</span><span class="token string">"comp"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    dimnames<span class="token punctuation">(</span>iocomponents<span class="token punctuation">)</span><span class="token operator">&lt;-</span>list<span class="token punctuation">(</span>rowname<span class="token punctuation">,</span>colname<span class="token punctuation">)</span>

    <span class="token comment">#整个结果到一个列表输出</span>
    result<span class="token operator">&lt;-</span>list<span class="token punctuation">(</span>主成份情况<span class="token operator">=</span>tsprint<span class="token punctuation">,</span>主成分个数<span class="token operator">=</span>principal_cnt<span class="token punctuation">,</span>主成份结果<span class="token operator">=</span>iocomponents<span class="token punctuation">,</span>特征向量<span class="token operator">=</span>eigenvector<span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">#用原始数据作为输入，得到主成分个数</span>
setwd<span class="token punctuation">(</span><span class="token string">"C:\\Users\\用户路径"</span><span class="token punctuation">)</span>
pca<span class="token operator">&lt;-</span>read.csv<span class="token punctuation">(</span><span class="token string">"pcatest.csv"</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span>stringsAsFactors<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
pca_index<span class="token operator">&lt;-</span>pca_eigen<span class="token punctuation">(</span>pca<span class="token punctuation">)</span>
<span class="token comment">##碎石图判断主成分个数</span>

<span class="token comment">###关于主成分旋转</span>
<span class="token comment">#用相关矩阵作为输入</span>
pc<span class="token operator">&lt;-</span>principal<span class="token punctuation">(</span>Harman23.cor<span class="token operator">$</span>cov<span class="token punctuation">,</span> nfactors<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>rotate<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">)</span>
pc
<span class="token comment">#用方差极大旋转法（它试图对载荷阵的列进行去噪，使得每个成分只是由一组有限的变量来解释）</span>
rc<span class="token operator">&lt;-</span>principal<span class="token punctuation">(</span>Harman23.cor<span class="token operator">$</span>cov<span class="token punctuation">,</span> nfactors<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>rotate<span class="token operator">=</span><span class="token string">"varimax"</span><span class="token punctuation">)</span>
rc
<span class="token comment">#输出主成分得分</span>
round<span class="token punctuation">(</span>unclass<span class="token punctuation">(</span>rc<span class="token operator">$</span>weights<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>PC1：成分载荷，指观测变量与主成分的相关系数，成分载荷可用来解释主成分的含义。<br> h2：成分公因子方差，即主成分对每个变量的方差解释度。<br> u2：成分唯一性，即方差无法被主成分解释的比例(1-h2)。<br> SS loadings：与主成分相关联的特征值，指的是与特定主成分相关联的标准化后的方差值（在本例中，第一主成分的值为4.67）。<br> Proportion Var：每个主成分对整个数据集的解释程度。此处可以看到，第一主成分解释了58%的方差。<br> PC1=0.28<em>height+0.3</em>arm.span+0.3<em>forearm+0.28</em>lower.leg-0.06*weight（数值为标准化后的数据）</p> 
<pre><code class="prism language-r"><span class="token comment">##关于主成分的R函数</span>
<span class="token comment">###########  prcomp函数  ################</span>
<span class="token comment">#prcomp函数是对变量矩阵(相关矩阵)采用SVD方法计算其奇异值（原理上是特征值的平方根），函数帮助中描述为函数结果中的sdev。prcomp函数输入参数为变量矩阵（x）,center中心化 默认为true，scale标准化 默认为false，建议改为true，rank主成份个数。prcomp函数输出有sdev（各主成份的奇异值），rotation（特征向量，回归系数），x（score得分矩阵）。</span>
	iris.pca<span class="token operator">&lt;-</span>prcomp<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>scale<span class="token operator">=</span>T<span class="token punctuation">,</span>rank<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>retx<span class="token operator">=</span>T<span class="token punctuation">)</span> <span class="token comment">#相关矩阵分解</span>
	<span class="token comment">#scale表示要标准化，retx表四返回score</span>
	summary<span class="token punctuation">(</span>iris.pca<span class="token punctuation">)</span> <span class="token comment">#方差解释度</span>
	iris.pca<span class="token operator">$</span>sdev <span class="token comment">#特征值的开方 ，平方后代表的是每个主成分可以解释的数据差异</span>
	iris.pca<span class="token operator">$</span>rotation <span class="token comment">#特征向量，回归系数</span>
	iris.pca<span class="token operator">$</span>x <span class="token comment">#样本得分score</span>

<span class="token comment">#princomp函数：princomp以计算相关矩阵或者协方差矩阵的特征值为主要手段。princomp函数输出有主成份的sd,loading,score,center,scale.</span>
data<span class="token punctuation">(</span>wine<span class="token punctuation">)</span> <span class="token comment">#三种葡萄酿造的红酒品质分析数据集</span>
wine.pca<span class="token operator">&lt;-</span>princomp<span class="token punctuation">(</span>wine<span class="token punctuation">,</span>cor<span class="token operator">=</span>T<span class="token punctuation">,</span>scores<span class="token operator">=</span>T<span class="token punctuation">)</span> 
<span class="token comment">#默认方差矩阵(cor=F),改为cor=T则结果与prcomp相同</span>
summary<span class="token punctuation">(</span>wine.pca<span class="token punctuation">)</span> <span class="token comment">#各主成份的SVD值以及相对方差</span>
wine.pca<span class="token operator">$</span>loading <span class="token comment">#特征向量，回归系数</span>
wine.pca<span class="token operator">$</span>score
screenplot<span class="token punctuation">(</span>wine.pca<span class="token punctuation">)</span> <span class="token comment">#方差分布图</span>
biplot<span class="token punctuation">(</span>wine.pca<span class="token punctuation">,</span>scale<span class="token operator">=</span>F<span class="token punctuation">)</span> <span class="token comment">#碎石图,直接把x与rotation绘图，而不标准化</span>
</code></pre> 
<p>详细的Rcode可以看<a href="https://blog.csdn.net/nikang3148/article/details/85246555?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161672733416780271589277%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161672733416780271589277&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-5-85246555.pc_search_result_no_baidu_js&amp;utm_term=R%E8%AF%AD%E8%A8%80+principal+">R语言 PAC分析与可视化</a>.</p> 
<h6><a id="4_303"></a>4.因子分析</h6> 
<pre><code class="prism language-r">library<span class="token punctuation">(</span>psych<span class="token punctuation">)</span>
mtc<span class="token operator">&lt;-</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment">#获取数据</span>
corr<span class="token operator">&lt;-</span>cor<span class="token punctuation">(</span>mtc<span class="token punctuation">)</span>  <span class="token comment">#计算相关矩阵</span>
ss<span class="token operator">&lt;-</span>fa.parallel<span class="token punctuation">(</span>corr<span class="token punctuation">,</span>n.obs<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>fa<span class="token operator">=</span><span class="token string">"both"</span><span class="token punctuation">,</span>n.iter<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment">#平行法碎石图</span>
<span class="token number">1</span><span class="token operator">&lt;-</span>ss<span class="token operator">$</span>nfact  <span class="token comment">#确定因子个数</span>
factanal<span class="token punctuation">(</span>mtc<span class="token punctuation">,</span>factors<span class="token operator">=</span>factornum<span class="token punctuation">,</span>rotation <span class="token operator">=</span> <span class="token string">'varimax'</span><span class="token punctuation">)</span>   <span class="token comment">#正交旋转 因子之间独立</span>
factanal<span class="token punctuation">(</span>mtc<span class="token punctuation">,</span>factors<span class="token operator">=</span>factornum<span class="token punctuation">,</span>rotation <span class="token operator">=</span> <span class="token string">'promax'</span><span class="token punctuation">)</span>   <span class="token comment">#斜交旋转 因子之间相关性</span>
fa<span class="token operator">&lt;-</span>factanal<span class="token punctuation">(</span>mtc<span class="token punctuation">,</span>factors<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>rotation <span class="token operator">=</span> <span class="token string">'promax'</span><span class="token punctuation">,</span>scores <span class="token operator">=</span> <span class="token string">"regression"</span><span class="token punctuation">)</span>
fa<span class="token operator">$</span>scores    <span class="token comment">#斜交旋转且输出因子得分</span>
</code></pre> 
<p>loadings为因子载荷矩阵，p-value对应的原假设为H0:两因子是充分的。也可以用于判断因子个数的选择合理性。</p> 
<h4><a id="63_317"></a>6.3项目实践</h4> 
<h5><a id="631_318"></a>6.3.1变量筛选</h5> 
<p>#导入测试数据<br> tot&lt;-read.csv(“运营指标数据.csv”)<br> tot_df&lt;-tot[,-1]</p> 
<p>#执行层次聚类和模糊聚类<br> corres&lt;-varcluster_hc(tot_df,5)<br> fuzzyres&lt;-fuzzycluster(tot_df,0.885)<br> #整合两种聚类效果<br> varclust&lt;-join(fuzzyres[,-2],corres)<br> varclust[order(varclust<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         c 
        
       
         o 
        
       
         r 
        
       
         c 
        
       
         l 
        
       
         a 
        
       
         s 
        
       
         s 
        
       
         , 
        
       
         v 
        
       
         a 
        
       
         r 
        
       
         c 
        
       
         l 
        
       
         u 
        
       
         s 
        
       
         t 
        
       
      
        corclass,varclust 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">corc</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ss</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal">rc</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span></span></span></span></span>fuzzyclass),]<br> ##根据聚合的情况结合实际业务分析得到这些指标中最具代表性、业务上最容易解释的，制作起来最方便的指标即可。</p> 
<h5><a id="632_331"></a>6.3.2变量降维</h5> 
<h6><a id="1_332"></a>1.主成分分析</h6> 
<pre><code class="prism language-r">library<span class="token punctuation">(</span>psych<span class="token punctuation">)</span>
tot<span class="token operator">&lt;-</span>read.csv<span class="token punctuation">(</span><span class="token string">"运营指标数据.csv"</span><span class="token punctuation">)</span>
tot_df<span class="token operator">&lt;-</span>tot<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment">#根据前面分类效果，初步变量筛选</span>
var<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">'fltorderamount'</span><span class="token punctuation">,</span><span class="token string">'ordercnt_outland'</span><span class="token punctuation">,</span>
       <span class="token string">'ordercnt_atoutland'</span><span class="token punctuation">,</span><span class="token string">'pship_uv'</span><span class="token punctuation">,</span><span class="token string">'pgroup_uv'</span><span class="token punctuation">,</span>
       <span class="token string">'ios_active'</span><span class="token punctuation">,</span><span class="token string">'ordercnt'</span><span class="token punctuation">,</span><span class="token string">'htlordercnt'</span><span class="token punctuation">,</span><span class="token string">'trnordercnt'</span><span class="token punctuation">,</span>
       <span class="token string">'ttdordercnt'</span><span class="token punctuation">,</span><span class="token string">'actordercnt'</span><span class="token punctuation">,</span><span class="token string">'uv'</span> <span class="token punctuation">,</span><span class="token string">'uv_h5'</span><span class="token punctuation">,</span><span class="token string">'fn_uv'</span><span class="token punctuation">,</span>
       <span class="token string">'hn_uv'</span><span class="token punctuation">,</span><span class="token string">'act_uv'</span><span class="token punctuation">,</span><span class="token string">'bus_uv'</span><span class="token punctuation">,</span><span class="token string">'pticket_uv'</span><span class="token punctuation">,</span><span class="token string">'train_uv'</span><span class="token punctuation">,</span>
       <span class="token string">'total_uid'</span><span class="token punctuation">,</span><span class="token string">'active'</span>
      <span class="token punctuation">)</span>
tot_res<span class="token operator">&lt;-</span>tot_df<span class="token punctuation">[</span><span class="token punctuation">,</span>var<span class="token punctuation">]</span>

<span class="token comment">#得到主成分个数</span>
pca_eigen<span class="token punctuation">(</span>tot_res<span class="token punctuation">)</span>

<span class="token comment">#用方差极大旋转法得到主成分得分</span>
rc<span class="token operator">&lt;-</span>principal<span class="token punctuation">(</span>tot_res<span class="token punctuation">,</span>nfactors<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>rotate<span class="token operator">=</span><span class="token string">"varimax"</span><span class="token punctuation">)</span>
<span class="token comment">#输出主成分得分</span>
round<span class="token punctuation">(</span>unclass<span class="token punctuation">(</span>rc<span class="token operator">$</span>weights<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>PC1=-0.06<em>orderamount-0.01</em>ordercnt_outland-0.12*ordercnt_atoutland<br> ……</p> 
<h6><a id="2_360"></a>2.因子分析</h6> 
<pre><code class="prism language-r">library<span class="token punctuation">(</span>psych<span class="token punctuation">)</span>
corr<span class="token operator">&lt;-</span>cor<span class="token punctuation">(</span>tot_res<span class="token punctuation">)</span>   <span class="token comment">#计算相关矩阵</span>
ss<span class="token operator">&lt;-</span>fa.parallel<span class="token punctuation">(</span>corr<span class="token punctuation">,</span>n.obs<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>fa<span class="token operator">=</span><span class="token string">"both"</span><span class="token punctuation">,</span>n.iter<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>   <span class="token comment">#平行法碎石图</span>
factornum<span class="token operator">&lt;-</span>ss<span class="token operator">$</span>nfact   <span class="token comment">#确定因子个数</span>
factanal<span class="token punctuation">(</span>tot_res<span class="token punctuation">,</span>factors<span class="token operator">=</span>factornum<span class="token punctuation">,</span>rotation <span class="token operator">=</span> <span class="token string">'varimax'</span><span class="token punctuation">)</span>    <span class="token comment">#正交旋转  PC actual data</span>
factanal<span class="token punctuation">(</span>tot_res<span class="token punctuation">,</span>factors<span class="token operator">=</span>factornum<span class="token punctuation">,</span>rotation <span class="token operator">=</span> <span class="token string">'promax'</span><span class="token punctuation">)</span>     <span class="token comment">#斜交旋转 FA actual data</span>
<span class="token comment">#用斜交旋转，并输出因子得分（由平行碎石图判断选取方法）</span>
fa<span class="token operator">&lt;-</span>factanal<span class="token punctuation">(</span>tot_res<span class="token punctuation">,</span>factors<span class="token operator">=</span>factornum<span class="token punctuation">,</span>rotation <span class="token operator">=</span> <span class="token string">'promax'</span><span class="token punctuation">,</span>score<span class="token operator">=</span><span class="token string">"regression"</span><span class="token punctuation">)</span>
fa<span class="token operator">$</span>score
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3c1757c1ca0e8e1bb3803942b0d798ca/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【嵌入式】飞凌嵌入式ELF1开发板 初体验 | 嵌入式Linux开发</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d7f83d4ae245064cb835764f404505df/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">搭建个人深度学习工作站（捡垃圾）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>