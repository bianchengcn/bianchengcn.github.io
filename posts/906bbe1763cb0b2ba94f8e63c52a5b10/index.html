<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java-String长度限制 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java-String长度限制" />
<meta property="og:description" content="文章目录 String数据结构限制JVM规范限制总结 String数据结构限制 Java中String用char value[]存储：
/** The value is used for character storage. */ private final char value[]; String长度length()取自数组长度，返回类型是int
/** * Returns the length of this string. * The length is equal to the number of &lt;a href=&#34; &#34;&gt;Unicode * code units&lt;/a &gt; in the string. * * @return the length of the sequence of characters represented by this * object. */ public int length() { return value.length; } 从这方面看，String的长度上限应该是Java中int的上限，即 2^31 - 1 = 2147483647，在Java中 char类型占2 byte（Character." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/906bbe1763cb0b2ba94f8e63c52a5b10/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-22T00:12:30+08:00" />
<meta property="article:modified_time" content="2021-11-22T00:12:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java-String长度限制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#String_1" rel="nofollow">String数据结构限制</a></li><li><a href="#JVM_28" rel="nofollow">JVM规范限制</a></li><li><a href="#_95" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="String_1"></a>String数据结构限制</h2> 
<p>Java中String用<code>char value[]</code>存储：</p> 
<pre><code class="prism language-java"><span class="token comment">/** The value is used for character storage. */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">char</span> value<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>String长度<code>length()</code>取自数组长度，返回类型是<code>int</code></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * Returns the length of this string.
 * The length is equal to the number of &lt;a href=" "&gt;Unicode
 * code units&lt;/a &gt; in the string.
 *
 * @return  the length of the sequence of characters represented by this
 *          object.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>从这方面看，String的长度上限应该是Java中<code>int</code>的上限，即 2^31 - 1 = 2147483647，在Java中 <code>char</code>类型占2 byte（<strong>Character.BYTES = 2</strong>），因此String最大占用 2 * (2^31 - 1) = 2^32 - 2，约为4GB</p> 
<h2><a id="JVM_28"></a>JVM规范限制</h2> 
<p>如果String定义成字面量的形式时，JVM编译时，String会被存放在常量池中</p> 
<pre><code class="prism language-java"><span class="token comment">//字面量</span>
<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"巴勃罗·迭戈·何塞·弗朗西斯科·狄·保拉·胡安·纳波穆西诺·玛莉亚·狄·洛斯·雷梅迪奥斯·西普里亚诺·狄·拉·圣地西玛·特里尼达·路易斯·毕加索"</span><span class="token punctuation">;</span>
</code></pre> 
<p>而JVM对常量池中存放的数据是有限制的，String的常量池项类型CONSTANT_String_info结构说明：</p> 
<p><img src="https://images2.imgbox.com/ed/db/XVi0U3G4_o.png" alt="截图"></p> 
<p>这里<code>u1</code>表示1个无符号字节，<code>u2</code>表示2个无符号字节。在class文件的常量池数组中，用1个字节的<code>tag</code>=8表示<code>String</code>，接下来的用2个字节表示具体某个<code>CONSTANT_Utf8_info</code>在常量池中的索引</p> 
<p><img src="https://images2.imgbox.com/98/f9/NlcuNYNo_o.png" alt="截图"></p> 
<p><code>CONSTANT_String_info</code>结构体中的<code>string_index</code>的值指向了<code>CONSTANT_Utf8_info</code>结构体，而字符串的utf-8编码数据就在这个结构体之中</p> 
<p><img src="https://images2.imgbox.com/43/28/1F7ttLiT_o.png" alt="截图"></p> 
<p>如定义一个Java类文件 StringConstant.java：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wkw<span class="token punctuation">.</span>comprehensive<span class="token punctuation">.</span>jdk</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringConstant</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">"test1"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">"test2"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"test3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>JVM编译为class文件StringConstant.class，使用<code>javap -verbose StringConstant.class</code>输出class文件具体内容：</p> 
<pre><code>Classfile /Users/developmac/workspace/develop/ideaWorkspace/comprehensive-learning/src/main/com/wkw/comprehensive/jdk/StringConstant.class
  Last modified 2021-6-10; size 605 bytes
  MD5 checksum b45b97cee3142d0b2df8ad70a9ed8487
  Compiled from "StringConstant.java"
public class com.wkw.comprehensive.jdk.StringConstant
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   #1 = Methodref          #10.#23        // java/lang/Object."&lt;init&gt;":()V
   #2 = String             #24            // test2
  ......
   #24 = Utf8               test2
  ......
</code></pre> 
<p>可以看到常量池中索引为2的常量是一个<code>String</code>，它指向了常量池中索引为24的常量为test2</p> 
<hr> 
<p>综上所述，字符串字面量的长度应该是<code>CONSTANT_Utf8_info</code>.<code>length</code>最大能表示的范围：2个无符号字节大小，即 2^16-1=65535</p> 
<p>但是JVM还需要1个字节的指令作为结束，所以其实真正的有效范围是[0, 65564]，这里要注意这里的范围<strong>仅限编译时期</strong>，如果是运行<strong>时拼接的字符串是可以超出这个范围的</strong>。</p> 
<br> 
<h2><a id="_95"></a>总结</h2> 
<ol><li><strong>运行时拼接或者赋值的话范围是在整形的最大范围</strong>，而字符串的内容是由一个字符数组 char[] 来存储的，由于数组的长度及索引是整数，且String类中返回字符串长度的方法length() 的返回值也是int ，所以通过查看java源码中的类Integer我们可以看到Integer的最大范围是2^31 -1,由于数组是从0开始的，所以<strong>数组的最大长度可以使[0, 2^31-1]，约为4GB</strong>；</li><li>直接定义字符串字面量的，由于JVM限制，长度为[0, 65534]。</li></ol> 
<br> 
<p>参考：</p> 
<p><a href="https://mp.weixin.qq.com/s/k6VmaEFY8W2POr6QIFGZgA" rel="nofollow">*面试官：String的长度有限制吗？是多少？</a></p> 
<p><a href="https://blog.csdn.net/TomAndersen/article/details/107147344">java字符串字面量是何时进入到字符串常量池中的</a></p> 
<p><a href="https://blog.csdn.net/wangtaomtk/article/details/52267548">*Class文件中的常量池详解（上）</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b31332c588835fe0f02f401232f4b111/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">简单的递归思想： gcd（最大公因数）&#43;hanoi（汉诺塔）&#43;quicksort（快排）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0a60f9bb064619c07b4a5725ba7ae9cb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">编译原理 实验4 语义分析（基于PL/0，使用C&#43;&#43;代码编写）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>