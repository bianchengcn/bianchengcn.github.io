<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python3 setproctitle多进程重命名详解 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python3 setproctitle多进程重命名详解" />
<meta property="og:description" content="今天由于便于管理，需要修改多进程（包括子进程）的名称，网上的资料不多，基本上没有我想要的案例，今天摸索了下才实现了我的目的，下面具体说一下。
首先，修改进程名，主要依靠一个第三方的模块：setproctitle 详情见：setproctitle · PyPI
用法很简单，基本就两个方法：
setproctitle(title)
Set title as the title for the current process.
getproctitle()
Return the current process title
我们先来一个例子，如下代码：
# -*- coding: utf-8 -*- from multiprocessing import Process import time import setproctitle def task(name): print(&#34;name=&#34;,name) time.sleep(30) if __name__ == &#34;__main__&#34;: setproctitle.setproctitle(&#39;python3 main--&#39;) start = time.time() p1 = Process(target=task,args=(&#34;safly1&#34;,),name=&#39;python3 safly1&#39;) p2 = Process(target=task, args=(&#34;safly2&#34;,),name=&#39;python3 safly2&#39;) p3 = Process(target=task, args=(&#34;safly3&#34;,),name=&#39;python3 safly3&#39;) p1.start() p2.start() p3.start() p1.join() p2.join() p3.join() print(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/4d9eb31ac37c02f58a89415c3fc6ecb2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-21T10:45:42+08:00" />
<meta property="article:modified_time" content="2023-06-21T10:45:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python3 setproctitle多进程重命名详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>今天由于便于管理，需要修改多进程（包括子进程）的名称，网上的资料不多，基本上没有我想要的案例，今天摸索了下才实现了我的目的，下面具体说一下。</p> 
<p></p> 
<p>首先，修改进程名，主要依靠一个第三方的模块：setproctitle   详情见：<a href="https://pypi.org/project/setproctitle/" rel="nofollow" title="setproctitle · PyPI">setproctitle · PyPI</a></p> 
<p>用法很简单，基本就两个方法：</p> 
<p>setproctitle(title)</p> 
<p>Set <em>title</em> as the title for the current process.</p> 
<p>getproctitle()</p> 
<p>Return the current process title</p> 
<p></p> 
<p>我们先来一个例子，如下代码：</p> 
<pre class="has"><code class="language-python"># -*- coding: utf-8 -*-

from multiprocessing import  Process

import  time

import setproctitle

def task(name):

    print("name=",name)

    time.sleep(30)

if __name__ == "__main__":

    setproctitle.setproctitle('python3 main--')

    start = time.time()

    p1 = Process(target=task,args=("safly1",),name='python3 safly1')

    p2 = Process(target=task, args=("safly2",),name='python3 safly2')

    p3 = Process(target=task, args=("safly3",),name='python3 safly3')

    p1.start()

    p2.start()

    p3.start()

    p1.join()

    p2.join()

    p3.join()

    print("main")

    print(p1.name)

    print(p2.name)

    print(p3.name)

    end = time.time()

    print(end- start)</code></pre> 
<p></p> 
<p>上面代码在linux下运行后在终端打印的输出为：</p> 
<p><img alt="" class="has" height="123" src="https://images2.imgbox.com/b2/81/vjFWblVh_o.png" width="459"></p> 
<p></p> 
<p>输出没有问题，我们再通过ps -ef|grep python命令来看下查找出来的结果：</p> 
<p></p> 
<p><img alt="" class="has" height="53" src="https://images2.imgbox.com/a7/ec/sVIn1M6B_o.png" width="518"></p> 
<p>发现，输出的四个进程为均为：python3 main--  </p> 
<p></p> 
<p>父子进程名均为python3 main--，这是没问题的，因为在启动多进程里，通过fork出来的子进程的内存空间和父进程是一样的。</p> 
<p></p> 
<p>这里我们需要提醒大家的是，Process(target=task,args=("safly1",),name='python3 safly1')  这里通过name传参数的name并不是修改程序在服务器中运行时系统分配的进程名，这里的name其实就是这个进程环境内的一个属性，也可以看作是这个进程的内存空间里的标记吧，仅此而已，实际中很多同学不小心就默认把它当进程名为对待，这个说法不完全正确。如果需要修改进程在服务器系统中的进程名称，那可以按如下：</p> 
<pre class="has"><code class="language-python"># -*- coding: utf-8 -*-

from multiprocessing import  Process

import  time

import setproctitle

def task(name):

    print("name=",name)

    time.sleep(30)

if __name__ == "__main__":

    setproctitle.setproctitle('python3 main--')

    start = time.time()

    p1 = Process(target=task,args=("safly1",),name='python3 safly1')

    p2 = Process(target=task, args=("safly2",),name='python3 safly2')

    p3 = Process(target=task, args=("safly3",),name='python3 safly3')

    p1.start()

    setproctitle.setproctitle('python3 main--1')

    print(setproctitle.getproctitle())

    p2.start()

    setproctitle.setproctitle('python3 main--2')

    print(setproctitle.getproctitle())

    p3.start()

    setproctitle.setproctitle('python3 main--3')

    print(setproctitle.getproctitle())

    p1.join()

    p2.join()

    p3.join()

    print("main")

    print(p1.name)

    print(p2.name)

    print(p3.name) 

    end = time.time()

    print(end- start)</code></pre> 
<p></p> 
<p>上面代码在linux终端上的输出为：</p> 
<p><img alt="" class="has" height="159" src="https://images2.imgbox.com/a3/94/HKD5RAVF_o.png" width="523"></p> 
<p></p> 
<p>查找进程信息 ps -ef|grep python3</p> 
<p></p> 
<p><img alt="" class="has" height="58" src="https://images2.imgbox.com/8e/04/a3WG4ORt_o.png" width="541"></p> 
<p></p> 
<p>如上所示，就可以通过命令ps来监控查询进程了。</p> 
<p></p> 
<p></p> 
<p>注意注意！！！</p> 
<p>也许有人并没有发现上述所存在的问题，我在这里特别说明一下，上面的子进程在使用setproctitle.setproctitle('python3 XX')时是有误的，如上代码，通过PS命令可 以看到父进程ID和子进程ID，和进程名是配对乱了。解决上述问题的核心是，必须在调用的函数task里执行setproctitle.setproctitle才不会导致错乱。如下片段代码为正确的：</p> 
<pre class="has"><code>def task(queue_name,threads_max):

    setproctitle.setproctitle('python3-spider&lt;%s&gt;-start.py' % queue_name)
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/28c5f04518d891fd3a574774c0a78ca3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据库三大范式讲解实用篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1c3abebb02da57e65a704203ad17b36d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用esp32&#43;micropython&#43;microdot搭建web(http&#43;websocket)服务器（超详细）第一部分</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>