<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用FLIR热数据集跑yolov5 个人踩坑大全 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="用FLIR热数据集跑yolov5 个人踩坑大全" />
<meta property="og:description" content="版本：yolov5-v5.0
环境：python3.8&#43;anaconda3_2020.7&#43;cuda10.1.105
数据集：FLIR_ADAS_1_3.tar
1、问题：ImportError: The _imagingft C module is not installed 在测试YOLO v5时出现错误提示：
ImportError: The _imagingft C module is not installed
经查是pillow库的问题
解决 windows系统
卸载pillow,重新安装
pip uninstall pillow pip3 install pillow 加上 --no-cache-dir参数：
pip3 install pillow --no-cache-dir Ubuntu系统
卸载同上
然后安装devel
sudo apt-get install libtiff-devel libjpeg-devel libzip-devel freetype-devel lcms2-devel libwebp-devel tcl-devel tk-devel 最后重新安装。
注：适用于代码中导入语句为：
from PIL import ImageFont 2、问题：train: Scanning ‘data\labels\train.cache’ images and labels… 0 found, 1000 missing, 0 empty, 0 corrupted: 100% 解决 （1）数据集格式不对" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/747d496f5013b8f9518d5093607a6e04/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-17T17:34:55+08:00" />
<meta property="article:modified_time" content="2022-05-17T17:34:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用FLIR热数据集跑yolov5 个人踩坑大全</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>版本：yolov5-v5.0<br> 环境：python3.8+anaconda3_2020.7+cuda10.1.105<br> 数据集：FLIR_ADAS_1_3.tar</p> 
<h3><a id="1ImportError_The__imagingft_C_module_is_not_installed_3"></a>1、问题：ImportError: The _imagingft C module is not installed</h3> 
<p>在测试YOLO v5时出现错误提示：<br> <strong>ImportError: The _imagingft C module is not installed</strong><br> 经查是pillow库的问题</p> 
<h2><a id="_8"></a>解决</h2> 
<p><strong>windows系统</strong><br> 卸载pillow,重新安装</p> 
<pre><code class="prism language-python1">pip uninstall pillow
</code></pre> 
<pre><code class="prism language-python">pip3 install pillow
</code></pre> 
<p>加上 --no-cache-dir参数：</p> 
<pre><code class="prism language-powershell">pip3 install pillow <span class="token operator">--</span>no-cache-<span class="token function">dir</span>
</code></pre> 
<p><strong>Ubuntu系统</strong><br> 卸载同上<br> 然后安装devel</p> 
<pre><code class="prism language-powershell">sudo apt-get install libtiff-devel libjpeg-devel libzip-devel freetype-devel lcms2-devel libwebp-devel tcl-devel tk-devel
</code></pre> 
<p>最后重新安装。<br> 注：适用于代码中导入语句为：</p> 
<pre><code class="prism language-powershell"><span class="token keyword">from</span> PIL import ImageFont
</code></pre> 
<h3><a id="2train_Scanning_datalabelstraincache_images_and_labels_0_found_1000_missing_0_empty_0_corrupted_100_38"></a>2、问题：train: Scanning ‘data\labels\train.cache’ images and labels… 0 found, 1000 missing, 0 empty, 0 corrupted: 100%</h3> 
<p><img src="https://images2.imgbox.com/c8/a9/8a5PLNdE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_40"></a>解决</h3> 
<p><strong>（1）数据集格式不对</strong><br> 正确voc格式如下：train文件夹含images和labels两个文件夹，同样的，valid文件夹、test文件夹也都含images和labels两个文件夹<br> <img src="https://images2.imgbox.com/82/81/eFNGyo8v_o.png" alt="在这里插入图片描述"><br> <strong>（2）yolov5数据集格式的label要求txt格式。</strong><br> FLIR数据集自带label存放在一个.json文件中，需要转成txt标签。<br> <strong>（3）images和labels名称必须一一对应。</strong><br> 我之前的labels在文件名前多加了label字样，最后导致标签全部missing，查了好久。</p> 
<h3><a id="3_49"></a>3、问题:</h3> 
<p><img src="https://images2.imgbox.com/02/11/4U483ZSh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_52"></a>解决</h3> 
<p>torch包环境、pycharm库和yolov5需求版本不同，用清华源最快解决</p> 
<pre><code class="prism language-powershell">pip install opencv-python==4<span class="token punctuation">.</span>2<span class="token punctuation">.</span>0<span class="token punctuation">.</span>32 <span class="token operator">-</span>i https:<span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn/simple
</code></pre> 
<h3><a id="4subprocessCalledProcessError_Command_pip_install_googleauth2163_returned_nonzero_exit_status_1_58"></a>4、问题：subprocess.CalledProcessError: Command ‘pip install ‘google-auth&lt;2,&gt;=1.6.3’’ returned non-zero exit status 1.</h3> 
<p><img src="https://images2.imgbox.com/8c/f1/KAu06Asr_o.png" alt="在这里插入图片描述"><br> 必须把tensorboard卸载之后再下载google-auth，不然报错解决不了。</p> 
<pre><code class="prism language-powershell">pip uninstall google-auth
</code></pre> 
<pre><code class="prism language-powershell">pip uninstall tensorboard
</code></pre> 
<pre><code class="prism language-powershell">pip install <span class="token operator">--</span>upgrade google-auth
</code></pre> 
<pre><code class="prism language-powershell">pip install tensorboard
</code></pre> 
<h3><a id="5FileNotFoundError_Errno_2_No_such_file_or_directory_yolov5spt_Download_error_WinError_10060__ERROR_Download_failure_yolov5spt_missing_try_downloading_from_httpsgithubcomultralyticsyolov5releases_74"></a>5、问题：FileNotFoundError: [Errno 2] No such file or directory: ‘yolov5s.pt’ Download error: [WinError 10060] 由于连接方在一段时间后没有正确答复或连接的主机没有反应，连接尝试失败。 ERROR: Download failure: yolov5s.pt missing, try downloading from https://github.com/ultralytics/yolov5/releases/</h3> 
<p>网速太慢，建议直接下载权重文件放在weights文件夹下。<br> <strong>yolov5l.pt yolov5m.pt yolov5s.pt yolov5n.pt yolov5x.pt</strong><br> 分享给你们了，自取。网上都付费。<br> <strong>百度网盘链接：https://pan.baidu.com/s/1af4C3qlYU4cQFRkHHWX_1Q<br> 提取码：f3rw</strong></p> 
<h3><a id="6AttributeError_Cant_get_attribute_SPPF_on_module_modelscommon_from_Fgrayolov5v50modelscommonpy_82"></a>6、问题：AttributeError: Can’t get attribute ‘SPPF’ on &lt;module ‘models.common’ from ‘F:\gra\yolov5-v5.0\models\common.py’&gt;</h3> 
<p><img src="https://images2.imgbox.com/11/19/unvLM5fH_o.png" alt="在这里插入图片描述"><br> 修改一下那个models文件夹下的common.py<br> <img src="https://images2.imgbox.com/1e/bd/HiGRMw5w_o.png" alt="在这里插入图片描述"><br> 添加下面代码即可</p> 
<pre><code class="prism language-powershell">import warnings
 
 
<span class="token keyword">class</span> SPPF<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span>:
    <span class="token comment"># Spatial Pyramid Pooling - Fast (SPPF) layer for YOLOv5 by Glenn Jocher</span>
    def __init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> k=5<span class="token punctuation">)</span>:  <span class="token comment"># equivalent to SPP(k=(5, 9, 13))</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        c_ = c1 <span class="token operator">/</span><span class="token operator">/</span> 2  <span class="token comment"># hidden channels</span>
        self<span class="token punctuation">.</span>cv1 = Conv<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c_<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 1<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cv2 = Conv<span class="token punctuation">(</span>c_ <span class="token operator">*</span> 4<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 1<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>m = nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size=k<span class="token punctuation">,</span> stride=1<span class="token punctuation">,</span> padding=k <span class="token operator">/</span><span class="token operator">/</span> 2<span class="token punctuation">)</span>
 
    def forward<span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span>:
        x = self<span class="token punctuation">.</span>cv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        with warnings<span class="token punctuation">.</span>catch_warnings<span class="token punctuation">(</span><span class="token punctuation">)</span>:
            warnings<span class="token punctuation">.</span>simplefilter<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>  <span class="token comment"># suppress torch 1.9.0 max_pool2d() warning</span>
            y1 = self<span class="token punctuation">.</span>m<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            y2 = self<span class="token punctuation">.</span>m<span class="token punctuation">(</span>y1<span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>cv2<span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token function">cat</span><span class="token punctuation">(</span><span class="token namespace">[x, y1, y2, self.m(y2)]</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="7OSError_WinError_1455__Error_loading_DAnaconda3_2020envstorchlibsitepackagestorchlibcaffe2_detectron_ops_gpudll_or_one_of_its_dependencies_111"></a>7、问题：OSError: [WinError 1455] 页面文件太小，无法完成操作。 Error loading “D:\Anaconda3_2020\envs\torch\lib\site-packages\torch\lib\caffe2_detectron_ops_gpu.dll” or one of its dependencies.</h3> 
<p><img src="https://images2.imgbox.com/df/d6/kJuc62ZA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_114"></a>解决</h3> 
<p>网上搜的是删除这个文件，但我试过了，删了这个.dll文件还有其他.dll文件报错。最根本原因是电脑显存不够了，跑不动了。我的电脑配置是i7-9750H+rtx2060+8G，batch=4电脑直接跑爆炸，显示器直接缓存不足。我跑的还是yolov5s.yaml，想象不到跑l的时候的样子哈哈。<br> 废话不多说，我的解决办法是把train.py里面的配置文件batch_size改成1，把datasets.py文件中的num_workers线程改成0。可能笔记本跑不动多线程。<br> <img src="https://images2.imgbox.com/01/cf/wTrvfRai_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f5/af/pLW0HEKj_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0de84d1130a3d308d36874ae1b3f4297/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python一段字符串仅包含小写字母和下划线且必须包含小写字母</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d6d1c093444ce983f84524584f30767/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阿里面试官：你先简单说说JVM 是如何管理内存的吧？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>