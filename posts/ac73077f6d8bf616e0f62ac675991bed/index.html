<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ajax的success函数获取不到返回的值（或者返回的json带有K_BackingField） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ajax的success函数获取不到返回的值（或者返回的json带有K_BackingField）" />
<meta property="og:description" content="首先看下我们的ajax： $.ajax({ url: &#34;Handler/GetUsers.ashx&#34;,//路径 type: &#34;get&#34;,//get请求 data: { &#34;LoginName&#34;: &#34;Admin&#34; }, dataType:&#34;json&#34;, async: false,//同步 cache: false,//不缓存 //成功调用的函数 success: function (datas) { alert(datas); //这里如果返回{object:object} alert(datas.LoginName);//而这里在f12调式工具中提示错误,或者为undefined,并且LoginName并没有写错 }, //发生错误调用的函数 error: function (errmsg) { alert(&#34;发生错误！&#34;); } }); 接下来看我们的ashx(一般处理程序) public void ProcessRequest (HttpContext context) { context.Response.ContentType = &#34;text/plain&#34;; string LoginName = context.Request.Params[&#34;LoginName&#34;]; Users model = new TestService().GetList_Users(LoginName); DataContractJsonSerializer ds = new DataContractJsonSerializer(typeof(Users)); ds.WriteObject(context.Response.OutputStream, model); } 我们用的是DataContractJsonSerializer这个类去序列化成json,并返回值
(注意：用DataContractJsonSerializer需引用命名空间 System.Runtime.Serialization.Json;)
接下来我们看看我们ajax获取到的datas是什么？ 运行vs，等执行了ajax并且返回了值我们按f12进入tiao调试者工具。找到Network这个选项点击
找到对应的ashx,你会发现我们的键值中的键跟我们model中的不一样,多出来K_BackingField这一项.
这是怎么回事呢？那是因为我们序列化的这个类中被我们加上了[Serializable]这个特性，我们只用这样写就可以正常获取了
[Serializable] [DataContract] public class Users { [DataMember] public int Uid {get;set;}//Id [DataMember] public string LoginName {get;set;}//登陆账号 [DataMember] public string LoginPwd {get;set;}//登陆密码 [DataMember] public int Rid {get;set;}//角色id [DataMember] public int EId { get; set; }//员工id } 在类加上一个[DataContract]这个特性,下面的列也要加上[DataMember]这个特性，这样我们获取的json就不会出现K_BackingField了。注意 需引用命名空间using System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ac73077f6d8bf616e0f62ac675991bed/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-03T14:35:56+08:00" />
<meta property="article:modified_time" content="2018-08-03T14:35:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ajax的success函数获取不到返回的值（或者返回的json带有K_BackingField）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>首先看下我们的ajax：</h3> 
<pre class="has"><code class="hljs language-javascript">
            $.ajax({
                url: "Handler/GetUsers.ashx",//路径
                type: "get",//get请求
                data: { "LoginName": "Admin" },
                dataType:"json",
                async: false,//同步
                cache: false,//不缓存
                //成功调用的函数
                success: function (datas) {
                    alert(datas); //这里如果返回{object:object}
                    alert(datas.LoginName);//而这里在f12调式工具中提示错误,或者为undefined,并且LoginName并没有写错
                },
                //发生错误调用的函数
                error: function (errmsg) {
                    alert("发生错误！");
                }
            });</code></pre> 
<h3>接下来看我们的ashx(一般处理程序)</h3> 
<pre class="has"><code class="hljs language-cs"> public void ProcessRequest (HttpContext context) {
        context.Response.ContentType = "text/plain";
        string LoginName = context.Request.Params["LoginName"];
        Users model = new TestService().GetList_Users(LoginName);
        DataContractJsonSerializer ds = new DataContractJsonSerializer(typeof(Users));
        ds.WriteObject(context.Response.OutputStream, model);

    }</code></pre> 
<p>我们用的是DataContractJsonSerializer这个类去序列化成json,并返回值</p> 
<p>(注意：用DataContractJsonSerializer需引用命名空间 System.Runtime.Serialization.Json;)</p> 
<h3>接下来我们看看我们ajax获取到的datas是什么？</h3> 
<p>运行vs，等执行了ajax并且返回了值我们按f12进入tiao调试者工具。找到Network这个选项点击</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/9b/c1/uoD8UU27_o.png"></p> 
<p>找到对应的ashx,你会发现我们的键值中的键跟我们model中的不一样,多出来K_BackingField这一项.</p> 
<p> <img alt="" class="has" src="https://images2.imgbox.com/60/e3/5eaO8MbX_o.png"></p> 
<p>这是怎么回事呢？那是因为我们序列化的这个类中被我们加上了[Serializable]这个特性，我们只用这样写就可以正常获取了</p> 
<pre class="has"><code class="hljs language-cs">    [Serializable]
    [DataContract]
    public class Users
    {
        [DataMember]
        public int Uid {get;set;}//Id
        [DataMember]
        public string LoginName  {get;set;}//登陆账号
        [DataMember]
        public string LoginPwd  {get;set;}//登陆密码
        [DataMember]
        public int Rid {get;set;}//角色id
        [DataMember]
        public int EId { get; set; }//员工id
    }</code></pre> 
<p>在类加上一个[DataContract]这个特性,下面的列也要加上[DataMember]这个特性，这样我们获取的json就不会出现K_BackingField了。注意 需引用命名空间using System.Runtime.Serialization。</p> 
<p>然后我们重新生成,进行运行vs查看效果。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/23/7b/YBKeqBFs_o.png"></p> 
<p>我们的json数据没有了K_BackingField了，datas.LoginName获取的也是正常的数据了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9aa598272677a6970c0463fc7a7be18b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">jpg转svg文字路径动画</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fd4ac8c906be6012fdaaf4fa5534140f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu 虚拟机设置root密码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>