<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【微信小程序开发】之微信授权登陆 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【微信小程序开发】之微信授权登陆" />
<meta property="og:description" content="目录
前言
​编辑一、微信授权登陆介绍
1. 基本概念
2. 微信小程序开发实现微信授权登陆原理流程
3. 小程序中运用微信授权登陆的好处
二、微信授权登陆接口演示
1. 在微信开发工具中导入小程序授权微信登陆前端项目
2. 微信授权登陆的方式
2.1 wx.login
2.2 wx.getUserProfile
2.3 二者的区别
三、 小程序微信授权登陆流程
1. 流程图
2. 代码调试
2.1 导入调试后端代码
2.2 导入调试前端代码
2.3 效果演示
3. 代码
小程序前端代码
login.wxml
login.js
后端代码
IpUtil.java
WxAuthController.java
WxHomeController.java
WxInfoController.java
WxUserController.java
四、解决微信名称含特殊标签符号的存储问题
1. 配置my.ini文件
2. 重启我们的数据库服务
3. 点击多账号调试
前言 在上一期的博客中与大家分享了微信小程序开发会议OA项目首页数据的后台交互，以及在其中使用到工具文件来实现便捷的去调用请求访问后台的接口方法，还涉及了.wxs文件的介绍和使用。今天给大家带来的是微信小程序开发之微信授权登陆，让我们一起来了解了解吧。
一、微信授权登陆介绍 1. 基本概念 微信授权登录是指用户通过微信账号登录第三方应用或网站的一种身份验证方式。当用户在第三方应用或网站上选择使用微信登录时，该应用或网站会跳转到微信登录页面，用户在此页面输入微信账号和密码进行登录。一旦用户成功登录并授权，第三方应用或网站就能够获得用户在微信上的基本信息，如昵称、头像等，并用于用户在应用或网站上的个性化服务。这种授权登录的方式方便用户快速登录第三方平台，同时减少了用户填写注册信息的麻烦。
2. 微信小程序开发实现微信授权登陆原理流程 实现微信授权登录的主要原理流程如下：
在小程序中创建一个“登录”按钮或其他触发授权登录的交互元素。
用户点击登录按钮后，小程序调用wx.login接口获取临时登录凭证code。
小程序调用wx.getUserInfo接口获取用户的基本信息，例如昵称、头像等。
小程序将获取到的临时登录凭证code和用户基本信息发送给开发者自己的后台服务器。
开发者的后台服务器收到请求后，通过code调用微信的登录凭证校验接口，验证凭证的有效性，并获取到openid和session_key。
开发者的后台服务器根据获取的openid和session_key生成一个自定义的用户标识 token，并返回给小程序。
小程序将自定义的用户标识 token 存储起来，作为用户登录的凭证。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/1485e5b8e8a8a90704527de11175e710/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-23T20:21:02+08:00" />
<meta property="article:modified_time" content="2023-10-23T20:21:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【微信小程序开发】之微信授权登陆</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91%E4%B8%80%E3%80%81%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91%E4%B8%80%E3%80%81%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E4%BB%8B%E7%BB%8D" rel="nofollow">​编辑一、微信授权登陆介绍</a></p> 
<p id="1.%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-toc" style="margin-left:40px;"><a href="#1.%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" rel="nofollow">1. 基本概念</a></p> 
<p id="2.%20%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#2.%20%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B" rel="nofollow">2. 微信小程序开发实现微信授权登陆原理流程</a></p> 
<p id="3.%20%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%AD%E8%BF%90%E7%94%A8%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E7%9A%84%E5%A5%BD%E5%A4%84-toc" style="margin-left:40px;"><a href="#3.%20%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%AD%E8%BF%90%E7%94%A8%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E7%9A%84%E5%A5%BD%E5%A4%84" rel="nofollow">3. 小程序中运用微信授权登陆的好处</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E6%8E%A5%E5%8F%A3%E6%BC%94%E7%A4%BA-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E6%8E%A5%E5%8F%A3%E6%BC%94%E7%A4%BA" rel="nofollow">二、微信授权登陆接口演示</a></p> 
<p id="%C2%A01.%20%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E4%B8%AD%E5%AF%BC%E5%85%A5%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8E%88%E6%9D%83%E5%BE%AE%E4%BF%A1%E7%99%BB%E9%99%86%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE-toc" style="margin-left:40px;"><a href="#%C2%A01.%20%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E4%B8%AD%E5%AF%BC%E5%85%A5%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8E%88%E6%9D%83%E5%BE%AE%E4%BF%A1%E7%99%BB%E9%99%86%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE" rel="nofollow"> 1. 在微信开发工具中导入小程序授权微信登陆前端项目</a></p> 
<p id="2.%20%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E7%9A%84%E6%96%B9%E5%BC%8F-toc" style="margin-left:40px;"><a href="#2.%20%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E7%9A%84%E6%96%B9%E5%BC%8F" rel="nofollow">2. 微信授权登陆的方式</a></p> 
<p id="2.1%20wx.login-toc" style="margin-left:80px;"><a href="#2.1%20wx.login" rel="nofollow">2.1 wx.login</a></p> 
<p id="2.2%C2%A0wx.getUserProfile-toc" style="margin-left:80px;"><a href="#2.2%C2%A0wx.getUserProfile" rel="nofollow">2.2 wx.getUserProfile</a></p> 
<p id="2.3%20%E4%BA%8C%E8%80%85%E7%9A%84%E5%8C%BA%E5%88%AB-toc" style="margin-left:80px;"><a href="#2.3%20%E4%BA%8C%E8%80%85%E7%9A%84%E5%8C%BA%E5%88%AB" rel="nofollow">2.3 二者的区别</a></p> 
<p id="%E4%B8%89%E3%80%81%C2%A0%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E6%B5%81%E7%A8%8B-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%C2%A0%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E6%B5%81%E7%A8%8B" rel="nofollow">三、 小程序微信授权登陆流程</a></p> 
<p id="1.%20%E6%B5%81%E7%A8%8B%E5%9B%BE-toc" style="margin-left:40px;"><a href="#1.%20%E6%B5%81%E7%A8%8B%E5%9B%BE" rel="nofollow">1. 流程图</a></p> 
<p id="%C2%A02.%20%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95-toc" style="margin-left:40px;"><a href="#%C2%A02.%20%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95" rel="nofollow"> 2. 代码调试</a></p> 
<p id="2.1%20%E5%AF%BC%E5%85%A5%E8%B0%83%E8%AF%95%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#2.1%20%E5%AF%BC%E5%85%A5%E8%B0%83%E8%AF%95%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81" rel="nofollow">2.1 导入调试后端代码</a></p> 
<p id="%C2%A02.2%20%E5%AF%BC%E5%85%A5%E8%B0%83%E8%AF%95%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%C2%A02.2%20%E5%AF%BC%E5%85%A5%E8%B0%83%E8%AF%95%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81" rel="nofollow"> 2.2 导入调试前端代码</a></p> 
<p id="%C2%A02.3%20%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA-toc" style="margin-left:80px;"><a href="#%C2%A02.3%20%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA" rel="nofollow"> 2.3 效果演示</a></p> 
<p id="3.%C2%A0%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#3.%C2%A0%E4%BB%A3%E7%A0%81" rel="nofollow">3. 代码</a></p> 
<p id="%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81-toc" style="margin-left:120px;"><a href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81" rel="nofollow">小程序前端代码</a></p> 
<p id="login.wxml-toc" style="margin-left:160px;"><a href="#login.wxml" rel="nofollow">login.wxml</a></p> 
<p id="%C2%A0login.js-toc" style="margin-left:160px;"><a href="#%C2%A0login.js" rel="nofollow"> login.js</a></p> 
<p id="%C2%A0%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81-toc" style="margin-left:120px;"><a href="#%C2%A0%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81" rel="nofollow"> 后端代码</a></p> 
<p id="IpUtil.java-toc" style="margin-left:160px;"><a href="#IpUtil.java" rel="nofollow">IpUtil.java</a></p> 
<p id="WxAuthController.java-toc" style="margin-left:160px;"><a href="#WxAuthController.java" rel="nofollow">WxAuthController.java</a></p> 
<p id="%C2%A0WxHomeController.java-toc" style="margin-left:160px;"><a href="#%C2%A0WxHomeController.java" rel="nofollow"> WxHomeController.java</a></p> 
<p id="%C2%A0WxInfoController.java-toc" style="margin-left:160px;"><a href="#%C2%A0WxInfoController.java" rel="nofollow"> WxInfoController.java</a></p> 
<p id="%C2%A0WxUserController.java-toc" style="margin-left:160px;"><a href="#%C2%A0WxUserController.java" rel="nofollow"> WxUserController.java</a></p> 
<p id="%E5%9B%9B%E3%80%81%E8%A7%A3%E5%86%B3%E5%BE%AE%E4%BF%A1%E5%90%8D%E7%A7%B0%E5%90%AB%E7%89%B9%E6%AE%8A%E6%A0%87%E7%AD%BE%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%AD%98%E5%82%A8%E9%97%AE%E9%A2%98-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E8%A7%A3%E5%86%B3%E5%BE%AE%E4%BF%A1%E5%90%8D%E7%A7%B0%E5%90%AB%E7%89%B9%E6%AE%8A%E6%A0%87%E7%AD%BE%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%AD%98%E5%82%A8%E9%97%AE%E9%A2%98" rel="nofollow">四、解决微信名称含特殊标签符号的存储问题</a></p> 
<p id="%C2%A01.%20%E9%85%8D%E7%BD%AEmy.ini%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%C2%A01.%20%E9%85%8D%E7%BD%AEmy.ini%E6%96%87%E4%BB%B6" rel="nofollow"> 1. 配置my.ini文件</a></p> 
<p id="2.%20%E9%87%8D%E5%90%AF%E6%88%91%E4%BB%AC%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#2.%20%E9%87%8D%E5%90%AF%E6%88%91%E4%BB%AC%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1" rel="nofollow">2. 重启我们的数据库服务</a></p> 
<p id="%C2%A03.%20%E7%82%B9%E5%87%BB%E5%A4%9A%E8%B4%A6%E5%8F%B7%E8%B0%83%E8%AF%95-toc" style="margin-left:40px;"><a href="#%C2%A03.%20%E7%82%B9%E5%87%BB%E5%A4%9A%E8%B4%A6%E5%8F%B7%E8%B0%83%E8%AF%95" rel="nofollow"> 3. 点击多账号调试</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E5%89%8D%E8%A8%80" style="background-color:transparent;">前言</h2> 
<blockquote> 
 <p>       <strong> 在上一期的博客中与大家分享了微信小程序开发会议OA项目首页数据的后台交互，以及在其中使用到工具文件来实现便捷的去调用请求访问后台的接口方法，还涉及了.wxs文件的介绍和使用。今天给大家带来的是<span style="color:#fe2c24;">微信小程序开发之微信授权登陆，</span>让我们一起来了解了解吧。</strong></p> 
</blockquote> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91%E4%B8%80%E3%80%81%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E4%BB%8B%E7%BB%8D"><img alt="" height="20" src="https://images2.imgbox.com/54/8e/NOkjRXdU_o.png" width="20">一、微信授权登陆介绍</h2> 
<h3 id="1.%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">1. 基本概念</h3> 
<blockquote> 
 <p>        微信授权登录是指用户通过<strong>微信账号登录第三方应用或网站</strong>的一种<strong>身份验证方式</strong>。当用户在第三方应用或网站上选择使用微信登录时，该应用或网站会跳转到微信登录页面，用户在此页面输入微信账号和密码进行登录。一旦用户成功登录并授权，第三方应用或网站就能够<span style="color:#fe2c24;"><strong>获得用户在微信上的基本信息，如昵称、头像等</strong></span>，并用于用户在应用或网站上的个性化服务。这种授权登录的方式方便用户快速登录第三方平台，同时减少了用户填写注册信息的麻烦。</p> 
</blockquote> 
<h3 id="2.%20%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B">2. 微信小程序开发实现微信授权登陆原理流程</h3> 
<blockquote> 
 <p><strong>实现微信授权登录的主要原理流程如下：</strong></p> 
 <ol><li> <p>在小程序中创建一个“登录”按钮或其他触发授权登录的交互元素。</p> </li><li> <p>用户点击登录按钮后，小程序调用<span style="color:#fe2c24;"><strong><code>wx.login</code>接口</strong></span>获取临时登录凭证<span style="color:#fe2c24;"><strong><code>code</code></strong></span>。</p> </li><li> <p>小程序调用<span style="color:#fe2c24;"><strong><code>wx.getUserInfo</code>接口</strong></span>获取用户的基本信息，例如昵称、头像等。</p> </li><li> <p>小程序将获取到的<span style="color:#fe2c24;"><strong>临时登录凭证<code>code</code>和用户基本信息</strong></span>发送给<span style="color:#fe2c24;"><strong>开发者自己的后台服务器。</strong></span></p> </li><li> <p>开发者的后台服务器收到请求后，通过<code>code</code>调用微信的登录凭证校验接口，验证凭证的有效性，并获取到<span style="color:#fe2c24;"><strong><code>openid</code>和<code>session_key</code></strong></span>。</p> </li><li> <p>开发者的后台服务器根据获取的<span style="color:#fe2c24;"><strong><code>openid</code>和<code>session_key</code></strong></span>生成一个自定义的用户标识 <span style="color:#fe2c24;"><strong>token</strong></span>，并返回给小程序。</p> </li><li> <p>小程序将自定义的用户标识<span style="color:#fe2c24;"><strong> token </strong></span>存储起来，作为用户登录的凭证。</p> </li><li> <p>用户在之后的小程序访问中，可以携带这个<strong>自定义的用户标识 token 请求开发者的后台服务器</strong>，进行用户身份的验证和数据操作。</p> </li><li> <p>开发者可以在后台服务器中根据用户的<span style="color:#fe2c24;"><strong>openid</strong></span>进行用户识别和管理，例如创建新用户、更新用户信息、绑定其他第三方账号等。</p> </li><li> <p>如果开发者需要获得用户的更多个人信息，例如手机号码、地理位置等，可以引导用户进行相应的授权，通过调用相应的接口获取这些信息。</p> </li><li> <p>如果小程序需要将用户的登录状态同步到其他终端（如PC端、移动App等），开发者可以通过在后台服务器中记录登录状态，实现多终端的登录一致性。</p> </li><li> <p>对于用户敏感操作或需要保护的数据，开发者可以在后台服务器进行权限验证，确保用户有足够的权限进行相应的操作。</p> </li></ol> 
</blockquote> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong> 注意：</strong></span></p> 
 <p>        为了确保用户信息的安全性，开发者在传输用户信息时，应使用加密算法进行加密，以保护用户的隐私。此外，开发者的后台服务器需要与微信服务器进行密切的协作，以保证登录凭证和用户信息的有效性和安全性。</p> 
 <p>        为了确保用户信息的安全性，开发者在传输用户信息时，应使用加密算法进行加密，以保护用户的隐私。此外，开发者的后台服务器需要与微信服务器进行密切的协作，以保证登录凭证和用户信息的有效性和安全性。</p> 
</blockquote> 
<h3 id="3.%20%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%AD%E8%BF%90%E7%94%A8%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E7%9A%84%E5%A5%BD%E5%A4%84">3. 小程序中运用微信授权登陆的好处</h3> 
<blockquote> 
 <p><strong>使用微信授权登陆的优势有以下几点：</strong></p> 
 <ol><li><span style="color:#fe2c24;"><strong>用户体验优化</strong></span>：相比传统的网页注册登录，微信授权登陆省去了繁琐的注册流程，用户只需授权手机用于绑定身份，即可完成登录，这大大提高了用户体验。</li><li><span style="color:#fe2c24;"><strong>安全性</strong></span>：微信授权登陆采用了安全、可靠的授权机制，确保用户的个人信息和数据安全，同时避免了恶意注册和滥用账号的风险。</li><li><span style="color:#fe2c24;"><strong>数据分析与优化</strong></span>：通过微信授权登陆，品牌企业可以获取到用户的手机信息，进而进行用户行为分析和数据挖掘，以便更好地了解用户需求，优化产品和服务。</li><li><span style="color:#fe2c24;"><strong>提高安全性</strong></span>：微信授权登陆采用了安全、可靠的授权机制，确保用户的个人信息和数据安全，防止了恶意注册和滥用账号的风险。</li><li><span style="color:#fe2c24;"><strong>简化开发流程</strong></span>：微信官方提供了丰富的API和开发工具，使得开发者可以轻松地实现微信授权登陆功能，简化了开发流程，提高了开发效率。</li></ol> 
 <p>除此之外，还有<span style="color:#fe2c24;"><strong>跨平台整合、增加用户粘性、社交功能拓展、避免重复注册</strong></span>等等的好处。</p> 
</blockquote> 
<h2 id="%E4%BA%8C%E3%80%81%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E6%8E%A5%E5%8F%A3%E6%BC%94%E7%A4%BA">二、微信授权登陆接口演示</h2> 
<blockquote> 
 <p>        资源文件介绍</p> 
</blockquote> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/81/bc/a4ETH87y_o.png"></p> 
<h3 id="%C2%A01.%20%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E4%B8%AD%E5%AF%BC%E5%85%A5%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8E%88%E6%9D%83%E5%BE%AE%E4%BF%A1%E7%99%BB%E9%99%86%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"> 1. 在微信开发工具中导入小程序授权微信登陆前端项目</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/54/1b/GjLGUraW_o.gif"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/77/74/80gzk22p_o.png"> </p> 
<h3 id="2.%20%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E7%9A%84%E6%96%B9%E5%BC%8F">2. 微信授权登陆的方式</h3> 
<h4 id="2.1%20wx.login">2.1 wx.login</h4> 
<blockquote> 
 <p>        该方式演示的效果是（微信直接登陆2），效果如下</p> 
</blockquote> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/d9/9d/zRj15rCM_o.gif"></p> 
<h4 id="2.2%C2%A0wx.getUserProfile">2.2 wx.getUserProfile</h4> 
<blockquote> 
 <p>   该方式演示的效果是（微信直接登陆1），效果如下。将index.js文件中的canIUseGetUserProfile的属性值改为true。效果演示如下</p> 
</blockquote> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/7a/25/hBI5hIao_o.gif"></p> 
<h4 id="2.3%20%E4%BA%8C%E8%80%85%E7%9A%84%E5%8C%BA%E5%88%AB">2.3 二者的区别</h4> 
<blockquote> 
 <ol><li> <p>wx.login: 这个接口用于获取用户的登录凭证（code），开发者可以通过这个凭证向服务器换取用户的唯一标识和会话密钥等信息。一般情况下，账号登录或者授权登录都会使用wx.login接口获取用户的code。</p> </li><li> <p>wx.getUserProfile: 这个接口用于获取用户的个人信息，包括昵称、头像等。在用户授权的情况下，开发者可以通过wx.getUserProfile获取用户的个人信息。</p> </li></ol> 
 <p>        因此，两者的区别在于功能和用途上。wx.login用于获取用户登录凭证，而wx.getUserProfile用于获取用户的个人信息。需要注意的是，为了保护用户隐私，获取用户个人信息需要用户授权，而且在小程序中需要提前向用户展示授权弹窗，让用户确认是否授权。</p> 
 <p>        但是微信官方推荐使用wx.getUserProfile的这种授权方式，这种方式安全性高。</p> 
</blockquote> 
<h2 id="%E4%B8%89%E3%80%81%C2%A0%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E7%99%BB%E9%99%86%E6%B5%81%E7%A8%8B">三、 小程序微信授权登陆流程</h2> 
<h3 id="1.%20%E6%B5%81%E7%A8%8B%E5%9B%BE" style="background-color:transparent;">1. 流程图</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/39/2a/p51yELRQ_o.png"></p> 
<h3 id="%C2%A02.%20%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95"> 2. 代码调试</h3> 
<h4 id="2.1%20%E5%AF%BC%E5%85%A5%E8%B0%83%E8%AF%95%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81" style="background-color:transparent;">2.1 导入调试后端代码</h4> 
<blockquote> 
 <p>        在我们的开发工具中导入资源中的ssm-oa项目文件</p> 
</blockquote> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/50/f5/Tenpg3LJ_o.gif"></p> 
<blockquote> 
 <p>        我们还要看Maven文件是否一致，以及依赖下载网址是否是阿里云的下载路径</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d9/e0/2VPOzIrm_o.png"></p> 
<blockquote> 
 <p> 配置我们的数据库连接接口文件以及appID和app密钥，在application.yml中配置</p> 
</blockquote> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/1e/c4/3IFnNtiG_o.png"></p> 
<p></p> 
<h4 id="%C2%A02.2%20%E5%AF%BC%E5%85%A5%E8%B0%83%E8%AF%95%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81" style="background-color:transparent;"> 2.2 导入调试前端代码</h4> 
<blockquote> 
 <p>        导入我们前端的测试代码</p> 
</blockquote> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/d4/c7/iFDq25OE_o.gif"></p> 
<h4 id="%C2%A02.3%20%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA"> 2.3 效果演示</h4> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/64/a9/A4MwYb6v_o.gif"></p> 
<blockquote> 
 <p>         我们授权登陆后会在数据库中显示增加一条关于该用户的数据</p> 
</blockquote> 
<h3 id="3.%C2%A0%E4%BB%A3%E7%A0%81" style="background-color:transparent;">3. 代码</h3> 
<h5 id="%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81" style="background-color:transparent;">小程序前端代码</h5> 
<h6 id="login.wxml">login.wxml</h6> 
<pre><code class="language-html">&lt;!--pages/auth/login/login.wxml--&gt;
&lt;view class="container"&gt;
  &lt;view class="login-box"&gt;
    &lt;button wx:if="{<!-- -->{canIUseGetUserProfile}}" type="primary" class="wx-login-btn" bindtap="getUserProfile"&gt;微信直接登录&lt;/button&gt;
    &lt;button wx:else open-type="getUserInfo" type="primary" class="wx-login-btn" bindgetuserinfo="wxLogin"&gt;微信直接登录&lt;/button&gt;
    &lt;button type="primary" class="account-login-btn" bindtap="accountLogin"&gt;账号登录&lt;/button&gt;
  &lt;/view&gt;
&lt;/view&gt;
</code></pre> 
<blockquote> 
 <p>        这编辑的是登陆功能的页面演示</p> 
</blockquote> 
<h6 id="%C2%A0login.js"> login.js</h6> 
<pre><code class="language-javascript">// pages/auth/login/login.js
var util = require('../../../utils/util.js');
var user = require('../../../utils/user.js');
const app = getApp();
Page({

    /**
     * 页面的初始数据
     */
    data: {
        canIUseGetUserProfile: false, // 用于向前兼容
        lock:false
    },
    onLoad: function(options) {
        // 页面初始化 options为页面跳转所带来的参数
        // 页面渲染完成
        if (wx.getUserProfile) {
          this.setData({
            canIUseGetUserProfile: true
          })
        }
        //console.log('login.onLoad.canIUseGetUserProfile='+this.data.canIUseGetUserProfile)
    },

    /**
     * 生命周期函数--监听页面初次渲染完成
     */
    onReady() {

    },

    /**
     * 生命周期函数--监听页面显示
     */
    onShow() {

    },
    getUserProfile(e) {
        // 推荐使用wx.getUserProfile获取用户信息，开发者每次通过该接口获取用户个人信息均需用户确认
        // 开发者妥善保管用户快速填写的头像昵称，避免重复弹窗
        wx.getUserProfile({
            desc: '用于完善会员资料', // 声明获取用户个人信息后的用途，后续会展示在弹窗中，请谨慎填写
            success: (res) =&gt; {
                //console.log(res);
                debugger
                user.checkLogin().catch(() =&gt; {
                    user.loginByWeixin(res.userInfo).then(res =&gt; {
                      app.globalData.hasLogin = true;
                      debugger
                      wx.navigateBack({
                        delta: 1
                      })
                    }).catch((err) =&gt; {
                      app.globalData.hasLogin = false;
                      if(err.errMsg=="request:fail timeout"){
                        util.showErrorToast('微信登录超时');
                      }else{
                        util.showErrorToast('微信登录失败');
                      }
                      this.setData({
                        lock:false
                      })
                    });
                  });
            },
            fail: (res) =&gt; {
                app.globalData.hasLogin = false;
                console.log(res);
                util.showErrorToast('微信登录失败');
            }
        });
    },
    wxLogin: function(e) {
        if (e.detail.userInfo == undefined) {
          app.globalData.hasLogin = false;
          util.showErrorToast('微信登录失败');
          return;
        }
        user.checkLogin().catch(() =&gt; {
            user.loginByWeixin(e.detail.userInfo).then(res =&gt; {
              app.globalData.hasLogin = true;
              wx.navigateBack({
                delta: 1
              })
            }).catch((err) =&gt; {
              app.globalData.hasLogin = false;
              if(err.errMsg=="request:fail timeout"){
                util.showErrorToast('微信登录超时');
              }else{
                util.showErrorToast('微信登录失败');
              }
            });
      
          });
    },
    accountLogin() {
        console.log('开发中....')
    }

})</code></pre> 
<blockquote> 
 <p>        login.js文件中定义的是授权登陆所要涉及到的方法函数</p> 
</blockquote> 
<h5 id="%C2%A0%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81"> 后端代码</h5> 
<h6 id="IpUtil.java">IpUtil.java</h6> 
<pre><code class="language-java">package com.zking.ssm.wxcontroller;

import java.net.InetAddress;
import java.net.UnknownHostException;

import javax.servlet.http.HttpServletRequest;

/**
 * IP地址相关工具类
 */
public class IpUtil {
	public static String client(HttpServletRequest request) {
		String xff = request.getHeader("x-forwarded-for");
		if (xff == null) {
			xff = request.getRemoteAddr();
		}
		return xff;
	}

	public static String getIpAddr(HttpServletRequest request) {
		String ipAddress = null;
		try {
			ipAddress = request.getHeader("x-forwarded-for");
			if (ipAddress == null || ipAddress.length() == 0 || "unknown".equalsIgnoreCase(ipAddress)) {
				ipAddress = request.getHeader("Proxy-Client-IP");
			}
			if (ipAddress == null || ipAddress.length() == 0 || "unknown".equalsIgnoreCase(ipAddress)) {
				ipAddress = request.getHeader("WL-Proxy-Client-IP");
			}
			if (ipAddress == null || ipAddress.length() == 0 || "unknown".equalsIgnoreCase(ipAddress)) {
				ipAddress = request.getRemoteAddr();
				if (ipAddress.equals("127.0.0.1")) {
					// 根据网卡取本机配置的IP
					InetAddress inet = null;
					try {
						inet = InetAddress.getLocalHost();
					} catch (UnknownHostException e) {
						e.printStackTrace();
					}
					ipAddress = inet.getHostAddress();
				}
			}
			// 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照','分割
			if (ipAddress != null &amp;&amp; ipAddress.length() &gt; 15) { // "***.***.***.***".length()
				// = 15
				if (ipAddress.indexOf(",") &gt; 0) {
					ipAddress = ipAddress.substring(0, ipAddress.indexOf(","));
				}
			}
		} catch (Exception e) {
			ipAddress = "";
		}
		// ipAddress = this.getRequest().getRemoteAddr();

		return ipAddress;
	}
}
</code></pre> 
<h6 id="WxAuthController.java">WxAuthController.java</h6> 
<pre><code class="language-java">package com.zking.ssm.wxcontroller;

/**
 * @Autho donkee
 * @Since 2022/6/27
 */

import cn.binarywang.wx.miniapp.bean.WxMaPhoneNumberInfo;
import com.alibaba.fastjson.JSONObject;
import com.zking.ssm.annotation.LoginUser;
import com.zking.ssm.model.UserInfo;
import com.zking.ssm.model.WxLoginInfo;
import com.zking.ssm.model.WxUser;
import com.zking.ssm.service.UserToken;
import com.zking.ssm.service.UserTokenManager;
import com.zking.ssm.service.WxUserService;
import com.zking.ssm.util.JacksonUtil;
import com.zking.ssm.util.ResponseUtil;
import com.zking.ssm.util.UserTypeEnum;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import cn.binarywang.wx.miniapp.api.WxMaService;
import cn.binarywang.wx.miniapp.bean.WxMaJscode2SessionResult;
import javax.servlet.http.HttpServletRequest;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

/**
 * 鉴权服务
 */
@Slf4j
@RestController
@RequestMapping("/wx/auth")
public class WxAuthController {
    @Autowired
    private WxMaService wxService;
    @Autowired
    private WxUserService userService;
    /**
     * 微信登录
     *
     * @param wxLoginInfo
     *            请求内容，{ code: xxx, userInfo: xxx }
     * @param request
     *            请求对象
     * @return 登录结果
     */
    @PostMapping("login_by_weixin")
    public Object loginByWeixin(@RequestBody WxLoginInfo wxLoginInfo, HttpServletRequest request) {

        //客户端需携带code与userInfo信息
        String code = wxLoginInfo.getCode();
        UserInfo userInfo = wxLoginInfo.getUserInfo();
        if (code == null || userInfo == null) {
            return ResponseUtil.badArgument();
        }
        //调用微信sdk获取openId及sessionKey
        String sessionKey = null;
        String openId = null;
        try {
            long beginTime = System.currentTimeMillis();
            //
            WxMaJscode2SessionResult result = this.wxService.getUserService().getSessionInfo(code);
//            Thread.sleep(6000);
            long endTime = System.currentTimeMillis();
            log.info("响应时间:{}",(endTime-beginTime));
            sessionKey = result.getSessionKey();//session id
            openId = result.getOpenid();//用户唯一标识 OpenID
        } catch (Exception e) {
            e.printStackTrace();
        }

        if (sessionKey == null || openId == null) {
            log.error("微信登录,调用官方接口失败：{}", code);
            return ResponseUtil.fail();
        }else{
            log.info("openId={},sessionKey={}",openId,sessionKey);
        }
        //根据openId查询wx_user表
        //如果不存在，初始化wx_user,并保存到数据库中
        //如果存在，更新最后登录时间
        WxUser user = userService.queryByOid(openId);

        if (user == null) {
            user = new WxUser();
            user.setUsername(openId);
            user.setPassword(openId);
            user.setWeixinOpenid(openId);
            user.setAvatar(userInfo.getAvatarUrl());
            user.setNickname(userInfo.getNickName());
            user.setGender(userInfo.getGender());
            user.setUserLevel((byte) 0);
            user.setStatus((byte) 0);
            user.setLastLoginTime(new Date());
            user.setLastLoginIp(IpUtil.client(request));
            user.setShareUserId(1);

            userService.add(user);

        } else {
            user.setLastLoginTime(new Date());
            user.setLastLoginIp(IpUtil.client(request));
            if (userService.updateById(user) == 0) {
                log.error("修改失败：{}", user);
                return ResponseUtil.updatedDataFailed();
            }
        }
        // token
        UserToken userToken = null;
        try {
            userToken = UserTokenManager.generateToken(user.getId());
        } catch (Exception e) {
            log.error("微信登录失败,生成token失败：{}", user.getId());
            e.printStackTrace();
            return ResponseUtil.fail();
        }
        userToken.setSessionKey(sessionKey);
        log.info("SessionKey={}",UserTokenManager.getSessionKey(user.getId()));
        Map&lt;Object, Object&gt; result = new HashMap&lt;Object, Object&gt;();
        result.put("token", userToken.getToken());
        result.put("tokenExpire", userToken.getExpireTime().toString());
        userInfo.setUserId(user.getId());
        if (!StringUtils.isEmpty(user.getMobile())) {// 手机号存在则设置
            userInfo.setPhone(user.getMobile());
        }
        try {
            DateFormat df = new SimpleDateFormat("yyyy-MM-dd");
            String registerDate = df.format(user.getAddTime() != null ? user.getAddTime() : new Date());
            userInfo.setRegisterDate(registerDate);
            userInfo.setStatus(user.getStatus());
            userInfo.setUserLevel(user.getUserLevel());// 用户层级
            userInfo.setUserLevelDesc(UserTypeEnum.getInstance(user.getUserLevel()).getDesc());// 用户层级描述
        } catch (Exception e) {
            log.error("微信登录：设置用户指定信息出错："+e.getMessage());
            e.printStackTrace();
        }
        result.put("userInfo", userInfo);


        log.info("【请求结束】微信登录,响应结果:{}", JSONObject.toJSONString(result));

        return ResponseUtil.ok(result);
    }
    /**
     * 绑定手机号码
     *
     * @param userId
     * @param body
     * @return
     */
    @PostMapping("bindPhone")
    public Object bindPhone(@LoginUser Integer userId, @RequestBody String body) {
        log.info("【请求开始】绑定手机号码,请求参数，body:{}", body);

        String sessionKey = UserTokenManager.getSessionKey(userId);
        String encryptedData = JacksonUtil.parseString(body, "encryptedData");
        String iv = JacksonUtil.parseString(body, "iv");
        WxMaPhoneNumberInfo phoneNumberInfo = null;
        try {
            phoneNumberInfo = this.wxService.getUserService().getPhoneNoInfo(sessionKey, encryptedData, iv);
        } catch (Exception e) {
            log.error("绑定手机号码失败,获取微信绑定的手机号码出错：{}", body);
            e.printStackTrace();
            return ResponseUtil.fail();
        }
        String phone = phoneNumberInfo.getPhoneNumber();
        WxUser user = userService.selectByPrimaryKey(userId);
        user.setMobile(phone);
        if (userService.updateById(user) == 0) {
            log.error("绑定手机号码,更新用户信息出错,id：{}", user.getId());
            return ResponseUtil.updatedDataFailed();
        }
        Map&lt;Object, Object&gt; data = new HashMap&lt;Object, Object&gt;();
        data.put("phone", phone);

        log.info("【请求结束】绑定手机号码,响应结果：{}", JSONObject.toJSONString(data));
        return ResponseUtil.ok(data);
    }
    /**
     * 注销登录
     */
    @PostMapping("logout")
    public Object logout(@LoginUser Integer userId) {
        log.info("【请求开始】注销登录,请求参数，userId:{}", userId);
        if (userId == null) {
            return ResponseUtil.unlogin();
        }
        try {
            UserTokenManager.removeToken(userId);
        } catch (Exception e) {
            log.error("注销登录出错：userId:{}", userId);
            e.printStackTrace();
            return ResponseUtil.fail();
        }

        log.info("【请求结束】注销登录成功!");
        return ResponseUtil.ok();
    }
}
</code></pre> 
<h6 id="%C2%A0WxHomeController.java"> WxHomeController.java</h6> 
<pre><code class="language-java">package com.zking.ssm.wxcontroller;

import com.zking.ssm.mapper.InfoMapper;
import com.zking.ssm.model.Info;
import com.zking.ssm.util.ResponseUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * @Autho donkee
 * @Since 2022/6/29
 */
@RestController
@RequestMapping("/wx/home")
public class WxHomeController {
    @Autowired
    private InfoMapper infoMapper;
    @RequestMapping("/index")
    public Object index(Info info) {
        List&lt;Info&gt; infoList = infoMapper.list(info);
        Map&lt;Object, Object&gt; data = new HashMap&lt;Object, Object&gt;();
        data.put("infoList",infoList);
        return ResponseUtil.ok(data);
    }
}
</code></pre> 
<h6 id="%C2%A0WxInfoController.java"> WxInfoController.java</h6> 
<pre><code class="language-java">package com.zking.ssm.wxcontroller;

import com.zking.ssm.mapper.InfoMapper;
import com.zking.ssm.model.Info;
import com.zking.ssm.util.ResponseUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * @Autho donkee
 * @Since 2022/7/29
 */
@SuppressWarnings("all")
@RestController
@RequestMapping("/wx/info")
public class WxInfoController {
    @Autowired
    private InfoMapper infoMapper;
    @RequestMapping("/list")
    public Object list (Info info){
        List&lt;Info&gt; list = infoMapper.list(info);
        Map&lt;Object, Object&gt; data = new HashMap&lt;Object, Object&gt;();
        data.put("infoList",list);
        return ResponseUtil.ok(data);
    }
}
</code></pre> 
<h6 id="%C2%A0WxUserController.java"> WxUserController.java</h6> 
<pre><code class="language-java">package com.zking.ssm.wxcontroller;

import java.math.BigDecimal;
import java.util.HashMap;
import java.util.Map;
import java.util.Random;

import com.zking.ssm.annotation.LoginUser;
import com.zking.ssm.model.WxUser;
import com.zking.ssm.service.UserTokenManager;
import com.zking.ssm.service.WxUserService;
import com.zking.ssm.util.ResponseUtil;
import lombok.extern.slf4j.Slf4j;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

import com.alibaba.fastjson.JSONObject;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;


/**
 * 用户服务
 */
@Slf4j
@RestController
@RequestMapping("/wx/user")
@Validated
public class WxUserController {
	@Autowired
	private WxUserService userService;

	/**
	 * 用户个人页面数据
	 * &lt;p&gt;
	 * @param userId
	 *            用户ID
	 * @return 用户个人页面数据
	 */
	@GetMapping("index")
	public Object list(@LoginUser Integer userId, @RequestHeader("X-OA-token") String token) {
		log.info("【请求开始】用户个人页面数据,请求参数,userId:{}", userId);
		log.info("【请求开始】用户个人页面数据,请求参数,token:{}", token);
		if (userId == null) {
			log.error("用户个人页面数据查询失败:用户未登录！！！");
			return ResponseUtil.unlogin();
		}
		WxUser wxUser = userService.selectByPrimaryKey(userId);
		Map&lt;Object, Object&gt; data = new HashMap&lt;Object, Object&gt;();
		data.put("metting_pubs", wxUser.getUserLevel());
		data.put("metting_joins",wxUser.getUserLevel());
		return ResponseUtil.ok(data);
	}

}</code></pre> 
<blockquote> 
 <p>        这就是微信授权登陆小程序所涉及的后台代码。</p> 
</blockquote> 
<h2 id="%E5%9B%9B%E3%80%81%E8%A7%A3%E5%86%B3%E5%BE%AE%E4%BF%A1%E5%90%8D%E7%A7%B0%E5%90%AB%E7%89%B9%E6%AE%8A%E6%A0%87%E7%AD%BE%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%AD%98%E5%82%A8%E9%97%AE%E9%A2%98">四、解决微信名称含特殊标签符号的存储问题</h2> 
<blockquote> 
 <p>        我们的一些微信名称有时会包含一些特殊符号的名称，当我们存储到数据库中时会出现异常，接下来就来解决一下这个问题。</p> 
</blockquote> 
<h3 id="%C2%A01.%20%E9%85%8D%E7%BD%AEmy.ini%E6%96%87%E4%BB%B6"> 1. 配置my.ini文件</h3> 
<blockquote> 
 <p>        找到我们安装mysql的数据库下的my.ini文件，在文件中修改default-character-set和character-set-server的属性值修改为utf8mb4</p> 
</blockquote> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/10/26/JlusVLNz_o.png"></p> 
<h3 id="2.%20%E9%87%8D%E5%90%AF%E6%88%91%E4%BB%AC%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1">2. 重启我们的数据库服务</h3> 
<blockquote> 
 <p>        在我们的服务中找到mysql服务重新启动即可。 </p> 
</blockquote> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/97/2e/PMBU07rs_o.gif"></p> 
<h3 id="%C2%A03.%20%E7%82%B9%E5%87%BB%E5%A4%9A%E8%B4%A6%E5%8F%B7%E8%B0%83%E8%AF%95"> 3. 点击多账号调试</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d0/39/mqEysgoN_o.gif"></p> 
<blockquote> 
 <p>        由此我们可以看到在数据库中我们成功将特殊字符存储到数据库中了。 </p> 
</blockquote> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>        本期的博客分享到此结束，谢谢到家 </strong></span></p> 
</blockquote> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/4d/2b/KdpF0Eaz_o.gif"> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6866a326af980030af099a04e84f26bc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【coderwhy前端笔记 - 阶段六 VUE 】(整理版)（更新中2023.7.16）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dae7bb124d086bef52d50d63d48fa423/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java中配置RabbitMQ基本步骤</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>