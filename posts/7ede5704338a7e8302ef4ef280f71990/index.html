<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NodeJS 之 fs 模块（文件操作） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="NodeJS 之 fs 模块（文件操作）" />
<meta property="og:description" content="NodeJS 之 fs 模块（文件系统模块） 参考描述fs（File System）文件读取fs.readFile()判断文件是否读取成功编码 写入fs.writeFile()覆盖 追加fs.appendFile() 移动fs.rename() 同步与异步区别后缀参数举个栗子 执行同步异步 错误同步异步 总结 更细致的文件操作fs.open()可能使用到的文件操作举个栗子 读取fs.read()举个栗子 写入fs.write() 关闭区别fs.readFile()、fs.readFileSync()、fs.writeFile() 及 fs.writeFileSync()fs.read()、fs.readSycn()、fs.write() 及 fs.writeSync() 参考 项目描述NodeJSNodeJS API 官方文档Node.js 权威指南陆凌牛哔哩哔哩黑马程序员 描述 项目描述操作系统Windows 10 专业版NodeJS18.13.0 fs（File System） fs 模块是 NodeJS 内置的文件系统模块，为开发者提供了许多用于文件及目录操作的 API。
在 NodeJS 中，我们可以通过如下代码来将该模块进行导入。
const fs = require(&#39;fs&#39;); 文件 读取 fs.readFile() fs.readFile(path[, options], callback) 其中：
path 与 callback 为必选参数，而 options 为可选参数。
参数描述path需要读取的目标文件的路径。options指定对被读取文件中的内容使用的编码方式。callback用以指定文件操作执行完成后需要执行的回调函数。 判断文件是否读取成功 传递给 fs.readFile() 的回调函数可以提供两个形参来分别接收 文件读取失败后得到的错误对象 及 文件读取成功后得到的文件内容。
文件读取成功时，第一个形参将接收到的值（实参）为 null，因此可以利用这个特性来判断文件是否读取成功：
const fs = require(&#39;fs&#39;); // 尝试读取当前工作目录下的 content." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/7ede5704338a7e8302ef4ef280f71990/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-21T14:26:04+08:00" />
<meta property="article:modified_time" content="2023-01-21T14:26:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">NodeJS 之 fs 模块（文件操作）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>NodeJS 之 fs 模块（文件系统模块）</h4> 
 <ul><li><a href="#_2" rel="nofollow">参考</a></li><li><a href="#_10" rel="nofollow">描述</a></li><li><a href="#fsFile_System_18" rel="nofollow">fs（File System）</a></li><li><a href="#_27" rel="nofollow">文件</a></li><li><ul><li><ul><li><a href="#_28" rel="nofollow">读取</a></li><li><ul><li><ul><li><a href="#fsreadFile_29" rel="nofollow">fs.readFile()</a></li><li><a href="#_44" rel="nofollow">判断文件是否读取成功</a></li><li><a href="#_61" rel="nofollow">编码</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_124" rel="nofollow">写入</a></li><li><ul><li><ul><li><a href="#fswriteFile_125" rel="nofollow">fs.writeFile()</a></li><li><a href="#_145" rel="nofollow">覆盖</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_184" rel="nofollow">追加</a></li><li><ul><li><ul><li><a href="#fsappendFile_185" rel="nofollow">fs.appendFile()</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_226" rel="nofollow">移动</a></li><li><ul><li><ul><li><a href="#fsrename_227" rel="nofollow">fs.rename()</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#_251" rel="nofollow">同步与异步</a></li><li><ul><li><ul><li><a href="#_259" rel="nofollow">区别</a></li><li><ul><li><ul><li><a href="#_260" rel="nofollow">后缀</a></li><li><a href="#_265" rel="nofollow">参数</a></li><li><ul><li><a href="#_268" rel="nofollow">举个栗子</a></li></ul> 
      </li><li><a href="#_282" rel="nofollow">执行</a></li><li><ul><li><a href="#_283" rel="nofollow">同步</a></li><li><a href="#_295" rel="nofollow">异步</a></li></ul> 
      </li><li><a href="#_313" rel="nofollow">错误</a></li><li><ul><li><a href="#_316" rel="nofollow">同步</a></li><li><a href="#_352" rel="nofollow">异步</a></li></ul> 
      </li><li><a href="#_373" rel="nofollow">总结</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#_376" rel="nofollow">更细致的文件操作</a></li><li><ul><li><ul><li><a href="#fsopen_377" rel="nofollow">fs.open()</a></li><li><ul><li><ul><li><a href="#_401" rel="nofollow">可能使用到的文件操作</a></li><li><a href="#_415" rel="nofollow">举个栗子</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_434" rel="nofollow">读取</a></li><li><ul><li><ul><li><a href="#fsread_436" rel="nofollow">fs.read()</a></li><li><ul><li><a href="#_498" rel="nofollow">举个栗子</a></li></ul> 
     </li></ul> 
    </li></ul> 
    </li><li><a href="#_568" rel="nofollow">写入</a></li><li><ul><li><ul><li><a href="#fswrite_570" rel="nofollow">fs.write()</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_591" rel="nofollow">关闭</a></li><li><a href="#_611" rel="nofollow">区别</a></li><li><ul><li><ul><li><a href="#fsreadFilefsreadFileSyncfswriteFile__fswriteFileSync_613" rel="nofollow">fs.readFile()、fs.readFileSync()、fs.writeFile() 及 fs.writeFileSync()</a></li><li><a href="#fsreadfsreadSycnfswrite__fswriteSync_620" rel="nofollow">fs.read()、fs.readSycn()、fs.write() 及 fs.writeSync()</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>参考</h2> 
<table><thead><tr><th>项目</th><th>描述</th></tr></thead><tbody><tr><td>NodeJS</td><td><strong><a href="http://nodejs.cn/api/fs.html" rel="nofollow">NodeJS API 官方文档</a></strong></td></tr><tr><td>Node.js 权威指南</td><td>陆凌牛</td></tr><tr><td>哔哩哔哩</td><td><a href="https://b23.tv/TNkXzmE" rel="nofollow"><strong>黑马程序员</strong></a></td></tr></tbody></table> 
<h2><a id="_10"></a>描述</h2> 
<table><thead><tr><th>项目</th><th>描述</th></tr></thead><tbody><tr><td>操作系统</td><td>Windows 10 专业版</td></tr><tr><td>NodeJS</td><td>18.13.0</td></tr></tbody></table> 
<h2><a id="fsFile_System_18"></a>fs（File System）</h2> 
<p>fs 模块是 NodeJS 内置的文件系统模块，为开发者提供了许多用于文件及目录操作的 API。</p> 
<p>在 NodeJS 中，我们可以通过如下代码来将该模块进行导入。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_27"></a>文件</h2> 
<h4><a id="_28"></a>读取</h4> 
<h6><a id="fsreadFile_29"></a>fs.readFile()</h6> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>其中：</strong></em></p> 
<p><strong>path</strong> 与 <strong>callback</strong> 为必选参数，而 <strong>options</strong> 为可选参数。</p> 
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>path</td><td>需要读取的目标文件的路径。</td></tr><tr><td>options</td><td>指定对被读取文件中的内容使用的编码方式。</td></tr><tr><td>callback</td><td>用以指定文件操作执行完成后需要执行的回调函数。</td></tr></tbody></table> 
<h6><a id="_44"></a>判断文件是否读取成功</h6> 
<p>传递给 <strong>fs.readFile()</strong> 的回调函数可以提供两个形参来分别接收 <strong>文件读取失败后得到的错误对象</strong> 及 <strong>文件读取成功后得到的文件内容</strong>。<br> 文件读取成功时，第一个形参将接收到的值（实参）为 <strong>null</strong>，因此可以利用这个特性来判断文件是否读取成功：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试读取当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取成功】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="_61"></a>编码</h6> 
<p><strong>options</strong> 为可选属性，若不使用该属性指定对被读取文件中的内容使用的编码方式，则文件内容的读取结果将以 <strong>Buffer</strong> 对象的形式返回。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试读取当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>打印结果：</strong></em></p> 
<blockquote> 
 <p>&lt;Buffer e9 9a 90 e7 ba a6 e9 9b b7 e9 b8 a3 ef bc 8c e9 98 b4 e9 9c be e5 a4 a9 e7 a9 ba e3 80 82 e4 bd 86 e7 9b bc e9 a3 8e e9 9b a8 e6 9d a5 ef bc 8c e8 83 … 84 more bytes&gt;</p> 
</blockquote> 
<p>你可以使用 <strong>Buffer</strong> 对象的 <strong>toString()</strong> 方法将 <strong>Buffer</strong> 对象转换为字符串：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试读取当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    	<span class="token comment">// 使用 Buffer 对象的 toString() 方法将 Buffer 对象转换为字符串</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>打印结果：</strong></em></p> 
<blockquote> 
 <p>隐约雷鸣，阴霾天空。但盼风雨来，能留你在此。<br> 隐约雷鸣，阴霾天空。即使无天雨，我亦留此地。</p> 
</blockquote> 
<p>你也可以通过 <strong>options</strong> 属性指定对被读取文件中的内容使用的编码方式来直接获取采用特定编码方式对文件内容编码后得到的字符串：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试读取当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>打印结果：</strong></p> 
<blockquote> 
 <p>隐约雷鸣，阴霾天空。但盼风雨来，能留你在此。<br> 隐约雷鸣，阴霾天空。即使无天雨，我亦留此地。</p> 
</blockquote> 
<ol start="3"><li>当提供的路径指向一个目录时，<strong>fs.readFile()</strong> 的行为是基于平台的。 在 macOS、Linux 以及 Windows 上，将得到一个错误，而在 FreeBSD 上，将返回目录内容的表示。</li></ol> 
<h4><a id="_124"></a>写入</h4> 
<h6><a id="fswriteFile_125"></a>fs.writeFile()</h6> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>其中：</strong></em></p> 
<p><strong>path</strong>、<strong>data</strong> 与 <strong>callback</strong> 为必选参数，而 <strong>options</strong> 为可选参数。</p> 
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>path</td><td>需要执行写入操作的目标文件的路径。</td></tr><tr><td>data</td><td>需要被写入文件中的内容。</td></tr><tr><td>options</td><td>指定将内容写入文件中时使用的编码方式，默认值为 <strong>utf8</strong>。</td></tr><tr><td>callback</td><td>用以指定文件操作执行完成后需要执行的回调函数。</td></tr></tbody></table> 
<p><strong>注：</strong></p> 
<p>传递给 <strong>fs.writeFile()</strong> 的回调函数中可以提供一个参数，用来指定接收将内容写入文件失败时产生的错误对象。</p> 
<h6><a id="_145"></a>覆盖</h6> 
<p>使用 <strong>fs.writeFile()</strong> 对文件执行写入操作时，写入的内容将覆盖目标文件中的原有内容。</p> 
<p><em><strong>文件 content.txt 中的原有内容：</strong></em></p> 
<blockquote> 
 <p>隐约雷鸣，阴霾天空。但盼风雨来，能留你在此。<br> 隐约雷鸣，阴霾天空。即使无天雨，我亦留此地。</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'在我贫瘠的土地上，你是最后一朵玫瑰。'</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试将变量 content 保存的内容输入到目标文本中</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件写入失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件写入成功】'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试读取当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token string">'UTF8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>打印结果：</strong></em></p> 
<blockquote> 
 <p>【文件写入成功】<br> 在我贫瘠的土地上，你是最后一朵玫瑰。</p> 
</blockquote> 
<h4><a id="_184"></a>追加</h4> 
<h6><a id="fsappendFile_185"></a>fs.appendFile()</h6> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> 
<p>在参数上，<strong>fs.appendFile()</strong> 与 <strong>fs.writeFile()</strong> 两者无异。只是在对文件进行写入操作时，<strong>fs.writeFile()</strong> 将会使用将要被写入目标文件中的内容来对目标文件中的原有内容进行覆盖，而 <strong>fs.appendFile()</strong> 则是将将要被写入目标文件中的内容附加在目标文件原有内容之后。</p> 
<p><em><strong>文件 content.txt 中的原有内容：</strong></em></p> 
<blockquote> 
 <p>在我贫瘠的土地上，你是最后一朵玫瑰。</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'\n隐约雷鸣，阴霾天空。但盼风雨来，能留你在此。\n隐约雷鸣，阴霾天空。即使无天雨，我亦留此地。'</span>

<span class="token comment">// 尝试将变量 content 中保存的内容写入到当前工作目录下的 content.txt 文件中</span>
fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件写入失败】'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 尝试读取当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>打印结果：</strong></em></p> 
<blockquote> 
 <p>在我贫瘠的土地上，你是最后一朵玫瑰。<br> 隐约雷鸣，阴霾天空。但盼风雨来，能留你在此。<br> 隐约雷鸣，阴霾天空。即使无天雨，我亦留此地。</p> 
</blockquote> 
<h4><a id="_226"></a>移动</h4> 
<h6><a id="fsrename_227"></a>fs.rename()</h6> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">,</span> newPath<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> 
<p><strong>其中：</strong></p> 
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>oldPath</td><td>需要被移动的文件所在的路径。</td></tr><tr><td>newPath</td><td>需要将文件移动到的目标路径。</td></tr><tr><td>callback</td><td>在对文件执行某项操作后需要执行的回调函数。</td></tr></tbody></table> 
<p><strong>注：</strong></p> 
<ol><li> <p>如果提供给 <strong>fs.rename()</strong> 的 <strong>newPath</strong> 的值指向的文件（夹）已经存在：</p> 
  <ul><li>如果 <strong>newPath</strong> 指向的是一个文件，则该文件将被覆盖。</li><li>如果 <strong>newPath</strong> 指向的是一个文件夹，程序将抛出错误。</li></ul> </li><li> <p>传递给 <strong>fs.rename()</strong> 的回调函数可以提供一个形参，用以接收文件操作失败后所产生的可能的错误对象。</p> </li></ol> 
<h2><a id="_251"></a>同步与异步</h2> 
<p>在 NodeJS 的 fs 模块，所有对文件及目录的操作都可以使用同步与异步两种方式，这两种方式分别对应 fs 对象的两种方法。</p> 
<p><strong>其中：</strong></p> 
<p>含有 <strong>Sync</strong> 后缀的方法名表示该方法将以同步的方式来处理文件或目录，<br> 没有 <strong>Sync</strong> 后缀的方法名表示该方法将以异步的方式来处理文件或目录。</p> 
<h4><a id="_259"></a>区别</h4> 
<h6><a id="_260"></a>后缀</h6> 
<p>有关两者在 <strong>后缀</strong> 上的区别，已在前面进行了讲述，故不在此进行赘述。</p> 
<h6><a id="_265"></a>参数</h6> 
<p>在对文件或目录实施同一操作（使用同一类方法对文件或目录进行操作，该类方法中的两种方法仅存在同步与异步之分）时，同步处理与异步处理所使用的方法在参数的含义上，两者并无差异；在使用的方法所需要的参数的数量上，同步方法不需要提供事件回调函数这一实参，而异步方法则需要进行提供。</p> 
<h6><a id="_268"></a>举个栗子</h6> 
<p><strong>fs.readFile()</strong> 需要提供的参数有：</p> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>而其对应的另一种实现（同步）<strong>fs.readFileSync()</strong> 所需要提供的参数有：</p> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="_282"></a>执行</h6> 
<h6><a id="_283"></a>同步</h6> 
<p>同步方法立即返回操作结果，在使用同步方法执行的操作结果之前，不能执行后续代码：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用同步方法时，你需要使用一个变量来接收被读取文件中的内容</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等待执行结果的返回，在执行结果返回后将打印文件中的内容</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="_295"></a>异步</h6> 
<p>异步方法将操作结果作为回调函数的参数进行返回，在方法调用之后，可以立即执行后续代码：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试读取当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token string">'UTF8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="_313"></a>错误</h6> 
<p>如果使用同步方法，你需要对文件操作过程中可能发生的错误进行捕获，否则一旦出现了相关的错误，后续代码将无法顺利执行。</p> 
<h6><a id="_316"></a>同步</h6> 
<p>这里，我将使用同步方法对不存在的文件进行读取：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试读取一个不存在的文件</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./content'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><em><strong>错误信息：</strong></em></p> 
<pre><code class="prism language-shell">node:internal/fs/utils:348
    throw err<span class="token punctuation">;</span>
    ^

Error: ENOENT: no such <span class="token function">file</span> or directory, <span class="token function">open</span> <span class="token string">'./content'</span>
    at Object.openSync <span class="token punctuation">(</span>node:fs:600:3<span class="token punctuation">)</span>
    at Object.readFileSync <span class="token punctuation">(</span>node:fs:468:35<span class="token punctuation">)</span>
    at Object.<span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span> <span class="token punctuation">(</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span><span class="token number">36683</span><span class="token punctuation">\</span>Template<span class="token punctuation">\</span>main.js:4:19<span class="token punctuation">)</span>
    at Module._compile <span class="token punctuation">(</span>node:internal/modules/cjs/loader:1218:14<span class="token punctuation">)</span>
    at Module._extensions<span class="token punctuation">..</span>js <span class="token punctuation">(</span>node:internal/modules/cjs/loader:1272:10<span class="token punctuation">)</span>
    at Module.load <span class="token punctuation">(</span>node:internal/modules/cjs/loader:1081:32<span class="token punctuation">)</span>
    at Module._load <span class="token punctuation">(</span>node:internal/modules/cjs/loader:922:12<span class="token punctuation">)</span>
    at Function.executeUserEntryPoint <span class="token punctuation">[</span>as runMain<span class="token punctuation">]</span> <span class="token punctuation">(</span>node:internal/modules/run_main:81:12<span class="token punctuation">)</span>
    at node:internal/main/run_main_module:23:47 <span class="token punctuation">{<!-- --></span>
  errno: -4058,
  syscall: <span class="token string">'open'</span>,
  code: <span class="token string">'ENOENT'</span>,
  path: <span class="token string">'./content'</span>
<span class="token punctuation">}</span>

Node.js v18.13.0
</code></pre> 
<h6><a id="_352"></a>异步</h6> 
<p>这里，我将使用异步方法对不存在的文件进行读取：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试读取一个不存在的文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./content'</span><span class="token punctuation">,</span> <span class="token string">'UTF8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><em><strong>打印结果：</strong></em></p> 
<blockquote> 
 <p>【文件读取失败】</p> 
</blockquote> 
<h6><a id="_373"></a>总结</h6> 
<p>在大多数时候，你应该使用异步方法。异步方法对开发者更为友好，并且使用异步方法也更能发挥好 NodeJS 本身的优势。但也不能对同步方法一味的排斥，在某些情况下（例如 <strong>读取配置文件并启动服务器</strong>），你应该使用同步方法。</p> 
<h2><a id="_376"></a>更细致的文件操作</h2> 
<h4><a id="fsopen_377"></a>fs.open()</h4> 
<p>使用 <strong>fs.open()</strong> 函数打开一个文件，你将能够对文件执行更细致的操作（比如从文件中的指定位置开始读写内容）。<br> 在使用 <strong>fs.open()</strong> 函数打开一个文件后，你可以使用 fs 模块中的 <strong>fs.read()</strong> 方法或 <strong>fs.readSync()</strong> 方法从文件中的指定位置开始读取文件；你也可以使用 <strong>fs.write()</strong> 方法或 <strong>fs.writeSync()</strong> 方法从文件中的指定位置开始向文件中写入内容。<br> 如果你需要在后续以 <strong>同步</strong> 方式对文件执行读写操作，请使用 <strong>fs.openSync()</strong> 函数将目标文件打开，该函数将返回目标文件的文件描述符，请注意接收。</p> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> flags<span class="token punctuation">[</span><span class="token punctuation">,</span> mode<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>其中：</strong></em></p> 
<p><strong>path</strong> 和 <strong>callback</strong> 为必选参数，而 <strong>flag</strong> 与 <strong>mode</strong> 为可选参数。</p> 
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>path</td><td>需要被打开的目标文件的路径。</td></tr><tr><td>flags</td><td>指定需要执行的文件操作，默认值为 <strong>r</strong> ，也即读取操作。</td></tr><tr><td>mode</td><td>用于指定文件被打开时对该文件的读写权限，默认值为 <strong>0666</strong> ，即可读可写。</td></tr><tr><td>callback</td><td>指定文件被打开后需要执行的回调函数。</td></tr></tbody></table> 
<p><strong>注：</strong></p> 
<p>传递给 <strong>fs.open()</strong> 的回调函数可以提供两个形参以分别接收 <strong>打开文件失败所产生的可能的错误对象</strong> 以及 <strong>代表被打开的文件的文件描述符</strong>。</p> 
<h6><a id="_401"></a>可能使用到的文件操作</h6> 
<table><thead><tr><th>项目</th><th>描述</th></tr></thead><tbody><tr><td>a</td><td>打开文件进行追加。 如果文件不存在，则创建该文件。</td></tr><tr><td>a+</td><td>打开文件进行读取和追加。 如果文件不存在，则创建该文件。</td></tr><tr><td>r</td><td>打开文件进行读取。 如果文件不存在，程序将抛出异常。</td></tr><tr><td>r+</td><td>打开文件进行读写。 如果文件不存在，程序将抛出异常。</td></tr><tr><td>w</td><td>打开文件进行写入。如果该文件不存在，则创建该文件。</td></tr><tr><td>w+</td><td>打开文件进行读写。如果该文件不存在，则创建该文件。</td></tr></tbody></table> 
<p>在 NodeJS API 官方文档对此有更详实的描述，<a href="http://nodejs.cn/api/fs.html#file-system-flags" rel="nofollow"><strong>前往查看</strong></a> 你将得到更全面的内容。</p> 
<h6><a id="_415"></a>举个栗子</h6> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试打开当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件打开失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印被开启文件对应的文件描述符</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>打印结果：</strong></em></p> 
<blockquote> 
 <p>3</p> 
</blockquote> 
<h4><a id="_434"></a>读取</h4> 
<h6><a id="fsread_436"></a>fs.read()</h6> 
<p><strong>fs.read()</strong> 函数将从文件中指定的位置开始读取文件，直到将文件读取完毕。你也可以使用 <strong>fs.readSync()</strong> 方法以同步的方式读取文件，该方法将返回实际从文件中读取到的字节数。</p> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> length<span class="token punctuation">,</span> position<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>其中：</strong></em></p> 
<p>在上述的参数中，仅 <strong>fd</strong> 与 <strong>callback</strong> 为必选参数。</p> 
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>fd</td><td>你需要为该参数提供一个文件描述符，该值必须为 <strong>fs.open()</strong> 或 <strong>fs.openSync()</strong> 函数提供的文件描述符。</td></tr><tr><td>buffer</td><td><strong>buffer</strong> 参数值需要为一个 <strong>Buffer</strong> 对象，用于指定将文件数据读取到哪个缓冲区中。</td></tr><tr><td>offset</td><td>该参数用于指定将读取到的文件内容在缓冲区中开始写入的位置（以字节为单位）。</td></tr><tr><td>length</td><td>该参数用于指定在文件中需要读取的字节数。</td></tr><tr><td>position</td><td>该参数用于指定在目标文件中开始读取文件的位置（以字节为单位）。</td></tr><tr><td>callback</td><td>用于指定读取操作完成后需要执行的回调函数。</td></tr></tbody></table> 
<p><em><strong>注：</strong></em></p> 
<ol><li>传递给 <strong>fs.read()</strong> 方法的回调函数可以提供三个形参，分别用于接收 <strong>读取文件时可能产生的错误对象</strong>、<strong>在目标文件中实际读取的字节数（指定读取的字节数可能大于文件的剩余长度）</strong> 以及 <strong>文件内容读取结果存放的缓冲区对象（Buffer）</strong> 。</li><li><strong>UTF-8</strong> 编码的单个中文字符所占据的大小为三个字节；单个 <strong>ASCII</strong> 字符所占据的大小为一个字节。</li><li>参数 
  <ul><li>若你没有为 <strong>buffer</strong> 参数提供一个缓冲区对象，<strong>fs.read()</strong> 将为你创建一个 <strong>Buffer</strong> 对象，并允许你通过提供给 <strong>fs.read()</strong> 的回调函数中的参数来对该 <strong>Buffer</strong> 对象进行接收。</li><li>若你没有指定 <strong>offset</strong> 参数的值，则默认在缓冲区对象（Buffer）的首部开始将文件内容写入到缓冲区中。</li><li>若你没有指定 <strong>position</strong> 及 <strong>length</strong> 的值，则将读取目标文件中的全部内容。</li></ul> </li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试打开当前工作目录下的 context.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件打开失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> len<span class="token punctuation">,</span> buf</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 打印从文件按中实际读取的内容所占据的字节数</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将缓冲区中的内容转换为字符串后将其打印</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>打印结果：</strong></em></p> 
<blockquote> 
 <p>190<br> 在我贫瘠的土地上，你是最后一朵玫瑰。<br> 隐约雷鸣，阴霾天空。但盼风雨来，能留你在此。<br> 隐约雷鸣，阴霾天空。即使无天雨，我亦留此地。</p> 
</blockquote> 
<p><strong>注：</strong><br> <strong>content.txt</strong> 文件中共含有 <strong>62</strong> 个字符，由于 <strong>content.txt</strong> 文件中还包含两个换行，一个换行符占用两个字节，所以在目标文件中读取的字节数为 <strong>190</strong>。</p> 
<h6><a id="_498"></a>举个栗子</h6> 
<p><em><strong>程序运行前，content.txt 文件中的内容为：</strong></em></p> 
<blockquote> 
 <p>在我贫瘠的土地上，你是最后一朵玫瑰。<br> 隐约雷鸣，阴霾天空。但盼风雨来，能留你在此。<br> 隐约雷鸣，阴霾天空。即使无天雨，我亦留此地。</p> 
</blockquote> 
<p>我将尝试在读取 <strong>content.txt</strong> 文件中的第一行文本后，再次读取该文件捉弄的余下内容。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试打开当前工作目录下的 content.txt 文件</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'./content.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【文件打开失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建大小为 256 字节的缓冲区对象用于</span>
        <span class="token comment">// 存放读取的文件内容。</span>
        <span class="token keyword">const</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 第一次读取</span>
        <span class="token comment">// 第一行中共有 18 个可见字符以及一个换行符</span>
        <span class="token comment">// 所以此处将 length 参数的值设置为 18 * 3 + 2 = 56</span>
        fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> len<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【第一次文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【第一次文件读取】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 第二次文件读取</span>
            <span class="token comment">// 第二次读取是在第一次读取完成后执行的回调函数中进行的，</span>
            <span class="token comment">// 这样可以避免第一次与第二次打印的内容相同</span>
            <span class="token comment">// （非阻塞机制使得两者在打印读取内容前均已将文件读取完毕）。</span>
            fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> len<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【第二次文件读取失败】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'【第二次文件读取】'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
 
</code></pre> 
<p><em><strong>打印结果：</strong></em></p> 
<blockquote> 
 <p>(node:14224) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.<br> (Use node --trace-deprecation … to show where the warning was created)<br> 【第一次文件读取】<br> 在我贫瘠的土地上，你是最后一朵玫瑰。</p> 
 <p>【第二次文件读取】<br> 在我贫瘠的土地上，你是最后一朵玫瑰。<br> 隐约雷鸣，阴霾天空。但盼风雨来，能留你在此。<br> 隐约雷鸣，阴霾天空。即使无天雨，我亦留此地。</p> 
</blockquote> 
<p><em><strong>其中：</strong></em></p> 
<blockquote> 
 <p>(node:14224) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.<br> (Use node --trace-deprecation … to show where the warning was created)</p> 
</blockquote> 
<p>在打印结果中出现上述内容并不是我们的程序出来问题，是由于安全性和可用性问题，官方并不推荐使用 <strong>new Buffer()</strong> 来创建缓冲区对象，因此打印内容中出现了警告以表明官方推荐使用 <strong>Buffer.alloc ()</strong>、 <strong>Buffer.allocUnsafe()</strong> 或 <strong>Buffer.from()</strong> 方法来代替 <strong>new Buffer()</strong> 方法。</p> 
<h4><a id="_568"></a>写入</h4> 
<h6><a id="fswrite_570"></a>fs.write()</h6> 
<p><strong>fs.write()</strong> 函数将从目标文件中的指定位置开始将内容写入，直到将内容完全写入到目标文件中。你也可以使用 <strong>fs.writeSync()</strong> 方法以同步的方式将内容写入文件。</p> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> length<span class="token punctuation">,</span> position<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> 
<p><em><strong>其中：</strong></em></p> 
<p>在上述的参数中，仅 <strong>fd</strong> 及 <strong>call</strong>为必选参数。</p> 
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>fd</td><td>你需要为该参数提供一个文件描述符，该值必须为 <strong>fs.open()</strong> 或 <strong>fs.openSync()</strong> 函数提供的文件描述符。</td></tr><tr><td>buffer</td><td><strong>buffer</strong> 参数值需要为一个 <strong>Buffer</strong> 对象，用于指定需要写入目标文件中的内容从哪一个缓冲区对象中读取。</td></tr><tr><td>offset</td><td>该参数用于指定从缓冲区中开始读取内容的位置（以字节为单位）。</td></tr><tr><td>length</td><td>该参数用于指定在缓冲区中需要读取的字节数。</td></tr><tr><td>position</td><td>该参数用于指定在目标文件中开始写入内容的位置（以字节为单位）。</td></tr><tr><td>callback</td><td>用于指定写入操作完成后需要执行的回调函数。</td></tr></tbody></table> 
<h4><a id="_591"></a>关闭</h4> 
<p>在 NodeJS 中的 fs 模块中，存在两个方法 <strong>fs.close()</strong> 及 <strong>fs.closeSync()</strong> 用于关闭由 <strong>fs.open()</strong> 及 <strong>fs.openSync()</strong> 打开的文件。</p> 
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>其中：</strong></p> 
<p>仅 <strong>fd</strong> 为必选参数。</p> 
<table><thead><tr><th>项目</th><th>描述</th></tr></thead><tbody><tr><td>fd</td><td>需要被关闭的文件的文件描述符。</td></tr><tr><td>callback</td><td>在关闭文件这一操作完成后需要执行的回调函数。</td></tr></tbody></table> 
<p><strong>注：</strong></p> 
<p>你可以为传递给 <strong>fs.close()</strong> 函数的回调函数提供一个形参用以接收关闭文件过程中可能产生的错误对象。</p> 
<h4><a id="_611"></a>区别</h4> 
<h6><a id="fsreadFilefsreadFileSyncfswriteFile__fswriteFileSync_613"></a>fs.readFile()、fs.readFileSync()、fs.writeFile() 及 fs.writeFileSync()</h6> 
<p>在使用 <strong>fs.read()File</strong>、<strong>fs.readFileSync()</strong>、<strong>fs.writeFile()</strong> 及 <strong>fs.writeFileSync()</strong> 等函数对文件进行读写操作时，NodeJS 首先将内容完整读写到缓存当中，再将该缓存中的内容读取或将该内容写入目标文件中。</p> 
<p><strong>也就是说：</strong></p> 
<p>在使用上述方法时，NodeJS 将内容视为一个整体，为其分配缓冲区并且一次性将内容读取到缓冲区中后，一次性将内容进行读取或写入目标文件中。</p> 
<h6><a id="fsreadfsreadSycnfswrite__fswriteSync_620"></a>fs.read()、fs.readSycn()、fs.write() 及 fs.writeSync()</h6> 
<p>与 <strong>fs.read()File</strong>、<strong>fs.readFileSync()</strong>、<strong>fs.writeFile()</strong> 及 <strong>fs.writeFileSync()</strong> 等方法不同的是，<strong>fs.read()</strong>、<strong>fs.readSycn()</strong>、<strong>fs.write()</strong> 及 <strong>fs.writeSync()</strong> 并不将内容看成一个整体，而是将内容看成许多个部分。</p> 
<p>在对文件进行处理时，<strong>fs.read()</strong>、<strong>fs.readSycn()</strong>、<strong>fs.write()</strong> 及 <strong>fs.writeSync()</strong> 方法会将内容分为许多个部分，重复的对这些部分进行读取或写入。</p> 
<p><code>至于为什么要这样设计，暂不清楚。</code></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3f24bab22746bff9507b8dfb1ef5caeb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL如何获取每个分组内前n条数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae0ab40bb5ca4c466e79602290325d9b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python基础—格式化输出</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>