<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何用python脚本实现一次获取token,多次使用token - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何用python脚本实现一次获取token,多次使用token" />
<meta property="og:description" content="这篇文章主要介绍了如何用python脚本实现一次获取token,多次使用token问题,具有很好的参考价值,希望对大家有所帮助,如有错误或未考虑完全的地方,望不吝赐教−
1.两种格式的文件 1）编写配置文件Token.yaml（暂时为空），用来存放token值
另外：用命令：pip3 install ruamel.yaml安装ruamel.yaml模块，用以去除yaml文件中的大括号
2）编写配置文件access_token.yml，把token值写到配置文件中的关键代码如下：
# 把token值写到配置文件access_token.yml中 def write_token(res): curPath = os.path.abspath(os.path.dirname(__file__)) yamlPath = os.path.abspath(os.path.dirname(curPath) &#43; os.path.sep &#43; &#34;configs/access_token.yml&#34;) # yamlPath = os.path.dirname(os.path.abspath(&#39;.&#39;))&#43;&#39;/data/access_token.yml&#39; # res = json.loads(res) tokenValue = { &#39;access_token&#39;: res[&#34;access_token&#34;] } with open(yamlPath, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f: yaml.dump(tokenValue, f) logger.info(&#34;\n token值已保存至配置文件中&#34;) 2.编写鉴权文件testingedu_auth.py 用于获取token值并存储token值：
#!/usr/bin/env python # -*- coding:utf-8 -*- # 用pip3命令安装 import requests from ruamel import yaml def test_testingedu_auth(): url = &#34;http://www.XXX.com.cn/XXX/HTTP//auth&#34; headers = {&#34;Content-Type&#34;: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/9e908fd83d8bd2d20dcb74d26b18343e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-20T21:59:16+08:00" />
<meta property="article:modified_time" content="2023-10-20T21:59:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何用python脚本实现一次获取token,多次使用token</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/fe/a0/CF4NmbfY_o.png" alt=""></p> 
<p>这篇文章主要介绍了如何用python脚本实现一次获取token,多次使用token问题,具有很好的参考价值,希望对大家有所帮助,如有错误或未考虑完全的地方,望不吝赐教−</p> 
<h3><a id="1_5"></a>1.两种格式的文件</h3> 
<p>1）编写配置文件Token.yaml（暂时为空），用来存放token值</p> 
<p>另外：用命令：pip3 install ruamel.yaml安装ruamel.yaml模块，用以去除yaml文件中的大括号</p> 
<p><img src="https://images2.imgbox.com/28/8d/ePdNkaTD_o.png" alt=""><br> 2）编写配置文件access_token.yml，把token值写到配置文件中的关键代码如下：</p> 
<pre><code>
# 把token值写到配置文件access_token.yml中
def write_token(res):
    curPath = os.path.abspath(os.path.dirname(__file__))
    yamlPath = os.path.abspath(os.path.dirname(curPath) + os.path.sep + "configs/access_token.yml")
    # yamlPath = os.path.dirname(os.path.abspath('.'))+'/data/access_token.yml'
    # res = json.loads(res)
    tokenValue = {
        'access_token': res["access_token"]
    }
    with open(yamlPath, 'w', encoding='utf-8') as f:
        yaml.dump(tokenValue, f)
    logger.info("\n token值已保存至配置文件中")
</code></pre> 
<h3><a id="2testingedu_authpy_28"></a>2.编写鉴权文件testingedu_auth.py</h3> 
<p>用于获取token值并存储token值：</p> 
<pre><code>
#!/usr/bin/env python 
# -*- coding:utf-8 -*-
# 用pip3命令安装
import requests
from ruamel import yaml
def test_testingedu_auth():
    url = "http://www.XXX.com.cn/XXX/HTTP//auth"
    headers = {"Content-Type": "application/json"}
    # 发送请求
    response = requests.post(url=url, headers=headers)
    print(response.text)
    print(response.status_code)
    print(response.json()["token"])
    # return response.json()["token"]
    # 把token值写入配置文件中
    # cur = os.path.dirname(os.path.realpath(__file__))
    # p = os.path.join(cur, 'Token.yaml')
    yamlpath = r'C:\Users\Administrator\PycharmProjects\APITest\common\Token.yaml'
    tokenValue = {
        'token': response.json()["token"],
    }
    with open(yamlpath, "w", encoding="utf-8") as f:
        yaml.dump(tokenValue, f, Dumper=yaml.RoundTripDumper)
if __name__ == "__main__":
    test_testingedu_auth()
</code></pre> 
<p>运行结果：</p> 
<p><img src="https://images2.imgbox.com/40/fa/g3f3KU8g_o.png" alt=""><br> 查看Token.yaml中的值：</p> 
<p><img src="https://images2.imgbox.com/c2/a0/Q0iXySDK_o.png" alt=""></p> 
<h3><a id="3tokenget_tokenpy_65"></a>3.编写获取token值的脚本：get_token.py</h3> 
<p>方便其他接口调用（登录、查看和退出）</p> 
<pre><code>
#!/usr/bin/env python 
# -*- coding:utf-8 -*-
import yaml
import os
# cur = os.path.dirname(os.path.realpath(__file__))
def get_token(yamlName = "Token.yaml"):
    # 从配置文件中读取token值，并返回
    p = os.path.join(r'C:\Users\Administrator\PycharmProjects\APITest\common\Token.yaml')
    f = open(p)
    a = f.read()
    t = yaml.load(a)
    f.close()
    return t["token"]
if __name__ == "__main__":
    get_token()
</code></pre> 
<h3><a id="4_87"></a>4.编写登录接口脚本</h3> 
<p>testingedu_login.py</p> 
<pre><code>#!/usr/bin/env python 
# -*- coding:utf-8 -*-
import requests
from common.get_token import get_token
def testingedu_login():
    url = "http://www.XXX.com.cn/XXX/HTTP//login?username=XXX&amp;password=XXX"
    headers = {"token": get_token()}
    response = requests.post(url=url, headers=headers)
    print("返回体是：", response.text)
    print("状态码是：", response.status_code)
if __name__ == "__main__":
    testingedu_login()
</code></pre> 
<p>运行结果：</p> 
<p><img src="https://images2.imgbox.com/7a/c9/SX5xh84X_o.png" alt=""></p> 
<h3><a id="5_108"></a>5.编写查看接口脚本</h3> 
<p>testingedu_info.py</p> 
<pre><code>
#!/usr/bin/env python 
# -*- coding:utf-8 -*
import requests
from common.get_token import get_token
def testingedu_info():
    url = "http://www.XXX.com.cn/XXX/HTTP//getUserInfo?id=XXX"
    headers = {"token": get_token()}
    response = requests.post(url=url, headers=headers)
    print(response.text)
    print(response.status_code)
if __name__ == "__main__":
    testingedu_info()
</code></pre> 
<p>运行结果：</p> 
<p><img src="https://images2.imgbox.com/0d/e3/Zg1JgW5o_o.png" alt=""></p> 
<h3><a id="6_129"></a>6.编写退出接口脚本</h3> 
<p>testingedu_logout.py</p> 
<pre><code>
#!/usr/bin/env python 
# -*- coding:utf-8 -*-
import requests
from common.get_token import get_token
def testingedu_logout():
    url = "http://www.XXX.com.cn/XXX/HTTP//logout"
    headers = {"token": get_token()}
    response = requests.post(url=url, headers=headers)
    print(response.text)
    print(response.status_code)
if __name__ == "__main__":
    testingedu_logout()
</code></pre> 
<p>运行结果：</p> 
<p><img src="https://images2.imgbox.com/00/92/HJh7QBYY_o.png" alt=""></p> 
<h3><a id="_150"></a>总结</h3> 
<p>以上为个人经验，希望能给大家一个参考。</p> 
<hr> 
<h3><a id="_157"></a>最后</h3> 
<p>如果你想学习自动化测试，那么下面这套视频应该会帮到你很多</p> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="hYZVpptO-1697609353619" frameborder="0" src="https://player.bilibili.com/player.html?aid=657315088" allowfullscreen="true" data-mediaembed="bilibili"></iframe> 
 <p>如何逼自己1个月学完自动化测试，学完即就业，小白也能信手拈来，拿走不谢，允许白嫖....</p> 
</div> 
<p></p> 
<p>最后我这里给你们分享一下我所积累和整理的一些文档和学习资料，有需要直接领取就可以了！</p> 
<p><img src="https://images2.imgbox.com/21/1f/KSB7fmmZ_o.png" alt=""><br> 以上内容，对于软件测试的朋友来说应该是最全面最完整的备战仓库了，为了更好地整理每个模块，我也参考了很多网上的优质博文和项目，力求不漏掉每一个知识点，很多朋友靠着这些内容进行复习，拿到了BATJ等大厂的offer，这个仓库也已经帮助了很多的软件测试的学习者，希望也能帮助到你。</p> 
<p>​​<img src="https://images2.imgbox.com/33/4e/SIrzCDuL_o.png" alt=""></p> 
<p>​​​​</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/43456d8cac5e9eb80a5074f1cd17e926/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">bash常用代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a304a463c1e04034bf0cec4e768d3445/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">绘制核密度估计图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>