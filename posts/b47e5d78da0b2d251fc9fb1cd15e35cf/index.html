<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>记一次vue2项目迁移至vue3经历 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="记一次vue2项目迁移至vue3经历" />
<meta property="og:description" content="升级之前建议阅读下面这篇文章，会对升级有帮助
vue官方文档：vue3迁移指南
注：vue3是支持vue2的选项式API风格的
下面就进入升级的流程了
环境准备，如果node和npm的版本过低需要升级，我的环境如下：
依赖升级以及错误修复
升级之前项目采用的是vue2.6&#43;ant-design-of-vue1.7&#43;less&#43;axios&#43;webpack，因为项目采用的是vue-cli搭建的，所以第一步是升级vue-cli,通过 vue upgrade 命令升级到最新的 @vue/cli-service
在终端执行npm view vue versions --json.查看vue的历史版本,选择合适的vue3版本后更改package.json,删除node-module，执行yarn重新安装node-module包，安装完成之后安装与vue版本相同的@vue/compact,如果项目中存在vue-template-compiler的话，将其替换为@vue/compiler-sfc
启动项目，根据终端的报错信息来修改项目
2.1 ERROR ValidationError: Invalid options object. Ignore Plugin has been initialized using an options object that does not match the API schema. - options should be one of these: object { resourceRegExp, contextRegExp? } | object { checkResource } Details: * options misses the property &#39;resourceRegExp&#39;. Should be: RegExp -&gt; A RegExp to test the request against." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/b47e5d78da0b2d251fc9fb1cd15e35cf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-13T17:49:51+08:00" />
<meta property="article:modified_time" content="2023-02-13T17:49:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">记一次vue2项目迁移至vue3经历</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="">升级之前建议阅读下面这篇文章，会对升级有帮助</p> 
 <p style="">vue官方文档：<a class="kdocs-link" style="color:#0A6CFF;" href="https://v3-migration.vuejs.org/zh" rel="nofollow noopener noreferrer" target="_blank">vue3迁移指南</a></p> 
 <p style="">注：vue3是支持vue2的选项式API风格的</p> 
 <p style=""></p> 
 <p style="">下面就进入升级的流程了</p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>环境准备，如果node和npm的版本过低需要升级，我的环境如下：</p></li></ol> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:942px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:21.019108%;height:0;"> 
    <img src="https://images2.imgbox.com/58/2b/p3S0EitI_o.png" style="margin-left:;display:block;width:942px;margin-top:-21.019108%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>依赖升级以及错误修复</p></li></ol> 
 <p style="">升级之前项目采用的是vue2.6+ant-design-of-vue1.7+less+axios+webpack，因为项目采用的是vue-cli搭建的，所以第一步是升级vue-cli,通过 vue upgrade 命令升级到最新的 @vue/cli-service</p> 
 <p style=""></p> 
 <p style="">在终端执行npm view vue versions --json.查看vue的历史版本,选择合适的vue3版本后更改package.json,删除node-module，执行yarn重新安装node-module包，安装完成之后安装与vue版本相同的@vue/compact,如果项目中存在vue-template-compiler的话，将其替换为@vue/compiler-sfc</p> 
 <p style=""></p> 
 <p style="">启动项目，根据终端的报错信息来修改项目</p> 
 <p style=""></p> 
 <p style="text-align:left;">2.1 </p> 
 <pre class="kdocs-javascript"><code class="language-javascript">ERROR  ValidationError: Invalid options object. Ignore Plugin has been initialized using an options object that does not match the API schema.
 - options should be one of these:
   object { resourceRegExp, contextRegExp? } | object { checkResource }
   Details:
    * options misses the property 'resourceRegExp'. Should be:
      RegExp
      -&gt; A RegExp to test the request against.
    * options misses the property 'checkResource'. Should be:
      function
      -&gt; A filter function for resource and context.</code></pre> 
 <p style="text-align:left;"></p> 
 <p style="text-align:left;">如果出现以上错误，修改vue.config.js中configureWebpack中 plugin的写法。</p> 
 <p style="text-align:left;">报错的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">plugins: [
      // Ignore all locale files of moment.js
      new webpack.IgnorePlugin(/^\.\/locale$/, /moment$/)
    ],</code></pre> 
 <p style="text-align:left;">正确的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">plugins: [ 
onew webpack.IgnorePlugin(
        {
          resourceRegExp:/^\.\/locale$/,
          contextRegExp:  /moment$/,
        }
)
]</code></pre> 
 <p style="text-align:left;"></p> 
 <p style="text-align:left;">2.2 </p> 
 <pre class="kdocs-javascript"><code class="language-javascript">Invalid options object. PostCSS Loader has been initialized using an options object that does not match the API schema.    
options has an unknown property ‘plugins’. These properties are valid:  
object { postcssOptions?, execute?, sourceMap?, implementation? } </code></pre> 
 <p style="text-align:left;">如果出现以上错误，是因为项目中采用了postcss-pxtorem 或者postcss-px2rem插件导致的运行报错，只需在vue.config.js中更改loaderOptions的写法就可以了</p> 
 <p style="">错误的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">loaderOptions: {
      postcss: {
        plugins: [
          require('postcss-px2rem')({
            remUnit: 100,
          }),
        ],
      },
    },</code></pre> 
 <p style="">正确的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">loaderOptions: {
        postcss: {
          postcssOptions:{
            plugins: [
              require('postcss-px2rem')({
                remUnit:100
              }),
            ]
          }
        }
    }</code></pre> 
 <p style=""></p> 
 <p style="">2.3 </p> 
 <pre class="kdocs-javascript"><code class="language-javascript">Uncaught Error: Module build failed (from ./node_modules/css-loader/dist/cjs.js): 
TypeError: node.getIterator is not a function</code></pre> 
 <p style="">如果出现上述错误，是因为用了postcss-px2rem插件，该插件与vue3不兼容，可以卸载该插件，安装postcss-pxtorem, vue.config.js修改如下：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">css: {  
  loaderOptions: {  
    postcss: {  
      postcssOptions: {  
        plugins: [  
          require('postcss-pxtorem')({  
            // remUnit: 100,  
            rootValue: 100,  
            // unitPrecision: 5,  
            propList: ['*'],  
          }),  
        ],  
      },  
    },  
  },  
},</code></pre> 
 <p style=""></p> 
 <p style="">2.4</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">Component name “xxx“ should always be multi-word vue/multi-word-component-names</code></pre> 
 <p style=""></p> 
 <p style="">升级为vue3后，文件的命名不符合规范，有2种解决方式：</p> 
 <p style="">一是修改组件文件的命名</p> 
 <p style="">另一种是更改eslint验证规则，内容如下</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">module.exports = {  
  root: true,  
  env: {  
    node: true  
  },  
  'extends': [  
    'plugin:vue/essential',  
    'eslint:recommended'  
  ],  
  parserOptions: {  
    parser: '@babel/eslint-parser'  
  },  
  rules: {  
    // 'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',  
    // 'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',  
     //在rules中添加自定义规则  
     //关闭组件命名规则  
     "vue/multi-word-component-names":"off",  
     "vue/no-v-model-argument":"off"  
  },  
  // overrides: [  
  //   {  
  //     files: [  
  //       '**/__tests__/*.{j,t}s?(x)',  
  //       '**/tests/unit/**/*.spec.{j,t}s?(x)'  
  //     ],  
  //     env: {  
  //       jest: true  
  //     }  
  //   }  
  // ]  
}  </code></pre> 
 <p style=""></p> 
 <p style="">到这里运行项目基本就不会报错了</p> 
 <p style=""></p> 
 <p style=""></p> 
 <p style="">3.接下来就是修改<span class="kdocs-bold" style="font-weight:bold;">main.js</span></p> 
 <p style="">原来的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">new Vue({  
  router,  
  store,  
  render: (h) =&gt; h(App),  
}).$mount('#app') </code></pre> 
 <p style="">新的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">import {createApp} from 'vue'  
  
const app = createApp(App)  
  
app.use(store)  
app.use(router)  
app.use(Antd)  
app.use(Plugins)  
  
app.config.productionTip = false;  
app.config.globalProperties.$message = message;  
app.config.globalProperties.$filters = filters  
  
app.mount('#app') </code></pre> 
 <p style="text-align:null;">需要注意的是app.use()的使用顺序</p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;">更改完之后升级vue-router,vuex到最新的版本，然后升级UIant-design,综合所有原因，UI框架最终选择了版本2的，ant-design升级建议了解下<a class="kdocs-link" style="color:#0A6CFF;" href="https://2x.antdv.com/docs/vue/migration-v2-cn" rel="nofollow noopener noreferrer" target="_blank">这篇文章</a></p> 
 <p style="text-align:null;">原来vue-router的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">import Vue from 'vue'  
import Router from 'vue-router'  
Vue.use(Router)  
  
function initRouter(isAsync) {  
  const options = isAsync  
    ? require('./async/config.async').default  
    : require('./config').default  
  formatRoutes(options.routes)  
  // 路由默认模式  
  options.mode = 'history'  
  return new Router(options)  
}</code></pre> 
 <p style="">升级后的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">import { createRouter, createWebHistory  } from "vue-router";  
function initRouter(isAsync) {  
  const options = isAsync  
    ? require('./async/config.async').default  
    : require('./config').default  
  formatRoutes(options.routes)  
  options.history = createWebHistory()  
  return createRouter(options)  
}  </code></pre> 
 <p style=""></p> 
 <p style="">原来vuex的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">import Vue from 'vue'  
import Vuex from 'vuex'  
import modules from './modules'  
  
Vue.use(Vuex)  
const store = new Vuex.Store({ modules })</code></pre> 
 <p style="">升级后的写法：</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">import { createStore } from 'vuex'  
import modules from './modules'  
  
const store = createStore({ modules })  
  
export default store </code></pre> 
 <p style=""></p> 
 <p style="">4.更改之后运行项目，可以看到控制台有非常多的警告</p> 
 <p style="">之后就是根据警告来修改代码</p> 
 <p style="">4.1 </p> 
 <pre class="kdocs-javascript"><code class="language-javascript">Vue.extend is not a function</code></pre> 
 <p style="text-align:null;">如果出现上述错误，有可能是插件不兼容，可以根据提示找到相应的文档暂时注释该插件的使用，后续再放开，升级插件或者是找到可更换的插件</p> 
 <p style=""></p> 
 <p style="">4.2</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">Non-function value encountered for default slot. Prefer function slots for better performance.</code></pre> 
 <p style="text-align:null;">vue3 更改了h函数的语法。原来的h函数可以从render 函数中获取，但是vue3当中获取h函数的方法改成了 import { h } from ‘vue’.并且语法改成了h(节点的标签名，节点的属性（如果没有属性，可以用{}代替），节点标签的内容（注意这块改成了对象）)，详情可以参考<a class="kdocs-link" style="color:#0A6CFF;" href="https://www.jb51.net/article/270858.htm" rel="nofollow noopener noreferrer" target="_blank">这篇文章</a></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;">4.3</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">Extraneous non-props attributes (style) were passed to component but could not be automatically inherited because component renders fragment or text root nodes.</code></pre> 
 <p style="text-indent:1.4em;text-align:null;">原因：在组件的节点上添加了样式</p> 
 <p style="text-indent:1.4em;text-align:null;">解决办法：在组件的外面套一层标签，把组件的样式放到这个标签上</p> 
 <p style="text-indent:1.4em;text-align:null;"></p> 
 <p style="text-align:null;">4.4 Invalid VNode type: undefined (undefined)</p> 
 <p style="text-align:left;">原因：某个节点获取不到，我这边是动态引入组件，()=&gt;<a class="kdocs-link" style="color:#0A6CFF;" href="mailto:import%28%E2%80%98@/components/tag/index.vue%E2%80%99%29" rel="nofollow noopener noreferrer" target="_blank"><span class="kdocs-underline" style="text-decoration:underline;">import(‘@/components/tag/index.vue’)</span></a> 报的警告</p> 
 <p style="text-align:left;">解决方式：vue3 增加了一个动态注册组件的方法defineAsyncComponent,用这个方法包裹一下就可以啦</p> 
 <p style=""></p> 
 <p style="">4.5</p> 
 <pre class="kdocs-javascript"><code class="language-javascript">Vue received a Component which was made a reactive object. This can lead to unnecessary performance overhead, and should be avoided by marking the component with `markRaw` or using `shallowRef` instead of `ref`.</code></pre> 
 <p style="text-indent:1.4em;text-align:null;">原因：组件是一个响应对象，将会进一步引入性能开销，也是解决警告5后出现的</p> 
 <p style="text-indent:1.4em;text-align:null;">解决方法：用markRaw包裹一下，写法如下：</p> 
 <p style="text-indent:1.4em;text-align:null;">markRaw（defineAsyncComponent（（）=&gt; import （‘组件路径’）））</p> 
 <p style=""></p> 
 <p style="">解决完上面的问题，项目基本上就可以正常的运行啦</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/16326f7c420f8533114096fed6aa0d49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">win11和win10哪个好?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7f60544b8fc36d3d2e45a101560517ea/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue js自动计算时间跨度从当前日期往后一个月、三个月、半年、一年时间计算</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>