<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>日志审计Graylog审计华为交换机用户登录日志 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="日志审计Graylog审计华为交换机用户登录日志" />
<meta property="og:description" content="上期讲解了日志审计graylog安装，这期讲解graylog的部分实用功能的使用。
上期内容链接：https://blog.csdn.net/weixin_43886932/article/details/125678301?spm=1001.2014.3001.5501
1、读取日志 日志基本上都存放在Streams — All messages中
进入ALL messages看到的日志并非很直观，如下图所示，我们登录的交换机日志都看不到是什么IP，解决方法是可以通过创建新的Stream来过滤所需要的的信息，创建仪表板Dashboards来显示需要的数据。
2、创建Stream 进入Create Stream，创建一个新的Stream，标题自定义，教程中为“78”，描述为“登录信息”。
配置Manage Rules
创建一个Stream rule
字段Field，选择远程IP（gl2_remote_ip），上期教程介绍了我们登录的交换机IP是172.16.1.254，如下图：
点击Strart Stream，开启“78”Stream。
点击运行，如下图：
上期教程已经配置好交换机，现在登录交换机获取到一些登录日志信息。
通过CRT登录交换机如下图：
日志审计GRAYLOG获取到的日志如下图：
我们获取一段交换机发给日志服务器的登录日志如下：
“Jul 6 2022 09:18:59 &#43;78 %%01SHELL/5/LOGIN(s)[257]:The user succeeded in logging in to VTY0. (UserType=SSH, UserName=78, AuthenticationMethod=“Local-user”, Ip=172.16.1.60, VpnName=)”
从日志中得出，关键字如下：
登录成功：The user succeeded in logging in to VTY0
登录时间：Jul 6 2022 09:18:59
登录协议：UserType=SSH
登录用户：UserName=78
登录用户IP：Ip=172.16.1.60
进入提取器并创建新的字段，每添加1个字段，该步骤需要重复一次，点开需要提前的消息，如下图：
点开子菜单，如下图：
选择正则表达式Regular expression，如下图：
创建字段登录协议字段UserType：
正则表达式：UserType=(.?),
创建字段登录用户字段UserName：
正则表达式：UserName=(.?),
创建字段登录IP字段Ip：
正则表达式：Ip=(.?),
创建字段登录成功字段login：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/7ffd10be35cab7a1942271ed3f3d3075/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-14T17:21:35+08:00" />
<meta property="article:modified_time" content="2022-07-14T17:21:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">日志审计Graylog审计华为交换机用户登录日志</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>上期讲解了日志审计graylog安装，这期讲解graylog的部分实用功能的使用。<br> 上期内容链接：https://blog.csdn.net/weixin_43886932/article/details/125678301?spm=1001.2014.3001.5501</p> 
<h2><a id="1_3"></a>1、读取日志</h2> 
<p>日志基本上都存放在Streams — All messages中<br> <img src="https://images2.imgbox.com/fd/f2/0mM8mm50_o.png" alt="在这里插入图片描述"><br> 进入ALL messages看到的日志并非很直观，如下图所示，我们登录的交换机日志都看不到是什么IP，解决方法是可以通过创建新的Stream来过滤所需要的的信息，创建仪表板Dashboards来显示需要的数据。</p> 
<p><img src="https://images2.imgbox.com/d2/a1/PI5binJF_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2Stream_10"></a>2、创建Stream</h2> 
<p>进入Create Stream，创建一个新的Stream，标题自定义，教程中为“78”，描述为“登录信息”。<br> <img src="https://images2.imgbox.com/0f/6a/CuOWT9YQ_o.png" alt="在这里插入图片描述"><br> 配置Manage Rules</p> 
<p><img src="https://images2.imgbox.com/be/9a/iP31qMqy_o.png" alt="在这里插入图片描述"><br> 创建一个Stream rule<br> <img src="https://images2.imgbox.com/aa/9e/5ygYbrse_o.png" alt="在这里插入图片描述"><br> 字段Field，选择远程IP（gl2_remote_ip），上期教程介绍了我们登录的交换机IP是172.16.1.254，如下图：</p> 
<p><img src="https://images2.imgbox.com/51/20/IbbCBhnK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1b/8f/gfuQx1JX_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f1/9f/eLc3eAWr_o.png" alt="在这里插入图片描述"><br> 点击Strart Stream，开启“78”Stream。<br> <img src="https://images2.imgbox.com/ed/5f/M3rQRQnb_o.png" alt="在这里插入图片描述"><br> 点击运行，如下图：<br> <img src="https://images2.imgbox.com/c9/a3/DJDHOlub_o.png" alt="在这里插入图片描述"><br> 上期教程已经配置好交换机，现在登录交换机获取到一些登录日志信息。<br> 通过CRT登录交换机如下图：<br> <img src="https://images2.imgbox.com/5e/d8/rIOIvF0w_o.png" alt="在这里插入图片描述"><br> 日志审计GRAYLOG获取到的日志如下图：<br> <img src="https://images2.imgbox.com/c9/d8/DJUJMlfl_o.png" alt="在这里插入图片描述"><br> 我们获取一段交换机发给日志服务器的登录日志如下：<br> “Jul 6 2022 09:18:59 +78 %%01SHELL/5/LOGIN(s)[257]:The user succeeded in logging in to VTY0. (UserType=SSH, UserName=78, AuthenticationMethod=“Local-user”, Ip=172.16.1.60, VpnName=)”<br> 从日志中得出，关键字如下：<br> 登录成功：The user succeeded in logging in to VTY0<br> 登录时间：Jul 6 2022 09:18:59<br> 登录协议：UserType=SSH<br> 登录用户：UserName=78<br> 登录用户IP：Ip=172.16.1.60</p> 
<p>进入提取器并创建新的字段，每添加1个字段，该步骤需要重复一次，点开需要提前的消息，如下图：<br> <img src="https://images2.imgbox.com/b9/03/atYvJUpn_o.png" alt="在这里插入图片描述"><br> 点开子菜单，如下图：<br> <img src="https://images2.imgbox.com/36/84/x8K1opZ2_o.png" alt="在这里插入图片描述"><br> 选择正则表达式Regular expression，如下图：<br> <img src="https://images2.imgbox.com/72/0d/KESr9VeG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bd/90/m3AesxZV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b8/1b/5Dvyl7oE_o.png" alt="在这里插入图片描述"><br> 创建字段登录协议字段UserType：<br> 正则表达式：UserType=(.<em>?),<br> <img src="https://images2.imgbox.com/7a/24/Qu2l856e_o.png" alt="在这里插入图片描述"><br> 创建字段登录用户字段UserName：<br> 正则表达式：UserName=(.</em>?),</p> 
<p><img src="https://images2.imgbox.com/70/f2/ucz34gOT_o.png" alt="在这里插入图片描述"><br> 创建字段登录IP字段Ip：<br> 正则表达式：Ip=(.<em>?),<br> <img src="https://images2.imgbox.com/15/93/0SAiNUxz_o.png" alt="在这里插入图片描述"><br> 创建字段登录成功字段login：<br> 正则表达式：👿.</em>?).</p> 
<pre><code class="prism language-xml">正则表达式：]:(.*?)\.
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/5e/Sz5UEmWR_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3Dashboards_69"></a>3、创建仪表盘Dashboards</h2> 
<p>点击Dashboards—Create new dashboard<br> <img src="https://images2.imgbox.com/d8/ff/hE2aC97h_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/37/4c/KTiI6xkM_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bd/92/5b3SqGZo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/78/9a/NnalNPhv_o.png" alt="在这里插入图片描述"><br> 点击“+”号，创建6个Group By，按顺序选择字段：<br> 第一个：timestamp<br> 第二个：UserName<br> 第三个：UserType<br> 第四个：Ip<br> 第五个：login<br> 第六个：gl2_remote_ip<br> Visualization：Type选择Date Table<br> Sort：<br> Field选择timestamp;<br> direction选择Descending<br> 如下图所示：<br> <img src="https://images2.imgbox.com/f4/72/w5hQECzx_o.png" alt="在这里插入图片描述"><br> 点击Apply Changes：<br> 一定要注意过滤器选择我们创建的stream“78”，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/78/82/1goAUPtF_o.png" alt="在这里插入图片描述"><br> 最后点击Save:<br> <img src="https://images2.imgbox.com/dc/7a/Z1yXgAgy_o.png" alt="在这里插入图片描述"><br> 选择日志的时间，任意选，点击播放符号运行。<br> <img src="https://images2.imgbox.com/7c/fc/rwziXt6C_o.png" alt="在这里插入图片描述"><br> 退出登录的交换机，重新登录一次交换机，让刚才创建的字段生效。<br> <img src="https://images2.imgbox.com/ae/c4/PPrSSosd_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b7/a5/U4FdiIGh_o.png" alt="在这里插入图片描述"></p> 
<p>登录退出华为交换机一下，就可以看到日志了，如下图所示：<br> <img src="https://images2.imgbox.com/71/1f/VrpSxgvl_o.png" alt="在这里插入图片描述"><br> 最后，查看以下自己创建的字段位置：<br> <img src="https://images2.imgbox.com/d4/24/1WbXVVNd_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/77/13/hrokIiAX_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/58/7c/dDGRSNEB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4_106"></a>4、日志保存时间</h2> 
<p>修改为保存180天，如下图所示：<br> <img src="https://images2.imgbox.com/9b/7f/Rii9KLv9_o.png" alt="在这里插入图片描述"><br> 选择Default index set，点击编辑edit,如下图所示：<br> <img src="https://images2.imgbox.com/71/62/wTxdltFI_o.png" alt="在这里插入图片描述"><br> 选择Index Time,输入P180D，最后SAVE如下图：<br> <img src="https://images2.imgbox.com/7b/7e/TUk6k5Wu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/8c/CkS8VYzH_o.png" alt="在这里插入图片描述"><br> 本期只讲解了华为交换机的登录退出日志审计，其它品牌的操作方法基本一样，熟悉正则表达式的情况下很容易完成，搞IT的相信大家都有一些基本功，举一反三。</p> 
<p>下期在讲解一些其它的功能应用。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3b4e502a81641c9cd19b9db15696b75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">海思 YOLOv5 pytorch 转 onnx 转 Caffe 再转 wk 的转化详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/64180ab1da983accdc0554337c9035a0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;基础知识点（2）关于输入输出，结构体，类的基础知识</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>