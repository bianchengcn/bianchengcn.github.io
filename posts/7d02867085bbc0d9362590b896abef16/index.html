<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Linux】编写第一个小程序：进度条 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Linux】编写第一个小程序：进度条" />
<meta property="og:description" content="文章目录 1. 预备知识1.1 简单认识几个函数1.1.1 sleep()1.1.2 fflush()1.1.3 usleep()1.1.4 memset() 1.2 缓冲区1.3 回车与换行 2. 编写入门版的进度条2.1 基本逻辑2.2 美化效果2.3 代码实现2.4 执行效果 3. 编写升级版的进度条3.1 代码实现3.2 执行效果 1. 预备知识 1.1 简单认识几个函数 1.1.1 sleep() unsigned int sleep(unsigned seconds); 作用：让程序休眠指定秒数，如：sleep(3); //让程序休眠3秒与 Windows 上的 Sleep() 函数不同需要包含头文件&lt;unistd.h&gt; 1.1.2 fflush() int fflush(FILE* stream); 作用：刷新缓冲区需要传入一个流需要包含头文件&lt;stdio.h&gt; 1.1.3 usleep() int usleep(useconds_t usec); 作用：让程序休眠指定微秒，如：usleep(100000); //让程序休眠100000微秒（0.1秒）1秒 = 1000000微秒需要包含头文件&lt;unistd.h&gt; 1.1.4 memset() void* memset(void* ptr, int value, size_t num); 作用：将 ptr 指向的内存块的前 num 个字节设置为指定的 value 值返回设置后的 ptr需要包含头文件&lt;string.h&gt; 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/7d02867085bbc0d9362590b896abef16/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T21:32:23+08:00" />
<meta property="article:modified_time" content="2024-01-12T21:32:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Linux】编写第一个小程序：进度条</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__3" rel="nofollow">1. 预备知识</a></li><li><ul><li><a href="#11__4" rel="nofollow">1.1 简单认识几个函数</a></li><li><ul><li><a href="#111_sleep_5" rel="nofollow">1.1.1 sleep()</a></li><li><a href="#112_fflush_15" rel="nofollow">1.1.2 fflush()</a></li><li><a href="#113_usleep_25" rel="nofollow">1.1.3 usleep()</a></li><li><a href="#114_memset_35" rel="nofollow">1.1.4 memset()</a></li></ul> 
   </li><li><a href="#12__45" rel="nofollow">1.2 缓冲区</a></li><li><a href="#13__69" rel="nofollow">1.3 回车与换行</a></li></ul> 
  </li><li><a href="#2__82" rel="nofollow">2. 编写入门版的进度条</a></li><li><ul><li><a href="#21__83" rel="nofollow">2.1 基本逻辑</a></li><li><a href="#22__91" rel="nofollow">2.2 美化效果</a></li><li><a href="#23__99" rel="nofollow">2.3 代码实现</a></li><li><a href="#24__147" rel="nofollow">2.4 执行效果</a></li></ul> 
  </li><li><a href="#3__155" rel="nofollow">3. 编写升级版的进度条</a></li><li><ul><li><a href="#31__161" rel="nofollow">3.1 代码实现</a></li><li><a href="#32__256" rel="nofollow">3.2 执行效果</a></li></ul> 
 </li></ul> 
</div> 
<br> 
<img src="https://images2.imgbox.com/1c/e2/gTiFW2xf_o.gif" alt="在这里插入图片描述"> 
<p></p> 
<h2><a id="1__3"></a>1. 预备知识</h2> 
<h3><a id="11__4"></a>1.1 简单认识几个函数</h3> 
<h4><a id="111_sleep_5"></a>1.1.1 sleep()</h4> 
<pre><code class="prism language-c"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> seconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <ul><li>作用：让程序休眠指定秒数，如：<code>sleep(3); //让程序休眠3秒</code></li><li>与 Windows 上的 Sleep() 函数不同</li><li>需要包含头文件<code>&lt;unistd.h&gt;</code></li></ul> 
</blockquote> 
<h4><a id="112_fflush_15"></a>1.1.2 fflush()</h4> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">fflush</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <ul><li>作用：刷新缓冲区</li><li>需要传入一个流</li><li>需要包含头文件<code>&lt;stdio.h&gt;</code></li></ul> 
</blockquote> 
<h4><a id="113_usleep_25"></a>1.1.3 usleep()</h4> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">usleep</span><span class="token punctuation">(</span><span class="token class-name">useconds_t</span> usec<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <ul><li>作用：让程序休眠指定微秒，如：<code>usleep(100000); //让程序休眠100000微秒（0.1秒）</code></li><li>1秒 = 1000000微秒</li><li>需要包含头文件<code>&lt;unistd.h&gt;</code></li></ul> 
</blockquote> 
<h4><a id="114_memset_35"></a>1.1.4 memset()</h4> 
<pre><code class="prism language-c"><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">memset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> ptr<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">,</span> <span class="token class-name">size_t</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <ul><li>作用：将 ptr 指向的内存块的前 num 个字节设置为指定的 value 值</li><li>返回设置后的 ptr</li><li>需要包含头文件<code>&lt;string.h&gt;</code></li></ul> 
</blockquote> 
<h3><a id="12__45"></a>1.2 缓冲区</h3> 
<p><strong>直接上代码观察现象</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"you can see me       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>执行效果图</strong></p> 
<p><img src="https://images2.imgbox.com/a8/61/h5LmNqQ0_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <ul><li>首先要否定上面不切实际的想法，C语言是顺序执行的，所以 printf 函数一定先于 sleep 函数执行。</li><li>那为什么 3 秒后才打印到屏幕上呢？当然是因为缓冲区！</li><li>printf 函数跑完后，输出的字符串是<strong>被保存到 C 对 IO 函数提供的一个缓冲区里了，在程序退出的时候，缓冲区中的内容才被刷新到屏幕上</strong>。</li><li>我们需要使用上面讲的 <strong>fflush</strong> 函数把缓冲区中的内容提前强制刷新到屏幕上，使用方法：<code>fflush(stdout);</code></li></ul> 
</blockquote> 
<h3><a id="13__69"></a>1.3 回车与换行</h3> 
<p>首先我要抛出一个概念：<strong>回车和换行是不一样的！</strong></p> 
<blockquote> 
 <ul><li>回车（ \r ）：把光标放到当前行的开始。</li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/df/ec/DAhbSmJB_o.png" alt="在这里插入图片描述" width="400"></p> 
<blockquote> 
 <ul><li>换行（ \n ）：把光标放到当前位置的下一行。</li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/2b/25/kwEW5lg3_o.png" alt="在这里插入图片描述" width="450"></p> 
<blockquote> 
 <ul><li>所以理论上来讲，‘\n’ 和 ‘\r’ 一起用才是我们理解中的”回车“，即：把光标放到下一行最开始的位置。</li></ul> 
</blockquote> 
<h2><a id="2__82"></a>2. 编写入门版的进度条</h2> 
<h3><a id="21__83"></a>2.1 基本逻辑</h3> 
<blockquote> 
 <ul><li>进度 1% 打印 1 个字符，回车到开始的位置，刷新缓冲区；</li><li>进度 2% 打印 2 个字符，回车到开始的位置，刷新缓冲区；</li><li>…</li><li>进度 100% 打印 100 个字符，回车到开始的位置，刷新缓冲区，程序终止。</li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/fa/b7/q1BoYWeh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22__91"></a>2.2 美化效果</h3> 
<blockquote> 
 <ul><li>进度条主体增加箭头显示</li><li>显示进度百分比</li><li>添加一个动态的旋转光标</li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/28/51/Vm0B008P_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23__99"></a>2.3 代码实现</h3> 
<pre><code class="prism language-c"><span class="token comment">// porcessbar.h</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM</span> <span class="token expression"><span class="token number">103</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Body</span> <span class="token char">'='</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Head</span> <span class="token char">'&gt;'</span></span>

<span class="token comment">// version 1</span>
<span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">// processbar.c</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"processbar.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> lable <span class="token operator">=</span> <span class="token string">"|/-\\"</span><span class="token punctuation">;</span>

<span class="token comment">// version 1</span>
<span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>NUM<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token char">'\0'</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>lable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Head<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cnt <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%-100s][%3d%%][%c]\r"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> cnt<span class="token punctuation">,</span> lable<span class="token punctuation">[</span>cnt <span class="token operator">%</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>cnt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> Body<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            buffer<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span> <span class="token operator">=</span> Head<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="24__147"></a>2.4 执行效果</h3> 
<p><img src="https://images2.imgbox.com/0c/d2/Dnb9etaB_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6b/15/tfQTDm4X_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/0b/78/DVz6J9QM_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3__155"></a>3. 编写升级版的进度条</h2> 
<blockquote> 
 <ul><li>上面的进度条算是一个进度条吗？我们的进度条似乎在一个人玩单机呀，这样的进度条是没有意义的。</li><li>进度条的进度应该是依赖于其他应用的，比如下载。</li><li>下面我们模拟一个下载环境，并修改进度条，使进度条可以根据下载的进度，同步进行显示进度的工作。</li></ul> 
</blockquote> 
<h3><a id="31__161"></a>3.1 代码实现</h3> 
<pre><code class="prism language-c"><span class="token comment">// processbar.h</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NUM</span> <span class="token expression"><span class="token number">103</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Body</span> <span class="token char">'='</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Head</span> <span class="token char">'&gt;'</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token class-name">callback_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 函数指针类型</span>

<span class="token comment">// version 2</span>
<span class="token keyword">void</span> <span class="token function">process_flush</span><span class="token punctuation">(</span><span class="token keyword">double</span> rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">// processbar.c</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"processbar.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> lable <span class="token operator">=</span> <span class="token string">"|/-\\"</span><span class="token punctuation">;</span>

<span class="token comment">// version 2: 进度是多少，你进度条能知道吗？另外，什么进度？依附于其他应用的，比如下载</span>
<span class="token keyword">char</span> buffer<span class="token punctuation">[</span>NUM<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">process_flush</span><span class="token punctuation">(</span><span class="token keyword">double</span> rate<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>lable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rate <span class="token operator">&lt;=</span> <span class="token number">1.0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Head<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[%-100s][%.1f%%][%c]\r"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> rate<span class="token punctuation">,</span> lable<span class="token punctuation">[</span>cnt <span class="token operator">%</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    buffer<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>rate<span class="token punctuation">]</span> <span class="token operator">=</span> Body<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>rate <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        buffer<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>rate <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Head<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rate <span class="token operator">&gt;=</span> <span class="token number">100.0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    cnt<span class="token operator">++</span><span class="token punctuation">;</span>
    cnt <span class="token operator">%=</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">// main.c</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"processbar.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token comment">// 模拟文件大小</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FILESIZE</span> <span class="token expression"><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span></span></span>

<span class="token comment">// 模拟一种场景，表示一种下载任务</span>
<span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token class-name">callback_t</span> cb<span class="token punctuation">)</span>    <span class="token comment">// 回调函数的形式</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">1023</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 这样写只是为了让随机数更随机</span>
    <span class="token keyword">int</span> total <span class="token operator">=</span> FILESIZE<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>total<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 下载动作</span>
        <span class="token keyword">int</span> one <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 一次下载的大小</span>
        total <span class="token operator">-=</span> one<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>total <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 当前的进度是多少？</span>
        <span class="token keyword">int</span> download <span class="token operator">=</span> FILESIZE <span class="token operator">-</span> total<span class="token punctuation">;</span>
        <span class="token keyword">double</span> rate <span class="token operator">=</span> <span class="token punctuation">(</span>download <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> FILESIZE<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100.0</span><span class="token punctuation">;</span>
        <span class="token function">cb</span><span class="token punctuation">(</span>rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">download</span><span class="token punctuation">(</span>process_flush<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="32__256"></a>3.2 执行效果</h3> 
<p><img src="https://images2.imgbox.com/d5/74/ObCvRElN_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fb/7c/OkEH6f9d_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/51/75/QsRITYKk_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<center>
  END 
</center>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/730b32a8af827082931a880a566f185d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何使用Java采集汽车之家车辆配置参数信息</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/164c24dc2515e76df020c1a94d62d582/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Github 2024-01-13 C#开源项目日报 Top8</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>