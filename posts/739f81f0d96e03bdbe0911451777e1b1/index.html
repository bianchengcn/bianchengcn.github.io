<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【FFmpeg&#43;Qt】视频进度条控制——点击跳转和拖动跳转 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【FFmpeg&#43;Qt】视频进度条控制——点击跳转和拖动跳转" />
<meta property="og:description" content="首先进度条采用Qslider，设置进度条主要有两点，一是当前视频总时长，二是当前播放时长，需要通过FFmpeg转码成mp4文件才能获取相应的时长数据；
往期回顾：
【Qt&#43;FFmpeg】视频转码详细流程_logani的博客-CSDN博客_qt&#43;ffmpeg视频流
【Qt&#43;FFmpeg】编码视频详细流程_logani的博客-CSDN博客_qt 视频编码
【Qt&#43;FFmpeg】解码播放本地视频（一）_logani的博客-CSDN博客_ffmpeg 打开本地视频
1.获取视频总时长
视频时长就封装在 AVFormatContext *formatContext 编解码上下文环境结构体的 duration 结构体成员中 ;AVFormatContext 中提取的 duration获取总视频总时长，单位是微秒；
2.获取当前时长：
AVFrame 结构体中封装的 best_effort_timestamp 元素值，就是当前视频帧的相对播放时间，其单位是AVRational，需要转换成秒，可以用视频流中提供的时间基
3.进行拖动跳转
在知道如何做之前，我们要先了解Qslider的几个信号，我们拖动时就需要用到点击、滑动和释放信号：
1.移动滑动条时发出的信号
void sliderMove(int value);
2.点击滑动条时所发出的信号
void sliderPressed();
3.释放时所发出的信号
void sliderReleased();
拖动跳转主要用到滑动信号和释放信号； 调用av_seek_frame函数查找进度条点击或拖动位置的帧数并跳转到该帧开始播放 ;
由于上述的播放时间已转成了秒为单位，所以这边将传入的秒转为微秒 av_seek_frame ( ) 函数原型 : 查找第 stream_index 个媒体流的 timestamp 微秒附近的关键帧 , 并跳转到该帧开始播放 ;
① AVFormatContext **ps 参数 : 封装了文件格式相关信息的结构体 , 如视频宽高 , 音频采样率等信息 ; 该参数是 二级指针 , 意味着在方法中会修改该指针的指向 , 该参数的实际作用是当做返回值用的 ;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/739f81f0d96e03bdbe0911451777e1b1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-19T22:17:30+08:00" />
<meta property="article:modified_time" content="2022-12-19T22:17:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【FFmpeg&#43;Qt】视频进度条控制——点击跳转和拖动跳转</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;">首先进度条采用Qslider，设置进度条主要有两点，一是当前视频总时长，二是当前播放时长，需要通过FFmpeg转码成mp4文件才能获取相应的时长数据；</p> 
<p style="margin-left:.0001pt;text-align:justify;">往期回顾：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="https://blog.csdn.net/logani/article/details/127600062?spm=1001.2014.3001.5501" title="【Qt+FFmpeg】视频转码详细流程_logani的博客-CSDN博客_qt+ffmpeg视频流">【Qt+FFmpeg】视频转码详细流程_logani的博客-CSDN博客_qt+ffmpeg视频流</a></p> 
<p><a href="https://blog.csdn.net/logani/article/details/127336149?spm=1001.2014.3001.5501" title="【Qt+FFmpeg】编码视频详细流程_logani的博客-CSDN博客_qt 视频编码">【Qt+FFmpeg】编码视频详细流程_logani的博客-CSDN博客_qt 视频编码</a></p> 
<p><a href="https://blog.csdn.net/logani/article/details/127233337?spm=1001.2014.3001.5501" title="【Qt+FFmpeg】解码播放本地视频（一）_logani的博客-CSDN博客_ffmpeg 打开本地视频">【Qt+FFmpeg】解码播放本地视频（一）_logani的博客-CSDN博客_ffmpeg 打开本地视频</a></p> 
<p> 1.获取视频总时长</p> 
<p style="margin-left:.0001pt;text-align:justify;">视频时长就封装在 <strong>AVFormatContext *formatContext</strong> 编解码上下文环境结构体的 duration 结构体成员中 ;AVFormatContext 中提取的 duration获取总视频总时长，单位是微秒；</p> 
<p style="margin-left:.0001pt;text-align:justify;">2.获取当前时长：</p> 
<p style="margin-left:.0001pt;text-align:justify;">AVFrame 结构体中封装的 best_effort_timestamp 元素值，就是当前视频帧的相对播放时间，其单位是AVRational，需要转换成秒，可以用视频流中提供的时间基</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="37" src="https://images2.imgbox.com/8e/5c/c7mqBAcn_o.png" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;">3.进行拖动跳转</p> 
<p>在知道如何做之前，我们要先了解Qslider的几个信号，我们拖动时就需要用到点击、滑动和释放信号：</p> 
<p>1.移动滑动条时发出的信号</p> 
<p>void sliderMove(int value);<br> 2.点击滑动条时所发出的信号</p> 
<p>void sliderPressed();<br>  3.释放时所发出的信号</p> 
<p>void sliderReleased();</p> 
<p>拖动跳转主要用到滑动信号和释放信号； </p> 
<p style="margin-left:.0001pt;text-align:justify;">调用<strong>av_seek_frame函数</strong>查找进度条点击或拖动位置的帧数并跳转到该帧开始播放 ;</p> 
<p>由于上述的播放时间已转成了秒为单位，所以这边将传入的秒转为微秒 </p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="101" src="https://images2.imgbox.com/ea/65/BqWgfBCL_o.png" width="896"></p> 
<p><span style="color:#fe2c24;">av_seek_frame ( ) 函数原型 :</span> 查找第 stream_index 个媒体流的 timestamp 微秒附近的关键帧 , 并跳转到该帧开始播放 ;<br> ① AVFormatContext **ps 参数 : 封装了文件格式相关信息的结构体 , 如视频宽高 , 音频采样率等信息 ; 该参数是 二级指针 , 意味着在方法中会修改该指针的指向 , 该参数的实际作用是当做返回值用的 ;</p> 
<p>② int stream_index 参数 : 音视频流索引 , 如果设置 -1 , 说明是所有的媒体流同时跳转 ;</p> 
<p>③ int64_t timestamp 参数 : 要跳转的目的时间戳 , 之后要在该时间附近查找关键帧 ;</p> 
<p>④ int flags 参数 : 设置跳转模式 ;</p> 
<p>⑤ int 返回值 : 返回值大于等于 0 , 代表打开成功 , 否则失败 ;</p> 
<p> 为了在用户拖动过程中不修改slider的值，这边采用定时器在拖动时暂停修改进度条，释放进度条时再开启定时器；</p> 
<pre><code>/*****************************************************************
* 函数名称：:sliderMoveSlot()
* 功能描述：拖动进度条，停止定时器
* 参数说明： 无
* 返回值：   无
******************************************************************/
void playbackVideowin::sliderMoveSlot()
{
    //暂时停止计时器，在用户拖动过程中不修改slider的值
    timer-&gt;stop();
}
/*****************************************************************
* 函数名称：:sliderReleaseSlot()
* 功能描述：释放进度条，重启定时器，修改视频当前位置
* 参数说明： 无
* 返回值：   无
******************************************************************/
void playbackVideowin::sliderReleaseSlot()
{
    timer-&gt;start(40);
    int currentValue=playProgressBar-&gt;value();
    pDeCoding-&gt;changeCurrentValue(currentValue);
}</code></pre> 
<p>4.进行点击跳转，重写一个进度条类</p> 
<p>因为系统自带的进度条点击时只能移动一小段，不能实现点哪就移动到哪，所以我们要自己重写一个进度条类</p> 
<pre><code>void newqslider::mousePressEvent(QMouseEvent *ev)
{
    //先调用父类的鼠标点击处理事件，这样可以不影响拖动的情况
    QSlider::mousePressEvent(ev);
    //获取鼠标的位置，这里并不能直接从ev中取值（因为如果是拖动的话，鼠标开始点击的位置没有意义了）
    double pos = ev-&gt;pos().x() / (double)width();
    setValue(pos * (maximum() - minimum()) + minimum());
    //发送自定义的鼠标单击信号
    emit costomSliderClicked();
}
</code></pre> 
<p> 进度条点击槽函数</p> 
<pre><code>/*****************************************************************
* 函数名称：:sliderClickedSlot()
* 功能描述：点击进度条
* 参数说明： 无
* 返回值：   无
******************************************************************/
void playbackVideowin::sliderClickedSlot()
{
    int currentValue=playProgressBar-&gt;value();
    pDeCoding-&gt;changeCurrentValue(currentValue);
}</code></pre> 
<p>信号槽连接</p> 
<p><img alt="" height="86" src="https://images2.imgbox.com/53/27/HJW24I2r_o.png" width="1183"></p> 
<p></p> 
<p>本文借鉴了</p> 
<p><a href="https://blog.csdn.net/shulianghan/article/details/106088151?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E8%A7%A3%E7%A0%81%E8%A7%86%E9%A2%91%E6%8B%96%E5%8A%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-106088151.142%5Ev62%5Epc_search_tree,201%5Ev3%5Econtrol_2,213%5Ev1%5Et3_esquery_v2&amp;spm=1018.2226.3001.4187" title="【Android FFMPEG 开发】FFMPEG 视频播放进度控制 ( 显示播放进度 | 拖动进度条播放 )_韩曙亮的博客-CSDN博客_安卓开发 ffmpeg如何获取视频当前播放进度">【Android FFMPEG 开发】FFMPEG 视频播放进度控制 ( 显示播放进度 | 拖动进度条播放 )_韩曙亮的博客-CSDN博客_安卓开发 ffmpeg如何获取视频当前播放进度</a></p> 
<p></p> 
<p>感谢观看！！！！</p> 
<p>以上就是全部内容，如果对您有帮助，欢迎点赞评论，或者发现有哪里写错的，欢迎指正！</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/be/0d/bfzmEguk_o.png"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8f927952059ce9f2c8d580f681ba528c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【bat批处理】手把手教你批量打开软件、文件、网页等</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/409e35d9f1fdaa206174b5a342a3c856/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu&#43;Qt下配置车牌识别系统EasyPR1.6环境</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>