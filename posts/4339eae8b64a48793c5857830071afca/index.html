<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>代理ip的使用方法——Python爬虫 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="代理ip的使用方法——Python爬虫" />
<meta property="og:description" content="本文内容：代理ip使用原理，如何在自己的爬虫里设置代理ip，如何知道代理ip有没有生效，没生效的话是哪里出了问题，个人使用的代理ip(付费）。
目录
代理ip原理
输入网址后发生了什么呢？
代理ip做了什么呢？
为什么要用代理呢？
爬虫代码中使用代理ip
代理ip的获取
检验代理ip是否生效
未生效问题排查
1.请求协议不匹配
2.代理失效
代理ip原理 输入网址后发生了什么呢？
浏览器获取域名浏览器渲染结果四次挥手释放TCP连接服务器将查询结果返回给浏览器浏览器通过HTTP协议向服务器发送数据请求通过DNS协议获取域名对应服务器的ip地址浏览器和对应的服务器通过三次握手建立TCP连接 其中涉及到了：
应用层：HTTP和DNS
传输层：TCP UDP
网络层：IP ICMP ARP
代理ip做了什么呢？
简单一点来说，使用代理ip就是：
原本你的访问目标网站
使用代理ip后你的访问目标网站
为什么要用代理ip呢？
我们在爬取数据的时候，如果使用自己的真实ip去访问目标网站，会有很大的风险被网站记录。而怎么才能避免我们的真实ip被网站记录呢，那就需要使用代理ip来给我们套上一层伪装，来让目标网站检测不到我们的真实ip地址。除了这种情况，有的网站限制了一些地区的ip地址，如果不使用代理的话，我们就无法正常访问目标网站了，所以我们很多时候需要使用代理ip：
爬虫代码中使用代理ip
就像是请求时伪装头一样，伪装ip，注意是 { }
代理ip的获取
像我们刚刚的proxies存储的代理，是可以直接作为参数传进requests里面使用的。那现在我们就来做这个proxies。
首先打开一个代理IP提供商，我这里选择的是站大爷，我们一般使用api获取，也就是接口直接获取我们需要的ip，由供应商返回提供给我们的ip信息：
可以根据自己需要的情况设置：
这里从URL点击进去使用生成的API接口链接来做演示，会生成一个url链接，我们requests直接去请求这个链接，就可以获得这个代理IP的详细信息。
# 拿到供应商给我们的代理IP URL = &#34;https://www.zdaye.net/?utm-source=csdnhao&amp;utm-keyword=%3Fcsdnhao&#34; # 这里参数控制了数量 格式 和ip协议等等 这也算是它的一个优势吧，多的话可以提取几百，而且可以指定城市从固定地点提取ip，更符合爬虫模拟人类的行为特征。 url = &#34;http://api.proxy.zdaye.io/getProxyIp?num=1&amp;return_type=txt&amp;lb=1&amp;sb=0&amp;flow=1&amp;regions=&amp;protocol=http&#34; # 输出ip res = requests.get(url) print(res.text) # 这个ip就可以放在我们实际要请求的网页requests中了 检验代理ip是否生效
我们访问一个网站，这个网站会返回我们的ip地址：
print(requests.get(&#39;http://httpbin.org/ip&#39;, proxies=proxies, timeout=3).text) 重点来了，我使用代理IP进行访问，如果返回来不是我们自己的IP，说明代理ip可用，可以伪装，也可以帮我们带回想要的信息。
我们看一下刚才我使用了四个不同的代理ip，结果是全部生效了，
未生效问题排查
如果你返回的还是本机地址，99%试一下两种情况之一：
1.请求协议不匹配
简单一点来说那就是，你请求的是http格式，那就要使用http的协议，是https格式，就要使用https的协议。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/4339eae8b64a48793c5857830071afca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-11T16:40:47+08:00" />
<meta property="article:modified_time" content="2023-04-11T16:40:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">代理ip的使用方法——Python爬虫</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;">本文内容：代理ip使用原理，如何在自己的爬虫里设置代理ip，如何知道代理ip有没有生效，没生效的话是哪里出了问题，个人使用的代理ip(付费）。</p> 
<p style="text-align:justify;"><strong>目录</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">代理ip原理</p> 
<p style="margin-left:.0001pt;text-align:justify;">      输入网址后发生了什么呢？</p> 
<p style="margin-left:.0001pt;text-align:justify;">      代理ip做了什么呢？</p> 
<p style="margin-left:.0001pt;text-align:justify;">      为什么要用代理呢？</p> 
<p style="margin-left:.0001pt;text-align:justify;"> 爬虫代码中使用代理ip</p> 
<p style="margin-left:.0001pt;text-align:justify;"> 代理ip的获取</p> 
<p style="margin-left:.0001pt;text-align:justify;"> 检验代理ip是否生效</p> 
<p style="margin-left:.0001pt;text-align:justify;">未生效问题排查</p> 
<p style="margin-left:.0001pt;text-align:justify;">    1.请求协议不匹配</p> 
<p style="margin-left:.0001pt;text-align:justify;">    2.代理失效</p> 
<h4 style="text-align:justify;"><strong>代理ip原理</strong></h4> 
<p style="text-align:justify;"><strong>输入网址后发生了什么呢？</strong></p> 
<ol><li style="text-align:justify;">浏览器获取域名</li><li style="text-align:justify;">浏览器渲染结果</li><li style="text-align:justify;">四次挥手释放TCP连接</li><li style="text-align:justify;">服务器将查询结果返回给浏览器</li><li style="text-align:justify;">浏览器通过HTTP协议向服务器发送数据请求</li><li style="text-align:justify;">通过DNS协议获取域名对应服务器的ip地址</li><li style="text-align:justify;">浏览器和对应的服务器通过三次握手建立TCP连接</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">其中涉及到了：</p> 
<p style="margin-left:.0001pt;text-align:justify;">应用层：HTTP和DNS</p> 
<p style="margin-left:.0001pt;text-align:justify;">传输层：TCP UDP</p> 
<p style="margin-left:.0001pt;text-align:justify;">网络层：IP ICMP ARP</p> 
<p style="text-align:justify;"><strong>代理ip做了什么呢？</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">简单一点来说，使用代理ip就是：</p> 
<p style="margin-left:.0001pt;text-align:justify;">原本你的访问目标网站</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" src="https://images2.imgbox.com/94/0d/lwIztFSL_o.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">使用代理ip后你的访问目标网站</p> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/ec/be/adDpNTt9_o.png"></p> 
<p></p> 
<p style="text-align:justify;"><strong>为什么要用代理</strong><strong>ip</strong><strong>呢？</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">我们在爬取数据的时候，如果使用自己的真实ip去访问目标网站，会有很大的风险被网站记录。而怎么才能避免我们的真实ip被网站记录呢，那就需要使用代理ip来给我们套上一层伪装，来让目标网站检测不到我们的真实ip地址。除了这种情况，有的网站限制了一些地区的ip地址，如果不使用代理的话，我们就无法正常访问目标网站了，所以我们很多时候需要使用代理ip：</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/ce/0e/XGypQCuD_o.png"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">爬虫代码中使用代理ip</p> 
<p style="margin-left:.0001pt;text-align:justify;">就像是请求时伪装头一样，伪装ip，注意是 { }</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="148" src="https://images2.imgbox.com/94/a8/YpWuetAB_o.png" width="675"></p> 
<p style="text-align:justify;"><strong>代理ip的获取</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">     像我们刚刚的proxies存储的代理，是可以直接作为参数传进requests里面使用的。那现在我们就来做这个proxies。</p> 
<p style="margin-left:.0001pt;text-align:justify;">     首先打开一个代理IP提供商，我这里选择的是站大爷，我们一般使用api获取，也就是接口直接获取我们需要的ip，由供应商返回提供给我们的ip信息：</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/80/55/4d6Miwit_o.png"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"> 可以根据自己需要的情况设置：</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" height="446" src="https://images2.imgbox.com/67/b7/hgaydENZ_o.png" width="416"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">     这里从URL点击进去使用生成的API接口链接来做演示，会生成一个url链接，我们requests直接去请求这个链接，就可以获得这个代理IP的详细信息。</p> 
<pre><code class="language-python"># 拿到供应商给我们的代理IP
URL = "https://www.zdaye.net/?utm-source=csdnhao&amp;utm-keyword=%3Fcsdnhao"
 
# 这里参数控制了数量 格式 和ip协议等等 这也算是它的一个优势吧，多的话可以提取几百，而且可以指定城市从固定地点提取ip，更符合爬虫模拟人类的行为特征。
url = "http://api.proxy.zdaye.io/getProxyIp?num=1&amp;return_type=txt&amp;lb=1&amp;sb=0&amp;flow=1&amp;regions=&amp;protocol=http"
 
# 输出ip
res = requests.get(url)
print(res.text)
# 这个ip就可以放在我们实际要请求的网页requests中了</code></pre> 
<p style="text-align:justify;"><strong>检验代理ip是否生效</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">我们访问一个网站，这个网站会返回我们的ip地址：</p> 
<pre><code class="language-python">print(requests.get('http://httpbin.org/ip', proxies=proxies, timeout=3).text)
</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">重点来了，我使用代理IP进行访问，如果返回来不是我们自己的IP，说明代理ip可用，可以伪装，也可以帮我们带回想要的信息。</p> 
<p style="margin-left:.0001pt;text-align:justify;">我们看一下刚才我使用了四个不同的代理ip，结果是全部生效了，</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" height="379" src="https://images2.imgbox.com/10/fd/oDqYav23_o.png" width="381"></p> 
<p></p> 
<p style="text-align:justify;"><strong>未生效问题排查</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">如果你返回的还是本机地址，99%试一下两种情况之一：</p> 
<p style="text-align:justify;"><strong>1.请求协议不匹配</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">简单一点来说那就是，你请求的是http格式，那就要使用http的协议，是https格式，就要使用https的协议。</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/4e/1b/3tJXcQqv_o.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">如果我请求是http ，但只有https，就会使用本机ip。</p> 
<p style="margin-left:.0001pt;text-align:justify;">     继续重点，我们获取的代理是两种都支持的，但是要自己像我这样设置，就像去买了条鱼准备放生。却又不把鱼丢河里去，你不让它去水里，它当然游不起来，这属于我们自己的问题。</p> 
<p style="text-align:justify;"><strong>2.代理失效</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">  当我们使用的是免费代理或者一些廉价的普匿代理，那失效就是必然的了。使用代理还是建议选择一些优质的，名气大一点的代理。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b794307eea224487ea7cf6575323173d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python学习笔记-6(for...in循环)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2773f931944364ea02d4b711d02cb40a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pyqt 设置 QComboBox 某个下拉选项不可选中</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>