<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vc自绘控件总结 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vc自绘控件总结" />
<meta property="og:description" content="想必很多使用MFC编程的朋友都想去用微软的控件，但是很多时候我们发现控件的功能并没有想象中的那么强大，而且很多功能我们根本都用不到，我们想去自绘控件，但是又不知道如何着手。本文介绍MFC控件设计的大致步骤。
Window窗口中的控件都是有一系列的窗口组成。其实按钮就是一个窗口，至于它是如何能嵌入到其他的窗口中呢，这就关系到一个父窗口的问题了，即按钮必须是父窗口的子窗口，并且父窗口移动及时通知子窗口移动。
了解了以上，我们就来看一下自绘控件的大致步骤吧 ①重载窗口类CShowDlg，在这里我们重载的基类为CDialog 对话框类
②插入对话框资源 IDD_DIALOG1，并绑定刚刚重载的窗口类CShowDlg
③定义重载的窗口类变量m_MyControl，并为定义的变量设计窗口风格，由于控件是一定要贴入到窗口中的，而不是弹出来，所以对话框设计风格一定要有WS_CHILD类型
④子窗口随父窗口一起移动，父窗口为对话框类，为此我们可以在父窗口上添加消息映射 ON_WM_MOVE()和 ON_WM_SIZE()及时获取父窗口的移动以及大小变化，并且使父窗口能够及时通知子窗口移动窗口以及改变窗口大小等命令。
⑤控件是禁止被鼠标拖动的，所以必须去掉标题栏属性，这样控件就不会移动了。
知道了MFC的基本原理，设计自己需要的控件不再那么难。
void CShowDlg::OnMove(int x, int y) { CDialog::OnMove(x, y); // TODO: Add your message handler code here //在移动窗口之前一定要确保m_MyControl已经创建 if (::IsWindow(m_MyControl.GetSafeHwnd())) { //x,y为父窗口左上角的坐标,子窗口CRect区域为[10,20,300,400] m_MyControl.MoveWindow(x&#43;10,y&#43;20,300,400); // m_MyControl.SetWindowPos(NULL,x&#43;10,y&#43;20,300,400,SWP_NOSIZE); } } 窗口设计风格如下所示。
ModifyStyle(0, WS_CLIPCHILDREN);// BOOL ModifyStyle ( DWORD dwRemove,// 指定修改时要删除的窗风格 DWORD dwAdd,//指定修改时将要增加的窗口风格 UINT nFlags=0//该参数将被传给SetWindowPos，否则为0，如果SetWindowPos不被调用的话，一般该参数默认值 );//如果该函数成功调用返回一个非0值，否则返回0； /* 如果nFlags不为0， ModifyStyle将调用Windows API 函数SetWindowPos并且结合nFlags和以下四个预先布置好的标志重画该窗口。 SWP_NOSIZE 保持当前大小。 SWP_NOMOVE 保持当前位置.。 SWP_NOZORDER 保持当前的Z次序。 SWP_NOACTIVATE 不激活该窗口。 */ //WinUser.h中的窗口风格如下所示。 /* * Window Styles */ #define WS_OVERLAPPED 0x00000000L #define WS_POPUP 0x80000000L #define WS_CHILD 0x40000000L #define WS_MINIMIZE 0x20000000L #define WS_VISIBLE 0x10000000L #define WS_DISABLED 0x08000000L #define WS_CLIPSIBLINGS 0x04000000L #define WS_CLIPCHILDREN 0x02000000L #define WS_MAXIMIZE 0x01000000L #define WS_CAPTION 0x00C00000L /* WS_BORDER | WS_DLGFRAME */ #define WS_BORDER 0x00800000L #define WS_DLGFRAME 0x00400000L #define WS_VSCROLL 0x00200000L #define WS_HSCROLL 0x00100000L #define WS_SYSMENU 0x00080000L #define WS_THICKFRAME 0x00040000L #define WS_GROUP 0x00020000L #define WS_TABSTOP 0x00010000L #define WS_MINIMIZEBOX 0x00020000L #define WS_MAXIMIZEBOX 0x00010000L #define WS_TILED WS_OVERLAPPED #define WS_ICONIC WS_MINIMIZE #define WS_SIZEBOX WS_THICKFRAME #define WS_TILEDWINDOW WS_OVERLAPPEDWINDOW /* * Common Window Styles */ #define WS_OVERLAPPEDWINDOW (WS_OVERLAPPED | \ WS_CAPTION | \ WS_SYSMENU | \ WS_THICKFRAME | \ WS_MINIMIZEBOX | \ WS_MAXIMIZEBOX) #define WS_POPUPWINDOW (WS_POPUP | \ WS_BORDER | \ WS_SYSMENU) #define WS_CHILDWINDOW (WS_CHILD) 其他需要了解的内容 获取屏幕大小 int nFullWidth = GetSystemMetris(SM_CXSCREEN); int nFullHeight = GetSystemMetris(SM_CYSCREEN);" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/8c09b79a78479384d13c36766503b764/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-01-04T23:02:14+08:00" />
<meta property="article:modified_time" content="2016-01-04T23:02:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vc自绘控件总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>想必很多使用MFC编程的朋友都想去用微软的控件，但是很多时候我们发现控件的功能并没有想象中的那么强大，而且很多功能我们根本都用不到，我们想去自绘控件，但是又不知道如何着手。本文介绍MFC控件设计的大致步骤。</p> 
<p>Window窗口中的控件都是有一系列的窗口组成。其实按钮就是一个窗口，至于它是如何能嵌入到其他的窗口中呢，这就关系到一个父窗口的问题了，即按钮必须是父窗口的子窗口，并且父窗口移动及时通知子窗口移动。</p> 
<p>了解了以上，我们就来看一下自绘控件的大致步骤吧 <br> ①重载窗口类<strong>CShowDlg</strong>，在这里我们重载的基类为<strong>CDialog</strong> 对话框类</p> 
<p>②插入对话框资源 <strong>IDD_DIALOG1</strong>，并绑定刚刚重载的窗口类<strong>CShowDlg</strong></p> 
<p>③定义重载的窗口类变量<strong>m_MyControl</strong>，并为定义的变量设计窗口风格，由于控件是一定要贴入到窗口中的，而不是弹出来，所以对话框设计风格一定要有WS_CHILD类型</p> 
<p>④子窗口随父窗口一起移动，父窗口为对话框类，为此我们可以在父窗口上添加消息映射 <strong>ON_WM_MOVE()</strong>和 <strong>ON_WM_SIZE()</strong>及时获取父窗口的移动以及大小变化，并且使父窗口能够及时通知子窗口移动窗口以及改变窗口大小等命令。</p> 
<p>⑤控件是禁止被鼠标拖动的，所以必须去掉标题栏属性，这样控件就不会移动了。</p> 
<p>知道了MFC的基本原理，设计自己需要的控件不再那么难。</p> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-literal">void</span> CShowDlg<span class="hljs-tag">::OnMove</span>(int x, int y) 
{
    CDialog<span class="hljs-tag">::OnMove</span>(x, y);

    <span class="hljs-comment">// TODO: Add your message handler code here</span>
    <span class="hljs-comment">//在移动窗口之前一定要确保m_MyControl已经创建</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-tag">::IsWindow</span>(m_MyControl<span class="hljs-built_in">.</span>GetSafeHwnd()))
    {
        <span class="hljs-comment">//x,y为父窗口左上角的坐标,子窗口CRect区域为[10,20,300,400]</span>
        m_MyControl<span class="hljs-built_in">.</span>MoveWindow(x<span class="hljs-subst">+</span><span class="hljs-number">10</span>,y<span class="hljs-subst">+</span><span class="hljs-number">20</span>,<span class="hljs-number">300</span>,<span class="hljs-number">400</span>);
        <span class="hljs-comment">// m_MyControl.SetWindowPos(NULL,x+10,y+20,300,400,SWP_NOSIZE);</span>
    }
}</code></pre> 
<p>窗口设计风格如下所示。</p> 
<pre class="prettyprint"><code class=" hljs cs">ModifyStyle(<span class="hljs-number">0</span>, WS_CLIPCHILDREN);<span class="hljs-comment">//</span>
BOOL ModifyStyle
(
    DWORD dwRemove,<span class="hljs-comment">// 指定修改时要删除的窗风格</span>
    DWORD dwAdd,<span class="hljs-comment">//指定修改时将要增加的窗口风格</span>
    UINT nFlags=<span class="hljs-number">0</span><span class="hljs-comment">//该参数将被传给SetWindowPos，否则为0，如果SetWindowPos不被调用的话，一般该参数默认值</span>
);<span class="hljs-comment">//如果该函数成功调用返回一个非0值，否则返回0；</span>

<span class="hljs-comment">/*
    如果nFlags不为0， ModifyStyle将调用Windows API 函数SetWindowPos并且结合nFlags和以下四个预先布置好的标志重画该窗口。
    SWP_NOSIZE 保持当前大小。
    SWP_NOMOVE 保持当前位置.。
    SWP_NOZORDER 保持当前的Z次序。
    SWP_NOACTIVATE 不激活该窗口。
*/</span>

<span class="hljs-comment">//WinUser.h中的窗口风格如下所示。</span>
<span class="hljs-comment">/*
 * Window Styles
 */</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_OVERLAPPED       0x00000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_POPUP            0x80000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_CHILD            0x40000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_MINIMIZE         0x20000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_VISIBLE          0x10000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_DISABLED         0x08000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_CLIPSIBLINGS     0x04000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_CLIPCHILDREN     0x02000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_MAXIMIZE         0x01000000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_CAPTION          0x00C00000L     /* WS_BORDER | WS_DLGFRAME  */</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_BORDER           0x00800000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_DLGFRAME         0x00400000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_VSCROLL          0x00200000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_HSCROLL          0x00100000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_SYSMENU          0x00080000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_THICKFRAME       0x00040000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_GROUP            0x00020000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_TABSTOP          0x00010000L</span>

<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_MINIMIZEBOX      0x00020000L</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_MAXIMIZEBOX      0x00010000L</span>


<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_TILED            WS_OVERLAPPED</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_ICONIC           WS_MINIMIZE</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_SIZEBOX          WS_THICKFRAME</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_TILEDWINDOW      WS_OVERLAPPEDWINDOW</span>

<span class="hljs-comment">/*
 * Common Window Styles
 */</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_OVERLAPPEDWINDOW (WS_OVERLAPPED     | \</span>
                             WS_CAPTION        | \
                             WS_SYSMENU        | \
                             WS_THICKFRAME     | \
                             WS_MINIMIZEBOX    | \
                             WS_MAXIMIZEBOX)

<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_POPUPWINDOW      (WS_POPUP          | \</span>
                             WS_BORDER         | \
                             WS_SYSMENU)

<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> WS_CHILDWINDOW      (WS_CHILD)</span>

</code></pre> 
<p>其他需要了解的内容 <br> 获取屏幕大小 <br> int nFullWidth = GetSystemMetris(SM_CXSCREEN); <br> int nFullHeight = GetSystemMetris(SM_CYSCREEN);</p> 
<p>在窗口的大小更改后，框架调用该成员函数。</p> 
<pre class="prettyprint"><code class=" hljs cs">afx_msg <span class="hljs-keyword">void</span> OnSize(
                       UINT nType,
                       <span class="hljs-keyword">int</span> cx,
                       <span class="hljs-keyword">int</span> cy 
                    );</code></pre> 
<p>参数 nType <br> 指定请求的调整大小的类型。 此参数可以是下列值之一： <br> SIZE_MAXIMIZED 窗口最大化。 <br> SIZE_MINIMIZED 窗口最小化。 <br> SIZE_RESTORED 窗口已调整大小，但是，SIZE_MINIMIZED 和 SIZE_MAXIMIZED 不适用。 <br> 在某些其他窗口最大化时，SIZE_MAXHIDE 发送到所有弹出窗口。 <br> 在某些其他窗口将还原为其以前的大小时，SIZE_MAXSHOW 发送到所有弹出窗口。 <br> cx 指定工作区的新的宽度。 <br> cy 指定工作区的新的高度。</p> 
<p>鼠标操作</p> 
<pre class="prettyprint"><code class=" hljs sql">afx_msg void OnLButtonDown( 
   UINT nFlags, //控制键信息
   CPoint point  //当前鼠标位置
);
Parameters
nFlags
Indicates whether various virtual keys are down. This parameter can be any combination of the following values:

MK_CONTROL   <span class="hljs-operator"><span class="hljs-keyword">Set</span> <span class="hljs-keyword">if</span> the CTRL <span class="hljs-keyword">key</span> <span class="hljs-keyword">is</span> down.

MK_LBUTTON   <span class="hljs-keyword">Set</span> <span class="hljs-keyword">if</span> the <span class="hljs-keyword">left</span> mouse button <span class="hljs-keyword">is</span> down.

MK_MBUTTON   <span class="hljs-keyword">Set</span> <span class="hljs-keyword">if</span> the middle mouse button <span class="hljs-keyword">is</span> down.

MK_RBUTTON   <span class="hljs-keyword">Set</span> <span class="hljs-keyword">if</span> the <span class="hljs-keyword">right</span> mouse button <span class="hljs-keyword">is</span> down.

MK_SHIFT   <span class="hljs-keyword">Set</span> <span class="hljs-keyword">if</span> the SHIFT <span class="hljs-keyword">key</span> <span class="hljs-keyword">is</span> down.

point
Specifies the x- <span class="hljs-keyword">and</span> y-coordinate <span class="hljs-keyword">of</span> the <span class="hljs-keyword">cursor</span>. These coordinates <span class="hljs-keyword">are</span> always <span class="hljs-keyword">relative</span> <span class="hljs-keyword">to</span> the upper-<span class="hljs-keyword">left</span> corner <span class="hljs-keyword">of</span> the window.</span></code></pre> 
<pre class="prettyprint"><code class=" hljs css"><span class="hljs-tag">void</span> <span class="hljs-tag">CShowDlg</span><span class="hljs-pseudo">::OnLButtonDown(UINT</span> <span class="hljs-tag">nFlags</span>, <span class="hljs-tag">CPoint</span> <span class="hljs-tag">point</span>) 
<span class="hljs-rules">{
    <span class="hljs-rule">// <span class="hljs-attribute">TODO</span>:<span class="hljs-value"> Add your message handler code here and/or call default

    CDialog::<span class="hljs-function">OnLButtonDown(nFlags, point)</span></span></span>;
<span class="hljs-rule">}</span></span></code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f9f73dddbe32496e94df227109b445d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">cocos游戏开始时游戏图片切换实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/67ca2f6a8172179a2812ed3632f34b66/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C#】华南理工大学计算机考研复试题目</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>