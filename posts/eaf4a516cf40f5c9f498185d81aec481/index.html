<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>菜单目录-行转树 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="菜单目录-行转树" />
<meta property="og:description" content="listProjectVOSForFeishu： @Override public List&lt;DashMenuTreeNodeVO&gt; listProjectVOSForFeishu() { List&lt;ProjectDashboardTabChartVO&gt; projectDashboardTabChartVOList = dashboardMapper.listProjectDashboardTabChart(true); if (CollectionUtils.isEmpty(projectDashboardTabChartVOList)) { return Collections.emptyList(); } DashMenuTreeNodeVO root = new DashMenuTreeNodeVO(); for (int i = 0; i &lt; projectDashboardTabChartVOList.size(); i&#43;&#43;) { ProjectDashboardTabChartVO vo = projectDashboardTabChartVOList.get(i); root.add(vo); } return new LinkedList&lt;&gt;(root.getChildren()); } DashMenuTreeNodeVO： package com.soyoung.ztdata.bi.core.vo.report; import com.soyoung.ztdata.bi.core.enums.DashMenuTypeEnum; import lombok.extern.slf4j.Slf4j; import org.apache.commons.lang3.StringUtils; import java.util.*; /** */ @Slf4j public class DashMenuTreeNodeVO { private String id; private String name; /** * 当前节点类型 */ String type; /** * 排序字段 */ private Integer sortNum; /** * 是否可编辑 */ private Boolean edit = false; /** * 是否可删除 */ private Boolean del = false; /** * 子节点 */ private Set&lt;DashMenuTreeNodeVO&gt; children = new TreeSet&lt;&gt;((o1, o2) -&gt; { if (null == o1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/eaf4a516cf40f5c9f498185d81aec481/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-06T12:48:09+08:00" />
<meta property="article:modified_time" content="2022-01-06T12:48:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">菜单目录-行转树</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre>listProjectVOSForFeishu：</pre> 
<pre><code class="language-java">    @Override
    public List&lt;DashMenuTreeNodeVO&gt; listProjectVOSForFeishu() {
        List&lt;ProjectDashboardTabChartVO&gt; projectDashboardTabChartVOList = dashboardMapper.listProjectDashboardTabChart(true);
        if (CollectionUtils.isEmpty(projectDashboardTabChartVOList)) {
            return Collections.emptyList();
        }
        DashMenuTreeNodeVO root = new DashMenuTreeNodeVO();
        for (int i = 0; i &lt; projectDashboardTabChartVOList.size(); i++) {
            ProjectDashboardTabChartVO vo = projectDashboardTabChartVOList.get(i);
            root.add(vo);
        }
        return new LinkedList&lt;&gt;(root.getChildren());
    }</code></pre> 
<pre>DashMenuTreeNodeVO：</pre> 
<pre><code class="language-java">package com.soyoung.ztdata.bi.core.vo.report;

import com.soyoung.ztdata.bi.core.enums.DashMenuTypeEnum;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;

import java.util.*;

/**
 */
@Slf4j
public class DashMenuTreeNodeVO {
    private String id;
    private String name;
    /**
     * 当前节点类型
     */
    String type;
    /**
     * 排序字段
     */
    private Integer sortNum;
    /**
     * 是否可编辑
     */
    private Boolean edit = false;
    /**
     * 是否可删除
     */
    private Boolean del = false;
    /**
     * 子节点
     */
    private Set&lt;DashMenuTreeNodeVO&gt; children = new TreeSet&lt;&gt;((o1, o2) -&gt; {
        if (null == o1.sortNum || null == o2.sortNum) {
            return -1;
        }
        if (Objects.equals(o1.sortNum, o2.sortNum)) {
            if (Objects.equals(o1.getId(), o2.getId())) {
                return -1;
            }
            return o1.getId().compareTo(o2.getId());
        }
        return o1.sortNum.compareTo(o2.sortNum);
    });

    public DashMenuTreeNodeVO() {
    }

    public DashMenuTreeNodeVO(String type) {
        this.type = type;
    }


    private static final ThreadLocal&lt;Finder&gt; finder = new ThreadLocal&lt;&gt;();


    /**
     * 状态模式
     * type == null, // 说明是 根 root 节点, 获取菜单探测器探测结果（DashMenuTreeNodeVO），探测结果作为 子树 root 继续添加节点（node）
     * &lt;p&gt;
     * type == project("文件夹") &amp;&amp; level == 0, // 说明是第一级菜单, 不可能出现此状态（type == null时，已经把level = 0 和 level = 1 两级节点关联了）
     * &lt;p&gt;
     * type == project("文件夹") &amp;&amp; level == 1, // 说明是第二级菜单, 获取仪表盘探测器探测结果（DashMenuTreeNodeVO），探测结果作为root继续添加节点（node）
     * &lt;p&gt;
     * // type == dashboard("看板"), // 说明是看板节点，从页签探测器中获取页签引用，作为 子树 root 继续添加节点（node）
     * &lt;p&gt;
     * // type == tab("页签"), // 说明是页签节点，从图表探测器中获取图表引用，作为 子树 root 继续添加节点（node）
     * &lt;p&gt;
     * // type == chart("图表"); // 说明是图表节点（叶子节点），将 子树集合 置为 null
     *
     * @param node
     */
    public void add(ProjectDashboardTabChartVO node) {
        if (null == finder.get() || (null == type &amp;&amp; this.children.size() == 0)) {
            finder.set(new Finder());
        }
        DashMenuTreeNodeVO root;
        String uniquePId = uniquePId(node);
        String uniqueProjId = uniqueProjId(node);
        String uniqueDashId = uniqueDashId(node);
        String uniqueTabId = uniqueTabId(node);
        String uniqueChartId = uniqueChartId(node);
        if (null == type) { // this == root
            if (Objects.equals("0", uniquePId)) { // node == 一级
                root = finder.get().getProjectFinder().computeIfAbsent(uniqueProjId,
                        key -&gt; {
                            DashMenuTreeNodeVO dashMenuTreeNodeVO = new DashMenuTreeNodeVO(DashMenuTypeEnum.project.name()).setId(node.getProjId()).setName(node.getProjName()).setSortNum(node.getProjectSortNum());
                            this.children.add(dashMenuTreeNodeVO);
                            return dashMenuTreeNodeVO;
                        });
                root.add(node);
            } else { // node == 二级
                // pid
                DashMenuTreeNodeVO rootPid = finder.get().getProjectFinder().computeIfAbsent(uniquePId,
                        key -&gt; {
                            DashMenuTreeNodeVO dashMenuTreeNodeVO = new DashMenuTreeNodeVO(DashMenuTypeEnum.project.name()).setId(node.getPid()).setName(node.getPname()).setSortNum(node.getPSortNum());
                            this.children.add(dashMenuTreeNodeVO);
                            return dashMenuTreeNodeVO;
                        });

                // projId
                root = finder.get().getProjectFinder().computeIfAbsent(uniqueProjId,
                        key -&gt; {
                            final DashMenuTreeNodeVO dashMenuTreeNodeVO = new DashMenuTreeNodeVO(DashMenuTypeEnum.project.name()).setId(node.getProjId()).setName(node.getProjName()).setSortNum(node.getProjectSortNum());
                            rootPid.getChildren().add(dashMenuTreeNodeVO);
                            return dashMenuTreeNodeVO;
                        });
                root.add(node);
            }
        } else if (Objects.equals(DashMenuTypeEnum.project.name(), this.type)) {
            root = finder.get().getDashboardFinder().computeIfAbsent(uniqueDashId,
                    key -&gt; {
                        final DashMenuTreeNodeVO dashMenuTreeNodeVO = new DashMenuTreeNodeVO(DashMenuTypeEnum.dashboard.name()).setId(node.getDashId()).setName(node.getDashName()).setSortNum(node.getDashSortNum());
                        this.children.add(dashMenuTreeNodeVO);
                        return dashMenuTreeNodeVO;
                    });
            root.add(node);
        } else if (Objects.equals(DashMenuTypeEnum.dashboard.name(), this.type)) {
            root = finder.get().getTabFinder().computeIfAbsent(uniqueTabId,
                    key -&gt; {
                        final DashMenuTreeNodeVO dashMenuTreeNodeVO = new DashMenuTreeNodeVO(DashMenuTypeEnum.tab.name()).setId(node.getTabId()).setName(node.getTabName());
                        this.children.add(dashMenuTreeNodeVO);
                        return dashMenuTreeNodeVO;
                    });

            root.add(node);
        } else if (Objects.equals(DashMenuTypeEnum.tab.name(), this.type)) {
            if (StringUtils.isBlank(uniqueChartId)) {
                this.children = null;
                return;
            }
            root = finder.get().getChartFinder().computeIfAbsent(uniqueChartId,
                    key -&gt; {
                        final DashMenuTreeNodeVO dashMenuTreeNodeVO = new DashMenuTreeNodeVO(DashMenuTypeEnum.chart.name()).setId(node.getChartId()).setName(node.getChartName());
                        this.children.add(dashMenuTreeNodeVO);
                        return dashMenuTreeNodeVO;
                    });
            root.add(node);
        } else if (Objects.equals(DashMenuTypeEnum.chart.name(), this.type)) {
            this.children = null;
        }
    }

    private String uniqueChartId(ProjectDashboardTabChartVO node) {
        return node.getChartId();
    }

    private String uniqueTabId(ProjectDashboardTabChartVO node) {
        return uniqueDashId(node) + ":" + node.getTabId();
    }

    private String uniquePId(ProjectDashboardTabChartVO node) {
        return node.getPid();
    }

    private String uniqueDashId(ProjectDashboardTabChartVO node) {
        return node.getDashId();
    }

    private String uniqueProjId(ProjectDashboardTabChartVO node) {
        return node.getProjId();
    }

    public String getId() {
        return id;
    }

    public DashMenuTreeNodeVO setId(String id) {
        this.id = id;
        return this;
    }

    public String getName() {
        return name;
    }

    public DashMenuTreeNodeVO setName(String name) {
        this.name = name;
        return this;
    }

    public String getType() {
        return type;
    }

    public DashMenuTreeNodeVO setType(String type) {
        this.type = type;
        return this;
    }

    public Boolean getEdit() {
        return edit;
    }

    public void setEdit(Boolean edit) {
        this.edit = edit;
    }

    public Boolean getDel() {
        return del;
    }

    public void setDel(Boolean del) {
        this.del = del;
    }

    public Integer getSortNum() {
        return sortNum;
    }

    public DashMenuTreeNodeVO setSortNum(Integer sortNum) {
        this.sortNum = sortNum;
        return this;
    }

    public Set&lt;DashMenuTreeNodeVO&gt; getChildren() {
        return children;
    }

    public void setChildren(Set&lt;DashMenuTreeNodeVO&gt; children) {
        this.children = children;
    }

    private static final class Finder {
        Map&lt;String, DashMenuTreeNodeVO&gt; projectFinder = new HashMap&lt;&gt;();
        Map&lt;String, DashMenuTreeNodeVO&gt; dashboardFinder = new HashMap&lt;&gt;();
        Map&lt;String, DashMenuTreeNodeVO&gt; tabFinder = new HashMap&lt;&gt;();
        Map&lt;String, DashMenuTreeNodeVO&gt; chartFinder = new HashMap&lt;&gt;();

        public Map&lt;String, DashMenuTreeNodeVO&gt; getProjectFinder() {
            return projectFinder;
        }

        public Map&lt;String, DashMenuTreeNodeVO&gt; getDashboardFinder() {
            return dashboardFinder;
        }

        public Map&lt;String, DashMenuTreeNodeVO&gt; getTabFinder() {
            return tabFinder;
        }

        public Map&lt;String, DashMenuTreeNodeVO&gt; getChartFinder() {
            return chartFinder;
        }
    }
}
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ba82e2deb375da99e40234185afc64cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">spring接口超时时间配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/931a9c536df830418e2fe6aa1b28d8a5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[样本分析初体验] Parite家族感染型病毒</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>