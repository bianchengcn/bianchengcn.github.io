<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【转载】libcurl的使用总结 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【转载】libcurl的使用总结" />
<meta property="og:description" content="最近的项目中由于要在C&#43;&#43;代码中调用PHP的URL，所以不得不借助libcurl这个库，由于第一次用，所以很多地方很是纠结，特此写在这里，方便给同样刚入门的朋友指引。 分两篇介绍，第一篇是理论知识，第二篇是实例。快速链接–libcurl的使用总结（一）
一.下载安装 1.到http://curl.haxx.se/download.html上下载最新版本，由于公司的机器安装rpm有依赖关系，所以直接下载了source 2.编译。解压后进入curl的目录，直接执行 make all 就行。 3.等待编译结束后，可以查看目录结构。 curl/include/curl ： 头文件目录 （一般只要包含curl.h即可） curl/lib/.lib/ ： lib文件目录（有libcurl.a和libcurl.so，注意，如果这两个文件在同一目录下，-lcurl默认是链接.so滴）
二.函数简要说明 在基于LibCurl的程序里，主要采用callback function （回调函数）的形式完成传输任务，用户在启动传输前设置好各类参数和回调函数，当满足条件时libcurl将调用用户的回调函数实现特定功能。下面是利用libcurl完成传输任务的流程：
1. 调用curl_global_init()初始化libcurl 2. 调用 curl_easy_init()函数得到 easy interface型指针 3. 调用curl_easy_setopt设置传输选项 4. 根据curl_easy_setopt设置的传输选项，实现回调函数以完成用户特定任务 5. 调用curl_easy_perform（）函数完成传输任务 6. 调用curl_easy_cleanup（）释放内存
在整过过程中设置curl_easy_setopt()参数是最关键的，几乎所有的libcurl程序都要使用它。
1）CURLcode curl_global_init(long flags); 描述： 这个函数只能用一次。(其实在调用curl_global_cleanup 函数后仍然可再用) 如果这个函数在curl_easy_init函数调用时还没调用，它讲由libcurl库自动完成。 参数：flags CURL_GLOBAL_ALL //初始化所有的可能的调用。 CURL_GLOBAL_SSL //初始化支持 安全套接字层。 CURL_GLOBAL_WIN32 //初始化win32套接字库。 CURL_GLOBAL_NOTHING //没有额外的初始化。
2）void curl_global_cleanup(void); 描述：在结束libcurl使用的时候，用来对curl_global_init做的工作清理。类似于close的函数。
3.char *curl_version( ); 描述: 打印当前libcurl库的版本。
4）CURL *curl_easy_init( ); 描述: curl_easy_init用来初始化一个CURL的指针(有些像返回FILE类型的指针一样). 相应的在调用结束时要用curl_easy_cleanup函数清理. 一般curl_easy_init意味着一个会话的开始. 它的返回值一般都用在easy系列的函数中." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/6b932b8d192e7f42183244c328ec92e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-03-25T15:12:28+08:00" />
<meta property="article:modified_time" content="2016-03-25T15:12:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【转载】libcurl的使用总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> 最近的项目中由于要在C++代码中调用PHP的URL，所以不得不借助libcurl这个库，由于第一次用，所以很多地方很是纠结，特此写在这里，方便给同样刚入门的朋友指引。<br style=""> 分两篇介绍，第一篇是理论知识，第二篇是实例。<a target="_blank" href="http://www.vimer.cn/2010/03/libcurl%E7%9A%84%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93%EF%BC%88%E4%BA%8C%EF%BC%89.html" rel="nofollow noopener noreferrer" style="color:rgb(210,50,45); text-decoration:none">快速链接–libcurl的使用总结（一）</a></p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style=""><span id="wiz_font_size_span_20088875" style="font-size:16pt"><span style=""><span style="font-size:14px">一.下载安装</span></span></span></span><br style="">     1.到<a target="_blank" href="http://curl.haxx.se/download.html" rel="nofollow noopener noreferrer" style="color:rgb(210,50,45); text-decoration:none">http://curl.haxx.se/download.html</a>上下载最新版本，由于公司的机器安装rpm有依赖关系，所以直接下载了source<br style="">     2.编译。解压后进入curl的目录，直接执行 make all 就行。<br style="">     3.等待编译结束后，可以查看目录结构。<br style="">         curl/include/curl ： 头文件目录 （一般只要包含curl.h即可）<br style="">         curl/lib/.lib/      ： lib文件目录（有libcurl.a和libcurl.so，注意，如果这两个文件在同一目录下，-lcurl默认是链接.so滴）</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style="font-size:14px"><span style="">二.函数简要说明</span></span><br style=""> 在基于LibCurl的程序里，主要采用callback function （回调函数）的形式完成传输任务，用户在启动传输前设置好各类参数和回调函数，当满足条件时libcurl将调用用户的回调函数实现特定功能。下面是利用libcurl完成传输任务的流程：</p> 
<p style="margin:0px auto 10px; padding-right:3px; padding-left:3px; padding-top:3px; font-family:'Courier New'; border:1px solid black; background-color:window"> <span style="font-family:微软雅黑"><span style="color:rgb(110,0,170)">1</span>.       调用curl_global_init()初始化libcurl<br style=""> <span style="color:rgb(110,0,170)">2</span>.       调用 curl_easy_init()函数得到 easy <span style="color:rgb(0,0,255)"><span style="">interface</span></span>型指针<br style=""> <span style="color:rgb(110,0,170)">3</span>.       调用curl_easy_setopt设置传输选项<br style=""> <span style="color:rgb(110,0,170)">4</span>.       根据curl_easy_setopt设置的传输选项，实现回调函数以完成用户特定任务<br style=""> <span style="color:rgb(110,0,170)">5</span>.       调用curl_easy_perform（）函数完成传输任务<br style=""> <span style="color:rgb(110,0,170)">6</span>.       调用curl_easy_cleanup（）释放内存</span></p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> 在整过过程中设置curl_easy_setopt()参数是最关键的，几乎所有的libcurl程序都要使用它。</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style="">1）CURLcode curl_global_init(long flags);</span><br style=""> 描述：<br style=""> 这个函数只能用一次。(其实在调用curl_global_cleanup 函数后仍然可再用)<br style=""> 如果这个函数在curl_easy_init函数调用时还没调用，它讲由libcurl库自动完成。<br style=""> 参数：flags<br style=""> CURL_GLOBAL_ALL                      //初始化所有的可能的调用。<br style=""> CURL_GLOBAL_SSL                      //初始化支持 安全套接字层。<br style=""> CURL_GLOBAL_WIN32            //初始化win32套接字库。<br style=""> CURL_GLOBAL_NOTHING         //没有额外的初始化。</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style="">2）void curl_global_cleanup(void);</span><br style=""> 描述：在结束libcurl使用的时候，用来对curl_global_init做的工作清理。类似于close的函数。</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> 3.char *curl_version( );<br style=""> 描述: 打印当前libcurl库的版本。</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style="">4）CURL *curl_easy_init( );</span><br style=""> 描述:<br style=""> curl_easy_init用来初始化一个CURL的指针(有些像返回FILE类型的指针一样). 相应的在调用结束时要用curl_easy_cleanup函数清理.<br style=""> 一般curl_easy_init意味着一个会话的开始. 它的返回值一般都用在easy系列的函数中.</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style="">5）void curl_easy_cleanup(CURL *handle);</span><br style=""> 描述:<br style=""> 这个调用用来结束一个会话.与curl_easy_init配合着用.<br style=""> 参数:<br style=""> CURL类型的指针.</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style="">6）CURLcode curl_easy_setopt(CURL *handle, CURLoption option, parameter);</span><br style=""> 描述: 这个函数最重要了.几乎所有的curl 程序都要频繁的使用它.它告诉curl库.程序将有如何的行为. 比如要查看一个网页的html代码等.(这个函数有些像ioctl函数)参数:<br style=""> 1 CURL类型的指针<br style=""> 2 各种CURLoption类型的选项.(都在curl.h库里有定义,man 也可以查看到)<br style=""> 3 parameter 这个参数 既可以是个函数的指针,也可以是某个对象的指针,也可以是个long型的变量.它用什么这取决于第二个参数.<br style=""> CURLoption 这个参数的取值很多.具体的可以查看man手册.</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style="">7）CURLcode curl_easy_perform(CURL *handle);</span></p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> 描述:这个函数在初始化CURL类型的指针 以及curl_easy_setopt完成后调用. 就像字面的意思所说perform就像是个舞台.让我们设置的<br style=""> option 运作起来.参数:<br style=""> CURL类型的指针.</p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style=""><span style="font-size:14px">三.重要函数详解</span></span><br style=""> <span style="">1）curl_easy_setopt函数介绍</span></p> 
<p style="margin-top:0px; margin-bottom:10px; font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> <span style="color:#3d4450">本节主要介绍curl_easy_setopt中跟http相关的参数。注意本节的阐述都是以libcurl作为主体，其它为客体来阐述的。</span><br style=""> <span style="color:#3d4450">1.     CURLOPT_URL</span><br style=""> <span style="color:#3d4450">设置访问URL</span><br style=""> <span style="color:#3d4450">2.       CURLOPT_WRITEFUNCTION，CURLOPT_WRITEDATA</span><br style=""> <span style="color:#3d4450">回调函数原型为：size_t function( void *ptr, size_t size, size_t nmemb, void *stream); 函数将在libcurl接收到数据后被调用，因此函数多做数据保存的功能，如处理下载文件。CURLOPT_WRITEDATA 用于表明CURLOPT_WRITEFUNCTION函数中的stream指针的来源。</span><br style=""> <span style="color:#3d4450">3.      CURLOPT_HEADERFUNCTION，CURLOPT_HEADERDATA</span><br style=""> <span style="color:#3d4450">回调函数原型为 size_t function( void *ptr, size_t size,size_t nmemb, void *stream); libcurl一旦接收到http 头部数据后将调用该函数。CURLOPT_WRITEDATA 传递指针给libcurl，该指针表明CURLOPT_HEADERFUNCTION 函数的stream指针的来源。</span><br style=""> <span style="color:#3d4450">4.       CURLOPT_READFUNCTION CURLOPT_READDATA</span><br style=""> <span style="color:#3d4450">libCurl需要读取数据传递给远程主机时将调用CURLOPT_READFUNCTION指定的函数，函数原型是：size_t function(void *ptr, size_t size, size_t nmemb,void *stream). CURLOPT_READDATA 表明CURLOPT_READFUNCTION函数原型中的stream指针来源。</span><br style=""> <span style="color:#3d4450">5.       CURLOPT_NOPROGRESS，CURLOPT_PROGRESSFUNCTION，CURLOPT_PROGRESSDATA</span><br style=""> <span style="color:#3d4450">跟数据传输进度相关的参数。CURLOPT_PROGRESSFUNCTION 指定的函数正常情况下每秒被libcurl调用一次，为了使CURLOPT_PROGRESSFUNCTION被调用，CURLOPT_NOPROGRESS必须被设置为false，CURLOPT_PROGRESSDATA指定的参数将作为CURLOPT_PROGRESSFUNCTION指定函数的第一个参数</span><br style=""> <span style="color:#3d4450">6.       CURLOPT_TIMEOUT，CURLOPT_CONNECTIONTIMEOUT:</span><br style=""> <span style="color:#3d4450">CURLOPT_TIMEOUT 由于设置传输时间，CURLOPT_CONNECTIONTIMEOUT 设置连接等待时间</span><br style=""> <span style="color:#3d4450">7.       CURLOPT_FOLLOWLOCATION</span><br style=""> <span style="color:#3d4450">设置重定位URL</span><br style=""> <span style="color:#3d4450">CURLOPT_RANGE: CURLOPT_RESUME_FROM:</span><br style=""> <span style="color:#3d4450">断点续传相关设置。CURLOPT_RANGE 指定char *参数传递给libcurl，用于指明http域的RANGE头域，例如：</span><br style=""> <span style="color:#3d4450">表示头500个字节：bytes=0-499</span><br style=""> <span style="color:#3d4450">表示第二个500字节：bytes=500-999</span><br style=""> <span style="color:#3d4450">表示最后500个字节：bytes=-500</span><br style=""> <span style="color:#3d4450">表示500字节以后的范围：bytes=500-</span><br style=""> <span style="color:#3d4450">第一个和最后一个字节：bytes=0-0,-1</span><br style=""> <span style="color:#3d4450">同时指定几个范围：bytes=500-600,601-999</span><br style=""> <u><span style="color:#ff0000">    CURLOPT_RESUME_FROM </span><span style="color:#330033">传递一个long参数给libcurl，指定你希望开始传递的<br style=""> 偏移量，以实现继续下载的功能。</span></u><br style=""> <span style="color:rgb(61,68,80)">2）curl_easy_perform 函数说明（error 状态码）</span></p> 
<p style="margin-top:0px; margin-bottom:10px; color:rgb(61,68,80); font-family:'Microsoft Yahei',Helvetica,Arial,sans-serif; font-size:13px; line-height:18.5714282989502px"> 该函数完成curl_easy_setopt指定的所有选项，本节重点介绍curl_easy_perform的返回值。返回0意味一切ok，非0代表错误发生。主要错误码说明：<br style=""> 1.    CURLE_OK<br style="">     任务完成一切都好<br style=""> 2     CURLE_UNSUPPORTED_PROTOCOL<br style="">     不支持的协议，由URL的头部指定<br style=""> 3     CURLE_COULDNT_CONNECT<br style="">     不能连接到remote 主机或者代理<br style=""> 4     CURLE_REMOTE_ACCESS_DENIED<br style="">     访问被拒绝<br style=""> 5     CURLE_HTTP_RETURNED_ERROR<br style="">     Http返回错误<br style=""> 6     CURLE_READ_ERROR<br style="">     读本地文件错误</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/654e79eef87aae5358254e6e2bf931de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">fstream的基础用法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/51545848d19862e855a14a192066310b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">from __future__ import absolute_import的作用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>