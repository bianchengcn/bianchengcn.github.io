<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>angular 路由拦截 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="angular 路由拦截" />
<meta property="og:description" content="$scope.$on(&#39;$stateChangeStart&#39;,function(event, toState, toParams, fromState, fromParams){ //如果是登录页面就不进行处理 retrun if(toState.name==&#39;login&#39;) return; //comApi是有一个工具类 此处是判断是否登录 登录信息放缓存了 if(!comApi.isNotNullAndUndefined($sessionStorage.ustu)){ //不是登录页面 取消默认跳转 去登录页面 event.preventDefault();// 取消默认跳转行为 $state.go(&#34;login&#34;,{from:toState.name,w:&#39;notLogin&#39;});//跳转到登录界面 } }); //登录控制器 var from = $stateParams.from; console.log($stateParams); $state.go(from &amp;&amp; from != &#34;login&#34; ? from : &#34;app.home&#34;); /** * Created by wanggs */ //拦截http请求的拦截器 httpProvider提供了一个名为interceptors的数组.这个数组接受拦截器服务注册,通过过程次的注册最终会形成拦截器链.这样每次在调用http服务的时候,angular都会通过我们定义的拦截点(切面)进行相应的Ajax动作修改. app.factory(&#39;factoryFilters&#39;, function ($sessionStorage, $location) { var sessionInjector = { request: function (config) { //请求之前 //判断是否登陆.登陆后将token放到请求头部 if ($sessionStorage.ustu) { config.headers[&#34;hahh&#34;] = $sessionStorage.ustu; } return config; }, response: function (config, header, header1, header2) { //请求成功之后 //从返回头部获跳转 if (config." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/791491f0875c264d92ff6c88e23c04d4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-04-28T14:43:55+08:00" />
<meta property="article:modified_time" content="2017-04-28T14:43:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">angular 路由拦截</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <pre class="prettyprint"><code class=" hljs php"> <span class="hljs-variable">$scope</span>.<span class="hljs-variable">$on</span>(<span class="hljs-string">'$stateChangeStart'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event, toState, toParams, fromState, fromParams)</span>{<!-- --></span>
       <span class="hljs-comment">//如果是登录页面就不进行处理 retrun</span>
       <span class="hljs-keyword">if</span>(toState.name==<span class="hljs-string">'login'</span>) <span class="hljs-keyword">return</span>;
         <span class="hljs-comment">//comApi是有一个工具类 此处是判断是否登录 登录信息放缓存了</span>
        <span class="hljs-keyword">if</span>(!comApi.isNotNullAndUndefined(<span class="hljs-variable">$sessionStorage</span>.ustu)){
       <span class="hljs-comment">//不是登录页面 取消默认跳转 去登录页面</span>
     event.preventDefault();<span class="hljs-comment">// 取消默认跳转行为</span>
      <span class="hljs-variable">$state</span>.go(<span class="hljs-string">"login"</span>,{from:toState.name,w:<span class="hljs-string">'notLogin'</span>});<span class="hljs-comment">//跳转到登录界面</span>
                }

            });

<span class="hljs-comment">//登录控制器</span>
 <span class="hljs-keyword">var</span> from = <span class="hljs-variable">$stateParams</span>.from;
        console.log(<span class="hljs-variable">$stateParams</span>);
         <span class="hljs-variable">$state</span>.go(from &amp;&amp; from != <span class="hljs-string">"login"</span> ? from : <span class="hljs-string">"app.home"</span>);

<span class="hljs-comment">/**
 * Created by wanggs  */</span>
<span class="hljs-comment">//拦截http请求的拦截器 httpProvider提供了一个名为interceptors的数组.这个数组接受拦截器服务注册,通过过程次的注册最终会形成拦截器链.这样每次在调用http服务的时候,angular都会通过我们定义的拦截点(切面)进行相应的Ajax动作修改.</span>
app.factory(<span class="hljs-string">'factoryFilters'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-variable">$sessionStorage</span>, <span class="hljs-variable">$location</span>)</span> {<!-- --></span>
    <span class="hljs-keyword">var</span> sessionInjector = {
        request: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(config)</span> {<!-- --></span>
            <span class="hljs-comment">//请求之前</span>
            <span class="hljs-comment">//判断是否登陆.登陆后将token放到请求头部</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$sessionStorage</span>.ustu) {
                config.headers[<span class="hljs-string">"hahh"</span>] = <span class="hljs-variable">$sessionStorage</span>.ustu;
            }
            <span class="hljs-keyword">return</span> config;
        },
        response: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(config, header, header1, header2)</span> {<!-- --></span>            <span class="hljs-comment">//请求成功之后</span>
            <span class="hljs-comment">//从返回头部获跳转</span>
            <span class="hljs-keyword">if</span> (config.headers(<span class="hljs-string">"hahh"</span>)) {
                <span class="hljs-variable">$sessionStorage</span>.ustu = config.headers(<span class="hljs-string">"hahh"</span>);
            }
            <span class="hljs-keyword">return</span> config;
        },
        requestError: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(config)</span> {<!-- --></span>
        <span class="hljs-comment">//请求之前错误</span>
            <span class="hljs-keyword">return</span> config;
        },
        responseError: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(config)</span> {<!-- --></span>
            <span class="hljs-comment">//请求之后错误</span>
            <span class="hljs-keyword">return</span> config;
        }
    };
    <span class="hljs-keyword">return</span> sessionInjector;
});
app.config([<span class="hljs-string">'$httpProvider'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-variable">$httpProvider</span>)</span> {<!-- --></span>
    <span class="hljs-variable">$httpProvider</span>.interceptors.push(<span class="hljs-string">'factoryFilters'</span>);
}]);</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/436b46f1af5771c31aca86ebcd889384/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决PyCharm [import tensorflow as tf]报错</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/25d81c3e6cb8f8efa92bc4b004123b34/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[编程之美-10]字符串的包含问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>