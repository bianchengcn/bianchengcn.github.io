<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Unity网格变形开源库测评 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Unity网格变形开源库测评" />
<meta property="og:description" content="【博物纳新】是UWA旨在为开发者推荐新颖、易用、有趣的开源项目，帮助大家在项目研发之余发现世界上的热门项目、前沿技术或者令人惊叹的视觉效果，并探索将其应用到自己项目的可行性。很多时候，我们并不知道自己想要什么，直到某一天我们遇到了它。
更多精彩内容请关注：lab.uwa4d.com
简介 Deform是一个Unity的网格变形工具框架，使用JoySystem&#43;Burst编译器工作，在CPU端获得更好的性能。它拥有便捷易用的Editor工具，可实现包括Blend、Twist等内置的40多种变形效果，当然也支持用户自己编写的Custom Deformer。
以下为部分效果图：
每一种类型的变形效果称为Deformer，而接收变形效果的网格物体称为Deformable。在每一类Deformer中会把计算量较大的顶点位置计算逻辑定位为IJobParallelFor类型的Job。
以下为预制的膨胀变形器BulgeDeformer中定义的网格顶点位置算法：
[BurstCompile(CompileSynchronously = COMPILE_SYNCHRONOUSLY)] public struct BulgeJob : IJobParallelFor { public float factor; public float top; public float bottom; public bool smooth; public float4x4 meshToAxis; public float4x4 axisToMesh; public NativeArray&lt;float3&gt; vertices; public void Execute(int index) { var point = mul(meshToAxis, float4(vertices[index], 1f)); var normalizedDistanceBetweenBounds = (clamp(point.z, bottom, top) - bottom) / (top - bottom); if (smooth) normalizedDistanceBetweenBounds = smoothstep(0f, 1f, normalizedDistanceBetweenBounds); var signedDistanceBetweenBounds = (normalizedDistanceBetweenBounds - 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/0e0b9ef3dd3fc27799c5d903eba52c58/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-21T14:47:02+08:00" />
<meta property="article:modified_time" content="2019-06-21T14:47:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Unity网格变形开源库测评</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0px;"><span style="color:#626773;">【博物纳新】是UWA旨在为开发者推荐新颖、易用、有趣的开源项目，帮助大家在项目研发之余发现世界上的热门项目、前沿技术或者令人惊叹的视觉效果，并探索将其应用到自己项目的可行性。很多时候，我们并不知道自己想要什么，直到某一天我们遇到了它。</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">更多精彩内容请关注：<a href="https://lab.uwa4d.com/" rel="nofollow">lab.uwa4d.com</a></span></p> 
<hr> 
<h3><span style="color:#626773;"><strong>简介</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#626773;">Deform是一个Unity的网格变形工具框架，使用JoySystem+Burst编译器工作，在CPU端获得更好的性能。它拥有便捷易用的Editor工具，可实现包括Blend、Twist等内置的40多种变形效果，当然也支持用户自己编写的Custom Deformer。</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">以下为部分效果图：</span></p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/43/e1/TNCBDuyw_o.gif"></p> 
<p> </p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/97/aa/FRP1Yzmc_o.gif"></p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/e3/ca/o6kSVLEj_o.gif"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">每一种类型的变形效果称为Deformer，而接收变形效果的网格物体称为Deformable。在每一类Deformer中会把计算量较大的顶点位置计算逻辑定位为IJobParallelFor类型的Job。</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">以下为预制的膨胀变形器BulgeDeformer中定义的网格顶点位置算法：</span></p> 
<pre class="has"><code>[BurstCompile(CompileSynchronously = COMPILE_SYNCHRONOUSLY)]
public struct BulgeJob : IJobParallelFor
{
    public float factor;
    public float top;
    public float bottom;
    public bool smooth;
    public float4x4 meshToAxis;
    public float4x4 axisToMesh;
    public NativeArray&lt;float3&gt; vertices;

    public void Execute(int index)
    {
        var point = mul(meshToAxis, float4(vertices[index], 1f));

        var normalizedDistanceBetweenBounds = (clamp(point.z, bottom, top) - bottom) / (top - bottom);
        if (smooth)
            normalizedDistanceBetweenBounds = smoothstep(0f, 1f, normalizedDistanceBetweenBounds);
        var signedDistanceBetweenBounds = (normalizedDistanceBetweenBounds - 0.5f) * 2f;

        point.xy *= signedDistanceBetweenBounds * signedDistanceBetweenBounds * -factor + factor + 1f;

        vertices[index] = mul(axisToMesh, point).xyz;
    }
}</code></pre> 
<p style="margin-left:0px;"><span style="color:#626773;">其在运行时在Timeline中查看Job Thread上的运行情况如下：</span></p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/a0/1a/is05yM6R_o.png"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">在运行时，所有需要应用变形的网格Deformables由一个DeformableManager管理，控制每一个网格的准备工作、变形计算、等待完成。再由每个Deformable安排其上Deformer的Job进行工作，以实现较好的性能。</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">开源库链接：<a href="https://lab.uwa4d.com/lab/5cabb5ad72745c25a82d8d64" rel="nofollow">https://lab.uwa4d.com/lab/5cabb5ad72745c25a82d8d64</a></span></p> 
<hr> 
<h3><span style="color:#626773;"><strong>使用说明</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#626773;">首先，你需要一个2018.3+的Unity版本，然后按照开源库中的安装说明安装一下即可。</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">打开Unity编辑器，可以在菜单栏中找到Tools -&gt; Deform -&gt; Creator Window，打开编辑面板。</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">点击【Create Deformable】即可快速创建一个约3000面的Deformable了。</span></p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/a2/d9/HWpJa796_o.png"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">接下来选中Deformable Object，点击Create Window面板中想要添加的预制Deformer，即可自动完成添加，这里选择一个Bulge类型的Deformer如下图：</span></p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/90/c0/mGtsFLpr_o.png"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">然后只要修改Bulge Deformer的参数即可看到网格变形的效果了。</span></p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/07/f4/EvLShlFd_o.gif"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">此外，Deformer还支持将变形后的网格保存成资源。</span></p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/d0/a5/noro0tKf_o.png"></p> 
<p style="margin-left:0px;"> </p> 
<hr> 
<h3><span style="color:#626773;"><strong>性能测评</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#626773;">本期的性能测评使用<a href="https://blog.uwa4d.com/archives/UWAGOTOL_Summary.html" rel="nofollow">UWA GOT Online</a>在小米8和三星S6两个中高端设备上进行了同屏压力测试。通过添加不同个数的Bulge Deformer的Deformable GameObject比较性能差异。测试用例的截图如下：</span></p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/d9/6e/AcWbkVmF_o.png"></p> 
<p style="margin-left:0px;"><span style="color:#626773;">得到在两个设备上的FPS帧率信息如下：</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">在小米8上Deformable从1个添加到45个，帧率一直稳定在59帧左右：</span></p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/06/ab/557nI5vE_o.png" width="800"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">而在三星S6上，当Deformable达到30个时开始掉帧，最终在Deformable添加到45个时掉到了27帧左右。</span></p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/87/97/looto62O_o.png" width="800"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">在CPU耗时方面，主线程的耗时主要集中在DeformableManager.Update上，统计得到其耗时均值与Deformable个数的关系如下：</span></p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/c2/d3/4QpQJ77o_o.png" width="800"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">同时，由于Deform应用的变形效果每一个网格都是一个实例，所以在内存中也会有同样多份的网格资源，这也是大家在使用时需要注意的：</span></p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/e5/11/4chzJ5wd_o.png" width="800"></p> 
<p style="margin-left:0px;"> </p> 
<hr> 
<h3><span style="color:#626773;"><strong>总结</strong></span></h3> 
<p style="margin-left:0px;"><span style="color:#626773;">正如作者在Release说明中提到的：</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">"Deform runs on the CPU. While it is incredibly fast, you should not expect to get performance comparable to vertex shaders.<br> Use shaders if you need speed, use Deform if you need modularity and ease-of-use."</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">使用CPU端来实现网格变形效率上必然比不上Vertex Shader，但如果希望有一个模块化易用性高的工具，Deform的确是一个不错的选择。</span></p> 
<hr> 
<p style="margin-left:0px;"> </p> 
<p>快用UWA Lab合辑Mark好项目！</p> 
<p> </p> 
<p style="text-align:center;"><img alt="请输入图片描述" class="has" src="https://images2.imgbox.com/65/f5/0KjJNyQd_o.gif"></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><span style="color:#626773;">今天的推荐就到这儿啦，或者它可直接使用，或者它需要您的润色，或者它启发了您的思路......</span></p> 
<p style="margin-left:0px;"><span style="color:#626773;">请不要吝啬您的点赞和转发，让我们知道我们在做对的事。当然如果您可以留言给出宝贵的意见，我们会越做越好。</span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a0c33778fed13b55a3cb091abcef0de3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">编译原理之语义分析和中间代码的生成</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8fb21f6bbf465af4bf2d68b9b9bb0f2a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Shiro免密登录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>