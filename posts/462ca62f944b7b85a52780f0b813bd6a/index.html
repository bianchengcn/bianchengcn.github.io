<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu16安装ClickHouse - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu16安装ClickHouse" />
<meta property="og:description" content="第1步：检查是否支持SSE4.2
因为向量化执行需要用到这一项特性
如果不支持SSE指令集,则不能直接使用预编译安装包,
需要通过源码编译特定的版本进行安装
grep -q sse4_2 /proc/cpuinfo &amp;&amp; echo &#34;SSE 4.2 supported&#34; || echo &#34;SSE 4.2 not supported&#34;
第2步：为apt添加clickhouse仓库
网上好多都说使用Yandex的官方仓库，
我一开始的时候也是用的Yandex的官方仓库，但是速度特慢，20KB/s左右下载完要1个多小时
于是换了清华源，链接在这里
https://mirrors.cnnic.cn/help/clickhouse/
当然你也可以选用阿里云源，163源，（一般阿里云源比清华源用得人更多，但是不知道为什么clickhouse相关的很少）
vim /etc/apt/sources.list
添加：
deb https://mirrors.tuna.tsinghua.edu.cn/clickhouse/deb/stable/ main/
或者：
deb http://repo.yandex.ru/clickhouse/deb/stable/ main/
第3步：添加依赖并更新apt数据库
apt install dirmngr
apt-key adv --keyserver keyserver.ubuntu.com --recv E0C56BD4
apt update
第4步：安装clickhouse服务端及客户端
apt-get install clickhouse-client clickhouse-server
第5步：启动clickhouse
先修改配置文件，可以远程访问
# 文件可能没有写入权限，先添加写入权限
sudo chmod 600 /etc/clickhouse-server/config.xml
vim /etc/clickhouse-server/config.xml
# config.xml文件添加以下内容或者直接找到把注释去除即可
&lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;
# 启动命令
systemctl start clickhouse-server" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/462ca62f944b7b85a52780f0b813bd6a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-20T17:39:05+08:00" />
<meta property="article:modified_time" content="2023-03-20T17:39:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu16安装ClickHouse</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>第1步：检查是否支持SSE4.2</p> 
<p></p> 
<p>因为向量化执行需要用到这一项特性<br> 如果不支持SSE指令集,则不能直接使用预编译安装包,<br> 需要通过源码编译特定的版本进行安装</p> 
<p>grep -q sse4_2 /proc/cpuinfo &amp;&amp; echo "SSE 4.2 supported" || echo "SSE 4.2 not supported"</p> 
<p>第2步：为apt添加clickhouse仓库<br> 网上好多都说使用Yandex的官方仓库，<br> 我一开始的时候也是用的Yandex的官方仓库，但是速度特慢，20KB/s左右下载完要1个多小时<br> 于是换了清华源，链接在这里<br> https://mirrors.cnnic.cn/help/clickhouse/<br> 当然你也可以选用阿里云源，163源，（一般阿里云源比清华源用得人更多，但是不知道为什么clickhouse相关的很少）</p> 
<p>vim /etc/apt/sources.list</p> 
<p>添加：</p> 
<p>deb https://mirrors.tuna.tsinghua.edu.cn/clickhouse/deb/stable/ main/</p> 
<p>或者：</p> 
<p>deb http://repo.yandex.ru/clickhouse/deb/stable/ main/</p> 
<p>第3步：添加依赖并更新apt数据库</p> 
<p>apt install dirmngr</p> 
<p><em id="__mceDel">apt-key adv --keyserver keyserver.ubuntu.com --recv E0C56BD4</em></p> 
<p>apt update</p> 
<p>第4步：安装clickhouse服务端及客户端</p> 
<p>apt-get install clickhouse-client clickhouse-server</p> 
<p>第5步：启动clickhouse</p> 
<p>先修改配置文件，可以远程访问</p> 
<p># 文件可能没有写入权限，先添加写入权限<br> sudo chmod 600 /etc/clickhouse-server/config.xml</p> 
<p>vim /etc/clickhouse-server/config.xml</p> 
<p># config.xml文件添加以下内容或者直接找到把注释去除即可<br> &lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;<br><img alt="" height="121" src="https://images2.imgbox.com/dd/00/2UJ9VaXz_o.png" width="477"></p> 
<p># 启动命令</p> 
<p>systemctl start clickhouse-server</p> 
<p># 查看clickhouse是否启动成功<br> systemctl status clickhouse-server</p> 
<p># 添加开机启动<br> systemctl enable clickhouse-server<br><img alt="" height="292" src="https://images2.imgbox.com/75/00/Sz0ECZML_o.png" width="948"></p> 
<p></p> 
<p>安装DBeaver<br> DBeaver很好安装的，不需要破解<br> 点击下面可以直接下载DBeaver<br> https://dbeaver.io/files/dbeaver-ce-latest-x86_64-setup.exe</p> 
<p>你也可以直接去他们官网下载：<br> https://dbeaver.io/download/</p> 
<p>DBeaver连接clickhouse<br><img alt="" height="442" src="https://images2.imgbox.com/a7/46/eLUFEwsr_o.png" width="1200"></p> 
<p><img alt="" height="632" src="https://images2.imgbox.com/62/9e/zowfOkoC_o.png" width="584"></p> 
<p>数据导出：</p> 
<p>clickhouse-client -h 127.0.0.1 -u default --password --database="default" --query="select * from default.dy_user_info FORMAT CSV" &gt; ts-20210611.csv<br> 数据导入：</p> 
<p>clickhouse-client -h 127.0.0.1 -u default --password --database="default" --query="insert into default.dy_user_info FORMAT CSV" &lt; ./ts-20210611.csv</p> 
<p></p> 
<p><strong>安装完成后需要配置日志表query_log和query_thread_log的生命周期，要不然这两个表会非常大</strong></p> 
<p>ALTER TABLE system.query_log MODIFY TTL event_date + toIntervalDay(3);</p> 
<p>ALTER TABLE system.query_thread_log MODIFY TTL event_date + toIntervalDay(3);</p> 
<p>ALTER TABLE system.asynchronous_metric_log MODIFY TTL event_date + toIntervalDay(60);</p> 
<p>ALTER TABLE system.trace_log MODIFY TTL event_date + toIntervalDay(60);</p> 
<p>ALTER TABLE system.metric_log MODIFY TTL event_date + toIntervalDay(60);</p> 
<p><strong>清理日志表（用工具执行SQL表过大导致执行超时，SQL实际在后台服务运行，等待即可）</strong>：</p> 
<p>alter table system.query_thread_log drop partition '202201';</p> 
<p>alter table system.query_log drop partition '202201';</p> 
<p><strong>如果日志表大于50G需要做以下配置：</strong></p> 
<p>cd /var/lib/clickhouse/flags/</p> 
<p>sudo touch force_drop_table &amp;&amp; sudo chmod 666 force_drop_table</p> 
<p><strong>查询统计表数据大小：</strong></p> 
<p>select</p> 
<p>　　database,</p> 
<p>　　table,</p> 
<p>　　formatReadableSize(size) as size,</p> 
<p>　　formatReadableSize(bytes_on_disk) as bytes_on_disk,</p> 
<p>　　formatReadableSize(data_uncompressed_bytes) as data_uncompressed_bytes,</p> 
<p>　　formatReadableSize(data_compressed_bytes) as data_compressed_bytes,</p> 
<p>　 compress_rate,</p> 
<p>　　rows,</p> 
<p>　　days,</p> 
<p>　　formatReadableSize(avgDaySize) as avgDaySize</p> 
<p>from</p> 
<p>　(</p> 
<p>　　　select</p> 
<p>　　　　　　database,</p> 
<p>　　　　　　table,</p> 
<p>　　　　　　sum(bytes) as size,</p> 
<p>　　　　　　sum(rows) as rows,</p> 
<p>　　　　　　min(min_date) as min_date,</p> 
<p>　　　　　　max(max_date) as max_date,</p> 
<p>　　　　　　sum(bytes_on_disk) as bytes_on_disk,</p> 
<p>　　　　　　sum(data_uncompressed_bytes) as data_uncompressed_bytes,</p> 
<p>　　　　　　sum(data_compressed_bytes) as data_compressed_bytes,</p> 
<p>　　　　　　(data_compressed_bytes / data_uncompressed_bytes) * 100 as compress_rate,</p> 
<p>　　　　　　max_date - min_date as days,</p> 
<p>　　　　　　size / (max_date - min_date) as avgDaySize</p> 
<p>　　　　from system.parts</p> 
<p>　　　　where active</p> 
<p>　　　　group by</p> 
<p>　　　　　　database,</p> 
<p>　　　　　　table</p> 
<p>　　　　order by data_compressed_bytes desc</p> 
<p>);</p> 
<p><img alt="" height="887" src="https://images2.imgbox.com/8a/a9/W9wI8Xg6_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/889060f230d83bf884ba538192c85c60/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【MySQL进阶】深入理解InnoDB数据页结构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/94b668f93e050e486e96df06808e47ee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据分片技术及其应用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>