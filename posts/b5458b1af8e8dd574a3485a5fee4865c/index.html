<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ffmpeg的一些初级语法 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ffmpeg的一些初级语法" />
<meta property="og:description" content="ffmpeg命令格式：
ffmpeg [全局选项][输入文件选项] -i [输入文件]...[输出文件选项][输出文件]
主要选项 ：
-f 指定输入或者输出文件格式，不指定的话会根据文件扩展名进行推测。
-i 输入文件
-y 默认覆盖同名文件
-n 不覆盖同名文件，如果输出文件存在立即退出
-codec 指定编码格式，也可以仅指定音频或视频，如-codec:v指定视频编码格式，-codec:a指定音频编码格式
-t 限制输入或者输出时间, 一般配合-ss使用，用来截取时间段的音视频。
-to 指定结束时间点，一般配合-ss使用，用来截取某时间段的内容。
-ss 设置开始时间，单位是秒
-fiiter_complex 复合滤镜
-vf 单一滤镜
视频：
-r 设置帧数
-s 设置输出尺寸（只能是偶数）
-vn 禁止输出视频
-va 禁止输出音频
-codec:v 设置视频编码格式，等同-c:v
-codec:a 设置音频编码格式，等同-c:a
音频：
-ar 设置采样频率
-ac 设置音频通道数
-an 禁止输出音频
-sn 禁止输出字幕
-ab 设置比特率
//将管道里的图片制作成视频
ffmpeg -f image2pipe -framerate 24 -i pipe:.png -s 1600x900 -y -vcodec libopenh264 out.mp4
//从视频里提取音频
ffmpeg -i input." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/b5458b1af8e8dd574a3485a5fee4865c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-08T23:44:09+08:00" />
<meta property="article:modified_time" content="2023-01-08T23:44:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ffmpeg的一些初级语法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg命令格式：</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg [全局选项][输入文件选项] -i [输入文件]...[输出文件选项][输出文件]</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">主要选项 ：</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-f 指定输入或者输出文件格式，不指定的话会根据文件扩展名进行推测。</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-i 输入文件</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-y 默认覆盖同名文件</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-n 不覆盖同名文件，如果输出文件存在立即退出</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-codec 指定编码格式，也可以仅指定音频或视频，如-codec:v指定视频编码格式，-codec:a指定音频编码格式</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-t 限制输入或者输出时间, 一般配合-ss使用，用来截取时间段的音视频。</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-to 指定结束时间点，一般配合-ss使用，用来截取某时间段的内容。</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-ss 设置开始时间，单位是秒</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-fiiter_complex 复合滤镜</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-vf 单一滤镜</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">视频：</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-r 设置帧数</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-s 设置输出尺寸（只能是偶数）</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-vn 禁止输出视频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-va 禁止输出音频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-codec:v 设置视频编码格式，等同-c:v</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-codec:a 设置音频编码格式，等同-c:a</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">音频：</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-ar 设置采样频率</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-ac 设置音频通道数</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-an 禁止输出音频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-sn 禁止输出字幕</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-ab 设置比特率</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//将管道里的图片制作成视频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -f image2pipe -framerate 24 -i pipe:.png -s 1600x900 -y -vcodec libopenh264 out.mp4</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//从视频里提取音频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -vn -ar 44100 -ab 128k -ac 2 out.ts</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -acodec copy -vn -y out.m4a</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//制作空音频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -f lavfi -i aevalsrc=0 -t 15 -q:a 9 -ar 44100 -ab 128k -ac 2 out.ts</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//连接视频或者音频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i "concat:0.ts|1.ts" -c copy out.ts </span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//混合音频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i 1.ts -i 2.ts -filter_complex"amix=inputs=2:duration=longest:dropout_transition=1" out.ts </span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//降低音频音量，比如降低50%</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg.exe -i a.mp3 -filter:a "volume=0.5" b.mp3</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//固定时间点截取一张图片</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -ss 4.500 -vframes 1 output.png</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//固定时间开始连续截图多张图片</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -ss 4.500 -vframes 10 output%d.png</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//视频每秒截一张图片，保存为png图片</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -vf fps=1 output%d.png</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//视频每10秒截一张图片，保存为jpeg图片</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -vf fps=0.1 output%d.jpg</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//视频每秒截十张图片，保存为bmp图片</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -vf fps=10 output%d.bmp</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//内嵌srt字幕</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -i input.srt -c copy -c:s mov_text output.mp4</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//媒体叠加</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input1 -i input2 -filter_complex overlay=x:y output</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">input1为背景输入源，input2为前景输入源。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">overlay为叠加滤镜：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> 描述：前景窗口(第二输入)覆盖在背景窗口(第一输入)的指定位置。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> 语法：overlay[=x:y[[:rgb={0, 1}]]</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> 参数 x 和 y 是可选的，默认为 0。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> 参数 rgb 参数也是可选的，其值为 0 或 1，默认为 0。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> 参数说明：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> x 从左上角的水平坐标，默认值为 0</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> y 从左上角的垂直坐标，默认值为 0</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> rgb 值为 0 表示输入颜色空间不改变，默认为 0；值为 1 表示将输入的颜色空间设置为 RGB</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> 变量说明：如下变量可用在 x 和 y 的表达式中</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> main_w 或 W 主输入(背景窗口)宽度</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> main_h 或 H 主输入(背景窗口)高度</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> overlay_w 或 w overlay 输入(前景窗口)宽度</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;"> overlay_h 或 h overlay 输入(前景窗口)高度</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//overlay应用示例：从左向右移动的入场动画</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i moving.jpg -vf color=c=green:s=720x1280[vbg];[vbg][0:v]overlay=x='if(lte(t,5),-w+(W+w)/2/5*t,(W-w)/2)':y=(H-h)/2 -t 5 -y move.mp4</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//运用delog滤镜去除logo,如果有多个delog用逗号分隔。 用delogo来做马赛克很不错。</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -t 10 -i input.mp4 -filter_complex "delogo=x=300:y=300:w=100:h=100" -c:v libx264 -crf 28 -preset veryfast -c:a copy -movflags +faststart output.mp4 -y</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">delog参数：</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">delogo=x:y:w:h[:t[:show]] </span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">x:y 离左上角的坐标 </span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">w:h logo的宽和高 </span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">band 或者 t: 矩形边缘的厚度，默认值4 </span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">show：若设置为1有一个绿色的矩形，默认值0。</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//合并视频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -f concat -safe 0 -i videoslist.txt -c copy output.mp4</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-safe 0 为了避免Operation not permitted.</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">videoslist.txt内容类似：</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">file '/path/to/file1'</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">file '/path/to/file2'</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//截取视频</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//从时间为00:00:15开始，截取5秒钟的视频。 </span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -ss 00:00:15.0 -t 00:00:05.0 -vcodec copy -acodec copy output.mp4 </span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-ss表示开始切割的时间，-t表示要切多少。上面就是从15秒开始，切5秒钟出来。</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">或者</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -ss 00:00:15.0 -c:v copy -c:a copy -to 00:00:20.0 output.mp4</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-to 表示截止到某个时间点为止</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-c:v copy 表示复制视频源的编码</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">-c:a copy 表示复制音频源的编码</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//降低视频码率，从而压缩视频体积</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -b:v 2000k -bufsize 2000k output.mp4</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">什么是码率？很简单： </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">bitrate = file size / duration </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">比如一个文件20.8M，时长1分钟，那么，码率就是： </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">biterate = 20.8M bit/60s = 20.8*1024*1024*8 bit/60s= 2841Kbps </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">一般音频的码率只有固定几种，比如是128Kbps， </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">那么，video的就是 </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">video biterate = 2841Kbps -128Kbps = 2713Kbps。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">那么ffmpeg如何控制码率。 </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpg控制码率有3种选择，-minrate -b:v -maxrate </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">-b:v主要是控制平均码率。 </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">比如一个视频源的码率太高了，有10Mbps，文件太大，想把文件弄小一点，但是又不破坏分辨率。 </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -b:v 2000k output.mp4 </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">上面把码率从原码率转成2Mbps码率，这样其实也间接让文件变小了。目测接近一半。 </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">不过，ffmpeg官方wiki比较建议，设置b:v时，同时加上 -bufsize </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">-bufsize 用于设置码率控制缓冲器的大小，设置的好处是，让整体的码率更趋近于希望的值，减少波动。（简单来说，比如1 2的平均值是1.5， 1.49 1.51 也是1.5, 当然是第二种比较好） </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -b:v 2000k -bufsize 2000k output.mp4</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">-minrate -maxrate就简单了，在线视频有时候，希望码率波动，不要超过一个阈值，可以设置maxrate。 </span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i input.mp4 -b:v 2000k -bufsize 2000k -maxrate 2500k output.mp4</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg.exe -i input.mkv -b:v 2000k -bufsize 2000k output.mkv</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//指定某几个时间段进行delogo</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg.exe -i input.mp4 -filter_complex "[0:v]crop=x=0:y=16:w=1080:h=38,delogo=x=0:y=0:w=1080:h=40[fg];[0:v][fg]overlay=0:16:enable='between(t,210,374) + between(t,1080,1244) + between(t, 2160, 2324)':eof_action=pass[v]" -map "[v]" -map 0:a -c:v libx264 -c:a copy -y "output.mp4"</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">注意overlay的enable参数，通过between选择符合需求的时间段，通过+(加号）进行“逻辑或”组合。</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">//根据不同时间调整delogo的位置</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg.exe -i "input.mp4" -filter_complex "[0:v]crop=x=0:y='if(between(t,2700,2721), 7, 16 )':w=1080:h=38,delogo=x=0:y=0:w=1080:h=40[fg];[0:v][fg]overlay=x=0:y='if(between(t,2700,2721), 7, 16 )':enable='between(t,210,386) + between(t,900,1076) + between(t, 1980, 2156) + between(t, 2700, 2721)':eof_action=pass[v]" -map "[v]" -map 0:a -c:v libx264 -c:a copy -y "output.mp4"</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">内置函数：</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">abs(x) 返回x的绝对值</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">acos(x) 计算x的反余弦</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">atan(x) 计算x的反正切</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">lte(x, y) 小于等于比较</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">lt(x, y) 小于比较</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">gte(x, y) 大于等于</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">gt(x, y) 大于比较</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">eq(x, y) 判断是否相等</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">floor(expr) 向下取整</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ceil(expr)向下取整</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">between(x, min, max) 判断min&lt;x&lt;max是否成立 成立返回1不成立返回0（*可以用来在视频的特定时间插入音频）</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">if(x, y) 判断x如果非0返回y否则返回0</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">if(x, y, z) 判断x如果非0返回y否则返回z</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ifnot(x, y)</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ifnot(x, y, z)</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">isinf(x) x是正无穷或者负无穷（+/-INFINITY），返回1</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">isnan(x) x是NAN,返回1</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">max(x,y) 返回x,y的最大值</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">min(x,y) 返回x，y的最小值</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">random(x) 返回0-1的随机数</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">mod(x, y) 取余</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">not(expr) expr 是零返回1</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">pow(x, y) x^y</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">round(expr) 四舍五入</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">* 星号相当于AND</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">+ 加号相当于OR</span></p> 
 <p style=""></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg滤镜的一些知识:</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">FFmpeg filter可以认为是一些预定义的范式，可以实现类似积木的多种功能的自由组合。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">每个filter都有固定数目的输入和输出，而且实际使用中不允许有空悬的输入输出端。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">使用文本描述时我们可以通过标识符指定输入和输出端口，将不同filter串联起来，构成更复杂的filter。这就形成了嵌套的filter。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">当然每个filter可以通过ffmpeg/ffplay命令行实现，但通常filter更方便。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg.exe、ffplay.exe能够通过filter处理原始的音视频数据。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg将filtergraph分为simple filtergraph和complex filtergraph。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">通常simple filtergraph只有一个输入和输出，ffmpeg命令行中使用-vf、-af识别，</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">complex filtergraph，通常是具有多个输入输出文件，并有多条执行路径；</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg命令行中使用-lavfi、-filter_complex，</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">在libavfilter, 一个filter可以包含多个输入、多个输出。</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;"><span class="kdocs-bold" style="font-weight:bold;">filterChain:</span></span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">filterchain的语法：filter1,filter2,...</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">它是多个filter的组合，以逗号分隔；并且每个filter是输入是前一个filter的输出；</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">例如：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i audio.aac -filter_complex "aresample=async=16000,adelay=316397,volume=1.0" -acodec libfdk_aac -y output.mp4</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">这里用到了三个filter，分别的aresample, adelay, volume, 组成一个filterchain.</span></p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:15pt;"><span class="kdocs-bold" style="font-weight:bold;">filterGraph:</span></span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">filtergraph的语法：filterchain1;filterchain2;...</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">它是多个filterchain的组合，以分号";"分隔，</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">例如：</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">ffmpeg -i INPUT -filter_complex "split [main][tmp]; [tmp] crop=iw:ih/2:0:0, vflip [flip]; [main][flip] overlay=0:H/2" OUTPUT</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">这里用到了三个filterchain, 分别是：</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">split [main][tmp]; // 它只有一个filter,即 split； 它有一个默认的输入，即INPUT解码后的frame;有两个输出, 以 [main], [tmp] 标识；</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">[tmp] crop=iw:ih/2:0:0, vflip [flip] // 它由两个filter组成，即crop和vflip；一个输入 [tmp]， 一个输出[flip]；</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:15pt;">[main][flip] overlay=0:H/2 // 它由一个filter组成，即overlay， 有两输入，分别是[main][flip], 一个默认的输出。</span></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/995bb4b5c84e2b5338336116fa897a95/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue基础</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9bc68d686ca8f43a3ed788405f157a0b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">夸克网盘的文件怎么保存到百度网盘？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>