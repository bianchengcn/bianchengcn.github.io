<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python程序打包成exe实现新版本的自动更新检测及下载 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python程序打包成exe实现新版本的自动更新检测及下载" />
<meta property="og:description" content="python使用pyinstaller打包成的exe程序，代码修改重新打包就需要重新发送一次程序，略微麻烦，通过服务器存储新版本打包后的程序，检测和下载通过代码实现。
本文通过FTP局域网服务器的形式完成，使用serv-u软件配置FTP服务器，配置方式可移步下方站内链接
Serv-U配置FTP服务器
使用designer画一个简单的ui，如下图
转成py文件如下，命名为 update_test_ui.py代码如下
# -*- coding: utf-8 -*- # Form implementation generated from reading ui file &#39;update_test.ui&#39; # # Created by: PyQt5 UI code generator 5.15.7 # # WARNING: Any manual changes made to this file will be lost when pyuic5 is # run again. Do not edit this file unless you know what you are doing. from PyQt5 import QtCore, QtGui, QtWidgets class Ui_MainTestUp(object): def setupUi(self, MainTestUp): MainTestUp." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ce3929143e4422b17fc96d07bfe21e12/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-07T15:38:32+08:00" />
<meta property="article:modified_time" content="2022-10-07T15:38:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python程序打包成exe实现新版本的自动更新检测及下载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>python使用pyinstaller打包成的exe程序，代码修改重新打包就需要重新发送一次程序，略微麻烦，通过服务器存储新版本打包后的程序，检测和下载通过代码实现。<br> 本文通过FTP局域网服务器的形式完成，使用serv-u软件配置FTP服务器，配置方式可移步下方站内链接<br> <a href="http://t.csdn.cn/TXsOf" rel="nofollow"><strong>Serv-U配置FTP服务器</strong></a><br> 使用<strong>designer</strong>画一个简单的ui，如下图<br> <img src="https://images2.imgbox.com/ea/b5/SfMjVTak_o.jpg" alt="在这里插入图片描述"><br> 转成py文件如下，命名为 <strong>update_test_ui.py</strong>代码如下</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token comment"># Form implementation generated from reading ui file 'update_test.ui'</span>
<span class="token comment">#</span>
<span class="token comment"># Created by: PyQt5 UI code generator 5.15.7</span>
<span class="token comment">#</span>
<span class="token comment"># WARNING: Any manual changes made to this file will be lost when pyuic5 is</span>
<span class="token comment"># run again.  Do not edit this file unless you know what you are doing.</span>


<span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtWidgets


<span class="token keyword">class</span> <span class="token class-name">Ui_MainTestUp</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">setupUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> MainTestUp<span class="token punctuation">)</span><span class="token punctuation">:</span>
        MainTestUp<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"MainTestUp"</span><span class="token punctuation">)</span>
        MainTestUp<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">603</span><span class="token punctuation">,</span> <span class="token number">378</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QWidget<span class="token punctuation">(</span>MainTestUp<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"centralwidget"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setBold<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>setWeight<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token string">"background-color: rgb(0, 255, 255);"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"pushButton"</span><span class="token punctuation">)</span>
        MainTestUp<span class="token punctuation">.</span>setCentralWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QMenuBar<span class="token punctuation">(</span>MainTestUp<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">603</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"menubar"</span><span class="token punctuation">)</span>
        MainTestUp<span class="token punctuation">.</span>setMenuBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menubar<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>statusbar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QStatusBar<span class="token punctuation">(</span>MainTestUp<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>statusbar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"statusbar"</span><span class="token punctuation">)</span>
        MainTestUp<span class="token punctuation">.</span>setStatusBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>statusbar<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>retranslateUi<span class="token punctuation">(</span>MainTestUp<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>MainTestUp<span class="token punctuation">.</span>close<span class="token punctuation">)</span> <span class="token comment"># type: ignore</span>
        QtCore<span class="token punctuation">.</span>QMetaObject<span class="token punctuation">.</span>connectSlotsByName<span class="token punctuation">(</span>MainTestUp<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">retranslateUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> MainTestUp<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _translate <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QCoreApplication<span class="token punctuation">.</span>translate
        MainTestUp<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainTestUp"</span><span class="token punctuation">,</span> <span class="token string">"软件自升级测试"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainTestUp"</span><span class="token punctuation">,</span> <span class="token string">"确定"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>定义一个<strong>main.py</strong>调用ui的py文件，并添加版本检测、FTP的服务器登录和文件下载功能，代码如下</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>Qt <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> os
<span class="token keyword">import</span> socket
<span class="token keyword">from</span> ftplib <span class="token keyword">import</span> FTP
<span class="token keyword">import</span> update_test_ui


<span class="token keyword">class</span> <span class="token class-name">UpdateTest</span><span class="token punctuation">(</span>update_test_ui<span class="token punctuation">.</span>Ui_MainTestUp<span class="token punctuation">,</span> QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>update_test_ui<span class="token punctuation">.</span>Ui_MainTestUp<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>current_version <span class="token operator">=</span> <span class="token string">'v2'</span>
        <span class="token comment"># 承接服务器的文件名称</span>
        self<span class="token punctuation">.</span>remote_name <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment"># 承接远程服务器文件路径</span>
        self<span class="token punctuation">.</span>remote_path <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment"># 当前exe程序地址</span>
        <span class="token comment"># self.local_folder = os.path.abspath(os.path.dirname(__file__))</span>
        <span class="token comment"># 运行第一步检查是否要更新</span>
        self<span class="token punctuation">.</span>first_step<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">first_step</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 登录FTP</span>
            self<span class="token punctuation">.</span>my_ftp <span class="token operator">=</span> self<span class="token punctuation">.</span>login_ftp<span class="token punctuation">(</span><span class="token string">"sq"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>my_ftp<span class="token punctuation">.</span>welcome<span class="token punctuation">)</span>
            <span class="token comment"># 服务器文件目录</span>
            self<span class="token punctuation">.</span>remote_path <span class="token operator">=</span> self<span class="token punctuation">.</span>getfile<span class="token punctuation">(</span><span class="token string">"/suite"</span><span class="token punctuation">)</span>
            <span class="token comment"># 服务器文件名称</span>
            self<span class="token punctuation">.</span>remote_name <span class="token operator">=</span> self<span class="token punctuation">.</span>remote_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment"># 服务器文件版本（设置服务器文件名称格式示例：软件名称_v1.exe）</span>
            remote_version <span class="token operator">=</span> self<span class="token punctuation">.</span>remote_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token comment"># 判断服务器软件版本是否与本地版本一致</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>current_version <span class="token operator">!=</span> remote_version<span class="token punctuation">:</span>
                <span class="token comment"># 本地路径，程序所在文件夹的上一级目录</span>
                local_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"../."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 拼接一个本地路径的文件</span>
                local_file <span class="token operator">=</span> local_path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>remote_name
                <span class="token comment"># 如果服务器文件还未下载</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>local_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># 本地文件目录全地址</span>
                    local_full <span class="token operator">=</span> local_path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>remote_name
                    <span class="token comment"># 执行下载</span>
                    self<span class="token punctuation">.</span>download_file<span class="token punctuation">(</span>local_full<span class="token punctuation">,</span> self<span class="token punctuation">.</span>remote_path<span class="token punctuation">)</span>
                    QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token string">"最新版软件已下载，请在上一级目录安装使用"</span><span class="token punctuation">)</span>
                <span class="token comment"># 服务器文件已下载</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 本地已存在，请在上一级目录安装使用最新版软件</span>
                    QMessageBox<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token string">"请在上一级目录安装使用最新版软件"</span><span class="token punctuation">)</span>
                <span class="token comment"># 设置下一步按钮不可操作，可强制使其使用新版本软件</span>
                self<span class="token punctuation">.</span>pushButton<span class="token punctuation">.</span>setEnabled<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">pass</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

    <span class="token comment"># 登录FTP服务器</span>
    <span class="token keyword">def</span> <span class="token function">login_ftp</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            timeout <span class="token operator">=</span> <span class="token number">60</span>
            socket<span class="token punctuation">.</span>setdefaulttimeout<span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
            ftp <span class="token operator">=</span> FTP<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 0主动模式 1 #被动模式</span>
            ftp<span class="token punctuation">.</span>set_pasv<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            host <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
            port <span class="token operator">=</span> <span class="token number">21</span>
            ftp<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>  <span class="token comment"># 'gbk'</span>
            ftp<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
            ftp<span class="token punctuation">.</span>login<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
            <span class="token keyword">return</span> ftp
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

    <span class="token comment"># 获得FTP目录及子目录下的文件名称</span>
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_file_name</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
        names <span class="token operator">=</span> f<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">''</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            file_names <span class="token operator">=</span> names<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            res <span class="token operator">=</span> <span class="token string">''</span>
            <span class="token keyword">for</span> name <span class="token keyword">in</span> file_names<span class="token punctuation">:</span>
                res <span class="token operator">=</span> res <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">''</span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获得FTP目录及子目录下的文件</span>
    <span class="token keyword">def</span> <span class="token function">getfile</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>my_ftp<span class="token punctuation">.</span>cwd<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        file_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>my_ftp<span class="token punctuation">.</span>retrlines<span class="token punctuation">(</span><span class="token string">"LIST"</span><span class="token punctuation">,</span> file_list<span class="token punctuation">.</span>append<span class="token punctuation">)</span>
        <span class="token keyword">for</span> f <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
            <span class="token keyword">if</span> f<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                file_name <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file_name<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                <span class="token keyword">if</span> file_name <span class="token operator">==</span> <span class="token string">'.'</span> <span class="token keyword">or</span> file_name <span class="token operator">==</span> <span class="token string">'..'</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                path_a <span class="token operator">=</span> self<span class="token punctuation">.</span>my_ftp<span class="token punctuation">.</span>pwd<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                self<span class="token punctuation">.</span>getfile<span class="token punctuation">(</span>path_a<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>my_ftp<span class="token punctuation">.</span>cwd<span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
                    <span class="token comment"># 得到文件名，并按照指定语句输出</span>
                    a <span class="token operator">=</span> self<span class="token punctuation">.</span>my_ftp<span class="token punctuation">.</span>pwd<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                    <span class="token keyword">return</span> a

    <span class="token comment"># 判断本地是否已经存在相同文件</span>
    <span class="token keyword">def</span> <span class="token function">is_same_size</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> local_file<span class="token punctuation">,</span> remote_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            remote_file_size <span class="token operator">=</span> self<span class="token punctuation">.</span>my_ftp<span class="token punctuation">.</span>size<span class="token punctuation">(</span>remote_file<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            remote_file_size <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            local_file_size <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span>local_file<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            local_file_size <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">if</span> remote_file_size <span class="token operator">==</span> local_file_size<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">download_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> local_file<span class="token punctuation">,</span> remote_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_same_size<span class="token punctuation">(</span>local_file<span class="token punctuation">,</span> remote_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                buf_size <span class="token operator">=</span> <span class="token number">1024</span>
                file_handler <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>local_file<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>my_ftp<span class="token punctuation">.</span>retrbinary<span class="token punctuation">(</span><span class="token string">'RETR %s'</span> <span class="token operator">%</span> remote_file<span class="token punctuation">,</span> file_handler<span class="token punctuation">.</span>write<span class="token punctuation">,</span> buf_size<span class="token punctuation">)</span>
                file_handler<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
                <span class="token keyword">return</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ui <span class="token operator">=</span> UpdateTest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ui<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>代码还未完全实现自动化，站内有通过.bat进行自动化下载及安装的，对.bat文件的运行规则不懂，尝试未成功，文中的方法还需一步处理才能使用新版软件，且该方法让<strong>确定</strong>按钮不可点击，必须更新才可使用，若有大佬有更厉害的更加自动化的方法，请留下脚步。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b416c59ae15c0483aae4cdb8a9c9cb49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mybatis_plus使用过程中NoSuchBeanDefinitionException，大概率是因为不能扫描到mapper文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/74b1f85ce46ec888a8f025eda979f4fa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Linux】一步一步教你编写单目录和多目录Makefile</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>