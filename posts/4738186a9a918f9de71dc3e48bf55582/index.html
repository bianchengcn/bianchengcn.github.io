<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序踩坑记录  -------  微信小程序如何开发常见的拉起外部地图软件进行导航的功能 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信小程序踩坑记录  -------  微信小程序如何开发常见的拉起外部地图软件进行导航的功能" />
<meta property="og:description" content="最近在做一个项目，需要开发大家在手机上经常用到的地图导航，主要实现功能有三点：
一、在地址旁加一个按钮可以点击拉起微信内置地图
二、点击地图内的导航按钮可以跳转到想要的地图软件进行操作，如：高德、腾讯、苹果内置
其实第二步，微信已经全部封装好了，不需要我们多去操心。我们只需要做好如下几点就可以了：
一、使用小程序内置方法拉起微信内置地图
二、使用腾讯的微信小程序 JavaScript SDK 进行地址名称 ==&gt; 经纬度 的转换
三、使用微信内置API传递获取到的坐标值，使拉起导航能够正常使用
具体实现之后的效果如下所示：
代码如下所示： WXML &lt;image src=&#34;{{imgCommon}}addr.png&#34; class=&#34;addr-image&#34; bindtap=&#34;mapNavigation&#34; data-addr=&#34;{{classdata.address}}&#34;&gt;&lt;/image&gt; 其中 bindtap 中设置的是点击之后js中的方法名，这个大家都知道；重点是 data-addr 中的参数，这个参数的值是我们最终想要导航到的地址名，比如 北京市海淀区清河五彩城，我这里的代码这个必须设置，不然我们最终实现的效果会出现，导航没有目的地。那这导航做的就没有意义了。
js // 引入SDK核心类 var QQMapWX = require(&#39;../../utils/qqmap-wx-jssdk.min.js&#39;) var qqmapsdk; page({ data: { } // 点击按钮触发方法 mapNavigation: function (e) { console.log(e.target.dataset.addr); var addr = e.target.dataset.addr; var that = this; // 使用 JavaScript SDK 获取目的地经纬度 // 实例化API核心类 qqmapsdk = new QQMapWX({ key: &#39;申请的腾讯地图key值&#39; }); qqmapsdk." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/4738186a9a918f9de71dc3e48bf55582/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-11-13T23:11:50+08:00" />
<meta property="article:modified_time" content="2018-11-13T23:11:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序踩坑记录  -------  微信小程序如何开发常见的拉起外部地图软件进行导航的功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近在做一个项目，需要开发大家在手机上经常用到的地图导航，主要实现功能有三点：<br> 一、在地址旁加一个按钮可以点击拉起微信内置地图<br> 二、点击地图内的导航按钮可以跳转到想要的地图软件进行操作，如：高德、腾讯、苹果内置</p> 
<p>其实第二步，微信已经全部封装好了，不需要我们多去操心。我们只需要做好如下几点就可以了：</p> 
<p>一、使用小程序内置方法拉起微信内置地图<br> 二、使用腾讯的微信小程序 JavaScript SDK 进行地址名称 ==&gt; 经纬度 的转换<br> 三、使用微信内置API传递获取到的坐标值，使拉起导航能够正常使用</p> 
<p><img src="https://images2.imgbox.com/4c/5c/4IEi0au1_o.jpg" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>具体实现之后的效果如下所示：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b0/29/edPBsN8z_o.gif" alt="在这里插入图片描述"></p> 
<h5><a id="_15"></a>代码如下所示：</h5> 
<h6><a id="WXML_16"></a>WXML</h6> 
<pre><code>&lt;image src="{<!-- -->{imgCommon}}addr.png" class="addr-image" bindtap="mapNavigation" data-addr="{<!-- -->{classdata.address}}"&gt;&lt;/image&gt;
</code></pre> 
<p>其中 <code>bindtap</code> 中设置的是点击之后js中的方法名，这个大家都知道；重点是 <code>data-addr</code> 中的参数，这个参数的值是我们最终想要导航到的地址名，比如 北京市海淀区清河五彩城，我这里的代码这个必须设置，不然我们最终实现的效果会出现，导航没有目的地。那这导航做的就没有意义了。</p> 
<h6><a id="js_21"></a>js</h6> 
<pre><code>// 引入SDK核心类
var QQMapWX = require('../../utils/qqmap-wx-jssdk.min.js')
var qqmapsdk;
page({
	data: {
	
	}
	// 点击按钮触发方法
	mapNavigation: function (e) {
	    console.log(e.target.dataset.addr);
	    var addr = e.target.dataset.addr;
	    var that = this;
	    // 使用 JavaScript SDK 获取目的地经纬度
	    // 实例化API核心类
	    qqmapsdk = new QQMapWX({
	        key: '申请的腾讯地图key值'
	    });
	    qqmapsdk.geocoder({
	        address: addr,
	        success: function (res) {
	            console.log(res);
	            var local = res.result.location;
	            that.setData({
	                latitude: local.lat,
	                longitude: local.lng
	            })
	        }
	    })
	    // 使用微信内置地图查看位置
	    wx.getLocation({
	        type: 'gcj02', //返回可以用于wx.openLocation的经纬度
	        success: function (res) {
	            wx.openLocation({
	                latitude: that.data.latitude,
	                longitude: that.data.longitude,
	                scale: 28,
	                name: addr, //打开后显示的地址名称
	            })
	        }
	    })
	},
})
</code></pre> 
<p>上面的是js的整体代码，为了能够更方便的讲解各个方法，我在这里将所有方法，都拆解开来，没有进行嵌套，看上去还是蛮简单易懂的。<br> 下面我一一介绍代码的功能以及需要注意的事项。</p> 
<h6><a id="1__JavaScript_SDK_68"></a>1、引入腾讯地图的 微信小程序 JavaScript SDK</h6> 
<pre><code>// 引入SDK核心类
var QQMapWX = require('../../utils/qqmap-wx-jssdk.min.js')
var qqmapsdk;
</code></pre> 
<blockquote> 
 <p>这里我们想要调用 SDK，需要进行如下操作：</p> 
</blockquote> 
<ul><li>下载微信小程序 JavaScriptSDK 文件，这里我直接给一个官方的下载直通车 <a href="http://3gimg.qq.com/lightmap/xcx/jssdk/qqmap-wx-jssdk1.0.zip" rel="nofollow">微信小程序JavaScriptSDK v1.0</a></li><li>进入小程序的后台，在“设置” -&gt; “开发设置”中设置 request 合法域名，添加腾讯地图的https://apis.map.qq.com 这个域名， 点击 <a href="https://mp.weixin.qq.com" rel="nofollow">小程序登录窗口</a> 输入自己正在开发相关功能的小程序账密，进行相关设置。</li></ul> 
<h6><a id="2WXMLSDK_78"></a>2、获取从WXML中传过来的导航终点地址，并使用第一步引入的SDK获取到相应的经纬度</h6> 
<pre><code>var addr = e.target.dataset.addr; //获取目的地 地址名
var that = this;
// 实例化API核心类
qqmapsdk = new QQMapWX({
    key: '申请的腾讯地图key值'
});
// 使用 JavaScript SDK 获取目的地经纬度
qqmapsdk.geocoder({
    address: addr,
    success: function (res) {
        console.log(res);
        var local = res.result.location;
        that.setData({
            latitude: local.lat,
            longitude: local.lng
        })
    }
})
</code></pre> 
<blockquote> 
 <p>这一段代码想要能够正常运行，需要进行如下操作：</p> 
</blockquote> 
<ul><li>申请腾讯地图的开发者秘钥（key），可以点击 <a href="https://lbs.qq.com/console/key.html" rel="nofollow">申请腾讯地图开发者密钥</a>，直接跳转到相应页面。</li></ul> 
<h6><a id="3_API__101"></a>3、使用小程序的内置 API 进行内置地图展示及参数传递，使后续拉起的导航能够正常使用</h6> 
<pre><code>// 使用微信内置地图查看位置
wx.getLocation({
    type: 'gcj02', //返回可以用于wx.openLocation的经纬度
    success: function (res) {
        wx.openLocation({
        	// 上述方法 2 中获取到的经纬度
            latitude: that.data.latitude,
            longitude: that.data.longitude,
            scale: 28,
            name: addr,  // 打开后显示的从WXML中传过来的地址名称
        })
    }
})
</code></pre> 
<blockquote> 
 <p>最终的拉起外部地图软件的方法，微信小程序已经内置好了，不需要我们做过多的操作。到这里，关于拉起外部导航的所有开发步骤、代码以及一些需要注意的地方和相关的设置都已经讲述完毕，如果哪里有疑问，或者我的代码哪里写的有问题，欢迎在评论中留言指正，咱们互相探讨。</p> 
</blockquote> 
<p>上述所有代码中涉及到的方法，如果有参数不知道是干什么的，或者想要让功能更加健壮，可以参考如下两个文档：</p> 
<blockquote> 
 <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.openLocation.html" rel="nofollow">微信小程序开发文档 —— 位置 =&gt; wx.openLocation</a><br> <a href="https://lbs.qq.com/qqmap_wx_jssdk/index.html" rel="nofollow">腾讯地图 微信小程序 JavaScript SDK 开发文档</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/819404548f00b097dc631067bcb7ac17/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">多线程-线程休眠（sleep）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/def2d82d04f0eb3f4f13d3940d60200d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">优先队列（C&#43;&#43;自实现）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>