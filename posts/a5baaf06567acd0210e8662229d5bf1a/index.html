<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CocosCreator2.x 开发笔记 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CocosCreator2.x 开发笔记" />
<meta property="og:description" content="笔记目录 一. 组件相关1. Canvas 组件1.1 画布透明 2. Label 组件2.1 截屏时字体有黑边2.2 动态改变字体颜色2.3 动态获取文字高度2.4 通过脚本添加 Label 3. Widget (对齐挂件)3.1 使用方法 4. BlockInputEvents 防止事件穿透4.1 使用方法 5. ScrollView 组件5.1 滚动到顶部5.2 规定时间内滚动指定百分比位置上 6. WebView 组件6.1 url改变后的适配问题 7. Sprite 组件7.1 图片置灰7.1.1 置灰显示7.1.2 代码控制参考链接 二. 常用方法1. 加载微信头像2. 开发环境判断3. 游戏全局变量4. 从父节点中删除该节点5. 转化局部坐标系、获取包围盒、判断某个区域是否包含指定坐标点6. 克隆clone节点7. 获取屏幕尺寸8. 打开网址9. 上传base64数据到oss参考链接 三. 使用技巧1. 自定义loading样式2. 字体制作的公共字符集3. 获取地址参数函数4. 上下滑动事件5. 随机函数6. 像素间隔Bug7. 远程打包8. 接口请求超时处理9. CNZZ事件统计10. 创建一个连续数字的数组 一. 组件相关 1. Canvas 组件 1.1 画布透明 场景描述
设置画布透明。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/a5baaf06567acd0210e8662229d5bf1a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-09T17:17:39+08:00" />
<meta property="article:modified_time" content="2023-01-09T17:17:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CocosCreator2.x 开发笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>笔记目录</h4> 
 <ul><li><a href="#__1" rel="nofollow">一. 组件相关</a></li><li><ul><li><a href="#1_Canvas__2" rel="nofollow">1. Canvas 组件</a></li><li><ul><li><a href="#11___3" rel="nofollow">1.1 画布透明</a></li></ul> 
   </li><li><a href="#2_Label__12" rel="nofollow">2. Label 组件</a></li><li><ul><li><a href="#21__13" rel="nofollow">2.1 截屏时字体有黑边</a></li><li><a href="#22__22" rel="nofollow">2.2 动态改变字体颜色</a></li><li><a href="#23__26" rel="nofollow">2.3 动态获取文字高度</a></li><li><a href="#24__Label_33" rel="nofollow">2.4 通过脚本添加 Label</a></li></ul> 
   </li><li><a href="#3_Widget__46" rel="nofollow">3. Widget (对齐挂件)</a></li><li><ul><li><a href="#31__47" rel="nofollow">3.1 使用方法</a></li></ul> 
   </li><li><a href="#4_BlockInputEvents__50" rel="nofollow">4. BlockInputEvents 防止事件穿透</a></li><li><ul><li><a href="#41__51" rel="nofollow">4.1 使用方法</a></li></ul> 
   </li><li><a href="#5_ScrollView__54" rel="nofollow">5. ScrollView 组件</a></li><li><ul><li><a href="#51__55" rel="nofollow">5.1 滚动到顶部</a></li><li><a href="#52__59" rel="nofollow">5.2 规定时间内滚动指定百分比位置上</a></li></ul> 
   </li><li><a href="#6_WebView__66" rel="nofollow">6. WebView 组件</a></li><li><ul><li><a href="#61_url_67" rel="nofollow">6.1 url改变后的适配问题</a></li></ul> 
   </li><li><a href="#7_Sprite__79" rel="nofollow">7. Sprite 组件</a></li><li><ul><li><a href="#71__80" rel="nofollow">7.1 图片置灰</a></li><li><ul><li><a href="#711__82" rel="nofollow">7.1.1 置灰显示</a></li><li><a href="#712__84" rel="nofollow">7.1.2 代码控制</a></li><li><a href="#_100" rel="nofollow">参考链接</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#__103" rel="nofollow">二. 常用方法</a></li><li><ul><li><a href="#1__104" rel="nofollow">1. 加载微信头像</a></li><li><a href="#2__117" rel="nofollow">2. 开发环境判断</a></li><li><a href="#3__125" rel="nofollow">3. 游戏全局变量</a></li><li><a href="#4__139" rel="nofollow">4. 从父节点中删除该节点</a></li><li><a href="#5__143" rel="nofollow">5. 转化局部坐标系、获取包围盒、判断某个区域是否包含指定坐标点</a></li><li><a href="#6_clone_149" rel="nofollow">6. 克隆clone节点</a></li><li><a href="#7__155" rel="nofollow">7. 获取屏幕尺寸</a></li><li><a href="#8__165" rel="nofollow">8. 打开网址</a></li><li><a href="#9_base64oss_170" rel="nofollow">9. 上传base64数据到oss</a></li><li><ul><li><a href="#_236" rel="nofollow">参考链接</a></li></ul> 
  </li></ul> 
  </li><li><a href="#__239" rel="nofollow">三. 使用技巧</a></li><li><ul><li><a href="#1_loading_240" rel="nofollow">1. 自定义loading样式</a></li><li><a href="#2__329" rel="nofollow">2. 字体制作的公共字符集</a></li><li><a href="#3__335" rel="nofollow">3. 获取地址参数函数</a></li><li><a href="#4__345" rel="nofollow">4. 上下滑动事件</a></li><li><a href="#5__359" rel="nofollow">5. 随机函数</a></li><li><a href="#6_Bug_372" rel="nofollow">6. 像素间隔Bug</a></li><li><a href="#7__380" rel="nofollow">7. 远程打包</a></li><li><a href="#8__447" rel="nofollow">8. 接口请求超时处理</a></li><li><a href="#9_CNZZ_479" rel="nofollow">9. CNZZ事件统计</a></li><li><a href="#10__484" rel="nofollow">10. 创建一个连续数字的数组</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="__1"></a>一. 组件相关</h2> 
<h3><a id="1_Canvas__2"></a>1. Canvas 组件</h3> 
<h4><a id="11___3"></a>1.1 画布透明</h4> 
<p><strong>场景描述</strong><br>   设置画布透明。<br> <strong>解决方法</strong><br>   开启宏，并且设置Camera的alpha为0。</p> 
<pre><code class="prism language-javascript">cc<span class="token punctuation">.</span>macro<span class="token punctuation">.</span><span class="token constant">ENABLE_TRANSPARENT_CANVAS</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/ea/PPuo911g_o.png" alt="在这里插入图片描述" width="300"></p> 
<h3><a id="2_Label__12"></a>2. Label 组件</h3> 
<h4><a id="21__13"></a>2.1 截屏时字体有黑边</h4> 
<p><strong>场景描述</strong><br>   海报生成类H5，截屏时 label 字体有黑边。<br> <strong>解决方法</strong><br>   把Label组件的 Src Blend Factior 设为 预乘处理 ONE<br> <img src="https://images2.imgbox.com/e2/e8/B0gSrLM8_o.png" alt="在这里插入图片描述" width="300"><br> <strong>参考链接</strong><br>   <a href="https://forum.cocos.org/t/2-0-0-b7/63327" rel="nofollow">2.0.0 b7 字体有黑边</a></p> 
<h4><a id="22__22"></a>2.2 动态改变字体颜色</h4> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>labelTip<span class="token punctuation">.</span>node<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">cc<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="23__26"></a>2.3 动态获取文字高度</h4> 
<p>Label 组件 overflow 设置为 resize_height 属性之后，动态获取文字高度，以便初始化 ScrollView 的 content高度。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>labelResult<span class="token punctuation">.</span>string <span class="token operator">=</span> <span class="token string">'xxx'</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>labelResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_forceUpdateRenderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>labelResult<span class="token punctuation">.</span>node<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="24__Label_33"></a>2.4 通过脚本添加 Label</h4> 
<pre><code class="prism language-javascript"><span class="token comment">// 游戏加分动效</span>
<span class="token keyword">let</span> labelScore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">cc<span class="token punctuation">.</span>Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
labelScore<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">cc<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
labelScore<span class="token punctuation">.</span><span class="token function">addComponent</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>Label<span class="token punctuation">)</span><span class="token punctuation">;</span>
labelScore<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>Label<span class="token punctuation">)</span><span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span>
labelScore<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>Label<span class="token punctuation">)</span><span class="token punctuation">.</span>string <span class="token operator">=</span> <span class="token string">'+'</span> <span class="token operator">+</span> score<span class="token punctuation">;</span>
labelScore<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'score'</span><span class="token punctuation">;</span>
labelScore<span class="token punctuation">.</span>parent <span class="token operator">=</span> scoreLayer<span class="token punctuation">;</span>
labelScore<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3_Widget__46"></a>3. Widget (对齐挂件)</h3> 
<h4><a id="31__47"></a>3.1 使用方法</h4> 
<p>通过 Widget (对齐挂件) 组件使元素固定在相当于屏幕的某个位置，注意<mark>target属性设置要为canvas</mark>。<br> <img src="https://images2.imgbox.com/f2/7d/eL3LIs43_o.png" alt="在这里插入图片描述" width="300"></p> 
<h3><a id="4_BlockInputEvents__50"></a>4. BlockInputEvents 防止事件穿透</h3> 
<h4><a id="41__51"></a>4.1 使用方法</h4> 
<p>在上层UI背景添加 BlockInputEvents 组件 防止事件穿透。<br> <img src="https://images2.imgbox.com/08/ef/z94EwJkE_o.png" alt="在这里插入图片描述" width="300"></p> 
<h3><a id="5_ScrollView__54"></a>5. ScrollView 组件</h3> 
<h4><a id="51__55"></a>5.1 滚动到顶部</h4> 
<pre><code class="prism language-javascript">scrollView<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>ScrollView<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollToTop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="52__59"></a>5.2 规定时间内滚动指定百分比位置上</h4> 
<pre><code class="prism language-javascript">scrollView<span class="token punctuation">.</span><span class="token function">scrollToPercentHorizontal</span><span class="token punctuation">(</span><span class="token number">0.22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scrollView<span class="token punctuation">.</span><span class="token function">scrollToPercentHorizontal</span><span class="token punctuation">(</span><span class="token number">0.22</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

scrollView<span class="token punctuation">.</span><span class="token function">scrollToPercentVertical</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="6_WebView__66"></a>6. WebView 组件</h3> 
<h4><a id="61_url_67"></a>6.1 url改变后的适配问题</h4> 
<p>WebView改变url后，iPhone底部出现导航栏，尺寸改变，出现顶部显示不全的适配问题。</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 改变 webview url</span>
WebView<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">'http://xxx'</span><span class="token punctuation">;</span>

<span class="token comment">// 监听屏幕尺寸改变，重新做顶部适配</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> adaptHeight <span class="token operator">=</span> <span class="token number">1514</span> <span class="token operator">-</span> <span class="token number">750</span> <span class="token operator">*</span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pageGroup<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span> adaptHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="7_Sprite__79"></a>7. Sprite 组件</h3> 
<h4><a id="71__80"></a>7.1 图片置灰</h4> 
<p>将彩色图片以黑白图片切换显示。</p> 
<h5><a id="711__82"></a>7.1.1 置灰显示</h5> 
<p>Sprite 的 Materials 属性默认为 builtin-2d-sprite.mtl，内置灰色Material为 builtin-2d-gray-sprite.mtl，把其拖到Sprite 插槽即可把图片置灰。<img src="https://images2.imgbox.com/db/d2/OZYqLiKj_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="712__84"></a>7.1.2 代码控制</h5> 
<pre><code class="prism language-typescript"><span class="token comment">// 图片节点</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>Sprite<span class="token punctuation">)</span> 
card<span class="token operator">:</span> cc<span class="token punctuation">.</span>Sprite <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token comment">// 材质数组：0=builtin-2d-sprite.mtl;1=builtin-2d-gray-sprite.mtl;</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">[</span>cc<span class="token punctuation">.</span>Material<span class="token punctuation">]</span><span class="token punctuation">)</span> 
cardMatArray<span class="token operator">:</span> cc<span class="token punctuation">.</span>Material<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 根据代码逻辑，为图片设置材质</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>gray <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>card<span class="token punctuation">.</span><span class="token function">setMaterial</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cardMatArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>card<span class="token punctuation">.</span><span class="token function">setMaterial</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cardMatArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_100"></a>参考链接</h5> 
<p><a href="https://blog.csdn.net/qq_43287088/article/details/109303175">CocosCreator 图片置灰(Material/按钮/图片/Spine)</a></p> 
<h2><a id="__103"></a>二. 常用方法</h2> 
<h3><a id="1__104"></a>1. 加载微信头像</h3> 
<p><strong>场景描述</strong><br>   H5生成海报，加载用户微信头像及昵称。<br> <strong>解决方法</strong><br>   使用cc.assetManager.loadRemote加载远程贴图资源。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> headimgurl <span class="token operator">=</span> <span class="token string">'https://thirdwx.qlogo.cn/xxx'</span><span class="token punctuation">;</span>
cc<span class="token punctuation">.</span>assetManager<span class="token punctuation">.</span>loadRemote<span class="token operator">&lt;</span>cc<span class="token punctuation">.</span>Texture2D<span class="token operator">&gt;</span><span class="token punctuation">(</span>headimgurl<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">'.png'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> <span class="token literal-property property">texture</span><span class="token operator">:</span> cc<span class="token punctuation">.</span>Texture2D</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Use texture to create sprite frame</span>
    <span class="token keyword">let</span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">cc<span class="token punctuation">.</span>SpriteFrame</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>itemHead<span class="token punctuation">.</span>spriteFrame <span class="token operator">=</span> sf<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2__117"></a>2. 开发环境判断</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CC_DEBUG</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'release'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3__125"></a>3. 游戏全局变量</h3> 
<p>通过 window[‘game’] 设置游戏的全局变量，注意在 onLoad() 里赋值</p> 
<pre><code class="prism language-javascript">@property <span class="token comment">// 关卡数据</span>
levelInfo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    window<span class="token punctuation">[</span><span class="token string">'gameData'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>levelInfo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4__139"></a>4. 从父节点中删除该节点</h3> 
<pre><code class="prism language-javascript">node<span class="token punctuation">.</span><span class="token function">removeFromParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="5__143"></a>5. 转化局部坐标系、获取包围盒、判断某个区域是否包含指定坐标点</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> p_start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodeParent<span class="token punctuation">.</span><span class="token function">convertToNodeSpaceAR</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// convertToNodeSpace 将一个点转换到节点 (局部) 坐标系，并加上锚点的坐标。</span>
<span class="token keyword">let</span> rect_block <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBoundingBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// getBoundingBox 返回父节坐标系下的轴向对齐的包围盒。</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>rect_block<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>p_start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">// contains 当前矩形是否包含指定坐标点。</span>
</code></pre> 
<h3><a id="6_clone_149"></a>6. 克隆clone节点</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> node <span class="token operator">=</span> cc<span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span>parent <span class="token operator">=</span> scene<span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="7__155"></a>7. 获取屏幕尺寸</h3> 
<pre><code class="prism language-javascript"><span class="token comment">// 返回视图的设计分辨率（开发分辨率），如：750*1514</span>
cc<span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">getDesignResolutionSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width
cc<span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">getDesignResolutionSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height

<span class="token comment">// 返回可见区域尺寸，如：750*1334</span>
cc<span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">getVisibleSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width
cc<span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">getVisibleSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height
</code></pre> 
<h3><a id="8__165"></a>8. 打开网址</h3> 
<pre><code class="prism language-javascript">cc<span class="token punctuation">.</span>sys<span class="token punctuation">.</span><span class="token function">openURL</span><span class="token punctuation">(</span><span class="token string">'http://www'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="9_base64oss_170"></a>9. 上传base64数据到oss</h3> 
<p>屏幕截图后，将base64数据上传至oss，并返回图片链接。<br> 需引用sdk<br> <code>&lt;script src="http://gosspublic.alicdn.com/aliyun-oss-sdk-4.4.4.min.js"&gt;&lt;/script&gt;</code></p> 
<pre><code class="prism language-ts"><span class="token comment">/**
 * 截图函数
 */</span>
<span class="token function">screenShot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token operator">...</span>
	<span class="token keyword">const</span> dataURL <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">"image/jpeg"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">uploadToOss</span><span class="token punctuation">(</span>dataURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * base64转blob
 */</span>
<span class="token function">toBlob</span><span class="token punctuation">(</span>urlData<span class="token punctuation">,</span> fileType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> bytes <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span>urlData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> n <span class="token operator">=</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">let</span> u8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        u8arr<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>u8arr<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> type<span class="token operator">:</span> fileType <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/** 
 * 上传base64到oss
 * urlData: 图像数据 (data:image/png;base64,iVBOR...yssDuN70DiAAAAABJRU5ErkJggg==)
 */</span>
<span class="token function">uploadToOss</span><span class="token punctuation">(</span>urlData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    
    <span class="token comment">// 图像数据</span>
    <span class="token keyword">const</span> base64 <span class="token operator">=</span> urlData<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fileType <span class="token operator">=</span> urlData<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// base64转blob</span>
    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> fileType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// blob转arrayBuffer</span>
    <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 配置OSS</span>
        <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">OSS</span></span><span class="token punctuation">.</span><span class="token function">Wrapper</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            region<span class="token operator">:</span> <span class="token string">'&lt;Your region&gt;'</span><span class="token punctuation">,</span>
            accessKeyId<span class="token operator">:</span> <span class="token string">'&lt;Your AccessKeyId&gt;'</span><span class="token punctuation">,</span>
            accessKeySecret<span class="token operator">:</span> <span class="token string">'&lt;Your AccessKeySecret&gt;'</span><span class="token punctuation">,</span>
            bucket<span class="token operator">:</span> <span class="token string">'Your bucket name'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 路径</span>
        <span class="token keyword">const</span> dirname <span class="token operator">=</span> <span class="token string">'xxx/upload/'</span>
        <span class="token comment">// 文件名</span>
        <span class="token keyword">const</span> objectKey <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>fileType<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token comment">// arrayBuffer转Buffer</span>
        <span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">OSS</span></span><span class="token punctuation">.</span><span class="token function">Buffer</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 上传</span>
        client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>dirname <span class="token operator">+</span> objectKey<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// console.log(result);</span>
            self<span class="token punctuation">.</span>uploadImg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://xxx/upload/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>objectKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>            
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_236"></a>参考链接</h4> 
<p><a href="https://www.jianshu.com/p/eaba1f2afa70" rel="nofollow">base64数据流、blob对象上传OSS</a></p> 
<h2><a id="__239"></a>三. 使用技巧</h2> 
<h3><a id="1_loading_240"></a>1. 自定义loading样式</h3> 
<p><strong>场景描述</strong><br>   H5加载页面，不使用cocos默认样式，改为白色页面显示加载百分比。<br> <strong>解决方法</strong><br>   使用自定义发布模版，新建build-templates/web-mobile目录，新建index.html、main.js文件。<br> index.html添加代码，</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">html, body</span> <span class="token punctuation">{<!-- --></span>
        <span class="token property">-ms-touch-action</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
        <span class="token property">touch-action</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.landscape-tip</span> <span class="token punctuation">{<!-- --></span>
        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
        <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
        <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
        <span class="token property">z-index</span><span class="token punctuation">:</span> 1000<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.landtip</span> <span class="token punctuation">{<!-- --></span>
        <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
        <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> -146px 0 0 -146px<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 292px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 370px<span class="token punctuation">;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>http://xxx/land-tip.png<span class="token punctuation">)</span></span> no-repeat center center<span class="token punctuation">;</span>
        <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>.5<span class="token punctuation">,</span> .5<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>.5<span class="token punctuation">,</span> .5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">#splash</span> <span class="token punctuation">{<!-- --></span>
        <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">#precent</span> <span class="token punctuation">{<!-- --></span>
        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
        <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
        <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.progress-bar</span> <span class="token punctuation">{<!-- --></span>
      <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
...
<span class="token comment">&lt;!-- 横屏提示 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>landscape-tip<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>landscape<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>landtip<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> landscape <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'landscape'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">orientationChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>orientation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
                landscape<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">90</span><span class="token operator">:</span>
                landscape<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">90</span><span class="token operator">:</span>
                landscape<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"onorientationchange"</span> <span class="token keyword">in</span> window <span class="token operator">?</span> <span class="token string">"orientationchange"</span> <span class="token operator">:</span> <span class="token string">"resize"</span><span class="token punctuation">,</span> orientationChange<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>main.js添加代码，</p> 
<pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">setLoadingDisplay</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
        <span class="token keyword">var</span> percent <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> finish <span class="token operator">/</span> total<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>progressBar <span class="token operator">&amp;&amp;</span> percent <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            progressBar<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> percent<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%'</span><span class="token punctuation">;</span>
            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'precent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Loading...'</span> <span class="token operator">+</span> percent<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2__329"></a>2. 字体制作的公共字符集</h3> 
<p><strong>场景</strong><br>   制作字体文件，如：加载文字、游戏提示语、游戏结果等字符集合。</p> 
<pre><code class="prism language-javascript">abcdefghijklmnopqrstuvwxyz <span class="token constant">ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890</span><span class="token punctuation">.</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">;</span>'"<span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">*</span><span class="token operator">/=</span><span class="token operator">%</span>
</code></pre> 
<h3><a id="3__335"></a>3. 获取地址参数函数</h3> 
<pre><code class="prism language-javascript"><span class="token comment">// 获取地址参数, 参数可以是中文也可以是英文</span>
<span class="token function">getUrlParam</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">;</span>
    <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">"(^|&amp;)"</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">"=([^&amp;]*)(&amp;|$)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result <span class="token operator">?</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4__345"></a>4. 上下滑动事件</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> startPosY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>eventLayer<span class="token punctuation">.</span>node<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>Node<span class="token punctuation">.</span>EventType<span class="token punctuation">.</span><span class="token constant">TOUCH_START</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    startPosY <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getLocationY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>eventLayer<span class="token punctuation">.</span>node<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>Node<span class="token punctuation">.</span>EventType<span class="token punctuation">.</span><span class="token constant">TOUCH_END</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getLocationY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startPosY <span class="token operator">&gt;</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cc<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上滑'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getLocationY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startPosY <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        cc<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'下滑'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="5__359"></a>5. 随机函数</h3> 
<pre><code class="prism language-javascript"><span class="token comment">// 随机数函数，num:随机数数量，from-to:随机数取值范围</span>
<span class="token function">createRandom</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span> from<span class="token punctuation">,</span> to</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> from<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> to<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    array<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0.5</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    array<span class="token punctuation">.</span>length <span class="token operator">=</span> num<span class="token punctuation">;</span>
    <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6_Bug_372"></a>6. 像素间隔Bug</h3> 
<p><strong>场景描述</strong><br>   本来间隔应该是1个像素，但会有规律地出现2个像素间隔的情况。</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 添加以下代码</span>
<span class="token keyword">let</span> size <span class="token operator">=</span> cc<span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">getVisibleSizeInPixel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cc<span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">setDesignResolutionSize</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> size<span class="token punctuation">.</span>height<span class="token punctuation">,</span> cc<span class="token punctuation">.</span>ResolutionPolicy<span class="token punctuation">.</span><span class="token constant">FIXED_WIDTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="7__380"></a>7. 远程打包</h3> 
<p><strong>场景描述</strong><br>   v2.4版本项目需要首页和资源代码分离部署。<br> <strong>解决方法</strong><br>   修改index.html、main.js文件。<br> main.js修改代码，</p> 
<pre><code class="prism language-javascript"><span class="token keyword">var</span> remote_url <span class="token operator">=</span> <span class="token string">"https://xxx/assets/"</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function-variable function">boot</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token operator">...</span>
    <span class="token keyword">function</span> <span class="token function">cb</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">,</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> bundleRoot<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cc<span class="token punctuation">.</span>assetManager<span class="token punctuation">.</span><span class="token function">loadBundle</span><span class="token punctuation">(</span>remote_url <span class="token operator">+</span> <span class="token constant">MAIN</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> cc<span class="token punctuation">.</span>game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>option<span class="token punctuation">,</span> onStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token operator">...</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bundleRoot<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cc<span class="token punctuation">.</span>assetManager<span class="token punctuation">.</span><span class="token function">loadBundle</span><span class="token punctuation">(</span>remote_url <span class="token operator">+</span> bundleRoot<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>jsb<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> isRuntime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> loadRuntime <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRuntime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https://xxx/src/settings.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https://xxx/src/settings.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>index.html修改代码，</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://xxx/style-mobile.css<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://xxx/favicon.ico<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://xxx/src/settings.js<span class="token punctuation">"</span></span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://xxx/main.js<span class="token punctuation">"</span></span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    <span class="token function">loadScript</span><span class="token punctuation">(</span>debug <span class="token operator">?</span> <span class="token string">'cocos2d-js.js'</span> <span class="token operator">:</span> <span class="token string">'https://xxx/cocos2d-js-min.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CC_PHYSICS_BUILTIN</span> <span class="token operator">||</span> <span class="token constant">CC_PHYSICS_CANNON</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">loadScript</span><span class="token punctuation">(</span>debug <span class="token operator">?</span> <span class="token string">'physics.js'</span> <span class="token operator">:</span> <span class="token string">'physics-min.js'</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>boot<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        window<span class="token punctuation">.</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>参考链接</strong><br>   <a href="https://www.jianshu.com/p/a6c29dac8076" rel="nofollow">Cocos Creator 打包WebMobile，实现资源代码分离，部署 cdn</a></p> 
<h3><a id="8__447"></a>8. 接口请求超时处理</h3> 
<pre><code class="prism language-javascript"><span class="token comment">// 接口请求</span>
<span class="token function">apiPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token operator">...</span>
    <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token string">'xxx'</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> timeState <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 是否超时</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        timeState <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求中止</span>
        <span class="token comment">// 隐藏加载提示</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">20000</span><span class="token punctuation">;</span> <span class="token comment">// 20秒超时时间</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'('</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>responseText <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           	<span class="token operator">...</span>
           	<span class="token comment">// 程序部分</span>
			<span class="token operator">...</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>timeState<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 请求已经超时，忽略中止请求</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取消等待的超时    </span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>参考链接</strong><br>   <a href="https://www.jianshu.com/p/d24bd7848677" rel="nofollow">cocos creator 网络http请求超时处理</a></p> 
<h3><a id="9_CNZZ_479"></a>9. CNZZ事件统计</h3> 
<pre><code class="prism language-javascript"><span class="token comment">// cnzz统计</span>
_czc<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'_trackEvent'</span><span class="token punctuation">,</span> <span class="token string">'按钮点击'</span><span class="token punctuation">,</span> <span class="token string">'开始游戏按钮'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="10__484"></a>10. 创建一个连续数字的数组</h3> 
<pre><code class="prism language-typescript"><span class="token comment">/**
 * 生成一个从 start 到 end 的连续数组
 * @param start
 * @param end
 */</span>
<span class="token function">generateArray</span> <span class="token punctuation">(</span>start<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">(</span>end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e4db0d434166606caa33828727549c3b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vim跳转到某行</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b6684b0056634e715697fda6cc453b3c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring Boot全局异常处理器（原理及使用详解）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>