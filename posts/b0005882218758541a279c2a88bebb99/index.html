<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue3 TypeScript 配置 Vuex4 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Vue3 TypeScript 配置 Vuex4" />
<meta property="og:description" content="本文记录 Ts 版的 Vue3 项目配置 Vuex。
目录 ./src/store 。
├── store │ ├── index.ts │ └── interface.ts 首先看 ./src/store/index.ts ，这里是整个 store 的入口，里面定义并默认导出了 createStore 方法创建的 store 供整个项目使用。
import { InjectionKey } from &#39;vue&#39;; import { createStore, Store } from &#39;vuex&#39;; import RootStateTypes from &#39;@/store/interface&#39;; export default createStore&lt;RootStateTypes&gt;({ state: { test:&#39;test&#39; }, getters :{ }, mutations: { CHANGE_TEST(state,val){ state.test = val; } }, actions: { }, modules: { testModule } }); export const key: InjectionKey&lt;Store&lt;RootStateTypes&gt;&gt; = Symbol(&#39;vue-store&#39;); InjectionKey 方法为创建并使用定义 state 时提供唯一的 key，用到了 ES6 的 Symbol。 ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/b0005882218758541a279c2a88bebb99/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-07T15:37:39+08:00" />
<meta property="article:modified_time" content="2021-06-07T15:37:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue3 TypeScript 配置 Vuex4</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>本文记录 <code>Ts</code> 版的 <code>Vue3</code> 项目配置 <code>Vuex</code>。</p> 
</blockquote> 
<p>目录 <strong><font color="#66f"> ./src/store </font></strong> 。</p> 
<pre><code>├── store
│   ├── index.ts
│   └── interface.ts
</code></pre> 
<p>首先看 <font color="#66f"> ./src/store/index.ts </font>，这里是整个 <code>store</code> 的入口，里面定义并默认导出了 <code>createStore</code> 方法创建的 <code>store</code> 供整个项目使用。</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> InjectionKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createStore<span class="token punctuation">,</span> Store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> RootStateTypes <span class="token keyword">from</span> <span class="token string">'@/store/interface'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token generic-function"><span class="token function">createStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>RootStateTypes<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  state<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    test<span class="token operator">:</span><span class="token string">'test'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters <span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token constant">CHANGE_TEST</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      state<span class="token punctuation">.</span>test <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    testModule
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> key<span class="token operator">:</span> InjectionKey<span class="token operator">&lt;</span>Store<span class="token operator">&lt;</span>RootStateTypes<span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'vue-store'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>InjectionKey</code> 方法为创建并使用定义 <code>state</code> 时提供唯一的 <code>key</code>，用到了 <code>ES6</code> 的 <code>Symbol</code>。</li></ul> 
<p><font color="#66f"> ./src/store/interface.ts </font>，定义并导出了所用状态的接口。</p> 
<pre><code class="prism language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">interface</span> <span class="token class-name">RootStateTypes</span><span class="token punctuation">{<!-- --></span>
  test<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font color="#66f"> ./src/main.ts </font> 中引入 <code>store</code></p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> store<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> key <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token operator">...</span>
<span class="token function">createApp</span><span class="token punctuation">(</span>App <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span>key<span class="token punctuation">)</span>
  <span class="token operator">...</span>
</code></pre> 
<ul><li>注意引入方式，这里引入了之前的唯一值 <code>key</code>，并在 <code>createApp</code> 的 <code>use</code> 方法中和 <code>store</code> 一起传入</li></ul> 
<p><strong>测试</strong></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{moduleTest}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handlerChnage<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> key <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  name<span class="token operator">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> moduleTest <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handlerChnage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'CHANGE_TEST'</span><span class="token punctuation">,</span><span class="token string">'test2021'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      moduleTest<span class="token punctuation">,</span>
      handlerChnage
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>这里的 <code>import { useStore } from ‘vuex’;</code><br> <code>import { key } from ‘@/store’;</code> 两条语句分别引入 <code>useStore</code> 和 <code>key</code></li><li>调用时 <code>const store = useStore(key);</code> 也要传入 <code>key</code></li></ul> 
<p>每次页面中使用时都要引入并传入 <code>key</code> 有些繁琐，我们可以在 <font color="#66f"> ./src/store/index.ts </font> 中统一导出。</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> InjectionKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createStore<span class="token punctuation">,</span> Store<span class="token punctuation">,</span> useStore <span class="token keyword">as</span> baseUseStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> RootStateTypes <span class="token keyword">from</span> <span class="token string">'@/store/interface'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token generic-function"><span class="token function">createStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>RootStateTypes<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  state<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    test<span class="token operator">:</span><span class="token string">'test'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters <span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token constant">CHANGE_TEST</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      state<span class="token punctuation">.</span>test <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    testModule
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> key<span class="token operator">:</span> InjectionKey<span class="token operator">&lt;</span>Store<span class="token operator">&lt;</span>RootStateTypes<span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'vue-store'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">baseUseStore</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>有两处改变：</p> 
<ol><li><code>useStore as baseUseStore</code> 通过 <font color="#369">TS</font> 的 <font color="#369">as</font> 语法从 <code>vuex</code> 中引入 <code>useStore</code></li><li>最后导出函数 <code>useStore</code>，相当于包装一下 <code>vuex</code> 中的 <code>useStore</code> 方法，传入 <code>key</code>。</li></ol> 
<p>优化后再测试，代码会有所简化。</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>不需要引入 <code>key</code>，也不需要把 <code>key</code> 当作参数传入 <code>useStore</code>方法。</li></ul> 
<p><strong>配置子模块</strong></p> 
<p>需要修改一下目录 <strong><font color="#66f"> ./src/store </font></strong> 。</p> 
<pre><code>├── store
│   ├── modules
│   │   ├── test
│   │   │   ├── index.ts
│   │   │   └── interface.ts
│   ├── index.ts
│   └── interface.ts
</code></pre> 
<ul><li>创建 <font color="#66f"> ./src/store/modules/ </font> 文件夹。</li><li>为了测试现在此目录创建 <font color="#66f"> test </font> 文件夹。</li><li><font color="#66f"> test </font> 相当于一个模块，在这个目录中再创建 <font color="#66f"> index.ts </font> <code>(state)</code> 和<font color="#66f"> interface </font> <code>(接口) </code>。</li></ul> 
<p><strong><font color="#66f"> ./src/store/modules/test/index.ts </font></strong></p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> RootStateTypes <span class="token keyword">from</span> <span class="token string">'@/store/interface'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TestModuleTypes <span class="token keyword">from</span> <span class="token string">'@/store/modules/test/interface'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> testModule<span class="token operator">:</span> Module<span class="token operator">&lt;</span>TestModuleTypes<span class="token punctuation">,</span>RootStateTypes<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  namespaced<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  state<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    name<span class="token operator">:</span> <span class="token string">'testmodule'</span><span class="token punctuation">,</span>
    count<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token constant">ADD_COUNT</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      state<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> testModule<span class="token punctuation">;</span>
</code></pre> 
<ul><li>整体思路和 <font color="#66f"> ./src/store/index.ts </font> 差不多。只是从 <code>vuex</code> 中引入了 <code>Module</code> 作为输出类型。</li><li><code>namespaced</code> 命名空间的使用可提高模块的封装性和可复用性。</li></ul> 
<p><strong><font color="#66f"> ./src/store/modules/test/interface.ts </font></strong></p> 
<pre><code class="prism language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">interface</span> <span class="token class-name">TestModuleTypes</span><span class="token punctuation">{<!-- --></span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>定义子模块的类型。</li></ul> 
<p><strong>根模块两个文件的修改：</strong></p> 
<p>先看 <strong><font color="#66f"> ./src/store/interface.ts </font></strong></p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> TestModuleTypes <span class="token keyword">from</span> <span class="token string">'@/store/modules/test/interface'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">interface</span> <span class="token class-name">RootStateTypes</span><span class="token punctuation">{<!-- --></span>
  test<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AllStateTypes</span> <span class="token keyword">extends</span> <span class="token class-name">RootStateTypes</span><span class="token punctuation">{<!-- --></span>
  testModule<span class="token operator">:</span> TestModuleTypes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>引入了刚定义的子模块类型 <code>TestModuleTypes</code></li><li>通过接口继承的方式定义<code>AllStateTypes</code> 接口，里面包含全部子模块接口。</li></ul> 
<p>再修改 <strong><font color="#66f"> ./src/store/index.ts </font></strong></p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> InjectionKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createStore<span class="token punctuation">,</span> Store<span class="token punctuation">,</span> useStore <span class="token keyword">as</span> baseUseStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> RootStateTypes<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> AllStateTypes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/interface'</span><span class="token punctuation">;</span>

<span class="token comment">// 引入子模块</span>
<span class="token keyword">import</span> testModule <span class="token keyword">from</span> <span class="token string">'@/store/modules/test'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token generic-function"><span class="token function">createStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>RootStateTypes<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  state<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    test<span class="token operator">:</span><span class="token string">'test'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters <span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token constant">CHANGE_TEST</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      state<span class="token punctuation">.</span>test <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    testModule
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> key<span class="token operator">:</span> InjectionKey<span class="token operator">&lt;</span>Store<span class="token operator">&lt;</span>RootStateTypes<span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'vue-store'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useStore</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">=</span>AllStateTypes<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">baseUseStore</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>引入刚定义的 <code>AllStateTypes</code> 子模块接口。</li><li>导入对应的子模块 <code>testModule</code>，并把它加入到默认导出的 <code>createStore</code> 的 <code>modules</code> 中</li><li>最后导出的 <code>useStore</code> 方法添加默认是 <code>AllStateTypes</code> 的泛型</li></ul> 
<p><strong>测试子模块</strong></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{testModuleName}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{testModuleCount}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handlerCount<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  name<span class="token operator">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> testModuleName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>testModule<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> testModuleCount <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>testModule<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handlerCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'testModule/ADD_COUNT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      testModuleName<span class="token punctuation">,</span>
      testModuleCount<span class="token punctuation">,</span>
      handlerCount
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>通过 <code>store.state.模块名</code> 的方式引用到子模块。</li><li>注意 <code>store.commit</code> 传参的方式 <code>‘testModule/ADD_COUNT’</code>，是 <code>‘模块名/方法名’</code></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6f5d73af4c787c17d7e9f572317feab8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【每日选择题】11~20天做选择题汇总</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9340758b15a83639b4e5bc4e0b4cc675/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">应用“Cain &amp; Abel”实现DNS欺骗</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>