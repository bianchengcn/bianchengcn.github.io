<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序实现地图自定义大小画圆以及地图自适应（iview-Weapp&#43;微信开发者工具） - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信小程序实现地图自定义大小画圆以及地图自适应（iview-Weapp&#43;微信开发者工具）" />
<meta property="og:description" content="iview-Weapp 本项目中使用的UI为iview-Weapp，可在百度自行进入官网并根据文档下载并引入至项目，此处就不多说了。
具体实现 主要实现了在微信小程序下使用地图的marker点击弹出画圆，并根据圆的大小实现地图缩放的问题。
注意！！！：目前半径不可超过60KM，过大会导致进入死循环卡死，如有需要请自行更改代码。
实现的效果如下：
目录如下：
map.js代码：
注意：代码中 drawingnumber 的单位是m（米），drawingnumberKM所代表的的是KM（千米）， getCrlcle()方法所计算出的当前缩放半径单位为KM
// pages/map/map.js // pages/map/map.js const { $Message } = require(&#39;../../dist/base/index&#39;); var QQMapWX = require(&#39;../../lib/qqmap-wx-jssdk.js&#39;); var qqmapsdk; var mapapp; const app = getApp(); var EARTH_RADIUS = 6378.137; //地球半径 function rad(d) { return d * Math.PI / 180.0; } function getDistance(lng1, lat1, lng2, lat2) { var radLat1 = rad(lat1); var radLat2 = rad(lat2); var a = radLat1 - radLat2; var b = rad(lng1) - rad(lng2); var s = 2 * Math." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/ece2ae0085312e9e8448e26b51795fa9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-08-06T12:21:25+08:00" />
<meta property="article:modified_time" content="2019-08-06T12:21:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序实现地图自定义大小画圆以及地图自适应（iview-Weapp&#43;微信开发者工具）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="iviewWeapp_1"></a>iview-Weapp</h3> 
<p>本项目中使用的UI为iview-Weapp，可在百度自行进入官网并根据文档下载并引入至项目，此处就不多说了。</p> 
<h3><a id="_4"></a>具体实现</h3> 
<p>主要实现了在微信小程序下使用地图的marker点击弹出画圆，并根据圆的大小实现地图缩放的问题。<br> <strong><mark>注意！！！：目前半径不可超过60KM，过大会导致进入死循环卡死，如有需要请自行更改代码。</mark></strong></p> 
<p>实现的效果如下：<br> <img src="https://images2.imgbox.com/af/3b/UtPZ8MeP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ab/02/sN4t3T5P_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ee/b4/Sp5jxpVg_o.png" alt="在这里插入图片描述"></p> 
<p>目录如下：<br> <img src="https://images2.imgbox.com/10/3a/D1pMmy0m_o.png" alt="在这里插入图片描述"><br> map.js代码：</p> 
<blockquote> 
 <p>注意：代码中 drawingnumber 的单位是m（米），drawingnumberKM所代表的的是KM（千米）， getCrlcle()方法所计算出的当前缩放半径单位为KM</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token comment">// pages/map/map.js</span>
<span class="token comment">// pages/map/map.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
  $Message
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../dist/base/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> QQMapWX <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../lib/qqmap-wx-jssdk.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> qqmapsdk<span class="token punctuation">;</span>
<span class="token keyword">var</span> mapapp<span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">EARTH_RADIUS</span> <span class="token operator">=</span> <span class="token number">6378.137</span><span class="token punctuation">;</span> <span class="token comment">//地球半径</span>

<span class="token keyword">function</span> <span class="token function">rad</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> d <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getDistance</span><span class="token punctuation">(</span>lng1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> lng2<span class="token punctuation">,</span> lat2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> radLat1 <span class="token operator">=</span> <span class="token function">rad</span><span class="token punctuation">(</span>lat1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> radLat2 <span class="token operator">=</span> <span class="token function">rad</span><span class="token punctuation">(</span>lat2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> radLat1 <span class="token operator">-</span> radLat2<span class="token punctuation">;</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">rad</span><span class="token punctuation">(</span>lng1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">rad</span><span class="token punctuation">(</span>lng2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">asin</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>a <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>radLat1<span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>radLat2<span class="token punctuation">)</span> <span class="token operator">*</span>
    Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>b <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s <span class="token operator">=</span> s <span class="token operator">*</span> <span class="token constant">EARTH_RADIUS</span><span class="token punctuation">;</span>
  s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>s <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10000</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> s<span class="token punctuation">;</span> <span class="token comment">//返回数值单位：公里</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>

  <span class="token comment">/**
   * 页面的初始数据
   */</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    longitude<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    latitude<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    markers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    markerseeion<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    visible<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    drawingnumber<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    drawingnumberKM<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    circles<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//点击标记点的经纬度</span>
    markerlongitude<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    markerlatitude<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    scale<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
    <span class="token comment">//页面加载时的半径</span>
    nowradius<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token comment">//地图加载</span>
    mapload<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">//地图</span>
    hidden<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    buttonhidden<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    localhidden<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    localplace<span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token comment">//判断getCrlcle方法走完没有</span>
    Crlcleisfinish<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    markere<span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token comment">//调用查询当前地图半径方法位置(0:点击标记时  1:在得到地图缩放等级后)</span>
    markerbechange<span class="token punctuation">:</span><span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 生命周期函数--监听页面加载
   */</span>
  onLoad<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// this.getCrlcle();</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    qqmapsdk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QQMapWX</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      key<span class="token punctuation">:</span> <span class="token string">'自行填写KEY'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取当前位置</span>
    wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      type<span class="token punctuation">:</span> <span class="token string">'gcj02'</span><span class="token punctuation">,</span>
      success<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> latitude <span class="token operator">=</span> res<span class="token punctuation">.</span>latitude
        <span class="token keyword">var</span> longitude <span class="token operator">=</span> res<span class="token punctuation">.</span>longitude
        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          latitude<span class="token punctuation">:</span> latitude<span class="token punctuation">,</span>
          longitude<span class="token punctuation">:</span> longitude
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>latitude<span class="token operator">+</span><span class="token string">"纬度"</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>longitude <span class="token operator">+</span> <span class="token string">"精度"</span><span class="token punctuation">)</span>
        <span class="token comment">//逆地址坐标解析</span>
        qqmapsdk<span class="token punctuation">.</span><span class="token function">reverseGeocoder</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          location<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            latitude<span class="token punctuation">:</span> latitude<span class="token punctuation">,</span>
            longitude<span class="token punctuation">:</span> longitude
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          success<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>addressres<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> address <span class="token operator">=</span> addressres<span class="token punctuation">.</span>result<span class="token punctuation">.</span>formatted_addresses<span class="token punctuation">.</span>recommend<span class="token punctuation">;</span>
            that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              localplace<span class="token punctuation">:</span>address
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          fail<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> errr<span class="token operator">=</span>err<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>errr<span class="token operator">+</span><span class="token string">"进来错误了"</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//定义个marker，并设置点击事件</span>
    <span class="token keyword">var</span> getmarkers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token keyword">var</span> allmarkersession<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">wxRequest</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"/markers/getAllMarkers"</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">var</span> usermarkers<span class="token operator">=</span>res<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> usermarkers<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        allmarkersession<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//如果是指挥中心</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            getmarkers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              id<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
              iconPath<span class="token punctuation">:</span> <span class="token string">"/images/CommandingOrganization.png"</span><span class="token punctuation">,</span>
              longitude<span class="token punctuation">:</span> usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
              latitude<span class="token punctuation">:</span> usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>latitude<span class="token punctuation">,</span>
              width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
              height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token comment">//如果是器材库</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          getmarkers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            id<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
            iconPath<span class="token punctuation">:</span> <span class="token string">"/images/Equipment.Repository.png"</span><span class="token punctuation">,</span>
            longitude<span class="token punctuation">:</span> usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
            latitude<span class="token punctuation">:</span> usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>latitude<span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> 
        <span class="token comment">//如果是重点保护目标</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          getmarkers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            id<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
            iconPath<span class="token punctuation">:</span> <span class="token string">"/images/Key.Protection.Objectives.png"</span><span class="token punctuation">,</span>
            longitude<span class="token punctuation">:</span> usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
            latitude<span class="token punctuation">:</span> usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>latitude<span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//如果是应急力量</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          getmarkers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            id<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
            iconPath<span class="token punctuation">:</span> <span class="token string">"/images/Emergency.Force.png"</span><span class="token punctuation">,</span>
            longitude<span class="token punctuation">:</span> usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
            latitude<span class="token punctuation">:</span> usermarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>latitude<span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        markers<span class="token punctuation">:</span> getmarkers<span class="token punctuation">,</span>
        mapload<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        localhidden<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
        markerseeion<span class="token punctuation">:</span> allmarkersession
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"错误信息"</span><span class="token operator">+</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>Crlcleisfinish<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        Crlcleisfinish<span class="token punctuation">:</span><span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//点击标记点</span>
  <span class="token function">markertap</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      markere<span class="token punctuation">:</span>e<span class="token punctuation">,</span>
      markerbechange<span class="token punctuation">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCrlcle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//点击确定关闭画圆选择</span>
  <span class="token function">handleCloseOK</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//判断异步是否执行完了</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>Crlcleisfinish <span class="token operator">+</span> <span class="token string">"当前状态"</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>hidden <span class="token operator">+</span> <span class="token string">"当前状态2"</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> that<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>Crlcleisfinish<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      mapapp<span class="token punctuation">.</span><span class="token function">getScale</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        success<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">var</span> scale<span class="token operator">=</span>res<span class="token punctuation">.</span>scale<span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"这是当前的缩放等级"</span><span class="token operator">+</span>scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> nowscale <span class="token operator">=</span> scale <span class="token operator">+</span> <span class="token number">1</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"这是当前的缩放等级+2"</span> <span class="token operator">+</span> nowscale<span class="token punctuation">)</span><span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            scale<span class="token punctuation">:</span> scale<span class="token punctuation">,</span>
            Crlcleisfinish<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            markerbechange<span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
            that<span class="token punctuation">.</span><span class="token function">getCrlcle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"点击后的半径"</span> <span class="token operator">+</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nowradius<span class="token punctuation">)</span>
    <span class="token comment">//首先清空原来的圆</span>
    <span class="token keyword">var</span> clearCircles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      circles<span class="token punctuation">:</span> clearCircles<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//计算当前地图缩放级别是否过小或者过大</span>
      <span class="token keyword">var</span> frequency<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      frequency <span class="token operator">=</span> frequency<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>frequency<span class="token operator">&gt;</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"===========超过50次退出=============="</span><span class="token punctuation">)</span>
        frequency<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"当前的地图半径"</span> <span class="token operator">+</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nowradius<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"当前的选择画圆的半径"</span> <span class="token operator">+</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>drawingnumberKM<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>drawingnumberKM <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> thescale <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
        frequency <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          scale<span class="token punctuation">:</span> thescale
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nowradius <span class="token operator">&lt;</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>drawingnumberKM<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> thescale <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>scale <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> thenowradius <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nowradius <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          scale<span class="token punctuation">:</span> thescale<span class="token punctuation">,</span>
          nowradius<span class="token punctuation">:</span> thenowradius
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nowradius <span class="token operator">&gt;</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>drawingnumberKM <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> thescale <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>scale <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> thenowradius <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nowradius <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          scale<span class="token punctuation">:</span> thescale<span class="token punctuation">,</span>
          nowradius<span class="token punctuation">:</span> thenowradius
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        frequency <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//定义一个圆</span>
    <span class="token keyword">var</span> drawCircles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
      latitude<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markerlatitude<span class="token punctuation">,</span>
      longitude<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markerlongitude<span class="token punctuation">,</span>
      color<span class="token punctuation">:</span> <span class="token string">'#FF0000DD'</span><span class="token punctuation">,</span>
      fillColor<span class="token punctuation">:</span> <span class="token string">'#7cb5ec88'</span><span class="token punctuation">,</span>
      <span class="token comment">//半径为M</span>
      radius<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>drawingnumber<span class="token punctuation">,</span>
      strokeWidth<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token comment">//将当前中心点定位到画圆的marker</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>drawingnumberKM<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        hidden<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        visible<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        buttonhidden<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        localhidden<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        circles<span class="token punctuation">:</span> drawCircles<span class="token punctuation">,</span>
        longitude<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markerlongitude<span class="token punctuation">,</span>
        latitude<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markerlatitude
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        hidden<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        visible<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        buttonhidden<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        localhidden<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        circles<span class="token punctuation">:</span> drawCircles<span class="token punctuation">,</span>
              longitude<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markerlongitude<span class="token punctuation">,</span>
              latitude<span class="token punctuation">:</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markerlatitude
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">//if的结尾符</span>
    <span class="token punctuation">}</span>

    


  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//点击取消关闭画圆选择</span>
  <span class="token function">handleCloseCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      hidden<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      visible<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      Crlcleisfinish<span class="token punctuation">:</span><span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log(this.data.drawingnumber+"取消关闭");</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//监听圆输入框的范围大小</span>
  <span class="token function">drawingnumberchange</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    detail
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      drawingnumberKM<span class="token punctuation">:</span> detail<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      drawingnumber<span class="token punctuation">:</span> detail<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">//抽屉遮罩层'取消'关闭</span>
  <span class="token function">drawerclose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    drawervisible<span class="token punctuation">:</span><span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//抽屉遮罩层'确定'关闭</span>
  <span class="token function">drawerclose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      drawervisible<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">//计算当前屏幕的半径</span>
  <span class="token function">getCrlcle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> mapradius1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    mapapp <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createMapContext</span><span class="token punctuation">(</span><span class="token string">'map'</span><span class="token punctuation">)</span>
    mapapp<span class="token punctuation">.</span><span class="token function">getRegion</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      success<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> lng1 <span class="token operator">=</span> res<span class="token punctuation">.</span>northeast<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span>
        <span class="token keyword">let</span> lat1 <span class="token operator">=</span> res<span class="token punctuation">.</span>northeast<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span>
        <span class="token keyword">let</span> lng2 <span class="token operator">=</span> res<span class="token punctuation">.</span>southwest<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span>
        <span class="token keyword">let</span> lat2 <span class="token operator">=</span> res<span class="token punctuation">.</span>southwest<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span>
        <span class="token keyword">let</span> longitude <span class="token operator">=</span> lng1 <span class="token operator">-</span> lng2<span class="token punctuation">;</span>
        <span class="token keyword">let</span> latitude <span class="token operator">=</span> lat1 <span class="token operator">-</span> lat2<span class="token punctuation">;</span>
        <span class="token keyword">let</span> flag <span class="token operator">=</span> longitude <span class="token operator">&gt;</span> latitude <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> radius <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">//计算得到短边，除2得到半径，*0.8优化显示，让圈圈只占界面的80%</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          radius <span class="token operator">=</span> <span class="token function">getDistance</span><span class="token punctuation">(</span>lng1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> lng1<span class="token punctuation">,</span> lat2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          radius <span class="token operator">=</span> <span class="token function">getDistance</span><span class="token punctuation">(</span>lng1<span class="token punctuation">,</span> lat1<span class="token punctuation">,</span> lng2<span class="token punctuation">,</span> lat1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mapradius1 <span class="token operator">=</span> radius<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>radius<span class="token operator">+</span><span class="token string">" 当前地图的半径"</span><span class="token punctuation">)</span>
        that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          nowradius<span class="token punctuation">:</span> radius<span class="token punctuation">,</span>
          Crlcleisfinish<span class="token punctuation">:</span><span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> allmarkers <span class="token operator">=</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markerseeion<span class="token punctuation">;</span>
        <span class="token comment">//如果不是应急力量（人员），则打开画圆</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> allmarkers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>allmarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markere<span class="token punctuation">.</span>markerId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>allmarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>data<span class="token punctuation">.</span>markerbechange<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                hidden<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                visible<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                markerlongitude<span class="token punctuation">:</span> allmarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
                markerlatitude<span class="token punctuation">:</span> allmarkers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>latitude
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>

              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 生命周期函数--监听页面初次渲染完成
   */</span>
  onReady<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 生命周期函数--监听页面显示
   */</span>
  onShow<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 生命周期函数--监听页面隐藏
   */</span>
  onHide<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 生命周期函数--监听页面卸载
   */</span>
  onUnload<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 页面相关事件处理函数--监听用户下拉动作
   */</span>
  onPullDownRefresh<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 页面上拉触底事件的处理函数
   */</span>
  onReachBottom<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 用户点击右上角分享
   */</span>
  onShareAppMessage<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>map.json代码：</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"usingComponents"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"i-modal"</span><span class="token punctuation">:</span> <span class="token string">"../../dist/modal/index"</span><span class="token punctuation">,</span>
    <span class="token string">"i-input-number"</span><span class="token punctuation">:</span> <span class="token string">"../../dist/input-number/index"</span><span class="token punctuation">,</span>
    <span class="token string">"i-drawer"</span><span class="token punctuation">:</span> <span class="token string">"../../dist/drawer/index"</span><span class="token punctuation">,</span>
    <span class="token string">"i-button"</span><span class="token punctuation">:</span> <span class="token string">"../../dist/button/index"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>map.wxml代码：</p> 
<pre><code class="prism language-html"><span class="token comment">&lt;!--pages/map/map.wxml--&gt;</span>
<span class="token comment">&lt;!--pages/map/map.wxml--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- &lt;view&gt;地图展示&lt;/view&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span> <span class="token attr-name">hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{hidden}}<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">"</span></span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span> <span class="token attr-name">longitude</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{longitude}}<span class="token punctuation">"</span></span> <span class="token attr-name">latitude</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{latitude}}<span class="token punctuation">"</span></span> <span class="token attr-name">bindmarkertap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>markertap<span class="token punctuation">"</span></span> <span class="token attr-name">show-location</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> 
<span class="token attr-name">markers</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{markers}}<span class="token punctuation">"</span></span>  <span class="token attr-name">circles</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{circles}}<span class="token punctuation">"</span></span> <span class="token attr-name">bindregionchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>regionchange<span class="token punctuation">"</span></span> 
<span class="token attr-name">scale</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{scale}}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{mapload}}<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-modal</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>选择画圆半径(单位为KM)<span class="token punctuation">"</span></span> <span class="token attr-name">visible</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{ visible }}<span class="token punctuation">"</span></span>  
  <span class="token attr-name"><span class="token namespace">bind:</span>ok</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleCloseOK<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>cancel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleCloseCancel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">padding</span><span class="token punctuation">:</span> 16px</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-input-number</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{ drawingnumberKM }}<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span> <span class="token attr-name">bindchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>drawingnumberchange<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-modal</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mapbutton<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{buttonhidden}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-button</span> <span class="token attr-name"><span class="token namespace">bind:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleClick<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>选择人员<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>localin<span class="token punctuation">"</span></span> <span class="token attr-name">hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<!-- -->{localhidden}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>local<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>当前位置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>place<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{localplace}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>map.wxss代码：</p> 
<pre><code class="prism language-css"><span class="token selector">//如有需要可自行增加样式
//此样式必须存在，否则会导致地图显示失败
.container</span> <span class="token punctuation">{<!-- --></span>
<span class="token property">height</span><span class="token punctuation">:</span> 90vh
<span class="token punctuation">}</span> 
<span class="token selector">.mapbutton</span><span class="token punctuation">{<!-- --></span>
<span class="token property">height</span><span class="token punctuation">:</span> 7vh
<span class="token punctuation">}</span>
<span class="token selector">::-webkit-scrollbar</span> <span class="token punctuation">{<!-- --></span>
<span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.local</span><span class="token punctuation">{<!-- --></span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
   <span class="token property">font-size</span><span class="token punctuation">:</span> 23px<span class="token punctuation">;</span>
   <span class="token property">margin-left</span><span class="token punctuation">:</span> 2px
<span class="token punctuation">}</span>
<span class="token selector">.place</span><span class="token punctuation">{<!-- --></span>
  <span class="token property">padding-top</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #8a8a8a<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> 2px
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>以上为具体示例，如果有问题可加qq：1016400304</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/25b72050d775c36fbf978324e57e4e1c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《Java开发实战经典》.(李兴华).[PDF]&amp;ckook百度网盘链接</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/acf6e35eb5ebb61d92cfe06c21bacc81/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何选择虚拟主机和云服务器，它们之间有何区别？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>