<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue使用h5puls做APP自动更新 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue使用h5puls做APP自动更新" />
<meta property="og:description" content="首先我们先来理清思路在来一步步的做 确保当前有h5puls的第三方库 或者使用HBuilder X 或者HBuilder 来打包webapp APK中就自动集成了h5puls（或者可以写道其他事件里面触发检查更新下载版本）
这里APP自动更新全部都在App.vue 页面完成
h5puls官方文档
先检查安装的apk的版本号，
文档链接Runtime
使用 plus.runtime.getProperty API	官方文档代码 // 获取应用信息 function getAppInfo() { plus.runtime.getProperty( plus.runtime.appid, function ( wgtinfo ) { //appid属性 var wgtStr = &#34;appid:&#34;&#43;wgtinfo.appid; //version属性 wgtStr &#43;= &#34;&lt;br/&gt;version:&#34;&#43;wgtinfo.version; //name属性 wgtStr &#43;= &#34;&lt;br/&gt;name:&#34;&#43;wgtinfo.name; //description属性 wgtStr &#43;= &#34;&lt;br/&gt;description:&#34;&#43;wgtinfo.description; //author属性 wgtStr &#43;= &#34;&lt;br/&gt;author:&#34;&#43;wgtinfo.author; //email属性 wgtStr &#43;= &#34;&lt;br/&gt;email:&#34;&#43;wgtinfo.email; //features 属性 wgtStr &#43;= &#34;&lt;br/&gt;features:&#34;&#43;wgtinfo.features; console.log( wgtStr ); } ); } 这里我们也使用这个API 来获取APPID window.plus.runtime.getProperty(window.plus.runtime.appid,(inf)=&gt;{ console.log(inf) //当前APP的数据包含了APP的版本号 console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/dbd80e5ed568f9ce33768292779a0de6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-21T10:07:09+08:00" />
<meta property="article:modified_time" content="2022-10-21T10:07:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue使用h5puls做APP自动更新</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>首先我们先来理清思路在来一步步的做 确保当前有h5puls的第三方库 或者使用HBuilder X 或者HBuilder 来打包webapp APK中就自动集成了h5puls（或者可以写道其他事件里面触发检查更新下载版本）</p> 
<p>这里APP自动更新全部都在App.vue 页面完成</p> 
<p><a href="http://www.html5plus.org/doc/h5p.html" rel="nofollow">h5puls官方文档</a></p> 
<ol><li> <p>先检查安装的apk的版本号，<br> 文档链接<a href="http://www.html5plus.org/doc/zh_cn/runtime.html" rel="nofollow">Runtime</a></p> <pre><code>使用 plus.runtime.getProperty  API	官方文档代码
</code></pre> </li></ol> 
<pre><code class="prism language-javascript">		<span class="token comment">// 获取应用信息</span>
		<span class="token keyword">function</span> <span class="token function">getAppInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span> plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>appid<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">wgtinfo</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">//appid属性</span>
				<span class="token keyword">var</span> wgtStr <span class="token operator">=</span> <span class="token string">"appid:"</span><span class="token operator">+</span>wgtinfo<span class="token punctuation">.</span>appid<span class="token punctuation">;</span>
				<span class="token comment">//version属性</span>
				wgtStr <span class="token operator">+=</span> <span class="token string">"&lt;br/&gt;version:"</span><span class="token operator">+</span>wgtinfo<span class="token punctuation">.</span>version<span class="token punctuation">;</span>
				<span class="token comment">//name属性</span>
				wgtStr <span class="token operator">+=</span> <span class="token string">"&lt;br/&gt;name:"</span><span class="token operator">+</span>wgtinfo<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
				<span class="token comment">//description属性</span>
				wgtStr <span class="token operator">+=</span> <span class="token string">"&lt;br/&gt;description:"</span><span class="token operator">+</span>wgtinfo<span class="token punctuation">.</span>description<span class="token punctuation">;</span>
				<span class="token comment">//author属性</span>
				wgtStr <span class="token operator">+=</span> <span class="token string">"&lt;br/&gt;author:"</span><span class="token operator">+</span>wgtinfo<span class="token punctuation">.</span>author<span class="token punctuation">;</span>
				<span class="token comment">//email属性</span>
				wgtStr <span class="token operator">+=</span> <span class="token string">"&lt;br/&gt;email:"</span><span class="token operator">+</span>wgtinfo<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
				<span class="token comment">//features 属性</span>
				wgtStr <span class="token operator">+=</span> <span class="token string">"&lt;br/&gt;features:"</span><span class="token operator">+</span>wgtinfo<span class="token punctuation">.</span>features<span class="token punctuation">;</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> wgtStr <span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<pre><code>	这里我们也使用这个API 来获取APPID
</code></pre> 
<pre><code class="prism language-javascript">	window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>appid<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">inf</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
		 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inf<span class="token punctuation">)</span> <span class="token comment">//当前APP的数据包含了APP的版本号</span>
		  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inf<span class="token punctuation">.</span>version<span class="token punctuation">)</span> <span class="token comment">//当前APP的版本号</span>
		
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li> <p>从服务端获取APP（服务端是我打包好的APP,以及对应的版本）<br> 获取服务端的数据 进行APP版本号的比较</p> <p>使用Downloader模块进行APK下载 管理文件下载，用于从网络下载各种文件，可支持跨域访问操作<br> <a href="http://www.html5plus.org/doc/zh_cn/downloader.html" rel="nofollow">Downloader</a><br> 官方示例</p> </li></ol> 
<pre><code class="prism language-javascript"><span class="token comment">// 创建下载任务</span>
<span class="token keyword">function</span> <span class="token function">createDownload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> dtask <span class="token operator">=</span> plus<span class="token punctuation">.</span>downloader<span class="token punctuation">.</span><span class="token function">createDownload</span><span class="token punctuation">(</span><span class="token string">"http://www.abc.com/a.doc"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> status</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 下载完成</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Download success: "</span> <span class="token operator">+</span> d<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Download failed: "</span> <span class="token operator">+</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token punctuation">}</span>  
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//dtask.addEventListener("statechanged", onStateChanged, false);</span>
	dtask<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p>这里我们新建一个自己的下载模块</p> 
<pre><code class="prism language-javascript">
<span class="token keyword">var</span> downToaknew <span class="token operator">=</span> window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>downloader<span class="token punctuation">.</span><span class="token function">createDownload</span><span class="token punctuation">(</span>‘<span class="token constant">APK</span>下载地址’<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">''</span>  <span class="token comment">//filename: (String 类型 )下载文件保存的路径  </span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> status</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 当前下载的状态</span>
                    <span class="token function">installApp</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>filename<span class="token punctuation">)</span> <span class="token comment">// 调用安装的方法</span>
                  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'下载失败'</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">)</span>

downToaknew<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//调用APP下载方法</span>

 <span class="token comment">// app自动更新进度  下面放发会显示 当前APK下载进度 已经APK的大小</span>
 downToaknew<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'statechanged'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">task<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>3.调用APP 安装模块 plus.runtime.install</p> 
<p>调用自动安装放发</p> 
<pre><code class="prism language-javascript">				<span class="token comment">//APK下载的路基 前面我们设置了APK下载的路基  调用放发时候 传入路径即可</span>
              <span class="token keyword">function</span> <span class="token function">installApp</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">showWaiting</span><span class="token punctuation">(</span><span class="token string">'安装文件...'</span><span class="token punctuation">)</span>
                window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span>
                  path<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// true表示强制安装，不进行版本号的校验；false则需要版本号校验，如果将要安装应用的版本号不高于现有应用的版本号则终止安装，并返回安装失败。 仅安装wgt和wgtu时生效，默认值 false</span>
                    <span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token boolean">false</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">closeWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'安装文件成功！'</span><span class="token punctuation">)</span>
                    _this<span class="token punctuation">.</span>hidedownloader <span class="token operator">=</span> <span class="token boolean">false</span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'应用资源更新完成！'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                      window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">closeWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'安装文件失败'</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
                    _this<span class="token punctuation">.</span>hidedownloader <span class="token operator">=</span> <span class="token boolean">false</span>
                    sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'nextCheckTime'</span><span class="token punctuation">,</span> <span class="token string">'UnupdateId'</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
</code></pre> 
<p>4.在APK下载完成后调用APK安装放法</p> 
<p>完成代码</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> PersonalCenter <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>router<span class="token operator">-</span>view v<span class="token operator">-</span>on<span class="token operator">:</span>public_header<span class="token operator">=</span><span class="token string">"public_header"</span> @toFather<span class="token operator">=</span><span class="token string">"getFlag"</span> @toFatherDetail<span class="token operator">=</span><span class="token string">"getDetailFlag"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">versionInformation</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">examine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'plusready'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 获取当前的APP版本号</span>
          window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>appid<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">inf</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inf<span class="token punctuation">)</span>
            <span class="token comment">// 判断最新版本的版本号是否大于当前的版本</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_this<span class="token punctuation">.</span>versionInformation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>versionNumber <span class="token operator">&gt;</span> inf<span class="token punctuation">.</span>version<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              <span class="token keyword">var</span> downToaknew <span class="token operator">=</span> window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>downloader<span class="token punctuation">.</span><span class="token function">createDownload</span><span class="token punctuation">(</span>
                _this<span class="token punctuation">.</span>versionInformation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>urldownloader <span class="token operator">+</span>
                _this<span class="token punctuation">.</span>versionInformation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>downloadAddress<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">''</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> status</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 当前下载的状态</span>
                    <span class="token function">installApp</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>filename<span class="token punctuation">)</span> <span class="token comment">// 调用安装的方法</span>
                  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'下载失败'</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">)</span>
              <span class="token comment">// 等于空代表，用户没有点击取消的任何操作</span>
                <span class="token keyword">let</span> ThereIsAnew <span class="token operator">=</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'发现新的版本啦,是否要更新'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ThereIsAnew<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                  downToaknew<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 开启下载的任务</span>
                  <span class="token comment">// app自动更新进度</span>
                  downToaknew<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'statechanged'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
                    <span class="token parameter">task<span class="token punctuation">,</span>
                    status</span>
                  <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 给下载任务设置一个监听 并根据状态  做操作</span>
                    <span class="token keyword">switch</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                      <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'正在下载'</span><span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
                      <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'已连接到服务器'</span><span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
                      <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
                        <span class="token comment">// console.log(task)</span>
                        <span class="token comment">// console.log(task.downloadedSize)//当前的大</span>
                        <span class="token comment">// console.log(task.totalSize)//安装包的大小</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token comment">// 自动更新</span>
              <span class="token comment">// eslint-disable-next-line no-inner-declarations</span>
              <span class="token keyword">function</span> <span class="token function">installApp</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">showWaiting</span><span class="token punctuation">(</span><span class="token string">'安装文件...'</span><span class="token punctuation">)</span>
                window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span>
                  path<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// true表示强制安装，不进行版本号的校验；false则需要版本号校验，如果将要安装应用的版本号不高于现有应用的版本号则终止安装，并返回安装失败。 仅安装wgt和wgtu时生效，默认值 false</span>
                    <span class="token literal-property property">force</span><span class="token operator">:</span> <span class="token boolean">false</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">closeWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'安装文件成功！'</span><span class="token punctuation">)</span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'应用资源更新完成！'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                      window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">closeWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    window<span class="token punctuation">.</span>plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'安装文件失败'</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有最新的版本'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 检查当前版本是否是最新的</span>
      <span class="token function-variable function">examine</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">versionType</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>api<span class="token punctuation">.</span>examine<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>rc <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>versionInformation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>versionInformation<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>versionInformation<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">urldownloader</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>api<span class="token punctuation">.</span>updateAPP
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 获取最新版本失败</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">"less"</span> scoped<span class="token operator">&gt;</span>
  #app <span class="token punctuation">{<!-- --></span>
    font<span class="token operator">-</span>family<span class="token operator">:</span> <span class="token string">"Avenir"</span><span class="token punctuation">,</span> Helvetica<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans<span class="token operator">-</span>serif<span class="token punctuation">;</span>
    <span class="token operator">-</span>webkit<span class="token operator">-</span>font<span class="token operator">-</span>smoothing<span class="token operator">:</span> antialiased<span class="token punctuation">;</span>
    <span class="token operator">-</span>moz<span class="token operator">-</span>osx<span class="token operator">-</span>font<span class="token operator">-</span>smoothing<span class="token operator">:</span> grayscale<span class="token punctuation">;</span>
    text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> #2c3e50<span class="token punctuation">;</span>
    margin<span class="token operator">-</span>top<span class="token operator">:</span> 0px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc88fa8985c9e2b04ede80adb319761d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言volatile 关键字</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/906f71cef2e15a58d1badb33a0bf643a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">10 分钟教会你如何看懂 MySQL 执行计划</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>