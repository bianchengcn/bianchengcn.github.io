<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue &#43; websocket &#43; element  Notification 消息推送 - 编程中国的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue &#43; websocket &#43; element  Notification 消息推送" />
<meta property="og:description" content="vue&#43; element Notification消息推送 业务需求：
登录后进入页面，将后端推送过来的【待审批】的消息，用$notify弹出，并且，此推送消息的弹窗可以点击，跳转到审批页面，且展示这条【待审批】的详情弹窗，以供用户审批
首先：登录进入页面后，消息可以显示在任何页面，所以，这个消息推送的【通知】写在了App.vue页面中
然后：既然是消息推送，我们用到的是websocket，实时接收消息
再然后：消息推送的【通知】使用的是element的Notification
再然后~~ 上代码
// App.vue &lt;template&gt; &lt;div id=&#34;app&#34;&gt; &lt;transition name=&#34;fade&#34; mode=&#34;out-in&#34;&gt; &lt;router-view/&gt; &lt;/transition&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; import Cookie from &#34;js-cookie&#34;; export default { name: &#34;App&#34;, data() { return { socUrl: &#34;localhost:8080&#34; }; }, created() { this.initWebSocket(); }, methods: { initWebSocket() { this.$http .service({ method: &#34;get&#34;, url: &#34;/user/current&#34;, data: { user: Cookie.get(&#34;user&#34;) } }) .then(res =&gt; { const resData = res.data.data; // ws是一定要写的，this.socUrl ：是后端的IP // &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/d1210ed2a05c47c910c8f213eb7d2d8b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-22T16:39:17+08:00" />
<meta property="article:modified_time" content="2021-04-22T16:39:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程中国的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程中国的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue &#43; websocket &#43; element  Notification 消息推送</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="vue_element__Notification_0"></a>vue+ element Notification消息推送</h3> 
<p>业务需求：<br> 登录后进入页面，将后端推送过来的【待审批】的消息，用$notify弹出，并且，此推送消息的弹窗可以点击，跳转到审批页面，且展示这条【待审批】的详情弹窗，以供用户审批</p> 
<hr> 
<p>首先：登录进入页面后，消息可以显示在任何页面，所以，这个消息推送的【通知】写在了App.vue页面中<br> 然后：既然是消息推送，我们用到的是websocket，实时接收消息<br> 再然后：消息推送的【通知】使用的是element的Notification<br> 再然后~~ 上代码</p> 
<pre><code>// App.vue
&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;transition name="fade" mode="out-in"&gt;
      &lt;router-view/&gt;
    &lt;/transition&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import Cookie from "js-cookie";

export default {
  name: "App",
  data() {
    return {
      socUrl: "localhost:8080"
    };
  },
  created() {
    this.initWebSocket();
  },
  methods: {
    initWebSocket() {
      this.$http
        .service({
          method: "get",
          url: "/user/current",
          data: {
            user: Cookie.get("user")
          }
        })
        .then(res =&gt; {
          const resData = res.data.data;
          // ws是一定要写的，this.socUrl ：是后端的IP
		// "/imserver/" + resData.pkId 是后端给的接口和要传的Id
          let socUrl = "ws:" + this.socUrl + "/imserver/" + resData.pkId;
          this.webSocket = new WebSocket(socUrl);
          this.webSocket.onopen = event =&gt; {
            console.log("event", event.data);
          };
			
			//建立连接成功，就可以推送消息，通知用户了
          this.webSocket.onmessage = event =&gt; {
            if (str != '连接成功') {
              const h = this.$createElement;
              this.$notify({
                title: "审批任务",
                message: h("i", { style: "color: teal" }, event.data),
                onClick:()=&gt; {
                  console.log("点击事件");
                  this.messageGoPath();
                  
                }
              });
            } else {
              console.log("无待办审批任务");
            }
          };
          this.webSocket.onclose = event =&gt; {
            console.log("关闭连接");
          };
          // this.webSocket.send
          if (typeof WebSocket != "function") {
            alert("您的浏览器不支持websocket");
          }
          if (typeof WebSocket != "undefined") {
            console.log("您的浏览器支持websocket通信协议");
          }
        });
    },
    messageGoPath() {
      
     
    },
    websockonmessage() {
      console.log("数据接收");
    }
  },
};
&lt;/script&gt;

&lt;style&gt;
#app {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: url("./assets/bg2.png");
  background-size: 100% 100%;
  /*禁止滚动*/
  /*overflow: hidden;*/
}
&lt;/style&gt;
</code></pre> 
<p>因为要在点击的时候根据Id打开这条待审批消息的详情弹窗，并且跳转到这个审批页面<br> 所以~~ 上代码</p> 
<pre><code>// App.vue
methods:{
	messageGoPath() {
      let _this = this;
      _this.$router.push({
	        path: `/demo2/mySp`,
	        query: {
	          afterStrId: this.afterStr,
	        },
      });
      this.reload();	//在这里加一个刷新，解决弹窗重复显示的问题
      console.log("走这里吗", this.$router);
    },
}

</code></pre> 
<pre><code>//审批页面.vue
created() {
// 页面加载时，如果携带了推送消息的id就调用接口 两个id相等，
// 就绑定数据，且显示弹窗
    if (this.$route.query.afterStrId ) {
      this.$http
        .service({
          method: "get",
          url: "/task/getTaskTableById/" + this.$route.query.afterStrId
        })
        .then(res =&gt; {
          if (this.$route.query.afterStrId == res.data.data.id) {
            this.addDataSp = res.data.data
            this.addRowsSp = true;
          }
        });
    }else{
      this.addRowsSp = false;
    }
  },
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5cb6f156e5bb42231c91297f0243206c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue3.0 ts版项目配置axios</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49f4703c45bf2ce3f19de623ff8b5800/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">冯诺依曼结构、哈佛结构、改进型哈佛结构</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程中国的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>